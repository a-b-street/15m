var FL=Object.defineProperty;var BL=(t,e,n)=>e in t?FL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var gi=(t,e,n)=>(BL(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function gt(){}function VL(t,e){for(const n in e)t[n]=e[n];return t}function UL(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function XS(t){return t()}function ex(){return Object.create(null)}function Ni(t){t.forEach(XS)}function gy(t){return typeof t=="function"}function Gt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let sg;function Eo(t,e){return t===e?!0:(sg||(sg=document.createElement("a")),sg.href=e,t===sg.href)}function GL(t){return Object.keys(t).length===0}function YS(t,...e){if(t==null){for(const r of e)r(void 0);return gt}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function KS(t){let e;return YS(t,n=>e=n)(),e}function Lt(t,e,n){t.$$.on_destroy.push(YS(e,n))}function ri(t,e,n,r){if(t){const i=JS(t,e,n,r);return t[0](i)}}function JS(t,e,n,r){return t[1]&&r?VL(n.ctx.slice(),t[1](r(e))):n.ctx}function ii(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const a=[],c=Math.max(e.dirty.length,i.length);for(let u=0;u<c;u+=1)a[u]=e.dirty[u]|i[u];return a}return e.dirty|i}return e.dirty}function oi(t,e,n,r,i,a){if(i){const c=JS(e,n,r,a);t.p(c,i)}}function si(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function qL(t){const e={};for(const n in t)e[n]=!0;return e}function Dg(t){return t??""}function Wn(t,e,n){return t.set(n),e}function E0(t){return t&&gy(t.destroy)?t.destroy:gt}const jL=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Le(t,e){t.appendChild(e)}function ke(t,e,n){t.insertBefore(e,n||null)}function Me(t){t.parentNode&&t.parentNode.removeChild(t)}function Pa(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function Ne(t){return document.createElement(t)}function jl(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Mt(t){return document.createTextNode(t)}function at(){return Mt(" ")}function Yr(){return Mt("")}function Wt(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function WL(t){return function(e){return e.preventDefault(),t.call(this,e)}}function Z_(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function Ve(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function HL(t){return t===""?null:+t}function ZL(t){return Array.from(t.childNodes)}function Hn(t,e){e=""+e,t.data!==e&&(t.data=e)}function Go(t,e){t.value=e??""}function Si(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Rg(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function QS(t){const e=t.querySelector(":checked");return e&&e.__value}function sl(t,e,n){t.classList.toggle(e,!!n)}function XL(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let vd;function Ul(t){vd=t}function Ff(){if(!vd)throw new Error("Function called outside component initialization");return vd}function qu(t){Ff().$$.on_mount.push(t)}function as(t){Ff().$$.on_destroy.push(t)}function ju(){const t=Ff();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const a=XL(e,n,{cancelable:r});return i.slice().forEach(c=>{c.call(t,a)}),!a.defaultPrevented}return!0}}function _v(t,e){return Ff().$$.context.set(t,e),e}function vv(t){return Ff().$$.context.get(t)}function In(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const ef=[],Zn=[];let af=[];const I0=[],$S=Promise.resolve();let C0=!1;function eE(){C0||(C0=!0,$S.then(bv))}function tE(){return eE(),$S}function bd(t){af.push(t)}function so(t){I0.push(t)}const X_=new Set;let Xh=0;function bv(){if(Xh!==0)return;const t=vd;do{try{for(;Xh<ef.length;){const e=ef[Xh];Xh++,Ul(e),YL(e.$$)}}catch(e){throw ef.length=0,Xh=0,e}for(Ul(null),ef.length=0,Xh=0;Zn.length;)Zn.pop()();for(let e=0;e<af.length;e+=1){const n=af[e];X_.has(n)||(X_.add(n),n())}af.length=0}while(ef.length);for(;I0.length;)I0.pop()();C0=!1,X_.clear(),Ul(t)}function YL(t){if(t.fragment!==null){t.update(),Ni(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(bd)}}function KL(t){const e=[],n=[];af.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),af=e}const bg=new Set;let Sc;function On(){Sc={r:0,c:[],p:Sc}}function zn(){Sc.r||Ni(Sc.c),Sc=Sc.p}function be(t,e){t&&t.i&&(bg.delete(t),t.i(e))}function Te(t,e,n,r){if(t&&t.o){if(bg.has(t))return;bg.add(t),Sc.c.push(()=>{bg.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function tx(t,e){const n=e.token={};function r(i,a,c,u){if(e.token!==n)return;e.resolved=u;let m=e.ctx;c!==void 0&&(m=m.slice(),m[c]=u);const w=i&&(e.current=i)(m);let S=!1;e.block&&(e.blocks?e.blocks.forEach((E,P)=>{P!==a&&E&&(On(),Te(E,1,1,()=>{e.blocks[P]===E&&(e.blocks[P]=null)}),zn())}):e.block.d(1),w.c(),be(w,1),w.m(e.mount(),e.anchor),S=!0),e.block=w,e.blocks&&(e.blocks[a]=w),S&&bv()}if(UL(t)){const i=Ff();if(t.then(a=>{Ul(i),r(e.then,1,e.value,a),Ul(null)},a=>{if(Ul(i),r(e.catch,2,e.error,a),Ul(null),!e.hasCatch)throw a}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function JL(t,e,n){const r=e.slice(),{resolved:i}=t;t.current===t.then&&(r[t.value]=i),t.current===t.catch&&(r[t.error]=i),t.block.p(r,n)}function zr(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function QL(t,e){Te(t,1,1,()=>{e.delete(t.key)})}function $L(t,e,n,r,i,a,c,u,m,w,S,E){let P=t.length,D=a.length,k=P;const V={};for(;k--;)V[t[k].key]=k;const j=[],te=new Map,U=new Map,W=[];for(k=D;k--;){const se=E(i,a,k),ce=n(se);let me=c.get(ce);me?r&&W.push(()=>me.p(se,e)):(me=w(ce,se),me.c()),te.set(ce,j[k]=me),ce in V&&U.set(ce,Math.abs(k-V[ce]))}const Y=new Set,oe=new Set;function _e(se){be(se,1),se.m(u,S),c.set(se.key,se),S=se.first,D--}for(;P&&D;){const se=j[D-1],ce=t[P-1],me=se.key,Ce=ce.key;se===ce?(S=se.first,P--,D--):te.has(Ce)?!c.has(me)||Y.has(me)?_e(se):oe.has(Ce)?P--:U.get(me)>U.get(Ce)?(oe.add(me),_e(se)):(Y.add(Ce),P--):(m(ce,c),P--)}for(;P--;){const se=t[P];te.has(se.key)||m(se,c)}for(;D;)_e(j[D-1]);return Ni(W),j}function ao(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function lt(t){t&&t.c()}function it(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),bd(()=>{const a=t.$$.on_mount.map(XS).filter(gy);t.$$.on_destroy?t.$$.on_destroy.push(...a):Ni(a),t.$$.on_mount=[]}),i.forEach(bd)}function ot(t,e){const n=t.$$;n.fragment!==null&&(KL(n.after_update),Ni(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function eP(t,e){t.$$.dirty[0]===-1&&(ef.push(t),eE(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Jt(t,e,n,r,i,a,c=null,u=[-1]){const m=vd;Ul(t);const w=t.$$={fragment:null,ctx:[],props:a,update:gt,not_equal:i,bound:ex(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(m?m.$$.context:[])),callbacks:ex(),dirty:u,skip_bound:!1,root:e.target||m.$$.root};c&&c(w.root);let S=!1;if(w.ctx=n?n(t,e.props||{},(E,P,...D)=>{const k=D.length?D[0]:P;return w.ctx&&i(w.ctx[E],w.ctx[E]=k)&&(!w.skip_bound&&w.bound[E]&&w.bound[E](k),S&&eP(t,E)),P}):[],w.update(),S=!0,Ni(w.before_update),w.fragment=r?r(w.ctx):!1,e.target){if(e.hydrate){const E=ZL(e.target);w.fragment&&w.fragment.l(E),E.forEach(Me)}else w.fragment&&w.fragment.c();e.intro&&be(t.$$.fragment),it(t,e.target,e.anchor),bv()}Ul(m)}class Qt{constructor(){gi(this,"$$");gi(this,"$$set")}$destroy(){ot(this,1),this.$destroy=gt}$on(e,n){if(!gy(n))return gt;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!GL(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const tP="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(tP);const nP="/15m/assets/logo_dark-ed08d841.svg";const rP=t=>({dialog:t&1}),nx=t=>({dialog:t[0]});function iP(t){let e,n,r,i,a;const c=t[4].default,u=ri(c,t,t[3],nx);return{c(){e=Ne("dialog"),n=Ne("article"),u&&u.c(),e.open=!0},m(m,w){ke(m,e,w),Le(e,n),u&&u.m(n,null),t[6](e),r=!0,i||(a=[Wt(window,"click",t[1]),Wt(window,"keydown",t[2]),Wt(e,"close",t[5])],i=!0)},p(m,[w]){u&&u.p&&(!r||w&9)&&oi(u,c,m,m[3],r?ii(c,m[3],w,rP):si(m[3]),nx)},i(m){r||(be(u,m),r=!0)},o(m){Te(u,m),r=!1},d(m){m&&Me(e),u&&u.d(m),t[6](null),i=!1,Ni(a)}}}function oP(t,e,n){let{$$slots:r={},$$scope:i}=e,a;function c(S){a.open&&S.target==a&&a.close()}function u(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),a.close())}function m(S){In.call(this,t,S)}function w(S){Zn[S?"unshift":"push"](()=>{a=S,n(0,a)})}return t.$$set=S=>{"$$scope"in S&&n(3,i=S.$$scope)},[a,c,u,i,r,m,w]}class xv extends Qt{constructor(e){super(),Jt(this,e,oP,iP,Gt,{})}}function rx(t,e,n){const r=t.slice();return r[1]=e[n][0],r[2]=e[n][1],r}function ix(t){let e,n,r=t[1]+"",i,a,c,u=t[2]+"",m,w;return{c(){e=Ne("tr"),n=Ne("td"),i=Mt(r),a=at(),c=Ne("td"),m=Mt(u),w=at()},m(S,E){ke(S,e,E),Le(e,n),Le(n,i),Le(e,a),Le(e,c),Le(c,m),Le(e,w)},p(S,E){E&1&&r!==(r=S[1]+"")&&Hn(i,r),E&1&&u!==(u=S[2]+"")&&Hn(m,u)},d(S){S&&Me(e)}}}function sP(t){let e,n,r=zr(Object.entries(t[0])),i=[];for(let a=0;a<r.length;a+=1)i[a]=ix(rx(t,r,a));return{c(){e=Ne("table"),n=Ne("tbody");for(let a=0;a<i.length;a+=1)i[a].c();Ve(e,"class","svelte-lh2o9l")},m(a,c){ke(a,e,c),Le(e,n);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(n,null)},p(a,[c]){if(c&1){r=zr(Object.entries(a[0]));let u;for(u=0;u<r.length;u+=1){const m=rx(a,r,u);i[u]?i[u].p(m,c):(i[u]=ix(m),i[u].c(),i[u].m(n,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=r.length}},i:gt,o:gt,d(a){a&&Me(e),Pa(i,a)}}}function aP(t,e,n){let{properties:r}=e;return t.$$set=i=>{"properties"in i&&n(0,r=i.properties)},[r]}class wv extends Qt{constructor(e){super(),Jt(this,e,aP,sP,Gt,{properties:0})}}function ox(t,e,n){const r=t.slice();return r[3]=e[n],r}function sx(t,e,n){const r=t.slice();return r[6]=e[n],r}function ax(t){let e,n;return{c(){e=Ne("span"),n=Mt(` 
    `),Si(e,"background",t[6]),Si(e,"width","100%"),Si(e,"border","1px solid black")},m(r,i){ke(r,e,i),Le(e,n)},p(r,i){i&1&&Si(e,"background",r[6])},d(r){r&&Me(e)}}}function lP(t){let e,n=t[3]+"",r;return{c(){e=Ne("span"),r=Mt(n)},m(i,a){ke(i,e,a),Le(e,r)},p(i,a){a&2&&n!==(n=i[3]+"")&&Hn(r,n)},d(i){i&&Me(e)}}}function uP(t){let e,n=t[3].toFixed(t[2])+"",r;return{c(){e=Ne("span"),r=Mt(n)},m(i,a){ke(i,e,a),Le(e,r)},p(i,a){a&6&&n!==(n=i[3].toFixed(i[2])+"")&&Hn(r,n)},d(i){i&&Me(e)}}}function lx(t){let e;function n(a,c){return a[2]>0?uP:lP}let r=n(t),i=r(t);return{c(){i.c(),e=Yr()},m(a,c){i.m(a,c),ke(a,e,c)},p(a,c){r===(r=n(a))&&i?i.p(a,c):(i.d(1),i=r(a),i&&(i.c(),i.m(e.parentNode,e)))},d(a){a&&Me(e),i.d(a)}}}function cP(t){let e,n,r,i=zr(t[0]),a=[];for(let m=0;m<i.length;m+=1)a[m]=ax(sx(t,i,m));let c=zr(t[1]),u=[];for(let m=0;m<c.length;m+=1)u[m]=lx(ox(t,c,m));return{c(){e=Ne("div");for(let m=0;m<a.length;m+=1)a[m].c();n=at(),r=Ne("div");for(let m=0;m<u.length;m+=1)u[m].c();Si(e,"display","flex"),Si(r,"display","flex"),Si(r,"justify-content","space-between")},m(m,w){ke(m,e,w);for(let S=0;S<a.length;S+=1)a[S]&&a[S].m(e,null);ke(m,n,w),ke(m,r,w);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(r,null)},p(m,[w]){if(w&1){i=zr(m[0]);let S;for(S=0;S<i.length;S+=1){const E=sx(m,i,S);a[S]?a[S].p(E,w):(a[S]=ax(E),a[S].c(),a[S].m(e,null))}for(;S<a.length;S+=1)a[S].d(1);a.length=i.length}if(w&6){c=zr(m[1]);let S;for(S=0;S<c.length;S+=1){const E=ox(m,c,S);u[S]?u[S].p(E,w):(u[S]=lx(E),u[S].c(),u[S].m(r,null))}for(;S<u.length;S+=1)u[S].d(1);u.length=c.length}},i:gt,o:gt,d(m){m&&(Me(e),Me(n),Me(r)),Pa(a,m),Pa(u,m)}}}function hP(t,e,n){let{colorScale:r}=e,{limits:i}=e,{decimalPlaces:a=0}=e;return t.$$set=c=>{"colorScale"in c&&n(0,r=c.colorScale),"limits"in c&&n(1,i=c.limits),"decimalPlaces"in c&&n(2,a=c.decimalPlaces)},[r,i,a]}class nE extends Qt{constructor(e){super(),Jt(this,e,hP,cP,Gt,{colorScale:0,limits:1,decimalPlaces:2})}}function ul(t){if(t==null||t==null)throw new Error("Oops, notNull given something null");return t}const Yh=[];function Y_(t,e){return{subscribe:sr(t,e).subscribe}}function sr(t,e=gt){let n;const r=new Set;function i(u){if(Gt(t,u)&&(t=u,n)){const m=!Yh.length;for(const w of r)w[1](),Yh.push(w,t);if(m){for(let w=0;w<Yh.length;w+=2)Yh[w][0](Yh[w+1]);Yh.length=0}}}function a(u){i(u(t))}function c(u,m=gt){const w=[u,m];return r.add(w),r.size===1&&(n=e(i,a)||gt),u(t),()=>{r.delete(w),r.size===0&&n&&(n(),n=null)}}return{set:i,update:a,subscribe:c}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const rE=Symbol("Comlink.proxy"),fP=Symbol("Comlink.endpoint"),pP=Symbol("Comlink.releaseProxy"),K_=Symbol("Comlink.finalizer"),xg=Symbol("Comlink.thrown"),iE=t=>typeof t=="object"&&t!==null||typeof t=="function",dP={canHandle:t=>iE(t)&&t[rE],serialize(t){const{port1:e,port2:n}=new MessageChannel;return Sv(t,e),[n,[n]]},deserialize(t){return t.start(),aE(t)}},mP={canHandle:t=>iE(t)&&xg in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},oE=new Map([["proxy",dP],["throw",mP]]);function gP(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function Sv(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!gP(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:c,path:u}=Object.assign({path:[]},i.data),m=(i.data.argumentList||[]).map(wc);let w;try{const S=u.slice(0,-1).reduce((P,D)=>P[D],t),E=u.reduce((P,D)=>P[D],t);switch(c){case"GET":w=E;break;case"SET":S[u.slice(-1)[0]]=wc(i.data.value),w=!0;break;case"APPLY":w=E.apply(S,m);break;case"CONSTRUCT":{const P=new E(...m);w=Ev(P)}break;case"ENDPOINT":{const{port1:P,port2:D}=new MessageChannel;Sv(t,D),w=xP(P,[P])}break;case"RELEASE":w=void 0;break;default:return}}catch(S){w={value:S,[xg]:0}}Promise.resolve(w).catch(S=>({value:S,[xg]:0})).then(S=>{const[E,P]=zg(S);e.postMessage(Object.assign(Object.assign({},E),{id:a}),P),c==="RELEASE"&&(e.removeEventListener("message",r),sE(e),K_ in t&&typeof t[K_]=="function"&&t[K_]())}).catch(S=>{const[E,P]=zg({value:new TypeError("Unserializable return value"),[xg]:0});e.postMessage(Object.assign(Object.assign({},E),{id:a}),P)})}),e.start&&e.start()}function yP(t){return t.constructor.name==="MessagePort"}function sE(t){yP(t)&&t.close()}function aE(t,e){return T0(t,[],e)}function ag(t){if(t)throw new Error("Proxy has been released and is not useable")}function lE(t){return tf(t,{type:"RELEASE"}).then(()=>{sE(t)})}const Ng=new WeakMap,Og="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Ng.get(t)||0)-1;Ng.set(t,e),e===0&&lE(t)});function _P(t,e){const n=(Ng.get(e)||0)+1;Ng.set(e,n),Og&&Og.register(t,e,t)}function vP(t){Og&&Og.unregister(t)}function T0(t,e=[],n=function(){}){let r=!1;const i=new Proxy(n,{get(a,c){if(ag(r),c===pP)return()=>{vP(i),lE(t),r=!0};if(c==="then"){if(e.length===0)return{then:()=>i};const u=tf(t,{type:"GET",path:e.map(m=>m.toString())}).then(wc);return u.then.bind(u)}return T0(t,[...e,c])},set(a,c,u){ag(r);const[m,w]=zg(u);return tf(t,{type:"SET",path:[...e,c].map(S=>S.toString()),value:m},w).then(wc)},apply(a,c,u){ag(r);const m=e[e.length-1];if(m===fP)return tf(t,{type:"ENDPOINT"}).then(wc);if(m==="bind")return T0(t,e.slice(0,-1));const[w,S]=ux(u);return tf(t,{type:"APPLY",path:e.map(E=>E.toString()),argumentList:w},S).then(wc)},construct(a,c){ag(r);const[u,m]=ux(c);return tf(t,{type:"CONSTRUCT",path:e.map(w=>w.toString()),argumentList:u},m).then(wc)}});return _P(i,t),i}function bP(t){return Array.prototype.concat.apply([],t)}function ux(t){const e=t.map(zg);return[e.map(n=>n[0]),bP(e.map(n=>n[1]))]}const uE=new WeakMap;function xP(t,e){return uE.set(t,e),t}function Ev(t){return Object.assign(t,{[rE]:!0})}function zg(t){for(const[e,n]of oE)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},uE.get(t)||[]]}function wc(t){switch(t.type){case"HANDLER":return oE.get(t.name).deserialize(t.value);case"RAW":return t.value}}function tf(t,e,n){return new Promise(r=>{const i=wP();t.addEventListener("message",function a(c){!c.data||!c.data.id||c.data.id!==i||(t.removeEventListener("message",a),r(c.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:i},e),n)})}function wP(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let cn;const Vl=new Array(128).fill(void 0);Vl.push(void 0,null,!0,!1);function dn(t){return Vl[t]}let hd=Vl.length;function SP(t){t<132||(Vl[t]=hd,hd=t)}function xc(t){const e=dn(t);return SP(t),e}let Ec=0,od=null;function fd(){return(od===null||od.byteLength===0)&&(od=new Uint8Array(cn.memory.buffer)),od}const wg=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},EP=typeof wg.encodeInto=="function"?function(t,e){return wg.encodeInto(t,e)}:function(t,e){const n=wg.encode(t);return e.set(n),{read:t.length,written:n.length}};function J_(t,e,n){if(n===void 0){const u=wg.encode(t),m=e(u.length,1)>>>0;return fd().subarray(m,m+u.length).set(u),Ec=u.length,m}let r=t.length,i=e(r,1)>>>0;const a=fd();let c=0;for(;c<r;c++){const u=t.charCodeAt(c);if(u>127)break;a[i+c]=u}if(c!==r){c!==0&&(t=t.slice(c)),i=n(i,r,r=c+t.length*3,1)>>>0;const u=fd().subarray(i+c,i+r),m=EP(t,u);c+=m.written,i=n(i,r,c,1)>>>0}return Ec=c,i}function pd(t){return t==null}let sd=null;function qn(){return(sd===null||sd.byteLength===0)&&(sd=new Int32Array(cn.memory.buffer)),sd}let ad=null;function cE(){return(ad===null||ad.byteLength===0)&&(ad=new Float64Array(cn.memory.buffer)),ad}const hE=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&hE.decode();function ol(t,e){return t=t>>>0,hE.decode(fd().subarray(t,t+e))}function or(t){hd===Vl.length&&Vl.push(Vl.length+1);const e=hd;return hd=Vl[e],Vl[e]=t,e}function L0(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const i=t.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=t.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(t)){const i=t.length;let a="[";i>0&&(a+=L0(t[0]));for(let c=1;c<i;c++)a+=", "+L0(t[c]);return a+="]",a}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}function IP(t,e){const n=e(t.length*1,1)>>>0;return fd().set(t,n/1),Ec=t.length,n}function CP(t,e){return t=t>>>0,cE().subarray(t/8,t/8+e)}function Su(t,e){try{return t.apply(this,e)}catch(n){cn.__wbindgen_exn_store(or(n))}}const TP=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>cn.__wbg_mapmodel_free(t>>>0));class cx{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,TP.unregister(this),e}free(){const e=this.__destroy_into_raw();cn.__wbg_mapmodel_free(e)}constructor(e,n,r){try{const u=cn.__wbindgen_add_to_stack_pointer(-16),m=IP(e,cn.__wbindgen_malloc),w=Ec;cn.mapmodel_new(u,m,w,n,pd(r)?0:or(r));var i=qn()[u/4+0],a=qn()[u/4+1],c=qn()[u/4+2];if(c)throw xc(a);return this.__wbg_ptr=i>>>0,this}finally{cn.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,n;try{const w=cn.__wbindgen_add_to_stack_pointer(-16);cn.mapmodel_renderDebug(w,this.__wbg_ptr);var r=qn()[w/4+0],i=qn()[w/4+1],a=qn()[w/4+2],c=qn()[w/4+3],u=r,m=i;if(c)throw u=0,m=0,xc(a);return e=u,n=m,ol(u,m)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(e,n,1)}}getInvertedBoundary(){let e,n;try{const w=cn.__wbindgen_add_to_stack_pointer(-16);cn.mapmodel_getInvertedBoundary(w,this.__wbg_ptr);var r=qn()[w/4+0],i=qn()[w/4+1],a=qn()[w/4+2],c=qn()[w/4+3],u=r,m=i;if(c)throw u=0,m=0,xc(a);return e=u,n=m,ol(u,m)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(e,n,1)}}getBounds(){try{const i=cn.__wbindgen_add_to_stack_pointer(-16);cn.mapmodel_getBounds(i,this.__wbg_ptr);var e=qn()[i/4+0],n=qn()[i/4+1],r=CP(e,n).slice();return cn.__wbindgen_free(e,n*8,8),r}finally{cn.__wbindgen_add_to_stack_pointer(16)}}isochrone(e){let n,r;try{const S=cn.__wbindgen_add_to_stack_pointer(-16);cn.mapmodel_isochrone(S,this.__wbg_ptr,or(e));var i=qn()[S/4+0],a=qn()[S/4+1],c=qn()[S/4+2],u=qn()[S/4+3],m=i,w=a;if(u)throw m=0,w=0,xc(c);return n=m,r=w,ol(m,w)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(n,r,1)}}route(e){let n,r;try{const S=cn.__wbindgen_add_to_stack_pointer(-16);cn.mapmodel_route(S,this.__wbg_ptr,or(e));var i=qn()[S/4+0],a=qn()[S/4+1],c=qn()[S/4+2],u=qn()[S/4+3],m=i,w=a;if(u)throw m=0,w=0,xc(c);return n=m,r=w,ol(m,w)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(n,r,1)}}score(e,n){let r,i;try{const E=cn.__wbindgen_add_to_stack_pointer(-16);cn.mapmodel_score(E,this.__wbg_ptr,or(e),pd(n)?0:or(n));var a=qn()[E/4+0],c=qn()[E/4+1],u=qn()[E/4+2],m=qn()[E/4+3],w=a,S=c;if(m)throw w=0,S=0,xc(u);return r=w,i=S,ol(w,S)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(r,i,1)}}}async function LP(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function PP(){const t={};return t.wbg={},t.wbg.__wbindgen_object_drop_ref=function(e){xc(e)},t.wbg.__wbindgen_string_get=function(e,n){const r=dn(n),i=typeof r=="string"?r:void 0;var a=pd(i)?0:J_(i,cn.__wbindgen_malloc,cn.__wbindgen_realloc),c=Ec;qn()[e/4+1]=c,qn()[e/4+0]=a},t.wbg.__wbindgen_boolean_get=function(e){const n=dn(e);return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_is_object=function(e){const n=dn(e);return typeof n=="object"&&n!==null},t.wbg.__wbindgen_is_undefined=function(e){return dn(e)===void 0},t.wbg.__wbindgen_in=function(e,n){return dn(e)in dn(n)},t.wbg.__wbindgen_number_get=function(e,n){const r=dn(n),i=typeof r=="number"?r:void 0;cE()[e/8+1]=pd(i)?0:i,qn()[e/4+0]=!pd(i)},t.wbg.__wbindgen_error_new=function(e,n){const r=new Error(ol(e,n));return or(r)},t.wbg.__wbindgen_string_new=function(e,n){const r=ol(e,n);return or(r)},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return dn(e)==dn(n)},t.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,n){const r=dn(e)[dn(n)];return or(r)},t.wbg.__wbindgen_object_clone_ref=function(e){const n=dn(e);return or(n)},t.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(dn(e))},t.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(dn(e))},t.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(dn(e))},t.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(dn(e))},t.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(dn(e))},t.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return or(e)},t.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const r=dn(n).stack,i=J_(r,cn.__wbindgen_malloc,cn.__wbindgen_realloc),a=Ec;qn()[e/4+1]=a,qn()[e/4+0]=i},t.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let r,i;try{r=e,i=n,console.error(ol(e,n))}finally{cn.__wbindgen_free(r,i,1)}},t.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const n=dn(e).performance;return or(n)},t.wbg.__wbg_now_abd80e969af37148=function(e){return dn(e).now()},t.wbg.__wbg_get_bd8e338fbd5f5cc8=function(e,n){const r=dn(e)[n>>>0];return or(r)},t.wbg.__wbg_length_cd7af8117672b8b8=function(e){return dn(e).length},t.wbg.__wbindgen_is_function=function(e){return typeof dn(e)=="function"},t.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,n){const r=new Function(ol(e,n));return or(r)},t.wbg.__wbg_next_40fc327bfc8770e6=function(e){const n=dn(e).next;return or(n)},t.wbg.__wbg_next_196c84450b364254=function(){return Su(function(e){const n=dn(e).next();return or(n)},arguments)},t.wbg.__wbg_done_298b57d23c0fc80c=function(e){return dn(e).done},t.wbg.__wbg_value_d93c65011f51a456=function(e){const n=dn(e).value;return or(n)},t.wbg.__wbg_iterator_2cee6dadfd956dfa=function(){return or(Symbol.iterator)},t.wbg.__wbg_get_e3c254076557e348=function(){return Su(function(e,n){const r=Reflect.get(dn(e),dn(n));return or(r)},arguments)},t.wbg.__wbg_call_27c0f87801dedf93=function(){return Su(function(e,n){const r=dn(e).call(dn(n));return or(r)},arguments)},t.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return Su(function(){const e=self.self;return or(e)},arguments)},t.wbg.__wbg_window_c6fb939a7f436783=function(){return Su(function(){const e=window.window;return or(e)},arguments)},t.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return Su(function(){const e=globalThis.globalThis;return or(e)},arguments)},t.wbg.__wbg_global_207b558942527489=function(){return Su(function(){const e=global.global;return or(e)},arguments)},t.wbg.__wbg_isArray_2ab64d95e09ea0ae=function(e){return Array.isArray(dn(e))},t.wbg.__wbg_instanceof_ArrayBuffer_836825be07d4c9d2=function(e){let n;try{n=dn(e)instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return Su(function(e,n,r){const i=dn(e).call(dn(n),dn(r));return or(i)},arguments)},t.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){const n=dn(e).buffer;return or(n)},t.wbg.__wbg_new_63b92bc8671ed464=function(e){const n=new Uint8Array(dn(e));return or(n)},t.wbg.__wbg_set_a47bac70306a19a7=function(e,n,r){dn(e).set(dn(n),r>>>0)},t.wbg.__wbg_length_c20a40f15020d68a=function(e){return dn(e).length},t.wbg.__wbg_instanceof_Uint8Array_2b3bbecd033d19f6=function(e){let n;try{n=dn(e)instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbindgen_debug_string=function(e,n){const r=L0(dn(n)),i=J_(r,cn.__wbindgen_malloc,cn.__wbindgen_realloc),a=Ec;qn()[e/4+1]=a,qn()[e/4+0]=i},t.wbg.__wbindgen_throw=function(e,n){throw new Error(ol(e,n))},t.wbg.__wbindgen_memory=function(){const e=cn.memory;return or(e)},t}function MP(t,e){return cn=t.exports,P0.__wbindgen_wasm_module=e,ad=null,sd=null,od=null,cn}async function P0(t){if(cn!==void 0)return cn;typeof t>"u"&&(t="/15m/assets/backend_bg.wasm");const e=PP();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:r}=await LP(await t,e);return MP(n,r)}class AP{constructor(){gi(this,"inner");this.inner=null}async loadOsmFile(e,n){await P0(),this.inner=new cx(e,!0,n)}async loadGraphFile(e){await P0(),this.inner=new cx(e,!1,void 0)}isLoaded(){return this.inner!=null}unset(){this.inner=null}getBounds(){if(!this.inner)throw new Error("Backend used without a file loaded");return Array.from(this.inner.getBounds())}getInvertedBoundary(){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.renderDebug())}isochrone(e){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.isochrone({x:e.start.lng,y:e.start.lat,mode:e.mode,contours:e.contours,start_time:e.startTime}))}route(e){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.route({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],mode:e.mode,debug_search:e.debugSearch,use_heuristic:e.useHeuristic,start_time:e.startTime}))}score(e,n){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.score({poi_kinds:e.poiKinds},n))}}Sv(AP);let fE="MZEJTanw3WpxRvt7qDfo",Ys=sr({kind:"title"}),yy=sr(null),Fg=sr(!0);function hx(t){return["!=",["get",`access_${t}`],"None"]}let hf=sr("foot"),Bg=sr("07:00"),Ic=sr(null),ff=sr(null),fx=sr(!0),Zl=sr(null),lf=sr(!1);function px(t){let e,n;return e=new xv({props:{$$slots:{default:[kP,({dialog:r})=>({3:r}),({dialog:r})=>r?8:0]},$$scope:{ctx:t}}}),e.$on("close",t[2]),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&24&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function kP(t){let e,n,r,i,a,c,u,m,w,S;function E(){return t[1](t[3])}return{c(){e=Ne("h1"),e.textContent="15-minute neighborhood tool",n=at(),r=Ne("p"),r.textContent="TODO. Extremely early in development.",i=at(),a=Ne("p"),a.innerHTML=`This <a href="https://github.com/a-b-street/15m/" target="_blank">open source</a>
      tool is created by
      <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a> data.`,c=at(),u=Ne("center"),m=Ne("button"),m.textContent="Start!"},m(P,D){ke(P,e,D),ke(P,n,D),ke(P,r,D),ke(P,i,D),ke(P,a,D),ke(P,c,D),ke(P,u,D),Le(u,m),w||(S=Wt(m,"click",E),w=!0)},p(P,D){t=P},d(P){P&&(Me(e),Me(n),Me(r),Me(i),Me(a),Me(c),Me(u)),w=!1,S()}}}function DP(t){let e,n,r=t[0]&&px(t);return{c(){r&&r.c(),e=Yr()},m(i,a){r&&r.m(i,a),ke(i,e,a),n=!0},p(i,[a]){i[0]?r?(r.p(i,a),a&1&&be(r,1)):(r=px(i),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(i)}}}function RP(t,e,n){let r;return Lt(t,Fg,c=>n(0,r=c)),[r,c=>ul(c).close(),()=>Wn(Fg,r=!1,r)]}class NP extends Qt{constructor(e){super(),Jt(this,e,RP,DP,Gt,{})}}var Gd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Iv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _y(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var dx=Object.prototype.toString,pE=function(e){var n=dx.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&dx.call(e.callee)==="[object Function]"),r},Q_,mx;function OP(){if(mx)return Q_;mx=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=pE,i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),c=i.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],m=function(P){var D=P.constructor;return D&&D.prototype===P},w={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},S=function(){if(typeof window>"u")return!1;for(var P in window)try{if(!w["$"+P]&&e.call(window,P)&&window[P]!==null&&typeof window[P]=="object")try{m(window[P])}catch{return!0}}catch{return!0}return!1}(),E=function(P){if(typeof window>"u"||!S)return m(P);try{return m(P)}catch{return!1}};t=function(D){var k=D!==null&&typeof D=="object",V=n.call(D)==="[object Function]",j=r(D),te=k&&n.call(D)==="[object String]",U=[];if(!k&&!V&&!j)throw new TypeError("Object.keys called on a non-object");var W=c&&V;if(te&&D.length>0&&!e.call(D,0))for(var Y=0;Y<D.length;++Y)U.push(String(Y));if(j&&D.length>0)for(var oe=0;oe<D.length;++oe)U.push(String(oe));else for(var _e in D)!(W&&_e==="prototype")&&e.call(D,_e)&&U.push(String(_e));if(a)for(var se=E(D),ce=0;ce<u.length;++ce)!(se&&u[ce]==="constructor")&&e.call(D,u[ce])&&U.push(u[ce]);return U}}return Q_=t,Q_}var zP=Array.prototype.slice,FP=pE,gx=Object.keys,Sg=gx?function(e){return gx(e)}:OP(),yx=Object.keys;Sg.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return FP(r)?yx(zP.call(r)):yx(r)})}else Object.keys=Sg;return Object.keys||Sg};var Cv=Sg,BP=Error,VP=EvalError,UP=RangeError,GP=ReferenceError,dE=SyntaxError,Wu=TypeError,qP=URIError,vy=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var c=Object.getOwnPropertyDescriptor(e,n);if(c.value!==i||c.enumerable!==!0)return!1}return!0},_x=typeof Symbol<"u"&&Symbol,jP=vy,Tv=function(){return typeof _x!="function"||typeof Symbol!="function"||typeof _x("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:jP()},$_={__proto__:null,foo:{}},WP=Object,HP=function(){return{__proto__:$_}.foo===$_.foo&&!($_ instanceof WP)},ZP="Function.prototype.bind called on incompatible ",XP=Object.prototype.toString,YP=Math.max,KP="[object Function]",vx=function(e,n){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var a=0;a<n.length;a+=1)r[a+e.length]=n[a];return r},JP=function(e,n){for(var r=[],i=n||0,a=0;i<e.length;i+=1,a+=1)r[a]=e[i];return r},QP=function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n},$P=function(e){var n=this;if(typeof n!="function"||XP.apply(n)!==KP)throw new TypeError(ZP+n);for(var r=JP(arguments,1),i,a=function(){if(this instanceof i){var S=n.apply(this,vx(r,arguments));return Object(S)===S?S:this}return n.apply(e,vx(r,arguments))},c=YP(0,n.length-r.length),u=[],m=0;m<c;m++)u[m]="$"+m;if(i=Function("binder","return function ("+QP(u,",")+"){ return binder.apply(this,arguments); }")(a),n.prototype){var w=function(){};w.prototype=n.prototype,i.prototype=new w,w.prototype=null}return i},eM=$P,Lv=Function.prototype.bind||eM,tM=Function.prototype.call,nM=Object.prototype.hasOwnProperty,rM=Lv,mE=rM.call(tM,nM),Nn,iM=BP,oM=VP,sM=UP,aM=GP,pf=dE,uf=Wu,lM=qP,gE=Function,e0=function(t){try{return gE('"use strict"; return ('+t+").constructor;")()}catch{}},Cc=Object.getOwnPropertyDescriptor;if(Cc)try{Cc({},"")}catch{Cc=null}var t0=function(){throw new uf},uM=Cc?function(){try{return arguments.callee,t0}catch{try{return Cc(arguments,"callee").get}catch{return t0}}}():t0,Kh=Tv(),cM=HP(),Vi=Object.getPrototypeOf||(cM?function(t){return t.__proto__}:null),nf={},hM=typeof Uint8Array>"u"||!Vi?Nn:Vi(Uint8Array),Tc={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Nn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Nn:ArrayBuffer,"%ArrayIteratorPrototype%":Kh&&Vi?Vi([][Symbol.iterator]()):Nn,"%AsyncFromSyncIteratorPrototype%":Nn,"%AsyncFunction%":nf,"%AsyncGenerator%":nf,"%AsyncGeneratorFunction%":nf,"%AsyncIteratorPrototype%":nf,"%Atomics%":typeof Atomics>"u"?Nn:Atomics,"%BigInt%":typeof BigInt>"u"?Nn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Nn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Nn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Nn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":iM,"%eval%":eval,"%EvalError%":oM,"%Float32Array%":typeof Float32Array>"u"?Nn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Nn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Nn:FinalizationRegistry,"%Function%":gE,"%GeneratorFunction%":nf,"%Int8Array%":typeof Int8Array>"u"?Nn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Nn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Nn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Kh&&Vi?Vi(Vi([][Symbol.iterator]())):Nn,"%JSON%":typeof JSON=="object"?JSON:Nn,"%Map%":typeof Map>"u"?Nn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Kh||!Vi?Nn:Vi(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Nn:Promise,"%Proxy%":typeof Proxy>"u"?Nn:Proxy,"%RangeError%":sM,"%ReferenceError%":aM,"%Reflect%":typeof Reflect>"u"?Nn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Nn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Kh||!Vi?Nn:Vi(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Nn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Kh&&Vi?Vi(""[Symbol.iterator]()):Nn,"%Symbol%":Kh?Symbol:Nn,"%SyntaxError%":pf,"%ThrowTypeError%":uM,"%TypedArray%":hM,"%TypeError%":uf,"%Uint8Array%":typeof Uint8Array>"u"?Nn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Nn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Nn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Nn:Uint32Array,"%URIError%":lM,"%WeakMap%":typeof WeakMap>"u"?Nn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Nn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Nn:WeakSet};if(Vi)try{null.error}catch(t){var fM=Vi(Vi(t));Tc["%Error.prototype%"]=fM}var pM=function t(e){var n;if(e==="%AsyncFunction%")n=e0("async function () {}");else if(e==="%GeneratorFunction%")n=e0("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=e0("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&Vi&&(n=Vi(i.prototype))}return Tc[e]=n,n},bx={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},qd=Lv,Vg=mE,dM=qd.call(Function.call,Array.prototype.concat),mM=qd.call(Function.apply,Array.prototype.splice),xx=qd.call(Function.call,String.prototype.replace),Ug=qd.call(Function.call,String.prototype.slice),gM=qd.call(Function.call,RegExp.prototype.exec),yM=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,_M=/\\(\\)?/g,vM=function(e){var n=Ug(e,0,1),r=Ug(e,-1);if(n==="%"&&r!=="%")throw new pf("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new pf("invalid intrinsic syntax, expected opening `%`");var i=[];return xx(e,yM,function(a,c,u,m){i[i.length]=u?xx(m,_M,"$1"):c||a}),i},bM=function(e,n){var r=e,i;if(Vg(bx,r)&&(i=bx[r],r="%"+i[0]+"%"),Vg(Tc,r)){var a=Tc[r];if(a===nf&&(a=pM(r)),typeof a>"u"&&!n)throw new uf("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:a}}throw new pf("intrinsic "+e+" does not exist!")},yl=function(e,n){if(typeof e!="string"||e.length===0)throw new uf("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new uf('"allowMissing" argument must be a boolean');if(gM(/^%?[^%]*%?$/,e)===null)throw new pf("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=vM(e),i=r.length>0?r[0]:"",a=bM("%"+i+"%",n),c=a.name,u=a.value,m=!1,w=a.alias;w&&(i=w[0],mM(r,dM([0,1],w)));for(var S=1,E=!0;S<r.length;S+=1){var P=r[S],D=Ug(P,0,1),k=Ug(P,-1);if((D==='"'||D==="'"||D==="`"||k==='"'||k==="'"||k==="`")&&D!==k)throw new pf("property names with quotes must have matching quotes");if((P==="constructor"||!E)&&(m=!0),i+="."+P,c="%"+i+"%",Vg(Tc,c))u=Tc[c];else if(u!=null){if(!(P in u)){if(!n)throw new uf("base intrinsic for "+e+" exists, but the property is not available.");return}if(Cc&&S+1>=r.length){var V=Cc(u,P);E=!!V,E&&"get"in V&&!("originalValue"in V.get)?u=V.get:u=u[P]}else E=Vg(u,P),u=u[P];E&&!m&&(Tc[c]=u)}}return u},n0,wx;function Pv(){if(wx)return n0;wx=1;var t=yl,e=t("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return n0=e,n0}var xM=yl,Eg=xM("%Object.getOwnPropertyDescriptor%",!0);if(Eg)try{Eg([],"length")}catch{Eg=null}var Mv=Eg,Sx=Pv(),wM=dE,Jh=Wu,Ex=Mv,Av=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new Jh("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new Jh("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Jh("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Jh("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Jh("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Jh("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,m=!!Ex&&Ex(e,n);if(Sx)Sx(e,n,{configurable:c===null&&m?m.configurable:!c,enumerable:i===null&&m?m.enumerable:!i,value:r,writable:a===null&&m?m.writable:!a});else if(u||!i&&!a&&!c)e[n]=r;else throw new wM("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},M0=Pv(),yE=function(){return!!M0};yE.hasArrayLengthDefineBug=function(){if(!M0)return null;try{return M0([],"length",{value:1}).length!==1}catch{return!0}};var kv=yE,SM=Cv,EM=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",IM=Object.prototype.toString,CM=Array.prototype.concat,Ix=Av,TM=function(t){return typeof t=="function"&&IM.call(t)==="[object Function]"},_E=kv(),LM=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!TM(r)||!r())return}_E?Ix(t,e,n,!0):Ix(t,e,n)},vE=function(t,e){var n=arguments.length>2?arguments[2]:{},r=SM(e);EM&&(r=CM.call(r,Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i+=1)LM(t,r[i],e[r[i]],n[r[i]])};vE.supportsDescriptors=!!_E;var qc=vE,bE={exports:{}},PM=yl,Cx=Av,MM=kv(),Tx=Mv,Lx=Wu,AM=PM("%Math.floor%"),kM=function(e,n){if(typeof e!="function")throw new Lx("`fn` is not a function");if(typeof n!="number"||n<0||n>4294967295||AM(n)!==n)throw new Lx("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],i=!0,a=!0;if("length"in e&&Tx){var c=Tx(e,"length");c&&!c.configurable&&(i=!1),c&&!c.writable&&(a=!1)}return(i||a||!r)&&(MM?Cx(e,"length",n,!0,!0):Cx(e,"length",n)),e};(function(t){var e=Lv,n=yl,r=kM,i=Wu,a=n("%Function.prototype.apply%"),c=n("%Function.prototype.call%"),u=n("%Reflect.apply%",!0)||e.call(c,a),m=Pv(),w=n("%Math.max%");t.exports=function(P){if(typeof P!="function")throw new i("a function is required");var D=u(e,c,arguments);return r(D,1+w(0,P.length-(arguments.length-1)),!0)};var S=function(){return u(e,a,arguments)};m?m(t.exports,"apply",{value:S}):t.exports.apply=S})(bE);var Bf=bE.exports,xE=yl,wE=Bf,DM=wE(xE("String.prototype.indexOf")),fa=function(e,n){var r=xE(e,!!n);return typeof r=="function"&&DM(e,".prototype.")>-1?wE(r):r},RM=Cv,SE=vy(),EE=fa,Px=Object,NM=EE("Array.prototype.push"),Mx=EE("Object.prototype.propertyIsEnumerable"),OM=SE?Object.getOwnPropertySymbols:null,IE=function(e,n){if(e==null)throw new TypeError("target must be an object");var r=Px(e);if(arguments.length===1)return r;for(var i=1;i<arguments.length;++i){var a=Px(arguments[i]),c=RM(a),u=SE&&(Object.getOwnPropertySymbols||OM);if(u)for(var m=u(a),w=0;w<m.length;++w){var S=m[w];Mx(a,S)&&NM(c,S)}for(var E=0;E<c.length;++E){var P=c[E];if(Mx(a,P)){var D=a[P];r[P]=D}}}return r},r0=IE,zM=function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),n={},r=0;r<e.length;++r)n[e[r]]=e[r];var i=Object.assign({},n),a="";for(var c in i)a+=c;return t!==a},FM=function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch{return t[1]==="y"}return!1},CE=function(){return!Object.assign||zM()||FM()?r0:Object.assign},BM=qc,VM=CE,UM=function(){var e=VM();return BM(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},GM=qc,qM=Bf,jM=IE,TE=CE,WM=UM,HM=qM.apply(TE()),LE=function(e,n){return HM(Object,arguments)};GM(LE,{getPolyfill:TE,implementation:jM,shim:WM});var ZM=LE,xd=function(){return typeof(function(){}).name=="string"},dd=Object.getOwnPropertyDescriptor;if(dd)try{dd([],"length")}catch{dd=null}xd.functionsHaveConfigurableNames=function(){if(!xd()||!dd)return!1;var e=dd(function(){},"name");return!!e&&!!e.configurable};var XM=Function.prototype.bind;xd.boundFunctionsHaveNames=function(){return xd()&&typeof XM=="function"&&(function(){}).bind().name!==""};var YM=xd,Ax=Av,KM=kv(),JM=YM.functionsHaveConfigurableNames(),QM=Wu,$M=function(e,n){if(typeof e!="function")throw new QM("`fn` is not a function");var r=arguments.length>2&&!!arguments[2];return(!r||JM)&&(KM?Ax(e,"name",n,!0,!0):Ax(e,"name",n)),e},eA=$M,tA=Wu,nA=Object,PE=eA(function(){if(this==null||this!==nA(this))throw new tA("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),rA=PE,iA=qc.supportsDescriptors,oA=Object.getOwnPropertyDescriptor,ME=function(){if(iA&&/a/mig.flags==="gim"){var e=oA(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var n="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){n+="d"}}),Object.defineProperty(r,"sticky",{get:function(){n+="y"}}),n==="dy")return e.get}}return rA},sA=qc.supportsDescriptors,aA=ME,lA=Object.getOwnPropertyDescriptor,uA=Object.defineProperty,cA=TypeError,kx=Object.getPrototypeOf,hA=/a/,fA=function(){if(!sA||!kx)throw new cA("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=aA(),n=kx(hA),r=lA(n,"flags");return(!r||r.get!==e)&&uA(n,"flags",{configurable:!0,enumerable:!1,get:e}),e},pA=qc,dA=Bf,mA=PE,AE=ME,gA=fA,kE=dA(AE());pA(kE,{getPolyfill:AE,implementation:mA,shim:gA});var yA=kE,Ig={exports:{}},_A=vy,jc=function(){return _A()&&!!Symbol.toStringTag},vA=jc(),bA=fa,A0=bA("Object.prototype.toString"),by=function(e){return vA&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:A0(e)==="[object Arguments]"},DE=function(e){return by(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&A0(e)!=="[object Array]"&&A0(e.callee)==="[object Function]"},xA=function(){return by(arguments)}();by.isLegacyArguments=DE;var RE=xA?by:DE;const wA={},SA=Object.freeze(Object.defineProperty({__proto__:null,default:wA},Symbol.toStringTag,{value:"Module"})),EA=_y(SA);var Dv=typeof Map=="function"&&Map.prototype,i0=Object.getOwnPropertyDescriptor&&Dv?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Gg=Dv&&i0&&typeof i0.get=="function"?i0.get:null,Dx=Dv&&Map.prototype.forEach,Rv=typeof Set=="function"&&Set.prototype,o0=Object.getOwnPropertyDescriptor&&Rv?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,qg=Rv&&o0&&typeof o0.get=="function"?o0.get:null,Rx=Rv&&Set.prototype.forEach,IA=typeof WeakMap=="function"&&WeakMap.prototype,md=IA?WeakMap.prototype.has:null,CA=typeof WeakSet=="function"&&WeakSet.prototype,gd=CA?WeakSet.prototype.has:null,TA=typeof WeakRef=="function"&&WeakRef.prototype,Nx=TA?WeakRef.prototype.deref:null,LA=Boolean.prototype.valueOf,PA=Object.prototype.toString,MA=Function.prototype.toString,AA=String.prototype.match,Nv=String.prototype.slice,Pu=String.prototype.replace,kA=String.prototype.toUpperCase,Ox=String.prototype.toLowerCase,NE=RegExp.prototype.test,zx=Array.prototype.concat,il=Array.prototype.join,DA=Array.prototype.slice,Fx=Math.floor,k0=typeof BigInt=="function"?BigInt.prototype.valueOf:null,s0=Object.getOwnPropertySymbols,D0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,df=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Io=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===df||"symbol")?Symbol.toStringTag:null,OE=Object.prototype.propertyIsEnumerable,Bx=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Vx(t,e){if(t===1/0||t===-1/0||t!==t||t&&t>-1e3&&t<1e3||NE.call(/e/,e))return e;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof t=="number"){var r=t<0?-Fx(-t):Fx(t);if(r!==t){var i=String(r),a=Nv.call(e,i.length+1);return Pu.call(i,n,"$&_")+"."+Pu.call(Pu.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Pu.call(e,n,"$&_")}var R0=EA,Ux=R0.custom,Gx=FE(Ux)?Ux:null,RA=function t(e,n,r,i){var a=n||{};if(Tu(a,"quoteStyle")&&a.quoteStyle!=="single"&&a.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Tu(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=Tu(a,"customInspect")?a.customInspect:!0;if(typeof c!="boolean"&&c!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Tu(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Tu(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var u=a.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return VE(e,a);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var m=String(e);return u?Vx(e,m):m}if(typeof e=="bigint"){var w=String(e)+"n";return u?Vx(e,w):w}var S=typeof a.depth>"u"?5:a.depth;if(typeof r>"u"&&(r=0),r>=S&&S>0&&typeof e=="object")return N0(e)?"[Array]":"[Object]";var E=QA(a,r);if(typeof i>"u")i=[];else if(BE(i,e)>=0)return"[Circular]";function P(Ke,Se,Ze){if(Se&&(i=DA.call(i),i.push(Se)),Ze){var tt={depth:a.depth};return Tu(a,"quoteStyle")&&(tt.quoteStyle=a.quoteStyle),t(Ke,tt,r+1,i)}return t(Ke,a,r+1,i)}if(typeof e=="function"&&!qx(e)){var D=qA(e),k=lg(e,P);return"[Function"+(D?": "+D:" (anonymous)")+"]"+(k.length>0?" { "+il.call(k,", ")+" }":"")}if(FE(e)){var V=df?Pu.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):D0.call(e);return typeof e=="object"&&!df?Jp(V):V}if(YA(e)){for(var j="<"+Ox.call(String(e.nodeName)),te=e.attributes||[],U=0;U<te.length;U++)j+=" "+te[U].name+"="+zE(NA(te[U].value),"double",a);return j+=">",e.childNodes&&e.childNodes.length&&(j+="..."),j+="</"+Ox.call(String(e.nodeName))+">",j}if(N0(e)){if(e.length===0)return"[]";var W=lg(e,P);return E&&!JA(W)?"["+O0(W,E)+"]":"[ "+il.call(W,", ")+" ]"}if(zA(e)){var Y=lg(e,P);return!("cause"in Error.prototype)&&"cause"in e&&!OE.call(e,"cause")?"{ ["+String(e)+"] "+il.call(zx.call("[cause]: "+P(e.cause),Y),", ")+" }":Y.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+il.call(Y,", ")+" }"}if(typeof e=="object"&&c){if(Gx&&typeof e[Gx]=="function"&&R0)return R0(e,{depth:S-r});if(c!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(jA(e)){var oe=[];return Dx&&Dx.call(e,function(Ke,Se){oe.push(P(Se,e,!0)+" => "+P(Ke,e))}),jx("Map",Gg.call(e),oe,E)}if(ZA(e)){var _e=[];return Rx&&Rx.call(e,function(Ke){_e.push(P(Ke,e))}),jx("Set",qg.call(e),_e,E)}if(WA(e))return a0("WeakMap");if(XA(e))return a0("WeakSet");if(HA(e))return a0("WeakRef");if(BA(e))return Jp(P(Number(e)));if(UA(e))return Jp(P(k0.call(e)));if(VA(e))return Jp(LA.call(e));if(FA(e))return Jp(P(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===Gd)return"{ [object globalThis] }";if(!OA(e)&&!qx(e)){var se=lg(e,P),ce=Bx?Bx(e)===Object.prototype:e instanceof Object||e.constructor===Object,me=e instanceof Object?"":"null prototype",Ce=!ce&&Io&&Object(e)===e&&Io in e?Nv.call(Hu(e),8,-1):me?"Object":"",Z=ce||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",fe=Z+(Ce||me?"["+il.call(zx.call([],Ce||[],me||[]),": ")+"] ":"");return se.length===0?fe+"{}":E?fe+"{"+O0(se,E)+"}":fe+"{ "+il.call(se,", ")+" }"}return String(e)};function zE(t,e,n){var r=(n.quoteStyle||e)==="double"?'"':"'";return r+t+r}function NA(t){return Pu.call(String(t),/"/g,"&quot;")}function N0(t){return Hu(t)==="[object Array]"&&(!Io||!(typeof t=="object"&&Io in t))}function OA(t){return Hu(t)==="[object Date]"&&(!Io||!(typeof t=="object"&&Io in t))}function qx(t){return Hu(t)==="[object RegExp]"&&(!Io||!(typeof t=="object"&&Io in t))}function zA(t){return Hu(t)==="[object Error]"&&(!Io||!(typeof t=="object"&&Io in t))}function FA(t){return Hu(t)==="[object String]"&&(!Io||!(typeof t=="object"&&Io in t))}function BA(t){return Hu(t)==="[object Number]"&&(!Io||!(typeof t=="object"&&Io in t))}function VA(t){return Hu(t)==="[object Boolean]"&&(!Io||!(typeof t=="object"&&Io in t))}function FE(t){if(df)return t&&typeof t=="object"&&t instanceof Symbol;if(typeof t=="symbol")return!0;if(!t||typeof t!="object"||!D0)return!1;try{return D0.call(t),!0}catch{}return!1}function UA(t){if(!t||typeof t!="object"||!k0)return!1;try{return k0.call(t),!0}catch{}return!1}var GA=Object.prototype.hasOwnProperty||function(t){return t in this};function Tu(t,e){return GA.call(t,e)}function Hu(t){return PA.call(t)}function qA(t){if(t.name)return t.name;var e=AA.call(MA.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function BE(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}function jA(t){if(!Gg||!t||typeof t!="object")return!1;try{Gg.call(t);try{qg.call(t)}catch{return!0}return t instanceof Map}catch{}return!1}function WA(t){if(!md||!t||typeof t!="object")return!1;try{md.call(t,md);try{gd.call(t,gd)}catch{return!0}return t instanceof WeakMap}catch{}return!1}function HA(t){if(!Nx||!t||typeof t!="object")return!1;try{return Nx.call(t),!0}catch{}return!1}function ZA(t){if(!qg||!t||typeof t!="object")return!1;try{qg.call(t);try{Gg.call(t)}catch{return!0}return t instanceof Set}catch{}return!1}function XA(t){if(!gd||!t||typeof t!="object")return!1;try{gd.call(t,gd);try{md.call(t,md)}catch{return!0}return t instanceof WeakSet}catch{}return!1}function YA(t){return!t||typeof t!="object"?!1:typeof HTMLElement<"u"&&t instanceof HTMLElement?!0:typeof t.nodeName=="string"&&typeof t.getAttribute=="function"}function VE(t,e){if(t.length>e.maxStringLength){var n=t.length-e.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return VE(Nv.call(t,0,e.maxStringLength),e)+r}var i=Pu.call(Pu.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,KA);return zE(i,"single",e)}function KA(t){var e=t.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return n?"\\"+n:"\\x"+(e<16?"0":"")+kA.call(e.toString(16))}function Jp(t){return"Object("+t+")"}function a0(t){return t+" { ? }"}function jx(t,e,n,r){var i=r?O0(n,r):il.call(n,", ");return t+" ("+e+") {"+i+"}"}function JA(t){for(var e=0;e<t.length;e++)if(BE(t[e],`
`)>=0)return!1;return!0}function QA(t,e){var n;if(t.indent==="	")n="	";else if(typeof t.indent=="number"&&t.indent>0)n=il.call(Array(t.indent+1)," ");else return null;return{base:n,prev:il.call(Array(e+1),n)}}function O0(t,e){if(t.length===0)return"";var n=`
`+e.prev+e.base;return n+il.call(t,","+n)+`
`+e.prev}function lg(t,e){var n=N0(t),r=[];if(n){r.length=t.length;for(var i=0;i<t.length;i++)r[i]=Tu(t,i)?e(t[i],t):""}var a=typeof s0=="function"?s0(t):[],c;if(df){c={};for(var u=0;u<a.length;u++)c["$"+a[u]]=a[u]}for(var m in t)Tu(t,m)&&(n&&String(Number(m))===m&&m<t.length||df&&c["$"+m]instanceof Symbol||(NE.call(/[^\w$]/,m)?r.push(e(m,t)+": "+e(t[m],t)):r.push(m+": "+e(t[m],t))));if(typeof s0=="function")for(var w=0;w<a.length;w++)OE.call(t,a[w])&&r.push("["+e(a[w])+"]: "+e(t[a[w]],t));return r}var UE=yl,Vf=fa,$A=RA,ek=Wu,ug=UE("%WeakMap%",!0),cg=UE("%Map%",!0),tk=Vf("WeakMap.prototype.get",!0),nk=Vf("WeakMap.prototype.set",!0),rk=Vf("WeakMap.prototype.has",!0),ik=Vf("Map.prototype.get",!0),ok=Vf("Map.prototype.set",!0),sk=Vf("Map.prototype.has",!0),Ov=function(t,e){for(var n=t,r;(r=n.next)!==null;n=r)if(r.key===e)return n.next=r.next,r.next=t.next,t.next=r,r},ak=function(t,e){var n=Ov(t,e);return n&&n.value},lk=function(t,e,n){var r=Ov(t,e);r?r.value=n:t.next={key:e,next:t.next,value:n}},uk=function(t,e){return!!Ov(t,e)},GE=function(){var e,n,r,i={assert:function(a){if(!i.has(a))throw new ek("Side channel does not contain "+$A(a))},get:function(a){if(ug&&a&&(typeof a=="object"||typeof a=="function")){if(e)return tk(e,a)}else if(cg){if(n)return ik(n,a)}else if(r)return ak(r,a)},has:function(a){if(ug&&a&&(typeof a=="object"||typeof a=="function")){if(e)return rk(e,a)}else if(cg){if(n)return sk(n,a)}else if(r)return uk(r,a);return!1},set:function(a,c){ug&&a&&(typeof a=="object"||typeof a=="function")?(e||(e=new ug),nk(e,a,c)):cg?(n||(n=new cg),ok(n,a,c)):(r||(r={key:{},next:null}),lk(r,a,c))}};return i},ck=mE,Qp=GE(),zl=Wu,zv={assert:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new zl("`O` is not an object");if(typeof e!="string")throw new zl("`slot` must be a string");if(Qp.assert(t),!zv.has(t,e))throw new zl("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new zl("`O` is not an object");if(typeof e!="string")throw new zl("`slot` must be a string");var n=Qp.get(t);return n&&n["$"+e]},has:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new zl("`O` is not an object");if(typeof e!="string")throw new zl("`slot` must be a string");var n=Qp.get(t);return!!n&&ck(n,"$"+e)},set:function(t,e,n){if(!t||typeof t!="object"&&typeof t!="function")throw new zl("`O` is not an object");if(typeof e!="string")throw new zl("`slot` must be a string");var r=Qp.get(t);r||(r={},Qp.set(t,r)),r["$"+e]=n}};Object.freeze&&Object.freeze(zv);var hk=zv,$p=hk,fk=SyntaxError,Wx=typeof StopIteration=="object"?StopIteration:null,pk=function(e){if(!Wx)throw new fk("this environment lacks StopIteration");$p.set(e,"[[Done]]",!1);var n={next:function(){var i=$p.get(this,"[[Iterator]]"),a=$p.get(i,"[[Done]]");try{return{done:a,value:a?void 0:i.next()}}catch(c){if($p.set(i,"[[Done]]",!0),c!==Wx)throw c;return{done:!0,value:void 0}}}};return $p.set(n,"[[Iterator]]",e),n},dk={}.toString,qE=Array.isArray||function(t){return dk.call(t)=="[object Array]"},mk=String.prototype.valueOf,gk=function(e){try{return mk.call(e),!0}catch{return!1}},yk=Object.prototype.toString,_k="[object String]",vk=jc(),jE=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:vk?gk(e):yk.call(e)===_k},Fv=typeof Map=="function"&&Map.prototype?Map:null,bk=typeof Set=="function"&&Set.prototype?Set:null,jg;Fv||(jg=function(e){return!1});var WE=Fv?Map.prototype.has:null,Hx=bk?Set.prototype.has:null;!jg&&!WE&&(jg=function(e){return!1});var HE=jg||function(e){if(!e||typeof e!="object")return!1;try{if(WE.call(e),Hx)try{Hx.call(e)}catch{return!0}return e instanceof Fv}catch{}return!1},xk=typeof Map=="function"&&Map.prototype?Map:null,Bv=typeof Set=="function"&&Set.prototype?Set:null,Wg;Bv||(Wg=function(e){return!1});var Zx=xk?Map.prototype.has:null,ZE=Bv?Set.prototype.has:null;!Wg&&!ZE&&(Wg=function(e){return!1});var XE=Wg||function(e){if(!e||typeof e!="object")return!1;try{if(ZE.call(e),Zx)try{Zx.call(e)}catch{return!0}return e instanceof Bv}catch{}return!1},Xx=RE,Yx=pk;if(Tv()||vy()){var l0=Symbol.iterator;Ig.exports=function(e){if(e!=null&&typeof e[l0]<"u")return e[l0]();if(Xx(e))return Array.prototype[l0].call(e)}}else{var wk=qE,Sk=jE,Kx=yl,Ek=Kx("%Map%",!0),Ik=Kx("%Set%",!0),Sa=fa,Jx=Sa("Array.prototype.push"),Qx=Sa("String.prototype.charCodeAt"),Ck=Sa("String.prototype.slice"),Tk=function(e,n){var r=e.length;if(n+1>=r)return n+1;var i=Qx(e,n);if(i<55296||i>56319)return n+1;var a=Qx(e,n+1);return a<56320||a>57343?n+1:n+2},u0=function(e){var n=0;return{next:function(){var i=n>=e.length,a;return i||(a=e[n],n+=1),{done:i,value:a}}}},$x=function(e,n){if(wk(e)||Xx(e))return u0(e);if(Sk(e)){var r=0;return{next:function(){var a=Tk(e,r),c=Ck(e,r,a);return r=a,{done:a>e.length,value:c}}}}if(n&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!Ek&&!Ik)Ig.exports=function(e){if(e!=null)return $x(e,!0)};else{var Lk=HE,Pk=XE,ew=Sa("Map.prototype.forEach",!0),tw=Sa("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var nw=Sa("Map.prototype.iterator",!0),rw=Sa("Set.prototype.iterator",!0);var iw=Sa("Map.prototype.@@iterator",!0)||Sa("Map.prototype._es6-shim iterator_",!0),ow=Sa("Set.prototype.@@iterator",!0)||Sa("Set.prototype._es6-shim iterator_",!0),Mk=function(e){if(Lk(e)){if(nw)return Yx(nw(e));if(iw)return iw(e);if(ew){var n=[];return ew(e,function(i,a){Jx(n,[a,i])}),u0(n)}}if(Pk(e)){if(rw)return Yx(rw(e));if(ow)return ow(e);if(tw){var r=[];return tw(e,function(i){Jx(r,i)}),u0(r)}}};Ig.exports=function(e){return Mk(e)||$x(e)}}}var Ak=Ig.exports,sw=function(t){return t!==t},YE=function(e,n){return e===0&&n===0?1/e===1/n:!!(e===n||sw(e)&&sw(n))},kk=YE,KE=function(){return typeof Object.is=="function"?Object.is:kk},Dk=KE,Rk=qc,Nk=function(){var e=Dk();return Rk(Object,{is:e},{is:function(){return Object.is!==e}}),e},Ok=qc,zk=Bf,Fk=YE,JE=KE,Bk=Nk,QE=zk(JE(),Object);Ok(QE,{getPolyfill:JE,implementation:Fk,shim:Bk});var Vk=QE,Uk=Bf,$E=fa,Gk=yl,z0=Gk("%ArrayBuffer%",!0),Cg=$E("ArrayBuffer.prototype.byteLength",!0),qk=$E("Object.prototype.toString"),aw=!!z0&&!Cg&&new z0(0).slice,lw=!!aw&&Uk(aw),eI=Cg||lw?function(e){if(!e||typeof e!="object")return!1;try{return Cg?Cg(e):lw(e,0),!0}catch{return!1}}:z0?function(e){return qk(e)==="[object ArrayBuffer]"}:function(e){return!1},jk=Date.prototype.getDay,Wk=function(e){try{return jk.call(e),!0}catch{return!1}},Hk=Object.prototype.toString,Zk="[object Date]",Xk=jc(),Yk=function(e){return typeof e!="object"||e===null?!1:Xk?Wk(e):Hk.call(e)===Zk},F0=fa,tI=jc(),nI,rI,B0,V0;if(tI){nI=F0("Object.prototype.hasOwnProperty"),rI=F0("RegExp.prototype.exec"),B0={};var c0=function(){throw B0};V0={toString:c0,valueOf:c0},typeof Symbol.toPrimitive=="symbol"&&(V0[Symbol.toPrimitive]=c0)}var Kk=F0("Object.prototype.toString"),Jk=Object.getOwnPropertyDescriptor,Qk="[object RegExp]",$k=tI?function(e){if(!e||typeof e!="object")return!1;var n=Jk(e,"lastIndex"),r=n&&nI(n,"value");if(!r)return!1;try{rI(e,V0)}catch(i){return i===B0}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:Kk(e)===Qk},e3=fa,uw=e3("SharedArrayBuffer.prototype.byteLength",!0),t3=uw?function(e){if(!e||typeof e!="object")return!1;try{return uw(e),!0}catch{return!1}}:function(e){return!1},n3=Number.prototype.toString,r3=function(e){try{return n3.call(e),!0}catch{return!1}},i3=Object.prototype.toString,o3="[object Number]",s3=jc(),a3=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:s3?r3(e):i3.call(e)===o3},iI=fa,l3=iI("Boolean.prototype.toString"),u3=iI("Object.prototype.toString"),c3=function(e){try{return l3(e),!0}catch{return!1}},h3="[object Boolean]",f3=jc(),p3=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:f3&&Symbol.toStringTag in e?c3(e):u3(e)===h3},U0={exports:{}},d3=Object.prototype.toString,m3=Tv();if(m3){var g3=Symbol.prototype.toString,y3=/^Symbol\(.*\)$/,_3=function(e){return typeof e.valueOf()!="symbol"?!1:y3.test(g3.call(e))};U0.exports=function(e){if(typeof e=="symbol")return!0;if(d3.call(e)!=="[object Symbol]")return!1;try{return _3(e)}catch{return!1}}}else U0.exports=function(e){return!1};var v3=U0.exports,G0={exports:{}},cw=typeof BigInt<"u"&&BigInt,b3=function(){return typeof cw=="function"&&typeof BigInt=="function"&&typeof cw(42)=="bigint"&&typeof BigInt(42)=="bigint"},x3=b3();if(x3){var w3=BigInt.prototype.valueOf,S3=function(e){try{return w3.call(e),!0}catch{}return!1};G0.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:S3(e)}}else G0.exports=function(e){return!1};var E3=G0.exports,I3=jE,C3=a3,T3=p3,L3=v3,P3=E3,M3=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(I3(e))return"String";if(C3(e))return"Number";if(T3(e))return"Boolean";if(L3(e))return"Symbol";if(P3(e))return"BigInt"},Hg=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,hw=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Zg;Hg||(Zg=function(e){return!1});var q0=Hg?Hg.prototype.has:null,h0=hw?hw.prototype.has:null;!Zg&&!q0&&(Zg=function(e){return!1});var A3=Zg||function(e){if(!e||typeof e!="object")return!1;try{if(q0.call(e,q0),h0)try{h0.call(e,h0)}catch{return!0}return e instanceof Hg}catch{}return!1},j0={exports:{}},k3=yl,oI=fa,D3=k3("%WeakSet%",!0),f0=oI("WeakSet.prototype.has",!0);if(f0){var p0=oI("WeakMap.prototype.has",!0);j0.exports=function(e){if(!e||typeof e!="object")return!1;try{if(f0(e,f0),p0)try{p0(e,p0)}catch{return!0}return e instanceof D3}catch{}return!1}}else j0.exports=function(e){return!1};var R3=j0.exports,N3=HE,O3=XE,z3=A3,F3=R3,B3=function(e){if(e&&typeof e=="object"){if(N3(e))return"Map";if(O3(e))return"Set";if(z3(e))return"WeakMap";if(F3(e))return"WeakSet"}return!1},sI=Function.prototype.toString,of=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,W0,Tg;if(typeof of=="function"&&typeof Object.defineProperty=="function")try{W0=Object.defineProperty({},"length",{get:function(){throw Tg}}),Tg={},of(function(){throw 42},null,W0)}catch(t){t!==Tg&&(of=null)}else of=null;var V3=/^\s*class\b/,H0=function(e){try{var n=sI.call(e);return V3.test(n)}catch{return!1}},d0=function(e){try{return H0(e)?!1:(sI.call(e),!0)}catch{return!1}},Lg=Object.prototype.toString,U3="[object Object]",G3="[object Function]",q3="[object GeneratorFunction]",j3="[object HTMLAllCollection]",W3="[object HTML document.all class]",H3="[object HTMLCollection]",Z3=typeof Symbol=="function"&&!!Symbol.toStringTag,X3=!(0 in[,]),Z0=function(){return!1};if(typeof document=="object"){var Y3=document.all;Lg.call(Y3)===Lg.call(document.all)&&(Z0=function(e){if((X3||!e)&&(typeof e>"u"||typeof e=="object"))try{var n=Lg.call(e);return(n===j3||n===W3||n===H3||n===U3)&&e("")==null}catch{}return!1})}var K3=of?function(e){if(Z0(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{of(e,null,W0)}catch(n){if(n!==Tg)return!1}return!H0(e)&&d0(e)}:function(e){if(Z0(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(Z3)return d0(e);if(H0(e))return!1;var n=Lg.call(e);return n!==G3&&n!==q3&&!/^\[object HTML/.test(n)?!1:d0(e)},J3=K3,Q3=Object.prototype.toString,aI=Object.prototype.hasOwnProperty,$3=function(e,n,r){for(var i=0,a=e.length;i<a;i++)aI.call(e,i)&&(r==null?n(e[i],i,e):n.call(r,e[i],i,e))},e4=function(e,n,r){for(var i=0,a=e.length;i<a;i++)r==null?n(e.charAt(i),i,e):n.call(r,e.charAt(i),i,e)},t4=function(e,n,r){for(var i in e)aI.call(e,i)&&(r==null?n(e[i],i,e):n.call(r,e[i],i,e))},n4=function(e,n,r){if(!J3(n))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=r),Q3.call(e)==="[object Array]"?$3(e,n,i):typeof e=="string"?e4(e,n,i):t4(e,n,i)},r4=n4,i4=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],m0=i4,o4=typeof globalThis>"u"?Gd:globalThis,s4=function(){for(var e=[],n=0;n<m0.length;n++)typeof o4[m0[n]]=="function"&&(e[e.length]=m0[n]);return e},Xg=r4,a4=s4,fw=Bf,Vv=fa,Pg=Mv,l4=Vv("Object.prototype.toString"),lI=jc(),pw=typeof globalThis>"u"?Gd:globalThis,X0=a4(),Uv=Vv("String.prototype.slice"),g0=Object.getPrototypeOf,u4=Vv("Array.prototype.indexOf",!0)||function(e,n){for(var r=0;r<e.length;r+=1)if(e[r]===n)return r;return-1},Yg={__proto__:null};lI&&Pg&&g0?Xg(X0,function(t){var e=new pw[t];if(Symbol.toStringTag in e){var n=g0(e),r=Pg(n,Symbol.toStringTag);if(!r){var i=g0(n);r=Pg(i,Symbol.toStringTag)}Yg["$"+t]=fw(r.get)}}):Xg(X0,function(t){var e=new pw[t],n=e.slice||e.set;n&&(Yg["$"+t]=fw(n))});var c4=function(e){var n=!1;return Xg(Yg,function(r,i){if(!n)try{"$"+r(e)===i&&(n=Uv(i,1))}catch{}}),n},h4=function(e){var n=!1;return Xg(Yg,function(r,i){if(!n)try{r(e),n=Uv(i,1)}catch{}}),n},f4=function(e){if(!e||typeof e!="object")return!1;if(!lI){var n=Uv(l4(e),8,-1);return u4(X0,n)>-1?n:n!=="Object"?!1:h4(e)}return Pg?c4(e):null},p4=fa,dw=p4("ArrayBuffer.prototype.byteLength",!0),d4=eI,m4=function(e){return d4(e)?dw?dw(e):e.byteLength:NaN},uI=ZM,_l=fa,mw=yA,g4=yl,mf=Ak,y4=GE,gw=Vk,yw=RE,_w=qE,vw=eI,bw=Yk,xw=$k,ww=t3,Sw=Cv,Ew=M3,Iw=B3,Cw=f4,Tw=m4,Lw=_l("SharedArrayBuffer.prototype.byteLength",!0),Pw=_l("Date.prototype.getTime"),y0=Object.getPrototypeOf,Mw=_l("Object.prototype.toString"),Kg=g4("%Set%",!0),Y0=_l("Map.prototype.has",!0),Jg=_l("Map.prototype.get",!0),Aw=_l("Map.prototype.size",!0),Qg=_l("Set.prototype.add",!0),cI=_l("Set.prototype.delete",!0),$g=_l("Set.prototype.has",!0),Mg=_l("Set.prototype.size",!0);function kw(t,e,n,r){for(var i=mf(t),a;(a=i.next())&&!a.done;)if(Ca(e,a.value,n,r))return cI(t,a.value),!0;return!1}function hI(t){if(typeof t>"u")return null;if(typeof t!="object")return typeof t=="symbol"?!1:typeof t=="string"||typeof t=="number"?+t==+t:!0}function _4(t,e,n,r,i,a){var c=hI(n);if(c!=null)return c;var u=Jg(e,c),m=uI({},i,{strict:!1});return typeof u>"u"&&!Y0(e,c)||!Ca(r,u,m,a)?!1:!Y0(t,c)&&Ca(r,u,m,a)}function v4(t,e,n){var r=hI(n);return r??($g(e,r)&&!$g(t,r))}function Dw(t,e,n,r,i,a){for(var c=mf(t),u,m;(u=c.next())&&!u.done;)if(m=u.value,Ca(n,m,i,a)&&Ca(r,Jg(e,m),i,a))return cI(t,m),!0;return!1}function Ca(t,e,n,r){var i=n||{};if(i.strict?gw(t,e):t===e)return!0;var a=Ew(t),c=Ew(e);if(a!==c)return!1;if(!t||!e||typeof t!="object"&&typeof e!="object")return i.strict?gw(t,e):t==e;var u=r.has(t),m=r.has(e),w;if(u&&m){if(r.get(t)===r.get(e))return!0}else w={};return u||r.set(t,w),m||r.set(e,w),w4(t,e,i,r)}function Rw(t){return!t||typeof t!="object"||typeof t.length!="number"||typeof t.copy!="function"||typeof t.slice!="function"||t.length>0&&typeof t[0]!="number"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function b4(t,e,n,r){if(Mg(t)!==Mg(e))return!1;for(var i=mf(t),a=mf(e),c,u,m;(c=i.next())&&!c.done;)if(c.value&&typeof c.value=="object")m||(m=new Kg),Qg(m,c.value);else if(!$g(e,c.value)){if(n.strict||!v4(t,e,c.value))return!1;m||(m=new Kg),Qg(m,c.value)}if(m){for(;(u=a.next())&&!u.done;)if(u.value&&typeof u.value=="object"){if(!kw(m,u.value,n.strict,r))return!1}else if(!n.strict&&!$g(t,u.value)&&!kw(m,u.value,n.strict,r))return!1;return Mg(m)===0}return!0}function x4(t,e,n,r){if(Aw(t)!==Aw(e))return!1;for(var i=mf(t),a=mf(e),c,u,m,w,S,E;(c=i.next())&&!c.done;)if(w=c.value[0],S=c.value[1],w&&typeof w=="object")m||(m=new Kg),Qg(m,w);else if(E=Jg(e,w),typeof E>"u"&&!Y0(e,w)||!Ca(S,E,n,r)){if(n.strict||!_4(t,e,w,S,n,r))return!1;m||(m=new Kg),Qg(m,w)}if(m){for(;(u=a.next())&&!u.done;)if(w=u.value[0],E=u.value[1],w&&typeof w=="object"){if(!Dw(m,t,w,E,n,r))return!1}else if(!n.strict&&(!t.has(w)||!Ca(Jg(t,w),E,n,r))&&!Dw(m,t,w,E,uI({},n,{strict:!1}),r))return!1;return Mg(m)===0}return!0}function w4(t,e,n,r){var i,a;if(typeof t!=typeof e||t==null||e==null||Mw(t)!==Mw(e)||yw(t)!==yw(e))return!1;var c=_w(t),u=_w(e);if(c!==u)return!1;var m=t instanceof Error,w=e instanceof Error;if(m!==w||(m||w)&&(t.name!==e.name||t.message!==e.message))return!1;var S=xw(t),E=xw(e);if(S!==E||(S||E)&&(t.source!==e.source||mw(t)!==mw(e)))return!1;var P=bw(t),D=bw(e);if(P!==D||(P||D)&&Pw(t)!==Pw(e)||n.strict&&y0&&y0(t)!==y0(e))return!1;var k=Cw(t),V=Cw(e);if(k!==V)return!1;if(k||V){if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}var j=Rw(t),te=Rw(e);if(j!==te)return!1;if(j||te){if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}var U=vw(t),W=vw(e);if(U!==W)return!1;if(U||W)return Tw(t)!==Tw(e)?!1:typeof Uint8Array=="function"&&Ca(new Uint8Array(t),new Uint8Array(e),n,r);var Y=ww(t),oe=ww(e);if(Y!==oe)return!1;if(Y||oe)return Lw(t)!==Lw(e)?!1:typeof Uint8Array=="function"&&Ca(new Uint8Array(t),new Uint8Array(e),n,r);if(typeof t!=typeof e)return!1;var _e=Sw(t),se=Sw(e);if(_e.length!==se.length)return!1;for(_e.sort(),se.sort(),i=_e.length-1;i>=0;i--)if(_e[i]!=se[i])return!1;for(i=_e.length-1;i>=0;i--)if(a=_e[i],!Ca(t[a],e[a],n,r))return!1;var ce=Iw(t),me=Iw(e);return ce!==me?!1:ce==="Set"||me==="Set"?b4(t,e,n,r):ce==="Map"?x4(t,e,n,r):!0}var S4=function(e,n,r){return Ca(e,n,r,y4())};const E4=Iv(S4);var I4=Object.defineProperty,nr=(t,e)=>I4(t,"name",{value:e,configurable:!0}),C4=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,i;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(i=e==null?void 0:e.compareProperties)!=null?i:!0}compare(e,n){if(e.type!==n.type||!ld(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=K0(e),i=K0(n);return r.every(a=>i.some(c=>this.compare(a,c)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,i)=>Math.abs(r-n[i])<this.precision)}compareLine(e,n,r=0,i=!1){if(!ld(e,n))return!1;const a=e;let c=n;if(i&&!this.compareCoord(a[0],c[0])){const m=this.fixStartIndex(c,a);if(m)c=m;else return!1}const u=this.compareCoord(a[r],c[r]);return this.direction||u?this.comparePath(a,c):this.compareCoord(a[r],c[c.length-(1+r)])?this.comparePath(a.slice().reverse(),c):!1}fixStartIndex(e,n){let r,i=-1;for(let a=0;a<e.length;a++)if(this.compareCoord(e[a],n[0])){i=a;break}return i>=0&&(r=[].concat(e.slice(i,e.length),e.slice(1,i+1))),r}comparePath(e,n){return e.every((r,i)=>this.compareCoord(r,n[i]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),i=n.coordinates.slice(1,n.coordinates.length);return r.every(a=>i.some(c=>this.compareLine(a,c,1,!0)))}return!1}compareGeometryCollection(e,n){return ld(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,i)=>this.compare(r,n.geometries[i]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?E4(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return ld(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,i)=>this.compare(r,n.features[i]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};nr(C4,"GeojsonEquality");function ld(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}nr(ld,"sameLength");function K0(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}nr(K0,"explode");var Ss=63710088e-1,fI={centimeters:Ss*100,centimetres:Ss*100,degrees:360/(2*Math.PI),feet:Ss*3.28084,inches:Ss*39.37,kilometers:Ss/1e3,kilometres:Ss/1e3,meters:Ss,metres:Ss,miles:Ss/1609.344,millimeters:Ss*1e3,millimetres:Ss*1e3,nauticalmiles:Ss/1852,radians:1,yards:Ss*1.0936},Nw={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function cl(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}nr(cl,"feature");function T4(t,e,n={}){switch(t){case"Point":return Bl(e).geometry;case"LineString":return Gl(e).geometry;case"Polygon":return Gv(e).geometry;case"MultiPoint":return dI(e).geometry;case"MultiLineString":return pI(e).geometry;case"MultiPolygon":return mI(e).geometry;default:throw new Error(t+" is invalid")}}nr(T4,"geometry");function Bl(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ey(t[0])||!ey(t[1]))throw new Error("coordinates must contain numbers");return cl({type:"Point",coordinates:t},e,n)}nr(Bl,"point");function L4(t,e,n={}){return xy(t.map(r=>Bl(r,e)),n)}nr(L4,"points");function Gv(t,e,n={}){for(const i of t){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return cl({type:"Polygon",coordinates:t},e,n)}nr(Gv,"polygon");function P4(t,e,n={}){return xy(t.map(r=>Gv(r,e)),n)}nr(P4,"polygons");function Gl(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return cl({type:"LineString",coordinates:t},e,n)}nr(Gl,"lineString");function M4(t,e,n={}){return xy(t.map(r=>Gl(r,e)),n)}nr(M4,"lineStrings");function xy(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}nr(xy,"featureCollection");function pI(t,e,n={}){return cl({type:"MultiLineString",coordinates:t},e,n)}nr(pI,"multiLineString");function dI(t,e,n={}){return cl({type:"MultiPoint",coordinates:t},e,n)}nr(dI,"multiPoint");function mI(t,e,n={}){return cl({type:"MultiPolygon",coordinates:t},e,n)}nr(mI,"multiPolygon");function A4(t,e,n={}){return cl({type:"GeometryCollection",geometries:t},e,n)}nr(A4,"geometryCollection");function k4(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}nr(k4,"round");function gI(t,e="kilometers"){const n=fI[e];if(!n)throw new Error(e+" units is invalid");return t*n}nr(gI,"radiansToLength");function qv(t,e="kilometers"){const n=fI[e];if(!n)throw new Error(e+" units is invalid");return t/n}nr(qv,"lengthToRadians");function D4(t,e){return yI(qv(t,e))}nr(D4,"lengthToDegrees");function R4(t){let e=t%360;return e<0&&(e+=360),e}nr(R4,"bearingToAzimuth");function yI(t){return t%(2*Math.PI)*180/Math.PI}nr(yI,"radiansToDegrees");function N4(t){return t%360*Math.PI/180}nr(N4,"degreesToRadians");function O4(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return gI(qv(t,e),n)}nr(O4,"convertLength");function z4(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Nw[e];if(!r)throw new Error("invalid original units");const i=Nw[n];if(!i)throw new Error("invalid final units");return t/r*i}nr(z4,"convertArea");function ey(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}nr(ey,"isNumber");function jv(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}nr(jv,"isObject");function F4(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ey(e))throw new Error("bbox must only contain numbers")})}nr(F4,"validateBBox");function B4(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}nr(B4,"validateId");var V4=Object.defineProperty,ho=(t,e)=>V4(t,"name",{value:e,configurable:!0});function Uf(t,e,n){if(t!==null)for(var r,i,a,c,u,m,w,S=0,E=0,P,D=t.type,k=D==="FeatureCollection",V=D==="Feature",j=k?t.features.length:1,te=0;te<j;te++){w=k?t.features[te].geometry:V?t.geometry:t,P=w?w.type==="GeometryCollection":!1,u=P?w.geometries.length:1;for(var U=0;U<u;U++){var W=0,Y=0;if(c=P?w.geometries[U]:w,c!==null){m=c.coordinates;var oe=c.type;switch(S=n&&(oe==="Polygon"||oe==="MultiPolygon")?1:0,oe){case null:break;case"Point":if(e(m,E,te,W,Y)===!1)return!1;E++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<m.length;r++){if(e(m[r],E,te,W,Y)===!1)return!1;E++,oe==="MultiPoint"&&W++}oe==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<m.length;r++){for(i=0;i<m[r].length-S;i++){if(e(m[r][i],E,te,W,Y)===!1)return!1;E++}oe==="MultiLineString"&&W++,oe==="Polygon"&&Y++}oe==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<m.length;r++){for(Y=0,i=0;i<m[r].length;i++){for(a=0;a<m[r][i].length-S;a++){if(e(m[r][i][a],E,te,W,Y)===!1)return!1;E++}Y++}W++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(Uf(c.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}ho(Uf,"coordEach");function U4(t,e,n,r){var i=n;return Uf(t,function(a,c,u,m,w){c===0&&n===void 0?i=a:i=e(i,a,c,u,m,w)},r),i}ho(U4,"coordReduce");function _I(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}ho(_I,"propEach");function G4(t,e,n){var r=n;return _I(t,function(i,a){a===0&&n===void 0?r=i:r=e(r,i,a)}),r}ho(G4,"propReduce");function vI(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}ho(vI,"featureEach");function q4(t,e,n){var r=n;return vI(t,function(i,a){a===0&&n===void 0?r=i:r=e(r,i,a)}),r}ho(q4,"featureReduce");function j4(t){var e=[];return Uf(t,function(n){e.push(n)}),e}ho(j4,"coordAll");function Wv(t,e){var n,r,i,a,c,u,m,w,S,E,P=0,D=t.type==="FeatureCollection",k=t.type==="Feature",V=D?t.features.length:1;for(n=0;n<V;n++){for(u=D?t.features[n].geometry:k?t.geometry:t,w=D?t.features[n].properties:k?t.properties:{},S=D?t.features[n].bbox:k?t.bbox:void 0,E=D?t.features[n].id:k?t.id:void 0,m=u?u.type==="GeometryCollection":!1,c=m?u.geometries.length:1,i=0;i<c;i++){if(a=m?u.geometries[i]:u,a===null){if(e(null,P,w,S,E)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,P,w,S,E)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(e(a.geometries[r],P,w,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}ho(Wv,"geomEach");function W4(t,e,n){var r=n;return Wv(t,function(i,a,c,u,m){a===0&&n===void 0?r=i:r=e(r,i,a,c,u,m)}),r}ho(W4,"geomReduce");function wy(t,e){Wv(t,function(n,r,i,a,c){var u=n===null?null:n.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return e(cl(n,i,{bbox:a,id:c}),r,0)===!1?!1:void 0}var m;switch(u){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var w=0;w<n.coordinates.length;w++){var S=n.coordinates[w],E={type:m,coordinates:S};if(e(cl(E,i),r,w)===!1)return!1}})}ho(wy,"flattenEach");function H4(t,e,n){var r=n;return wy(t,function(i,a,c){a===0&&c===0&&n===void 0?r=i:r=e(r,i,a,c)}),r}ho(H4,"flattenReduce");function bI(t,e){wy(t,function(n,r,i){var a=0;if(n.geometry){var c=n.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var u,m=0,w=0,S=0;if(Uf(n,function(E,P,D,k,V){if(u===void 0||r>m||k>w||V>S){u=E,m=r,w=k,S=V,a=0;return}var j=Gl([u,E],n.properties);if(e(j,r,i,V,a)===!1)return!1;a++,u=E})===!1)return!1}}})}ho(bI,"segmentEach");function Z4(t,e,n){var r=n,i=!1;return bI(t,function(a,c,u,m,w){i===!1&&n===void 0?r=a:r=e(r,a,c,u,m,w),i=!0}),r}ho(Z4,"segmentReduce");function xI(t,e){if(!t)throw new Error("geojson is required");wy(t,function(n,r,i){if(n.geometry!==null){var a=n.geometry.type,c=n.geometry.coordinates;switch(a){case"LineString":if(e(n,r,i,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<c.length;u++)if(e(Gl(c[u],n.properties),r,i,u)===!1)return!1;break}}})}ho(xI,"lineEach");function X4(t,e,n){var r=n;return xI(t,function(i,a,c,u){a===0&&n===void 0?r=i:r=e(r,i,a,c,u)}),r}ho(X4,"lineReduce");function Y4(t,e){if(e=e||{},!jv(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,c=e.properties,u;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,u=t.features[n].geometry;break;case"Feature":c=c||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var m=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=m.length+a-1),Gl([m[a],m[a+1]],c,e);case"Polygon":return i<0&&(i=m.length+i),a<0&&(a=m[i].length+a-1),Gl([m[i][a],m[i][a+1]],c,e);case"MultiLineString":return r<0&&(r=m.length+r),a<0&&(a=m[r].length+a-1),Gl([m[r][a],m[r][a+1]],c,e);case"MultiPolygon":return r<0&&(r=m.length+r),i<0&&(i=m[r].length+i),a<0&&(a=m[r][i].length-a-1),Gl([m[r][i][a],m[r][i][a+1]],c,e)}throw new Error("geojson is invalid")}ho(Y4,"findSegment");function K4(t,e){if(e=e||{},!jv(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,c=e.properties,u;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,u=t.features[n].geometry;break;case"Feature":c=c||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var m=u.coordinates;switch(u.type){case"Point":return Bl(m,c,e);case"MultiPoint":return r<0&&(r=m.length+r),Bl(m[r],c,e);case"LineString":return a<0&&(a=m.length+a),Bl(m[a],c,e);case"Polygon":return i<0&&(i=m.length+i),a<0&&(a=m[i].length+a),Bl(m[i][a],c,e);case"MultiLineString":return r<0&&(r=m.length+r),a<0&&(a=m[r].length+a),Bl(m[r][a],c,e);case"MultiPolygon":return r<0&&(r=m.length+r),i<0&&(i=m[r].length+i),a<0&&(a=m[r][i].length-a),Bl(m[r][i][a],c,e)}throw new Error("geojson is invalid")}ho(K4,"findPoint");var J4=Object.defineProperty,Q4=(t,e)=>J4(t,"name",{value:e,configurable:!0});function Hv(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const n=[1/0,1/0,-1/0,-1/0];return Uf(t,r=>{n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}Q4(Hv,"bbox");var $4=Hv;const eD=Object.freeze(Object.defineProperty({__proto__:null,bbox:Hv,default:$4},Symbol.toStringTag,{value:"Module"}));var wI={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(t,e){(function(n,r){t.exports=r()})(Gd,function(){var n={},r={};function i(c,u,m){if(r[c]=m,c==="index"){var w="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",S={};return r.shared(S),r.index(n,S),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([w],{type:"text/javascript"}))),n}}i("shared",["exports"],function(c){function u(l,o,h,p){return new(h||(h=Promise))(function(y,b){function x(A){try{L(p.next(A))}catch(N){b(N)}}function I(A){try{L(p.throw(A))}catch(N){b(N)}}function L(A){var N;A.done?y(A.value):(N=A.value,N instanceof h?N:new h(function(O){O(N)})).then(x,I)}L((p=p.apply(l,o||[])).next())})}function m(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}typeof SuppressedError=="function"&&SuppressedError;var w=S;function S(l,o){this.x=l,this.y=o}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,h=l.y-this.y;return o*o+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),h=Math.sin(l),p=h*this.x+o*this.y;return this.x=o*this.x-h*this.y,this.y=p,this},_rotateAround:function(l,o){var h=Math.cos(l),p=Math.sin(l),y=o.y+p*(this.x-o.x)+h*(this.y-o.y);return this.x=o.x+h*(this.x-o.x)-p*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(l){return l instanceof S?l:Array.isArray(l)?new S(l[0],l[1]):l};var E=m(w),P=D;function D(l,o,h,p){this.cx=3*l,this.bx=3*(h-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=h,this.p2y=p}D.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(o===void 0&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var h=l,p=0;p<8;p++){var y=this.sampleCurveX(h)-l;if(Math.abs(y)<o)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=y/b}var x=0,I=1;for(h=l,p=0;p<20&&(y=this.sampleCurveX(h),!(Math.abs(y-l)<o));p++)l>y?x=h:I=h,h=.5*(I-x)+x;return h},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};var k=m(P);let V,j;function te(){return V==null&&(V=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),V}function U(){if(j==null&&(j=!1,te())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let p=0;p<5*5;p++){const y=4*p;o.fillStyle=`rgb(${y},${y+1},${y+2})`,o.fillRect(p%5,Math.floor(p/5),1,1)}const h=o.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&h[p]!==p){j=!0;break}}}return j||!1}function W(l,o,h,p){const y=new k(l,o,h,p);return function(b){return y.solve(b)}}const Y=W(.25,.1,.25,1);function oe(l,o,h){return Math.min(h,Math.max(o,l))}function _e(l,o,h){const p=h-o,y=((l-o)%p+p)%p+o;return y===o?h:y}function se(l,...o){for(const h of o)for(const p in h)l[p]=h[p];return l}let ce=1;function me(l,o,h){const p={};for(const y in l)p[y]=o.call(h||this,l[y],y,l);return p}function Ce(l,o,h){const p={};for(const y in l)o.call(h||this,l[y],y,l)&&(p[y]=l[y]);return p}function Z(l){return Array.isArray(l)?l.map(Z):typeof l=="object"&&l?me(l,Z):l}const fe={};function Ke(l){fe[l]||(typeof console<"u"&&console.warn(l),fe[l]=!0)}function Se(l,o,h){return(h.y-l.y)*(o.x-l.x)>(o.y-l.y)*(h.x-l.x)}function Ze(l){let o=0;for(let h,p,y=0,b=l.length,x=b-1;y<b;x=y++)h=l[y],p=l[x],o+=(p.x-h.x)*(h.y+p.y);return o}function tt(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let qe=null;function Ot(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function un(l,o,h,p,y){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(l,{timestamp:0});try{const x=b==null?void 0:b.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const I=x.startsWith("BGR"),L=new Uint8ClampedArray(p*y*4);if(yield b.copyTo(L,function(A,N,O,G,H){const K=4*Math.max(-N,0),ee=(Math.max(0,O)-O)*G*4+K,ae=4*G,pe=Math.max(0,N),De=Math.max(0,O);return{rect:{x:pe,y:De,width:Math.min(A.width,N+G)-pe,height:Math.min(A.height,O+H)-De},layout:[{offset:ee,stride:ae}]}}(l,o,h,p,y)),I)for(let A=0;A<L.length;A+=4){const N=L[A];L[A]=L[A+2],L[A+2]=N}return L}finally{b.close()}})}let qt,At;const hn="AbortError";function Tn(){return new Error(hn)}const yn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function _n(l){return yn.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const kn="global-dispatcher";class wr extends Error{constructor(o,h,p,y){super(`AJAXError: ${h} (${o}): ${p}`),this.status=o,this.statusText=h,this.url=p,this.body=y}}const kr=()=>tt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Sr=function(l,o){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const p=_n(l.url);if(p)return p(l,o);if(tt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:kn},o)}if(!(/^file:/.test(h=l.url)||/^file:/.test(kr())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,y){return u(this,void 0,void 0,function*(){const b=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:kr(),signal:y.signal});p.type==="json"&&b.headers.set("Accept","application/json");const x=yield fetch(b);if(!x.ok){const A=yield x.blob();throw new wr(x.status,x.statusText,p.url,A)}let I;I=p.type==="arrayBuffer"||p.type==="image"?x.arrayBuffer():p.type==="json"?x.json():x.text();const L=yield I;if(y.signal.aborted)throw Tn();return{data:L,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(l,o);if(tt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:kn},o)}var h;return function(p,y){return new Promise((b,x)=>{const I=new XMLHttpRequest;I.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(I.responseType="arraybuffer");for(const L in p.headers)I.setRequestHeader(L,p.headers[L]);p.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=p.credentials==="include",I.onerror=()=>{x(new Error(I.statusText))},I.onload=()=>{if(!y.signal.aborted)if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){let L=I.response;if(p.type==="json")try{L=JSON.parse(I.response)}catch(A){return void x(A)}b({data:L,cacheControl:I.getResponseHeader("Cache-Control"),expires:I.getResponseHeader("Expires")})}else{const L=new Blob([I.response],{type:I.getResponseHeader("Content-Type")});x(new wr(I.status,I.statusText,p.url,L))}},y.signal.addEventListener("abort",()=>{I.abort(),x(Tn())}),I.send(p.body)})}(l,o)};function dr(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const o=new URL(l),h=window.location;return o.protocol===h.protocol&&o.host===h.host}function Qe(l,o,h){h[l]&&h[l].indexOf(o)!==-1||(h[l]=h[l]||[],h[l].push(o))}function ge(l,o,h){if(h&&h[l]){const p=h[l].indexOf(o);p!==-1&&h[l].splice(p,1)}}class Pe{constructor(o,h={}){se(this,h),this.type=o}}class It extends Pe{constructor(o,h={}){super("error",se({error:o},h))}}class Dn{on(o,h){return this._listeners=this._listeners||{},Qe(o,h,this._listeners),this}off(o,h){return ge(o,h,this._listeners),ge(o,h,this._oneTimeListeners),this}once(o,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Qe(o,h,this._oneTimeListeners),this):new Promise(p=>this.once(o,p))}fire(o,h){typeof o=="string"&&(o=new Pe(o,h||{}));const p=o.type;if(this.listens(p)){o.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of y)I.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of b)ge(p,I,this._oneTimeListeners),I.call(this,o);const x=this._eventedParent;x&&(se(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(o))}else o instanceof It&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,h){return this._eventedParent=o,this._eventedParentData=h,this}}var Oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Yt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Dr(l,o){const h={};for(const p in l)p!=="ref"&&(h[p]=l[p]);return Yt.forEach(p=>{p in o&&(h[p]=o[p])}),h}function ln(l,o){if(Array.isArray(l)){if(!Array.isArray(o)||l.length!==o.length)return!1;for(let h=0;h<l.length;h++)if(!ln(l[h],o[h]))return!1;return!0}if(typeof l=="object"&&l!==null&&o!==null){if(typeof o!="object"||Object.keys(l).length!==Object.keys(o).length)return!1;for(const h in l)if(!ln(l[h],o[h]))return!1;return!0}return l===o}function er(l,o){l.push(o)}function Mo(l,o,h){er(h,{command:"addSource",args:[l,o[l]]})}function ps(l,o,h){er(o,{command:"removeSource",args:[l]}),h[l]=!0}function Os(l,o,h,p){ps(l,h,p),Mo(l,o,h)}function Va(l,o,h){let p;for(p in l[h])if(Object.prototype.hasOwnProperty.call(l[h],p)&&p!=="data"&&!ln(l[h][p],o[h][p]))return!1;for(p in o[h])if(Object.prototype.hasOwnProperty.call(o[h],p)&&p!=="data"&&!ln(l[h][p],o[h][p]))return!1;return!0}function Pi(l,o,h,p,y,b){l=l||{},o=o||{};for(const x in l)Object.prototype.hasOwnProperty.call(l,x)&&(ln(l[x],o[x])||h.push({command:b,args:[p,x,o[x],y]}));for(const x in o)Object.prototype.hasOwnProperty.call(o,x)&&!Object.prototype.hasOwnProperty.call(l,x)&&(ln(l[x],o[x])||h.push({command:b,args:[p,x,o[x],y]}))}function xl(l){return l.id}function ds(l,o){return l[o.id]=o,l}class rt{constructor(o,h,p,y){this.message=(o?`${o}: `:"")+p,y&&(this.identifier=y),h!=null&&h.__line__&&(this.line=h.__line__)}}function Ko(l,...o){for(const h of o)for(const p in h)l[p]=h[p];return l}class Ki extends Error{constructor(o,h){super(h),this.message=h,this.key=o}}class wl{constructor(o,h=[]){this.parent=o,this.bindings={};for(const[p,y]of h)this.bindings[p]=y}concat(o){return new wl(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Kr={kind:"null"},ht={kind:"number"},tn={kind:"string"},$t={kind:"boolean"},Rr={kind:"color"},Jo={kind:"object"},Kt={kind:"value"},ga={kind:"collator"},Vr={kind:"formatted"},le={kind:"padding"},B={kind:"resolvedImage"},q={kind:"variableAnchorOffsetCollection"};function J(l,o){return{kind:"array",itemType:l,N:o}}function ne(l){if(l.kind==="array"){const o=ne(l.itemType);return typeof l.N=="number"?`array<${o}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${o}>`}return l.kind}const xe=[Kr,ht,tn,$t,Rr,Vr,Jo,J(Kt),le,B,q];function Q(l,o){if(o.kind==="error")return null;if(l.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Q(l.itemType,o.itemType))&&(typeof l.N!="number"||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if(l.kind==="value"){for(const h of xe)if(!Q(h,o))return null}}return`Expected ${ne(l)} but found ${ne(o)} instead.`}function we(l,o){return o.some(h=>h.kind===l.kind)}function de(l,o){return o.some(h=>h==="null"?l===null:h==="array"?Array.isArray(l):h==="object"?l&&!Array.isArray(l)&&typeof l=="object":h===typeof l)}function Ae(l,o){return l.kind==="array"&&o.kind==="array"?l.itemType.kind===o.itemType.kind&&typeof l.N=="number":l.kind===o.kind}const Ue=.96422,We=.82521,Xe=4/29,Tt=6/29,Dt=3*Tt*Tt,Ht=Tt*Tt*Tt,Zt=Math.PI/180,xn=180/Math.PI;function Xn(l){return(l%=360)<0&&(l+=360),l}function lr([l,o,h,p]){let y,b;const x=sn((.2225045*(l=Jr(l))+.7168786*(o=Jr(o))+.0606169*(h=Jr(h)))/1);l===o&&o===h?y=b=x:(y=sn((.4360747*l+.3850649*o+.1430804*h)/Ue),b=sn((.0139322*l+.0971045*o+.7141733*h)/We));const I=116*x-16;return[I<0?0:I,500*(y-x),200*(x-b),p]}function Jr(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function sn(l){return l>Ht?Math.pow(l,1/3):l/Dt+Xe}function Er([l,o,h,p]){let y=(l+16)/116,b=isNaN(o)?y:y+o/500,x=isNaN(h)?y:y-h/200;return y=1*Ji(y),b=Ue*Ji(b),x=We*Ji(x),[ai(3.1338561*b-1.6168667*y-.4906146*x),ai(-.9787684*b+1.9161415*y+.033454*x),ai(.0719453*b-.2289914*y+1.4052427*x),p]}function ai(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Ji(l){return l>Tt?l*l*l:Dt*(l-Xe)}function fo(l){return parseInt(l.padEnd(2,l),16)/255}function bi(l,o){return zs(o?l/100:l,0,1)}function zs(l,o,h){return Math.min(Math.max(o,l),h)}function tm(l){return!l.some(Number.isNaN)}const Gy={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Vn{constructor(o,h,p,y=1,b=!0){this.r=o,this.g=h,this.b=p,this.a=y,b||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[o,h,p,y]))}static parse(o){if(o instanceof Vn)return o;if(typeof o!="string")return;const h=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=Gy[p];if(y){const[x,I,L]=y;return[x/255,I/255,L/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const x=p.length<6?1:2;let I=1;return[fo(p.slice(I,I+=x)),fo(p.slice(I,I+=x)),fo(p.slice(I,I+=x)),fo(p.slice(I,I+x)||"ff")]}if(p.startsWith("rgb")){const x=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[I,L,A,N,O,G,H,K,ee,ae,pe,De]=x,ye=[N||" ",H||" ",ae].join("");if(ye==="  "||ye==="  /"||ye===",,"||ye===",,,"){const Ee=[A,G,ee].join(""),Ye=Ee==="%%%"?100:Ee===""?255:0;if(Ye){const Je=[zs(+L/Ye,0,1),zs(+O/Ye,0,1),zs(+K/Ye,0,1),pe?bi(+pe,De):1];if(tm(Je))return Je}}return}}const b=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[x,I,L,A,N,O,G,H,K]=b,ee=[L||" ",N||" ",G].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ae=[+I,zs(+A,0,100),zs(+O,0,100),H?bi(+H,K):1];if(tm(ae))return function([pe,De,ye,Ee]){function Ye(Je){const bt=(Je+pe/30)%12,Ct=De*Math.min(ye,1-ye);return ye-Ct*Math.max(-1,Math.min(bt-3,9-bt,1))}return pe=Xn(pe),De/=100,ye/=100,[Ye(0),Ye(8),Ye(4),Ee]}(ae)}}}(o);return h?new Vn(...h,!1):void 0}get rgb(){const{r:o,g:h,b:p,a:y}=this,b=y||1/0;return this.overwriteGetter("rgb",[o/b,h/b,p/b,y])}get hcl(){return this.overwriteGetter("hcl",function(o){const[h,p,y,b]=lr(o),x=Math.sqrt(p*p+y*y);return[Math.round(1e4*x)?Xn(Math.atan2(y,p)*xn):NaN,x,h,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",lr(this.rgb))}overwriteGetter(o,h){return Object.defineProperty(this,o,{value:h}),h}toString(){const[o,h,p,y]=this.rgb;return`rgba(${[o,h,p].map(b=>Math.round(255*b)).join(",")},${y})`}}Vn.black=new Vn(0,0,0,1),Vn.white=new Vn(1,1,1,1),Vn.transparent=new Vn(0,0,0,0),Vn.red=new Vn(1,0,0,1);class Jf{constructor(o,h,p){this.sensitivity=o?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,h){return this.collator.compare(o,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qf{constructor(o,h,p,y,b){this.text=o,this.image=h,this.scale=p,this.fontStack=y,this.textColor=b}}class Ao{constructor(o){this.sections=o}static fromString(o){return new Ao([new Qf(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Ao?o:Ao.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class po{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof po)return o;if(typeof o=="number")return new po([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const h of o)if(typeof h!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new po(o)}}toString(){return JSON.stringify(this.values)}}const Yu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qo{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Qo)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let h=0;h<o.length;h+=2){const p=o[h],y=o[h+1];if(typeof p!="string"||!Yu.has(p)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new Qo(o)}}toString(){return JSON.stringify(this.values)}}class $o{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new $o({name:o,available:!1}):null}}function iu(l,o,h,p){return typeof l=="number"&&l>=0&&l<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,o,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,o,h,p]:[l,o,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Jc(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Vn||l instanceof Jf||l instanceof Ao||l instanceof po||l instanceof Qo||l instanceof $o)return!0;if(Array.isArray(l)){for(const o of l)if(!Jc(o))return!1;return!0}if(typeof l=="object"){for(const o in l)if(!Jc(l[o]))return!1;return!0}return!1}function Qr(l){if(l===null)return Kr;if(typeof l=="string")return tn;if(typeof l=="boolean")return $t;if(typeof l=="number")return ht;if(l instanceof Vn)return Rr;if(l instanceof Jf)return ga;if(l instanceof Ao)return Vr;if(l instanceof po)return le;if(l instanceof Qo)return q;if(l instanceof $o)return B;if(Array.isArray(l)){const o=l.length;let h;for(const p of l){const y=Qr(p);if(h){if(h===y)continue;h=Kt;break}h=y}return J(h||Kt,o)}return Jo}function Ku(l){const o=typeof l;return l===null?"":o==="string"||o==="number"||o==="boolean"?String(l):l instanceof Vn||l instanceof Ao||l instanceof po||l instanceof Qo||l instanceof $o?l.toString():JSON.stringify(l)}class Ua{constructor(o,h){this.type=o,this.value=h}static parse(o,h){if(o.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Jc(o[1]))return h.error("invalid value");const p=o[1];let y=Qr(p);const b=h.expectedType;return y.kind!=="array"||y.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(y=b),new Ua(y,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class mr{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Qc={string:tn,number:ht,boolean:$t,object:Jo};class ko{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");let p,y=1;const b=o[0];if(b==="array"){let I,L;if(o.length>2){const A=o[1];if(typeof A!="string"||!(A in Qc)||A==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);I=Qc[A],y++}else I=Kt;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return h.error('The length argument to "array" must be a positive integer literal',2);L=o[2],y++}p=J(I,L)}else{if(!Qc[b])throw new Error(`Types doesn't contain name = ${b}`);p=Qc[b]}const x=[];for(;y<o.length;y++){const I=h.parse(o[y],y,Kt);if(!I)return null;x.push(I)}return new ko(p,x)}evaluate(o){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(o);if(!Q(this.type,Qr(p)))return p;if(h===this.args.length-1)throw new mr(`Expected value to be of type ${ne(this.type)}, but found ${ne(Qr(p))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const $c={"to-boolean":$t,"to-color":Rr,"to-number":ht,"to-string":tn};class Fs{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const p=o[0];if(!$c[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&o.length!==2)return h.error("Expected one argument.");const y=$c[p],b=[];for(let x=1;x<o.length;x++){const I=h.parse(o[x],x,Kt);if(!I)return null;b.push(I)}return new Fs(y,b)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let h,p;for(const y of this.args){if(h=y.evaluate(o),p=null,h instanceof Vn)return h;if(typeof h=="string"){const b=o.parseColor(h);if(b)return b}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:iu(h[0],h[1],h[2],h[3]),!p))return new Vn(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new mr(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const p of this.args){h=p.evaluate(o);const y=po.parse(h);if(y)return y}throw new mr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const p of this.args){h=p.evaluate(o);const y=Qo.parse(h);if(y)return y}throw new mr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const p of this.args){if(h=p.evaluate(o),h===null)return 0;const y=Number(h);if(!isNaN(y))return y}throw new mr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Ao.fromString(Ku(this.args[0].evaluate(o)));case"resolvedImage":return $o.fromString(Ku(this.args[0].evaluate(o)));default:return Ku(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Ju=["Unknown","Point","LineString","Polygon"];class Un{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ju[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let h=this._parseColorCache[o];return h||(h=this._parseColorCache[o]=Vn.parse(o)),h}}class eh{constructor(o,h,p=[],y,b=new wl,x=[]){this.registry=o,this.path=p,this.key=p.map(I=>`[${I}]`).join(""),this.scope=b,this.errors=x,this.expectedType=y,this._isConstant=h}parse(o,h,p,y,b={}){return h?this.concat(h,p,y)._parse(o,b):this._parse(o,b)}_parse(o,h){function p(y,b,x){return x==="assert"?new ko(b,[y]):x==="coerce"?new Fs(b,[y]):y}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=o[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[y];if(b){let x=b.parse(o,this);if(!x)return null;if(this.expectedType){const I=this.expectedType,L=x.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||L.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string")if(I.kind!=="padding"||L.kind!=="value"&&L.kind!=="number"&&L.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||L.kind!=="value"&&L.kind!=="array"){if(this.checkSubtype(I,L))return null}else x=p(x,I,h.typeAnnotation||"coerce");else x=p(x,I,h.typeAnnotation||"coerce");else x=p(x,I,h.typeAnnotation||"coerce");else x=p(x,I,h.typeAnnotation||"assert")}if(!(x instanceof Ua)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const I=new Un;try{x=new Ua(x.type,x.evaluate(I))}catch(L){return this.error(L.message),null}}return x}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,h,p){const y=typeof o=="number"?this.path.concat(o):this.path,b=p?this.scope.concat(p):this.scope;return new eh(this.registry,this._isConstant,y,h||null,b,this.errors)}error(o,...h){const p=`${this.key}${h.map(y=>`[${y}]`).join("")}`;this.errors.push(new Ki(p,o))}checkSubtype(o,h){const p=Q(o,h);return p&&this.error(p),p}}class ou{constructor(o,h,p){this.type=ga,this.locale=p,this.caseSensitive=o,this.diacriticSensitive=h}static parse(o,h){if(o.length!==2)return h.error("Expected one argument.");const p=o[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const y=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,$t);if(!y)return null;const b=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,$t);if(!b)return null;let x=null;return p.locale&&(x=h.parse(p.locale,1,tn),!x)?null:new ou(y,b,x)}evaluate(o){return new Jf(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const Ga=8192;function th(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function Qu(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function qy(l,o){const h=(180+l[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(h*y*Ga),Math.round(p*y*Ga)]}function nm(l,o,h){const p=l[0]-o[0],y=l[1]-o[1],b=l[0]-h[0],x=l[1]-h[1];return p*x-b*y==0&&p*b<=0&&y*x<=0}function nh(l,o){let h=!1;for(let x=0,I=o.length;x<I;x++){const L=o[x];for(let A=0,N=L.length;A<N-1;A++){if(nm(l,L[A],L[A+1]))return!1;(y=L[A])[1]>(p=l)[1]!=(b=L[A+1])[1]>p[1]&&p[0]<(b[0]-y[0])*(p[1]-y[1])/(b[1]-y[1])+y[0]&&(h=!h)}}var p,y,b;return h}function jy(l,o){for(let h=0;h<o.length;h++)if(nh(l,o[h]))return!0;return!1}function rm(l,o,h,p){const y=p[0]-h[0],b=p[1]-h[1],x=(l[0]-h[0])*b-y*(l[1]-h[1]),I=(o[0]-h[0])*b-y*(o[1]-h[1]);return x>0&&I<0||x<0&&I>0}function Wy(l,o,h){for(const A of h)for(let N=0;N<A.length-1;++N)if((I=[(x=A[N+1])[0]-(b=A[N])[0],x[1]-b[1]])[0]*(L=[(y=o)[0]-(p=l)[0],y[1]-p[1]])[1]-I[1]*L[0]!=0&&rm(p,y,b,x)&&rm(b,x,p,y))return!0;var p,y,b,x,I,L;return!1}function im(l,o){for(let h=0;h<l.length;++h)if(!nh(l[h],o))return!1;for(let h=0;h<l.length-1;++h)if(Wy(l[h],l[h+1],o))return!1;return!0}function om(l,o){for(let h=0;h<o.length;h++)if(im(l,o[h]))return!0;return!1}function rh(l,o,h){const p=[];for(let y=0;y<l.length;y++){const b=[];for(let x=0;x<l[y].length;x++){const I=qy(l[y][x],h);th(o,I),b.push(I)}p.push(b)}return p}function sm(l,o,h){const p=[];for(let y=0;y<l.length;y++){const b=rh(l[y],o,h);p.push(b)}return p}function am(l,o,h,p){if(l[0]<h[0]||l[0]>h[2]){const y=.5*p;let b=l[0]-h[0]>y?-p:h[0]-l[0]>y?p:0;b===0&&(b=l[0]-h[2]>y?-p:h[2]-l[0]>y?p:0),l[0]+=b}th(o,l)}function ih(l,o,h,p){const y=Math.pow(2,p.z)*Ga,b=[p.x*Ga,p.y*Ga],x=[];for(const I of l)for(const L of I){const A=[L.x+b[0],L.y+b[1]];am(A,o,h,y),x.push(A)}return x}function lm(l,o,h,p){const y=Math.pow(2,p.z)*Ga,b=[p.x*Ga,p.y*Ga],x=[];for(const L of l){const A=[];for(const N of L){const O=[N.x+b[0],N.y+b[1]];th(o,O),A.push(O)}x.push(A)}if(o[2]-o[0]<=y/2){(I=o)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const L of x)for(const A of L)am(A,o,h,y)}var I;return x}class Sl{constructor(o,h){this.type=$t,this.geojson=o,this.geometries=h}static parse(o,h){if(o.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Jc(o[1])){const p=o[1];if(p.type==="FeatureCollection"){const y=[];for(const b of p.features){const{type:x,coordinates:I}=b.geometry;x==="Polygon"&&y.push(I),x==="MultiPolygon"&&y.push(...I)}if(y.length)return new Sl(p,{type:"MultiPolygon",coordinates:y})}else if(p.type==="Feature"){const y=p.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Sl(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Sl(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(h,p){const y=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=h.canonicalID();if(p.type==="Polygon"){const I=rh(p.coordinates,b,x),L=ih(h.geometry(),y,b,x);if(!Qu(y,b))return!1;for(const A of L)if(!nh(A,I))return!1}if(p.type==="MultiPolygon"){const I=sm(p.coordinates,b,x),L=ih(h.geometry(),y,b,x);if(!Qu(y,b))return!1;for(const A of L)if(!jy(A,I))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(h,p){const y=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=h.canonicalID();if(p.type==="Polygon"){const I=rh(p.coordinates,b,x),L=lm(h.geometry(),y,b,x);if(!Qu(y,b))return!1;for(const A of L)if(!im(A,I))return!1}if(p.type==="MultiPolygon"){const I=sm(p.coordinates,b,x),L=lm(h.geometry(),y,b,x);if(!Qu(y,b))return!1;for(const A of L)if(!om(A,I))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class oh{constructor(o,h){this.type=h.type,this.name=o,this.boundExpression=h}static parse(o,h){if(o.length!==2||typeof o[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=o[1];return h.scope.has(p)?new oh(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class Do{constructor(o,h,p,y){this.name=o,this.type=h,this._evaluate=p,this.args=y}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,h){const p=o[0],y=Do.definitions[p];if(!y)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(y)?y[0]:y.type,x=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=x.filter(([A])=>!Array.isArray(A)||A.length===o.length-1);let L=null;for(const[A,N]of I){L=new eh(h.registry,$u,h.path,null,h.scope);const O=[];let G=!1;for(let H=1;H<o.length;H++){const K=o[H],ee=Array.isArray(A)?A[H-1]:A.type,ae=L.parse(K,1+O.length,ee);if(!ae){G=!0;break}O.push(ae)}if(!G)if(Array.isArray(A)&&A.length!==O.length)L.error(`Expected ${A.length} arguments, but found ${O.length} instead.`);else{for(let H=0;H<O.length;H++){const K=Array.isArray(A)?A[H]:A.type,ee=O[H];L.concat(H+1).checkSubtype(K,ee.type)}if(L.errors.length===0)return new Do(p,b,N,O)}}if(I.length===1)h.errors.push(...L.errors);else{const A=(I.length?I:x).map(([O])=>{return G=O,Array.isArray(G)?`(${G.map(ne).join(", ")})`:`(${ne(G.type)}...)`;var G}).join(" | "),N=[];for(let O=1;O<o.length;O++){const G=h.parse(o[O],1+N.length);if(!G)return null;N.push(ne(G.type))}h.error(`Expected arguments of type ${A}, but found (${N.join(", ")}) instead.`)}return null}static register(o,h){Do.definitions=h;for(const p in h)o[p]=Do}}function $u(l){if(l instanceof oh)return $u(l.boundExpression);if(l instanceof Do&&l.name==="error"||l instanceof ou||l instanceof Sl)return!1;const o=l instanceof Fs||l instanceof ko;let h=!0;return l.eachChild(p=>{h=o?h&&$u(p):h&&p instanceof Ua}),!!h&&sh(l)&&tc(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function sh(l){if(l instanceof Do&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Sl)return!1;let o=!0;return l.eachChild(h=>{o&&!sh(h)&&(o=!1)}),o}function ec(l){if(l instanceof Do&&l.name==="feature-state")return!1;let o=!0;return l.eachChild(h=>{o&&!ec(h)&&(o=!1)}),o}function tc(l,o){if(l instanceof Do&&o.indexOf(l.name)>=0)return!1;let h=!0;return l.eachChild(p=>{h&&!tc(p,o)&&(h=!1)}),h}function nc(l,o){const h=l.length-1;let p,y,b=0,x=h,I=0;for(;b<=x;)if(I=Math.floor((b+x)/2),p=l[I],y=l[I+1],p<=o){if(I===h||o<y)return I;b=I+1}else{if(!(p>o))throw new mr("Input is not a number.");x=I-1}return 0}class rc{constructor(o,h,p){this.type=o,this.input=h,this.labels=[],this.outputs=[];for(const[y,b]of p)this.labels.push(y),this.outputs.push(b)}static parse(o,h){if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(o[1],1,ht);if(!p)return null;const y=[];let b=null;h.expectedType&&h.expectedType.kind!=="value"&&(b=h.expectedType);for(let x=1;x<o.length;x+=2){const I=x===1?-1/0:o[x],L=o[x+1],A=x,N=x+1;if(typeof I!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(y.length&&y[y.length-1][0]>=I)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const O=h.parse(L,N,b);if(!O)return null;b=b||O.type,y.push([I,O])}return new rc(b,p,y)}evaluate(o){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(o);const y=this.input.evaluate(o);if(y<=h[0])return p[0].evaluate(o);const b=h.length;return y>=h[b-1]?p[b-1].evaluate(o):p[nc(h,y)].evaluate(o)}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Hy(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Zy=um;function um(l,o,h,p){this.cx=3*l,this.bx=3*(h-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=h,this.p2y=p}um.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(o===void 0&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var h=l,p=0;p<8;p++){var y=this.sampleCurveX(h)-l;if(Math.abs(y)<o)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=y/b}var x=0,I=1;for(h=l,p=0;p<20&&(y=this.sampleCurveX(h),!(Math.abs(y-l)<o));p++)l>y?x=h:I=h,h=.5*(I-x)+x;return h},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};var Xy=Hy(Zy);function El(l,o,h){return l+h*(o-l)}function ah(l,o,h){return l.map((p,y)=>El(p,o[y],h))}const Qi={number:El,color:function(l,o,h,p="rgb"){switch(p){case"rgb":{const[y,b,x,I]=ah(l.rgb,o.rgb,h);return new Vn(y,b,x,I,!1)}case"hcl":{const[y,b,x,I]=l.hcl,[L,A,N,O]=o.hcl;let G,H;if(isNaN(y)||isNaN(L))isNaN(y)?isNaN(L)?G=NaN:(G=L,x!==1&&x!==0||(H=A)):(G=y,N!==1&&N!==0||(H=b));else{let De=L-y;L>y&&De>180?De-=360:L<y&&y-L>180&&(De+=360),G=y+h*De}const[K,ee,ae,pe]=function([De,ye,Ee,Ye]){return De=isNaN(De)?0:De*Zt,Er([Ee,Math.cos(De)*ye,Math.sin(De)*ye,Ye])}([G,H??El(b,A,h),El(x,N,h),El(I,O,h)]);return new Vn(K,ee,ae,pe,!1)}case"lab":{const[y,b,x,I]=Er(ah(l.lab,o.lab,h));return new Vn(y,b,x,I,!1)}}},array:ah,padding:function(l,o,h){return new po(ah(l.values,o.values,h))},variableAnchorOffsetCollection:function(l,o,h){const p=l.values,y=o.values;if(p.length!==y.length)throw new mr(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${o.toString()}`);const b=[];for(let x=0;x<p.length;x+=2){if(p[x]!==y[x])throw new mr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${p[x]}, to[${x}]: ${y[x]}`);b.push(p[x]);const[I,L]=p[x+1],[A,N]=y[x+1];b.push([El(I,A,h),El(L,N,h)])}return new Qo(b)}};class Oi{constructor(o,h,p,y,b){this.type=o,this.operator=h,this.interpolation=p,this.input=y,this.labels=[],this.outputs=[];for(const[x,I]of b)this.labels.push(x),this.outputs.push(I)}static interpolationFactor(o,h,p,y){let b=0;if(o.name==="exponential")b=Rn(h,o.base,p,y);else if(o.name==="linear")b=Rn(h,1,p,y);else if(o.name==="cubic-bezier"){const x=o.controlPoints;b=new Xy(x[0],x[1],x[2],x[3]).solve(Rn(h,1,p,y))}return b}static parse(o,h){let[p,y,b,...x]=o;if(!Array.isArray(y)||y.length===0)return h.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const A=y[1];if(typeof A!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:A}}else{if(y[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const A=y.slice(1);if(A.length!==4||A.some(N=>typeof N!="number"||N<0||N>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:A}}}if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(b=h.parse(b,2,ht),!b)return null;const I=[];let L=null;p==="interpolate-hcl"||p==="interpolate-lab"?L=Rr:h.expectedType&&h.expectedType.kind!=="value"&&(L=h.expectedType);for(let A=0;A<x.length;A+=2){const N=x[A],O=x[A+1],G=A+3,H=A+4;if(typeof N!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(I.length&&I[I.length-1][0]>=N)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const K=h.parse(O,H,L);if(!K)return null;L=L||K.type,I.push([N,K])}return Ae(L,ht)||Ae(L,Rr)||Ae(L,le)||Ae(L,q)||Ae(L,J(ht))?new Oi(L,p,y,b,I):h.error(`Type ${ne(L)} is not interpolatable.`)}evaluate(o){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(o);const y=this.input.evaluate(o);if(y<=h[0])return p[0].evaluate(o);const b=h.length;if(y>=h[b-1])return p[b-1].evaluate(o);const x=nc(h,y),I=Oi.interpolationFactor(this.interpolation,y,h[x],h[x+1]),L=p[x].evaluate(o),A=p[x+1].evaluate(o);switch(this.operator){case"interpolate":return Qi[this.type.kind](L,A,I);case"interpolate-hcl":return Qi.color(L,A,I,"hcl");case"interpolate-lab":return Qi.color(L,A,I,"lab")}}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Rn(l,o,h,p){const y=p-h,b=l-h;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}class lh{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expectected at least one argument.");let p=null;const y=h.expectedType;y&&y.kind!=="value"&&(p=y);const b=[];for(const I of o.slice(1)){const L=h.parse(I,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!L)return null;p=p||L.type,b.push(L)}if(!p)throw new Error("No output type");const x=y&&b.some(I=>Q(y,I.type));return new lh(x?Kt:p,b)}evaluate(o){let h,p=null,y=0;for(const b of this.args)if(y++,p=b.evaluate(o),p&&p instanceof $o&&!p.available&&(h||(h=p.name),p=null,y===this.args.length&&(p=h)),p!==null)break;return p}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class uh{constructor(o,h){this.type=h.type,this.bindings=[].concat(o),this.result=h}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const h of this.bindings)o(h[1]);o(this.result)}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const p=[];for(let b=1;b<o.length-1;b+=2){const x=o[b];if(typeof x!="string")return h.error(`Expected string, but found ${typeof x} instead.`,b);if(/[^a-zA-Z0-9_]/.test(x))return h.error("Variable names must contain only alphanumeric characters or '_'.",b);const I=h.parse(o[b+1],b+1);if(!I)return null;p.push([x,I])}const y=h.parse(o[o.length-1],o.length-1,h.expectedType,p);return y?new uh(p,y):null}outputDefined(){return this.result.outputDefined()}}class $f{constructor(o,h,p){this.type=o,this.index=h,this.input=p}static parse(o,h){if(o.length!==3)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=h.parse(o[1],1,ht),y=h.parse(o[2],2,J(h.expectedType||Kt));return p&&y?new $f(y.type.itemType,p,y):null}evaluate(o){const h=this.index.evaluate(o),p=this.input.evaluate(o);if(h<0)throw new mr(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new mr(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new mr(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class ep{constructor(o,h){this.type=$t,this.needle=o,this.haystack=h}static parse(o,h){if(o.length!==3)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=h.parse(o[1],1,Kt),y=h.parse(o[2],2,Kt);return p&&y?we(p.type,[$t,tn,ht,Kr,Kt])?new ep(p,y):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(p.type)} instead`):null}evaluate(o){const h=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!p)return!1;if(!de(h,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${ne(Qr(h))} instead.`);if(!de(p,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${ne(Qr(p))} instead.`);return p.indexOf(h)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class ch{constructor(o,h,p){this.type=ht,this.needle=o,this.haystack=h,this.fromIndex=p}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=h.parse(o[1],1,Kt),y=h.parse(o[2],2,Kt);if(!p||!y)return null;if(!we(p.type,[$t,tn,ht,Kr,Kt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(p.type)} instead`);if(o.length===4){const b=h.parse(o[3],3,ht);return b?new ch(p,y,b):null}return new ch(p,y)}evaluate(o){const h=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!de(h,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${ne(Qr(h))} instead.`);if(!de(p,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${ne(Qr(p))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(o);return p.indexOf(h,y)}return p.indexOf(h)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class tp{constructor(o,h,p,y,b,x){this.inputType=o,this.type=h,this.input=p,this.cases=y,this.outputs=b,this.otherwise=x}static parse(o,h){if(o.length<5)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return h.error("Expected an even number of arguments.");let p,y;h.expectedType&&h.expectedType.kind!=="value"&&(y=h.expectedType);const b={},x=[];for(let A=2;A<o.length-1;A+=2){let N=o[A];const O=o[A+1];Array.isArray(N)||(N=[N]);const G=h.concat(A);if(N.length===0)return G.error("Expected at least one branch label.");for(const K of N){if(typeof K!="number"&&typeof K!="string")return G.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof K=="number"&&Math.floor(K)!==K)return G.error("Numeric branch labels must be integer values.");if(p){if(G.checkSubtype(p,Qr(K)))return null}else p=Qr(K);if(b[String(K)]!==void 0)return G.error("Branch labels must be unique.");b[String(K)]=x.length}const H=h.parse(O,A,y);if(!H)return null;y=y||H.type,x.push(H)}const I=h.parse(o[1],1,Kt);if(!I)return null;const L=h.parse(o[o.length-1],o.length-1,y);return L?I.type.kind!=="value"&&h.concat(1).checkSubtype(p,I.type)?null:new tp(p,y,I,b,x,L):null}evaluate(o){const h=this.input.evaluate(o);return(Qr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class np{constructor(o,h,p){this.type=o,this.branches=h,this.otherwise=p}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const y=[];for(let x=1;x<o.length-1;x+=2){const I=h.parse(o[x],x,$t);if(!I)return null;const L=h.parse(o[x+1],x+1,p);if(!L)return null;y.push([I,L]),p=p||L.type}const b=h.parse(o[o.length-1],o.length-1,p);if(!b)return null;if(!p)throw new Error("Can't infer output type");return new np(p,y,b)}evaluate(o){for(const[h,p]of this.branches)if(h.evaluate(o))return p.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[h,p]of this.branches)o(h),o(p);o(this.otherwise)}outputDefined(){return this.branches.every(([o,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class hh{constructor(o,h,p,y){this.type=o,this.input=h,this.beginIndex=p,this.endIndex=y}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=h.parse(o[1],1,Kt),y=h.parse(o[2],2,ht);if(!p||!y)return null;if(!we(p.type,[J(Kt),tn,Kt]))return h.error(`Expected first argument to be of type array or string, but found ${ne(p.type)} instead`);if(o.length===4){const b=h.parse(o[3],3,ht);return b?new hh(p.type,p,y,b):null}return new hh(p.type,p,y)}evaluate(o){const h=this.input.evaluate(o),p=this.beginIndex.evaluate(o);if(!de(h,["string","array"]))throw new mr(`Expected first argument to be of type array or string, but found ${ne(Qr(h))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(o);return h.slice(p,y)}return h.slice(p)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function cm(l,o){return l==="=="||l==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function hm(l,o,h,p){return p.compare(o,h)===0}function su(l,o,h){const p=l!=="=="&&l!=="!=";return class SI{constructor(b,x,I){this.type=$t,this.lhs=b,this.rhs=x,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||x.type.kind==="value"}static parse(b,x){if(b.length!==3&&b.length!==4)return x.error("Expected two or three arguments.");const I=b[0];let L=x.parse(b[1],1,Kt);if(!L)return null;if(!cm(I,L.type))return x.concat(1).error(`"${I}" comparisons are not supported for type '${ne(L.type)}'.`);let A=x.parse(b[2],2,Kt);if(!A)return null;if(!cm(I,A.type))return x.concat(2).error(`"${I}" comparisons are not supported for type '${ne(A.type)}'.`);if(L.type.kind!==A.type.kind&&L.type.kind!=="value"&&A.type.kind!=="value")return x.error(`Cannot compare types '${ne(L.type)}' and '${ne(A.type)}'.`);p&&(L.type.kind==="value"&&A.type.kind!=="value"?L=new ko(A.type,[L]):L.type.kind!=="value"&&A.type.kind==="value"&&(A=new ko(L.type,[A])));let N=null;if(b.length===4){if(L.type.kind!=="string"&&A.type.kind!=="string"&&L.type.kind!=="value"&&A.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(N=x.parse(b[3],3,ga),!N)return null}return new SI(L,A,N)}evaluate(b){const x=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const L=Qr(x),A=Qr(I);if(L.kind!==A.kind||L.kind!=="string"&&L.kind!=="number")throw new mr(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${L.kind}, ${A.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const L=Qr(x),A=Qr(I);if(L.kind!=="string"||A.kind!=="string")return o(b,x,I)}return this.collator?h(b,x,I,this.collator.evaluate(b)):o(b,x,I)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Yy=su("==",function(l,o,h){return o===h},hm),Ky=su("!=",function(l,o,h){return o!==h},function(l,o,h,p){return!hm(0,o,h,p)}),Jy=su("<",function(l,o,h){return o<h},function(l,o,h,p){return p.compare(o,h)<0}),Qy=su(">",function(l,o,h){return o>h},function(l,o,h,p){return p.compare(o,h)>0}),$y=su("<=",function(l,o,h){return o<=h},function(l,o,h,p){return p.compare(o,h)<=0}),e_=su(">=",function(l,o,h){return o>=h},function(l,o,h,p){return p.compare(o,h)>=0});class rp{constructor(o,h,p,y,b){this.type=tn,this.number=o,this.locale=h,this.currency=p,this.minFractionDigits=y,this.maxFractionDigits=b}static parse(o,h){if(o.length!==3)return h.error("Expected two arguments.");const p=h.parse(o[1],1,ht);if(!p)return null;const y=o[2];if(typeof y!="object"||Array.isArray(y))return h.error("NumberFormat options argument must be an object.");let b=null;if(y.locale&&(b=h.parse(y.locale,1,tn),!b))return null;let x=null;if(y.currency&&(x=h.parse(y.currency,1,tn),!x))return null;let I=null;if(y["min-fraction-digits"]&&(I=h.parse(y["min-fraction-digits"],1,ht),!I))return null;let L=null;return y["max-fraction-digits"]&&(L=h.parse(y["max-fraction-digits"],1,ht),!L)?null:new rp(p,b,x,I,L)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class fh{constructor(o){this.type=Vr,this.sections=o}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const p=o[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const y=[];let b=!1;for(let x=1;x<=o.length-1;++x){const I=o[x];if(b&&typeof I=="object"&&!Array.isArray(I)){b=!1;let L=null;if(I["font-scale"]&&(L=h.parse(I["font-scale"],1,ht),!L))return null;let A=null;if(I["text-font"]&&(A=h.parse(I["text-font"],1,J(tn)),!A))return null;let N=null;if(I["text-color"]&&(N=h.parse(I["text-color"],1,Rr),!N))return null;const O=y[y.length-1];O.scale=L,O.font=A,O.textColor=N}else{const L=h.parse(o[x],1,Kt);if(!L)return null;const A=L.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,y.push({content:L,scale:null,font:null,textColor:null})}}return new fh(y)}evaluate(o){return new Ao(this.sections.map(h=>{const p=h.content.evaluate(o);return Qr(p)===B?new Qf("",p,null,null,null):new Qf(Ku(p),null,h.scale?h.scale.evaluate(o):null,h.font?h.font.evaluate(o).join(","):null,h.textColor?h.textColor.evaluate(o):null)}))}eachChild(o){for(const h of this.sections)o(h.content),h.scale&&o(h.scale),h.font&&o(h.font),h.textColor&&o(h.textColor)}outputDefined(){return!1}}class ip{constructor(o){this.type=B,this.input=o}static parse(o,h){if(o.length!==2)return h.error("Expected two arguments.");const p=h.parse(o[1],1,tn);return p?new ip(p):h.error("No image name provided.")}evaluate(o){const h=this.input.evaluate(o),p=$o.fromString(h);return p&&o.availableImages&&(p.available=o.availableImages.indexOf(h)>-1),p}eachChild(o){o(this.input)}outputDefined(){return!1}}class op{constructor(o){this.type=ht,this.input=o}static parse(o,h){if(o.length!==2)return h.error(`Expected 1 argument, but found ${o.length-1} instead.`);const p=h.parse(o[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${ne(p.type)} instead.`):new op(p):null}evaluate(o){const h=this.input.evaluate(o);if(typeof h=="string"||Array.isArray(h))return h.length;throw new mr(`Expected value to be of type string or array, but found ${ne(Qr(h))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const au={"==":Yy,"!=":Ky,">":Qy,"<":Jy,">=":e_,"<=":$y,array:ko,at:$f,boolean:ko,case:np,coalesce:lh,collator:ou,format:fh,image:ip,in:ep,"index-of":ch,interpolate:Oi,"interpolate-hcl":Oi,"interpolate-lab":Oi,length:op,let:uh,literal:Ua,match:tp,number:ko,"number-format":rp,object:ko,slice:hh,step:rc,string:ko,"to-boolean":Fs,"to-color":Fs,"to-number":Fs,"to-string":Fs,var:oh,within:Sl};function fm(l,[o,h,p,y]){o=o.evaluate(l),h=h.evaluate(l),p=p.evaluate(l);const b=y?y.evaluate(l):1,x=iu(o,h,p,b);if(x)throw new mr(x);return new Vn(o/255,h/255,p/255,b,!1)}function pm(l,o){return l in o}function sp(l,o){const h=o[l];return h===void 0?null:h}function Il(l){return{type:l}}function dm(l){return{result:"success",value:l}}function lu(l){return{result:"error",value:l}}function uu(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function mm(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function ap(l){return!!l.expression&&l.expression.interpolated}function Cn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function ph(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function t_(l){return l}function gm(l,o){const h=o.type==="color",p=l.stops&&typeof l.stops[0][0]=="object",y=p||!(p||l.property!==void 0),b=l.type||(ap(o)?"exponential":"interval");if(h||o.type==="padding"){const N=h?Vn.parse:po.parse;(l=Ko({},l)).stops&&(l.stops=l.stops.map(O=>[O[0],N(O[1])])),l.default=N(l.default?l.default:o.default)}if(l.colorSpace&&(x=l.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var x;let I,L,A;if(b==="exponential")I=wn;else if(b==="interval")I=n_;else if(b==="categorical"){I=Ur,L=Object.create(null);for(const N of l.stops)L[N[0]]=N[1];A=typeof l.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);I=lp}if(p){const N={},O=[];for(let K=0;K<l.stops.length;K++){const ee=l.stops[K],ae=ee[0].zoom;N[ae]===void 0&&(N[ae]={zoom:ae,type:l.type,property:l.property,default:l.default,stops:[]},O.push(ae)),N[ae].stops.push([ee[0].value,ee[1]])}const G=[];for(const K of O)G.push([N[K].zoom,gm(N[K],o)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Oi.interpolationFactor.bind(void 0,H),zoomStops:G.map(K=>K[0]),evaluate:({zoom:K},ee)=>wn({stops:G,base:l.base},o,K).evaluate(K,ee)}}if(y){const N=b==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Oi.interpolationFactor.bind(void 0,N),zoomStops:l.stops.map(O=>O[0]),evaluate:({zoom:O})=>I(l,o,O,L,A)}}return{kind:"source",evaluate(N,O){const G=O&&O.properties?O.properties[l.property]:void 0;return G===void 0?ic(l.default,o.default):I(l,o,G,L,A)}}}function ic(l,o,h){return l!==void 0?l:o!==void 0?o:h!==void 0?h:void 0}function Ur(l,o,h,p,y){return ic(typeof h===y?p[h]:void 0,l.default,o.default)}function n_(l,o,h){if(Cn(h)!=="number")return ic(l.default,o.default);const p=l.stops.length;if(p===1||h<=l.stops[0][0])return l.stops[0][1];if(h>=l.stops[p-1][0])return l.stops[p-1][1];const y=nc(l.stops.map(b=>b[0]),h);return l.stops[y][1]}function wn(l,o,h){const p=l.base!==void 0?l.base:1;if(Cn(h)!=="number")return ic(l.default,o.default);const y=l.stops.length;if(y===1||h<=l.stops[0][0])return l.stops[0][1];if(h>=l.stops[y-1][0])return l.stops[y-1][1];const b=nc(l.stops.map(N=>N[0]),h),x=function(N,O,G,H){const K=H-G,ee=N-G;return K===0?0:O===1?ee/K:(Math.pow(O,ee)-1)/(Math.pow(O,K)-1)}(h,p,l.stops[b][0],l.stops[b+1][0]),I=l.stops[b][1],L=l.stops[b+1][1],A=Qi[o.type]||t_;return typeof I.evaluate=="function"?{evaluate(...N){const O=I.evaluate.apply(void 0,N),G=L.evaluate.apply(void 0,N);if(O!==void 0&&G!==void 0)return A(O,G,x,l.colorSpace)}}:A(I,L,x,l.colorSpace)}function lp(l,o,h){switch(o.type){case"color":h=Vn.parse(h);break;case"formatted":h=Ao.fromString(h.toString());break;case"resolvedImage":h=$o.fromString(h.toString());break;case"padding":h=po.parse(h);break;default:Cn(h)===o.type||o.type==="enum"&&o.values[h]||(h=void 0)}return ic(h,l.default,o.default)}Do.register(au,{error:[{kind:"error"},[tn],(l,[o])=>{throw new mr(o.evaluate(l))}],typeof:[tn,[Kt],(l,[o])=>ne(Qr(o.evaluate(l)))],"to-rgba":[J(ht,4),[Rr],(l,[o])=>{const[h,p,y,b]=o.evaluate(l).rgb;return[255*h,255*p,255*y,b]}],rgb:[Rr,[ht,ht,ht],fm],rgba:[Rr,[ht,ht,ht,ht],fm],has:{type:$t,overloads:[[[tn],(l,[o])=>pm(o.evaluate(l),l.properties())],[[tn,Jo],(l,[o,h])=>pm(o.evaluate(l),h.evaluate(l))]]},get:{type:Kt,overloads:[[[tn],(l,[o])=>sp(o.evaluate(l),l.properties())],[[tn,Jo],(l,[o,h])=>sp(o.evaluate(l),h.evaluate(l))]]},"feature-state":[Kt,[tn],(l,[o])=>sp(o.evaluate(l),l.featureState||{})],properties:[Jo,[],l=>l.properties()],"geometry-type":[tn,[],l=>l.geometryType()],id:[Kt,[],l=>l.id()],zoom:[ht,[],l=>l.globals.zoom],"heatmap-density":[ht,[],l=>l.globals.heatmapDensity||0],"line-progress":[ht,[],l=>l.globals.lineProgress||0],accumulated:[Kt,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[ht,Il(ht),(l,o)=>{let h=0;for(const p of o)h+=p.evaluate(l);return h}],"*":[ht,Il(ht),(l,o)=>{let h=1;for(const p of o)h*=p.evaluate(l);return h}],"-":{type:ht,overloads:[[[ht,ht],(l,[o,h])=>o.evaluate(l)-h.evaluate(l)],[[ht],(l,[o])=>-o.evaluate(l)]]},"/":[ht,[ht,ht],(l,[o,h])=>o.evaluate(l)/h.evaluate(l)],"%":[ht,[ht,ht],(l,[o,h])=>o.evaluate(l)%h.evaluate(l)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(l,[o,h])=>Math.pow(o.evaluate(l),h.evaluate(l))],sqrt:[ht,[ht],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[ht,[ht],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[ht,[ht],(l,[o])=>Math.log(o.evaluate(l))],log2:[ht,[ht],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[ht,[ht],(l,[o])=>Math.sin(o.evaluate(l))],cos:[ht,[ht],(l,[o])=>Math.cos(o.evaluate(l))],tan:[ht,[ht],(l,[o])=>Math.tan(o.evaluate(l))],asin:[ht,[ht],(l,[o])=>Math.asin(o.evaluate(l))],acos:[ht,[ht],(l,[o])=>Math.acos(o.evaluate(l))],atan:[ht,[ht],(l,[o])=>Math.atan(o.evaluate(l))],min:[ht,Il(ht),(l,o)=>Math.min(...o.map(h=>h.evaluate(l)))],max:[ht,Il(ht),(l,o)=>Math.max(...o.map(h=>h.evaluate(l)))],abs:[ht,[ht],(l,[o])=>Math.abs(o.evaluate(l))],round:[ht,[ht],(l,[o])=>{const h=o.evaluate(l);return h<0?-Math.round(-h):Math.round(h)}],floor:[ht,[ht],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[ht,[ht],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[$t,[tn,Kt],(l,[o,h])=>l.properties()[o.value]===h.value],"filter-id-==":[$t,[Kt],(l,[o])=>l.id()===o.value],"filter-type-==":[$t,[tn],(l,[o])=>l.geometryType()===o.value],"filter-<":[$t,[tn,Kt],(l,[o,h])=>{const p=l.properties()[o.value],y=h.value;return typeof p==typeof y&&p<y}],"filter-id-<":[$t,[Kt],(l,[o])=>{const h=l.id(),p=o.value;return typeof h==typeof p&&h<p}],"filter->":[$t,[tn,Kt],(l,[o,h])=>{const p=l.properties()[o.value],y=h.value;return typeof p==typeof y&&p>y}],"filter-id->":[$t,[Kt],(l,[o])=>{const h=l.id(),p=o.value;return typeof h==typeof p&&h>p}],"filter-<=":[$t,[tn,Kt],(l,[o,h])=>{const p=l.properties()[o.value],y=h.value;return typeof p==typeof y&&p<=y}],"filter-id-<=":[$t,[Kt],(l,[o])=>{const h=l.id(),p=o.value;return typeof h==typeof p&&h<=p}],"filter->=":[$t,[tn,Kt],(l,[o,h])=>{const p=l.properties()[o.value],y=h.value;return typeof p==typeof y&&p>=y}],"filter-id->=":[$t,[Kt],(l,[o])=>{const h=l.id(),p=o.value;return typeof h==typeof p&&h>=p}],"filter-has":[$t,[Kt],(l,[o])=>o.value in l.properties()],"filter-has-id":[$t,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[$t,[J(tn)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[$t,[J(Kt)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[$t,[tn,J(Kt)],(l,[o,h])=>h.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[$t,[tn,J(Kt)],(l,[o,h])=>function(p,y,b,x){for(;b<=x;){const I=b+x>>1;if(y[I]===p)return!0;y[I]>p?x=I-1:b=I+1}return!1}(l.properties()[o.value],h.value,0,h.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(l,[o,h])=>o.evaluate(l)&&h.evaluate(l)],[Il($t),(l,o)=>{for(const h of o)if(!h.evaluate(l))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(l,[o,h])=>o.evaluate(l)||h.evaluate(l)],[Il($t),(l,o)=>{for(const h of o)if(h.evaluate(l))return!0;return!1}]]},"!":[$t,[$t],(l,[o])=>!o.evaluate(l)],"is-supported-script":[$t,[tn],(l,[o])=>{const h=l.globals&&l.globals.isSupportedScript;return!h||h(o.evaluate(l))}],upcase:[tn,[tn],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[tn,[tn],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[tn,Il(Kt),(l,o)=>o.map(h=>Ku(h.evaluate(l))).join("")],"resolved-locale":[tn,[ga],(l,[o])=>o.evaluate(l).resolvedLocale()]});class rr{constructor(o,h){var p;this.expression=o,this._warningHistory={},this._evaluator=new Un,this._defaultValue=h?(p=h).type==="color"&&ph(p.default)?new Vn(0,0,0,0):p.type==="color"?Vn.parse(p.default)||null:p.type==="padding"?po.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Qo.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(o,h,p,y,b,x){return this._evaluator.globals=o,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=y,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(o,h,p,y,b,x){this._evaluator.globals=o,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=y,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function $n(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in au}function Cl(l,o){const h=new eh(au,$u,[],o?function(y){const b={color:Rr,string:tn,number:ht,enum:tn,boolean:$t,formatted:Vr,padding:le,resolvedImage:B,variableAnchorOffsetCollection:q};return y.type==="array"?J(b[y.value]||Kt,y.length):b[y.type]}(o):void 0),p=h.parse(l,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?dm(new rr(p,o)):lu(h.errors)}class dh{constructor(o,h){this.kind=o,this._styleExpression=h,this.isStateDependent=o!=="constant"&&!ec(h.expression)}evaluateWithoutErrorHandling(o,h,p,y,b,x){return this._styleExpression.evaluateWithoutErrorHandling(o,h,p,y,b,x)}evaluate(o,h,p,y,b,x){return this._styleExpression.evaluate(o,h,p,y,b,x)}}class up{constructor(o,h,p,y){this.kind=o,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=o!=="camera"&&!ec(h.expression),this.interpolationType=y}evaluateWithoutErrorHandling(o,h,p,y,b,x){return this._styleExpression.evaluateWithoutErrorHandling(o,h,p,y,b,x)}evaluate(o,h,p,y,b,x){return this._styleExpression.evaluate(o,h,p,y,b,x)}interpolationFactor(o,h,p){return this.interpolationType?Oi.interpolationFactor(this.interpolationType,o,h,p):0}}function ym(l,o){const h=Cl(l,o);if(h.result==="error")return h;const p=h.value.expression,y=sh(p);if(!y&&!uu(o))return lu([new Ki("","data expressions not supported")]);const b=tc(p,["zoom"]);if(!b&&!mm(o))return lu([new Ki("","zoom expressions not supported")]);const x=gh(p);return x||b?x instanceof Ki?lu([x]):x instanceof Oi&&!ap(o)?lu([new Ki("",'"interpolate" expressions cannot be used with this property')]):dm(x?new up(y?"camera":"composite",h.value,x.labels,x instanceof Oi?x.interpolation:void 0):new dh(y?"constant":"source",h.value)):lu([new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mh{constructor(o,h){this._parameters=o,this._specification=h,Ko(this,gm(this._parameters,this._specification))}static deserialize(o){return new mh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function gh(l){let o=null;if(l instanceof uh)o=gh(l.result);else if(l instanceof lh){for(const h of l.args)if(o=gh(h),o)break}else(l instanceof rc||l instanceof Oi)&&l.input instanceof Do&&l.input.name==="zoom"&&(o=l);return o instanceof Ki||l.eachChild(h=>{const p=gh(h);p instanceof Ki?o=p:!o&&p?o=new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&p&&o!==p&&(o=new Ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function yh(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!yh(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const _m={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _h(l){if(l==null)return{filter:()=>!0,needGeometry:!1};yh(l)||(l=bh(l));const o=Cl(l,_m);if(o.result==="error")throw new Error(o.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,y)=>o.value.evaluate(h,p,{},y),needGeometry:vh(l)}}function vm(l,o){return l<o?-1:l>o?1:0}function vh(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(let o=1;o<l.length;o++)if(vh(l[o]))return!0;return!1}function bh(l){if(!l)return!0;const o=l[0];return l.length<=1?o!=="any":o==="=="?cp(l[1],l[2],"=="):o==="!="?xh(cp(l[1],l[2],"==")):o==="<"||o===">"||o==="<="||o===">="?cp(l[1],l[2],o):o==="any"?(h=l.slice(1),["any"].concat(h.map(bh))):o==="all"?["all"].concat(l.slice(1).map(bh)):o==="none"?["all"].concat(l.slice(1).map(bh).map(xh)):o==="in"?bm(l[1],l.slice(2)):o==="!in"?xh(bm(l[1],l.slice(2))):o==="has"?xm(l[1]):o==="!has"?xh(xm(l[1])):o!=="within"||l;var h}function cp(l,o,h){switch(l){case"$type":return[`filter-type-${h}`,o];case"$id":return[`filter-id-${h}`,o];default:return[`filter-${h}`,l,o]}}function bm(l,o){if(o.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(h=>typeof h!=typeof o[0])?["filter-in-large",l,["literal",o.sort(vm)]]:["filter-in-small",l,["literal",o]]}}function xm(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function xh(l){return["!",l]}function hp(l){const o=typeof l;if(o==="number"||o==="boolean"||o==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let y="[";for(const b of l)y+=`${hp(b)},`;return`${y}]`}const h=Object.keys(l).sort();let p="{";for(let y=0;y<h.length;y++)p+=`${JSON.stringify(h[y])}:${hp(l[h[y]])},`;return`${p}}`}function r_(l){let o="";for(const h of Yt)o+=`/${hp(l[h])}`;return o}function wm(l){const o=l.value;return o?[new rt(l.key,o,"constants have been deprecated as of v8")]:[]}function Ir(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function qa(l){if(Array.isArray(l))return l.map(qa);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const h in l)o[h]=qa(l[h]);return o}return Ir(l)}function $i(l){const o=l.key,h=l.value,p=l.valueSpec||{},y=l.objectElementValidators||{},b=l.style,x=l.styleSpec,I=l.validateSpec;let L=[];const A=Cn(h);if(A!=="object")return[new rt(o,h,`object expected, ${A} found`)];for(const N in h){const O=N.split(".")[0],G=p[O]||p["*"];let H;if(y[O])H=y[O];else if(p[O])H=I;else if(y["*"])H=y["*"];else{if(!p["*"]){L.push(new rt(o,h[N],`unknown property "${N}"`));continue}H=I}L=L.concat(H({key:(o&&`${o}.`)+N,value:h[N],valueSpec:G,style:b,styleSpec:x,object:h,objectKey:N,validateSpec:I},h))}for(const N in p)y[N]||p[N].required&&p[N].default===void 0&&h[N]===void 0&&L.push(new rt(o,h,`missing required property "${N}"`));return L}function fp(l){const o=l.value,h=l.valueSpec,p=l.style,y=l.styleSpec,b=l.key,x=l.arrayElementValidator||l.validateSpec;if(Cn(o)!=="array")return[new rt(b,o,`array expected, ${Cn(o)} found`)];if(h.length&&o.length!==h.length)return[new rt(b,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new rt(b,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let I={type:h.value,values:h.values};y.$version<7&&(I.function=h.function),Cn(h.value)==="object"&&(I=h.value);let L=[];for(let A=0;A<o.length;A++)L=L.concat(x({array:o,arrayIndex:A,value:o[A],valueSpec:I,validateSpec:l.validateSpec,style:p,styleSpec:y,key:`${b}[${A}]`}));return L}function wh(l){const o=l.key,h=l.value,p=l.valueSpec;let y=Cn(h);return y==="number"&&h!=h&&(y="NaN"),y!=="number"?[new rt(o,h,`number expected, ${y} found`)]:"minimum"in p&&h<p.minimum?[new rt(o,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new rt(o,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function Sm(l){const o=l.valueSpec,h=Ir(l.value.type);let p,y,b,x={};const I=h!=="categorical"&&l.value.property===void 0,L=!I,A=Cn(l.value.stops)==="array"&&Cn(l.value.stops[0])==="array"&&Cn(l.value.stops[0][0])==="object",N=$i({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(H){if(h==="identity")return[new rt(H.key,H.value,'identity function may not have a "stops" property')];let K=[];const ee=H.value;return K=K.concat(fp({key:H.key,value:ee,valueSpec:H.valueSpec,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:O})),Cn(ee)==="array"&&ee.length===0&&K.push(new rt(H.key,ee,"array must have at least one stop")),K},default:function(H){return H.validateSpec({key:H.key,value:H.value,valueSpec:o,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec})}}});return h==="identity"&&I&&N.push(new rt(l.key,l.value,'missing required property "property"')),h==="identity"||l.value.stops||N.push(new rt(l.key,l.value,'missing required property "stops"')),h==="exponential"&&l.valueSpec.expression&&!ap(l.valueSpec)&&N.push(new rt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(L&&!uu(l.valueSpec)?N.push(new rt(l.key,l.value,"property functions not supported")):I&&!mm(l.valueSpec)&&N.push(new rt(l.key,l.value,"zoom functions not supported"))),h!=="categorical"&&!A||l.value.property!==void 0||N.push(new rt(l.key,l.value,'"property" property is required')),N;function O(H){let K=[];const ee=H.value,ae=H.key;if(Cn(ee)!=="array")return[new rt(ae,ee,`array expected, ${Cn(ee)} found`)];if(ee.length!==2)return[new rt(ae,ee,`array length 2 expected, length ${ee.length} found`)];if(A){if(Cn(ee[0])!=="object")return[new rt(ae,ee,`object expected, ${Cn(ee[0])} found`)];if(ee[0].zoom===void 0)return[new rt(ae,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new rt(ae,ee,"object stop key must have value")];if(b&&b>Ir(ee[0].zoom))return[new rt(ae,ee[0].zoom,"stop zoom values must appear in ascending order")];Ir(ee[0].zoom)!==b&&(b=Ir(ee[0].zoom),y=void 0,x={}),K=K.concat($i({key:`${ae}[0]`,value:ee[0],valueSpec:{zoom:{}},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:wh,value:G}}))}else K=K.concat(G({key:`${ae}[0]`,value:ee[0],valueSpec:{},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec},ee));return $n(qa(ee[1]))?K.concat([new rt(`${ae}[1]`,ee[1],"expressions are not allowed in function stops.")]):K.concat(H.validateSpec({key:`${ae}[1]`,value:ee[1],valueSpec:o,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec}))}function G(H,K){const ee=Cn(H.value),ae=Ir(H.value),pe=H.value!==null?H.value:K;if(p){if(ee!==p)return[new rt(H.key,pe,`${ee} stop domain type must match previous stop domain type ${p}`)]}else p=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean")return[new rt(H.key,pe,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&h!=="categorical"){let De=`number expected, ${ee} found`;return uu(o)&&h===void 0&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(H.key,pe,De)]}return h!=="categorical"||ee!=="number"||isFinite(ae)&&Math.floor(ae)===ae?h!=="categorical"&&ee==="number"&&y!==void 0&&ae<y?[new rt(H.key,pe,"stop domain values must appear in ascending order")]:(y=ae,h==="categorical"&&ae in x?[new rt(H.key,pe,"stop domain values must be unique")]:(x[ae]=!0,[])):[new rt(H.key,pe,`integer expected, found ${ae}`)]}}function ja(l){const o=(l.expressionContext==="property"?ym:Cl)(qa(l.value),l.valueSpec);if(o.result==="error")return o.value.map(p=>new rt(`${l.key}${p.key}`,l.value,p.message));const h=o.value.expression||o.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!h.outputDefined())return[new rt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!ec(h))return[new rt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!ec(h))return[new rt(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!tc(h,["zoom","feature-state"]))return[new rt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!sh(h))return[new rt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wa(l){const o=l.key,h=l.value,p=l.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Ir(h))===-1&&y.push(new rt(o,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(Ir(h))===-1&&y.push(new rt(o,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),y}function cu(l){return yh(qa(l.value))?ja(Ko({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pp(l)}function pp(l){const o=l.value,h=l.key;if(Cn(o)!=="array")return[new rt(h,o,`array expected, ${Cn(o)} found`)];const p=l.styleSpec;let y,b=[];if(o.length<1)return[new rt(h,o,"filter array must have at least 1 element")];switch(b=b.concat(Wa({key:`${h}[0]`,value:o[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),Ir(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Ir(o[1])==="$type"&&b.push(new rt(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&b.push(new rt(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(y=Cn(o[1]),y!=="string"&&b.push(new rt(`${h}[1]`,o[1],`string expected, ${y} found`)));for(let x=2;x<o.length;x++)y=Cn(o[x]),Ir(o[1])==="$type"?b=b.concat(Wa({key:`${h}[${x}]`,value:o[x],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&b.push(new rt(`${h}[${x}]`,o[x],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let x=1;x<o.length;x++)b=b.concat(pp({key:`${h}[${x}]`,value:o[x],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":y=Cn(o[1]),o.length!==2?b.push(new rt(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):y!=="string"&&b.push(new rt(`${h}[1]`,o[1],`string expected, ${y} found`));break;case"within":y=Cn(o[1]),o.length!==2?b.push(new rt(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):y!=="object"&&b.push(new rt(`${h}[1]`,o[1],`object expected, ${y} found`))}return b}function Sh(l,o){const h=l.key,p=l.validateSpec,y=l.style,b=l.styleSpec,x=l.value,I=l.objectKey,L=b[`${o}_${l.layerType}`];if(!L)return[];const A=I.match(/^(.*)-transition$/);if(o==="paint"&&A&&L[A[1]]&&L[A[1]].transition)return p({key:h,value:x,valueSpec:b.transition,style:y,styleSpec:b});const N=l.valueSpec||L[I];if(!N)return[new rt(h,x,`unknown property "${I}"`)];let O;if(Cn(x)==="string"&&uu(N)&&!N.tokens&&(O=/^{([^}]+)}$/.exec(x)))return[new rt(h,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const G=[];return l.layerType==="symbol"&&(I==="text-field"&&y&&!y.glyphs&&G.push(new rt(h,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&ph(qa(x))&&Ir(x.type)==="identity"&&G.push(new rt(h,x,'"text-font" does not support identity functions'))),G.concat(p({key:l.key,value:x,valueSpec:N,style:y,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:I}))}function dp(l){return Sh(l,"paint")}function mp(l){return Sh(l,"layout")}function oc(l){let o=[];const h=l.value,p=l.key,y=l.style,b=l.styleSpec;h.type||h.ref||o.push(new rt(p,h,'either "type" or "ref" is required'));let x=Ir(h.type);const I=Ir(h.ref);if(h.id){const L=Ir(h.id);for(let A=0;A<l.arrayIndex;A++){const N=y.layers[A];Ir(N.id)===L&&o.push(new rt(p,h.id,`duplicate layer id "${h.id}", previously used at line ${N.id.__line__}`))}}if("ref"in h){let L;["type","source","source-layer","filter","layout"].forEach(A=>{A in h&&o.push(new rt(p,h[A],`"${A}" is prohibited for ref layers`))}),y.layers.forEach(A=>{Ir(A.id)===I&&(L=A)}),L?L.ref?o.push(new rt(p,h.ref,"ref cannot reference another ref layer")):x=Ir(L.type):o.push(new rt(p,h.ref,`ref layer "${I}" not found`))}else if(x!=="background")if(h.source){const L=y.sources&&y.sources[h.source],A=L&&Ir(L.type);L?A==="vector"&&x==="raster"?o.push(new rt(p,h.source,`layer "${h.id}" requires a raster source`)):A!=="raster-dem"&&x==="hillshade"?o.push(new rt(p,h.source,`layer "${h.id}" requires a raster-dem source`)):A==="raster"&&x!=="raster"?o.push(new rt(p,h.source,`layer "${h.id}" requires a vector source`)):A!=="vector"||h["source-layer"]?A==="raster-dem"&&x!=="hillshade"?o.push(new rt(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!h.paint||!h.paint["line-gradient"]||A==="geojson"&&L.lineMetrics||o.push(new rt(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new rt(p,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new rt(p,h.source,`source "${h.source}" not found`))}else o.push(new rt(p,h,'missing required property "source"'));return o=o.concat($i({key:p,value:h,valueSpec:b.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${p}.type`,value:h.type,valueSpec:b.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:h,objectKey:"type"}),filter:cu,layout:L=>$i({layer:h,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":A=>mp(Ko({layerType:x},A))}}),paint:L=>$i({layer:h,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":A=>dp(Ko({layerType:x},A))}})}})),o}function Tl(l){const o=l.value,h=l.key,p=Cn(o);return p!=="string"?[new rt(h,o,`string expected, ${p} found`)]:[]}const Em={promoteId:function({key:l,value:o}){if(Cn(o)==="string")return Tl({key:l,value:o});{const h=[];for(const p in o)h.push(...Tl({key:`${l}.${p}`,value:o[p]}));return h}}};function Im(l){const o=l.value,h=l.key,p=l.styleSpec,y=l.style,b=l.validateSpec;if(!o.type)return[new rt(h,o,'"type" is required')];const x=Ir(o.type);let I;switch(x){case"vector":case"raster":return I=$i({key:h,value:o,valueSpec:p[`source_${x.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:Em,validateSpec:b}),I;case"raster-dem":return I=function(L){var A;const N=(A=L.sourceName)!==null&&A!==void 0?A:"",O=L.value,G=L.styleSpec,H=G.source_raster_dem,K=L.style;let ee=[];const ae=Cn(O);if(O===void 0)return ee;if(ae!=="object")return ee.push(new rt("source_raster_dem",O,`object expected, ${ae} found`)),ee;const pe=Ir(O.encoding)==="custom",De=["redFactor","greenFactor","blueFactor","baseShift"],ye=L.value.encoding?`"${L.value.encoding}"`:"Default";for(const Ee in O)!pe&&De.includes(Ee)?ee.push(new rt(Ee,O[Ee],`In "${N}": "${Ee}" is only valid when "encoding" is set to "custom". ${ye} encoding found`)):H[Ee]?ee=ee.concat(L.validateSpec({key:Ee,value:O[Ee],valueSpec:H[Ee],validateSpec:L.validateSpec,style:K,styleSpec:G})):ee.push(new rt(Ee,O[Ee],`unknown property "${Ee}"`));return ee}({sourceName:h,value:o,style:l.style,styleSpec:p,validateSpec:b}),I;case"geojson":if(I=$i({key:h,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,validateSpec:b,objectElementValidators:Em}),o.cluster)for(const L in o.clusterProperties){const[A,N]=o.clusterProperties[L],O=typeof A=="string"?[A,["accumulated"],["get",L]]:A;I.push(...ja({key:`${h}.${L}.map`,value:N,validateSpec:b,expressionContext:"cluster-map"})),I.push(...ja({key:`${h}.${L}.reduce`,value:O,validateSpec:b,expressionContext:"cluster-reduce"}))}return I;case"video":return $i({key:h,value:o,valueSpec:p.source_video,style:y,validateSpec:b,styleSpec:p});case"image":return $i({key:h,value:o,valueSpec:p.source_image,style:y,validateSpec:b,styleSpec:p});case"canvas":return[new rt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wa({key:`${h}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,validateSpec:b,styleSpec:p})}}function Cm(l){const o=l.value,h=l.styleSpec,p=h.light,y=l.style;let b=[];const x=Cn(o);if(o===void 0)return b;if(x!=="object")return b=b.concat([new rt("light",o,`object expected, ${x} found`)]),b;for(const I in o){const L=I.match(/^(.*)-transition$/);b=b.concat(L&&p[L[1]]&&p[L[1]].transition?l.validateSpec({key:I,value:o[I],valueSpec:h.transition,validateSpec:l.validateSpec,style:y,styleSpec:h}):p[I]?l.validateSpec({key:I,value:o[I],valueSpec:p[I],validateSpec:l.validateSpec,style:y,styleSpec:h}):[new rt(I,o[I],`unknown property "${I}"`)])}return b}function Tm(l){const o=l.value,h=l.styleSpec,p=h.sky,y=l.style,b=Cn(o);if(o===void 0)return[];if(b!=="object")return[new rt("sky",o,`object expected, ${b} found`)];let x=[];for(const I in o)x=x.concat(p[I]?Bs({key:I,value:o[I],valueSpec:p[I],style:y,styleSpec:h}):[new rt(I,o[I],`unknown property "${I}"`)]);return x}function sc(l){const o=l.value,h=l.styleSpec,p=h.terrain,y=l.style;let b=[];const x=Cn(o);if(o===void 0)return b;if(x!=="object")return b=b.concat([new rt("terrain",o,`object expected, ${x} found`)]),b;for(const I in o)b=b.concat(p[I]?l.validateSpec({key:I,value:o[I],valueSpec:p[I],validateSpec:l.validateSpec,style:y,styleSpec:h}):[new rt(I,o[I],`unknown property "${I}"`)]);return b}function ac(l){let o=[];const h=l.value,p=l.key;if(Array.isArray(h)){const y=[],b=[];for(const x in h)h[x].id&&y.includes(h[x].id)&&o.push(new rt(p,h,`all the sprites' ids must be unique, but ${h[x].id} is duplicated`)),y.push(h[x].id),h[x].url&&b.includes(h[x].url)&&o.push(new rt(p,h,`all the sprites' URLs must be unique, but ${h[x].url} is duplicated`)),b.push(h[x].url),o=o.concat($i({key:`${p}[${x}]`,value:h[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return o}return Tl({key:p,value:h})}const mo={"*":()=>[],array:fp,boolean:function(l){const o=l.value,h=l.key,p=Cn(o);return p!=="boolean"?[new rt(h,o,`boolean expected, ${p} found`)]:[]},number:wh,color:function(l){const o=l.key,h=l.value,p=Cn(h);return p!=="string"?[new rt(o,h,`color expected, ${p} found`)]:Vn.parse(String(h))?[]:[new rt(o,h,`color expected, "${h}" found`)]},constants:wm,enum:Wa,filter:cu,function:Sm,layer:oc,object:$i,source:Im,light:Cm,sky:Tm,terrain:sc,string:Tl,formatted:function(l){return Tl(l).length===0?[]:ja(l)},resolvedImage:function(l){return Tl(l).length===0?[]:ja(l)},padding:function(l){const o=l.key,h=l.value;if(Cn(h)==="array"){if(h.length<1||h.length>4)return[new rt(o,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let y=[];for(let b=0;b<h.length;b++)y=y.concat(l.validateSpec({key:`${o}[${b}]`,value:h[b],validateSpec:l.validateSpec,valueSpec:p}));return y}return wh({key:o,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(l){const o=l.key,h=l.value,p=Cn(h),y=l.styleSpec;if(p!=="array"||h.length<1||h.length%2!=0)return[new rt(o,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let x=0;x<h.length;x+=2)b=b.concat(Wa({key:`${o}[${x}]`,value:h[x],valueSpec:y.layout_symbol["text-anchor"]})),b=b.concat(fp({key:`${o}[${x+1}]`,value:h[x+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:y}));return b},sprite:ac};function Bs(l){const o=l.value,h=l.valueSpec,p=l.styleSpec;return l.validateSpec=Bs,h.expression&&ph(Ir(o))?Sm(l):h.expression&&$n(qa(o))?ja(l):h.type&&mo[h.type]?mo[h.type](l):$i(Ko({},l,{valueSpec:h.type?p[h.type]:h}))}function gp(l){const o=l.value,h=l.key,p=Tl(l);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new rt(h,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new rt(h,o,'"glyphs" url must include a "{range}" token'))),p}function ms(l,o=Oe){let h=[];return h=h.concat(Bs({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,validateSpec:Bs,objectElementValidators:{glyphs:gp,"*":()=>[]}})),l.constants&&(h=h.concat(wm({key:"constants",value:l.constants,style:l,styleSpec:o,validateSpec:Bs}))),hu(h)}function Vs(l){return function(o){return l({...o,validateSpec:Bs})}}function hu(l){return[].concat(l).sort((o,h)=>o.line-h.line)}function gs(l){return function(...o){return hu(l.apply(this,o))}}ms.source=gs(Vs(Im)),ms.sprite=gs(Vs(ac)),ms.glyphs=gs(Vs(gp)),ms.light=gs(Vs(Cm)),ms.sky=gs(Vs(Tm)),ms.terrain=gs(Vs(sc)),ms.layer=gs(Vs(oc)),ms.filter=gs(Vs(cu)),ms.paintProperty=gs(Vs(dp)),ms.layoutProperty=gs(Vs(mp));const Ll=ms,i_=Ll.light,yp=Ll.paintProperty,o_=Ll.layoutProperty;function fu(l,o){let h=!1;if(o&&o.length)for(const p of o)l.fire(new It(new Error(p.message))),h=!0;return h}class lc{constructor(o,h,p){const y=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const x=new Int32Array(this.arrayBuffer);o=x[0],this.d=(h=x[1])+2*(p=x[2]);for(let L=0;L<this.d*this.d;L++){const A=x[3+L],N=x[3+L+1];y.push(A===N?null:x.subarray(A,N))}const I=x[3+y.length+1];this.keys=x.subarray(x[3+y.length],I),this.bboxes=x.subarray(I),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let x=0;x<this.d*this.d;x++)y.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=o,this.padding=p,this.scale=h/o,this.uid=0;const b=p/h*o;this.min=-b,this.max=o+b}insert(o,h,p,y,b){this._forEachCell(h,p,y,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,h,p,y,b,x){this.cells[b].push(x)}query(o,h,p,y,b){const x=this.min,I=this.max;if(o<=x&&h<=x&&I<=p&&I<=y&&!b)return Array.prototype.slice.call(this.keys);{const L=[];return this._forEachCell(o,h,p,y,this._queryCell,L,{},b),L}}_queryCell(o,h,p,y,b,x,I,L){const A=this.cells[b];if(A!==null){const N=this.keys,O=this.bboxes;for(let G=0;G<A.length;G++){const H=A[G];if(I[H]===void 0){const K=4*H;(L?L(O[K+0],O[K+1],O[K+2],O[K+3]):o<=O[K+2]&&h<=O[K+3]&&p>=O[K+0]&&y>=O[K+1])?(I[H]=!0,x.push(N[H])):I[H]=!1}}}}_forEachCell(o,h,p,y,b,x,I,L){const A=this._convertToCellCoord(o),N=this._convertToCellCoord(h),O=this._convertToCellCoord(p),G=this._convertToCellCoord(y);for(let H=A;H<=O;H++)for(let K=N;K<=G;K++){const ee=this.d*K+H;if((!L||L(this._convertFromCellCoord(H),this._convertFromCellCoord(K),this._convertFromCellCoord(H+1),this._convertFromCellCoord(K+1)))&&b.call(this,o,h,p,y,ee,x,I,L))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,h=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const y=new Int32Array(h+p+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let b=h;for(let x=0;x<o.length;x++){const I=o[x];y[3+x]=b,y.set(I,b),b+=I.length}return y[3+o.length]=b,y.set(this.keys,b),b+=this.keys.length,y[3+o.length+1]=b,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer}static serialize(o,h){const p=o.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(o){return new lc(o.buffer)}}const Us={};function St(l,o,h={}){if(Us[l])throw new Error(`${l} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:l,writeable:!1}),Us[l]={klass:o,omit:h.omit||[],shallow:h.shallow||[]}}St("Object",Object),St("TransferableGridIndex",lc),St("Color",Vn),St("Error",Error),St("AJAXError",wr),St("ResolvedImage",$o),St("StylePropertyFunction",mh),St("StyleExpression",rr,{omit:["_evaluator"]}),St("ZoomDependentExpression",up),St("ZoomConstantExpression",dh),St("CompoundExpression",Do,{omit:["_evaluate"]});for(const l in au)au[l]._classRegistryKey||St(`Expression_${l}`,au[l]);function Eh(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function pu(l,o){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error)return l;if(Eh(l)||Ot(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const h=l;return o&&o.push(h.buffer),h}if(l instanceof ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const h=[];for(const p of l)h.push(pu(p,o));return h}if(typeof l=="object"){const h=l.constructor,p=h._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!Us[p])throw new Error(`${p} is not registered.`);const y=h.serialize?h.serialize(l,o):{};if(h.serialize){if(o&&y===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in l){if(!l.hasOwnProperty(b)||Us[p].omit.indexOf(b)>=0)continue;const x=l[b];y[b]=Us[p].shallow.indexOf(b)>=0?x:pu(x,o)}l instanceof Error&&(y.message=l.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(y.$name=p),y}throw new Error("can't serialize object of type "+typeof l)}function du(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||Eh(l)||Ot(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(du);if(typeof l=="object"){const o=l.$name||"Object";if(!Us[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:h}=Us[o];if(!h)throw new Error(`can't deserialize unregistered class ${o}`);if(h.deserialize)return h.deserialize(l);const p=Object.create(h.prototype);for(const y of Object.keys(l)){if(y==="$name")continue;const b=l[y];p[y]=Us[o].shallow.indexOf(y)>=0?b:du(b)}return p}throw new Error("can't deserialize object of type "+typeof l)}class Lm{constructor(){this.first=!0}update(o,h){const p=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=p,!0))}}const _t={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function mu(l){for(const o of l)if(Ih(o.charCodeAt(0)))return!0;return!1}function Pm(l){for(const o of l)if(!Mm(o.charCodeAt(0)))return!1;return!0}function Mm(l){return!(_t.Arabic(l)||_t["Arabic Supplement"](l)||_t["Arabic Extended-A"](l)||_t["Arabic Presentation Forms-A"](l)||_t["Arabic Presentation Forms-B"](l))}function Ih(l){return!(l!==746&&l!==747&&(l<4352||!(_t["Bopomofo Extended"](l)||_t.Bopomofo(l)||_t["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||_t["CJK Compatibility Ideographs"](l)||_t["CJK Compatibility"](l)||_t["CJK Radicals Supplement"](l)||_t["CJK Strokes"](l)||!(!_t["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||_t["CJK Unified Ideographs Extension A"](l)||_t["CJK Unified Ideographs"](l)||_t["Enclosed CJK Letters and Months"](l)||_t["Hangul Compatibility Jamo"](l)||_t["Hangul Jamo Extended-A"](l)||_t["Hangul Jamo Extended-B"](l)||_t["Hangul Jamo"](l)||_t["Hangul Syllables"](l)||_t.Hiragana(l)||_t["Ideographic Description Characters"](l)||_t.Kanbun(l)||_t["Kangxi Radicals"](l)||_t["Katakana Phonetic Extensions"](l)||_t.Katakana(l)&&l!==12540||!(!_t["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!_t["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||_t["Unified Canadian Aboriginal Syllabics"](l)||_t["Unified Canadian Aboriginal Syllabics Extended"](l)||_t["Vertical Forms"](l)||_t["Yijing Hexagram Symbols"](l)||_t["Yi Syllables"](l)||_t["Yi Radicals"](l))))}function _p(l){return!(Ih(l)||function(o){return!!(_t["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||_t["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||_t["Letterlike Symbols"](o)||_t["Number Forms"](o)||_t["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||_t["Control Pictures"](o)&&o!==9251||_t["Optical Character Recognition"](o)||_t["Enclosed Alphanumerics"](o)||_t["Geometric Shapes"](o)||_t["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||_t["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||_t["CJK Symbols and Punctuation"](o)||_t.Katakana(o)||_t["Private Use Area"](o)||_t["CJK Compatibility Forms"](o)||_t["Small Form Variants"](o)||_t["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(l))}function Ch(l){return l>=1424&&l<=2303||_t["Arabic Presentation Forms-A"](l)||_t["Arabic Presentation Forms-B"](l)}function Am(l,o){return!(!o&&Ch(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||_t.Khmer(l))}function s_(l){for(const o of l)if(Ch(o.charCodeAt(0)))return!0;return!1}const Ha=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ur{constructor(o,h){this.zoom=o,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lm,this.transition={})}isSupportedScript(o){return function(h,p){for(const y of h)if(!Am(y.charCodeAt(0),p))return!1;return!0}(o,Ha.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,h=o-Math.floor(o),p=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class uc{constructor(o,h){this.property=o,this.value=h,this.expression=function(p,y){if(ph(p))return new mh(p,y);if($n(p)){const b=ym(p,y);if(b.result==="error")throw new Error(b.value.map(x=>`${x.key}: ${x.message}`).join(", "));return b.value}{let b=p;return y.type==="color"&&typeof p=="string"?b=Vn.parse(p):y.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?y.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(b=Qo.parse(p)):b=po.parse(p),{kind:"constant",evaluate:()=>b}}}(h===void 0?o.specification.default:h,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,h,p){return this.property.possiblyEvaluate(this,o,h,p)}}class Th{constructor(o){this.property=o,this.value=new uc(o,void 0)}transitioned(o,h){return new km(this.property,this.value,h,se({},o.transition,this.transition),o.now)}untransitioned(){return new km(this.property,this.value,null,{},0)}}class vp{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Z(this._values[o].value.value)}setValue(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Th(this._values[o].property)),this._values[o].value=new uc(this._values[o].property,h===null?void 0:Z(h))}getTransition(o){return Z(this._values[o].transition)}setTransition(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Th(this._values[o].property)),this._values[o].transition=Z(h)||void 0}serialize(){const o={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(o[h]=p);const y=this.getTransition(h);y!==void 0&&(o[`${h}-transition`]=y)}return o}transitioned(o,h){const p=new Dm(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].transitioned(o,h._values[y]);return p}untransitioned(){const o=new Dm(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].untransitioned();return o}}class km{constructor(o,h,p,y,b){this.property=o,this.value=h,this.begin=b+y.delay||0,this.end=this.begin+y.duration||0,o.specification.transition&&(y.delay||y.duration)&&(this.prior=p)}possiblyEvaluate(o,h,p){const y=o.now||0,b=this.value.possiblyEvaluate(o,h,p),x=this.prior;if(x){if(y>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(y<this.begin)return x.possiblyEvaluate(o,h,p);{const I=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(o,h,p),b,function(L){if(L<=0)return 0;if(L>=1)return 1;const A=L*L,N=A*L;return 4*(L<.5?N:3*(L-A)+N-.75)}(I))}}return b}}class Dm{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,h,p){const y=new cc(this._properties);for(const b of Object.keys(this._values))y._values[b]=this._values[b].possiblyEvaluate(o,h,p);return y}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Rm{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return Z(this._values[o].value)}setValue(o,h){this._values[o]=new uc(this._values[o].property,h===null?void 0:Z(h))}serialize(){const o={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(o[h]=p)}return o}possiblyEvaluate(o,h,p){const y=new cc(this._properties);for(const b of Object.keys(this._values))y._values[b]=this._values[b].possiblyEvaluate(o,h,p);return y}}class ys{constructor(o,h,p){this.property=o,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,h,p,y){return this.property.evaluate(this.value,this.parameters,o,h,p,y)}}class cc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class kt{constructor(o){this.specification=o}possiblyEvaluate(o,h){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(h)}interpolate(o,h,p){const y=Qi[this.specification.type];return y?y(o,h,p):o}}class Ft{constructor(o,h){this.specification=o,this.overrides=h}possiblyEvaluate(o,h,p,y){return new ys(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(h,null,{},p,y)}:o.expression,h)}interpolate(o,h,p){if(o.value.kind!=="constant"||h.value.kind!=="constant")return o;if(o.value.value===void 0||h.value.value===void 0)return new ys(this,{kind:"constant",value:void 0},o.parameters);const y=Qi[this.specification.type];if(y){const b=y(o.value.value,h.value.value,p);return new ys(this,{kind:"constant",value:b},o.parameters)}return o}evaluate(o,h,p,y,b,x){return o.kind==="constant"?o.value:o.evaluate(h,p,y,b,x)}}class Lh extends Ft{possiblyEvaluate(o,h,p,y){if(o.value===void 0)return new ys(this,{kind:"constant",value:void 0},h);if(o.expression.kind==="constant"){const b=o.expression.evaluate(h,null,{},p,y),x=o.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,I=this._calculate(x,x,x,h);return new ys(this,{kind:"constant",value:I},h)}if(o.expression.kind==="camera"){const b=this._calculate(o.expression.evaluate({zoom:h.zoom-1}),o.expression.evaluate({zoom:h.zoom}),o.expression.evaluate({zoom:h.zoom+1}),h);return new ys(this,{kind:"constant",value:b},h)}return new ys(this,o.expression,h)}evaluate(o,h,p,y,b,x){if(o.kind==="source"){const I=o.evaluate(h,p,y,b,x);return this._calculate(I,I,I,h)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(h.zoom)-1},p,y),o.evaluate({zoom:Math.floor(h.zoom)},p,y),o.evaluate({zoom:Math.floor(h.zoom)+1},p,y),h):o.value}_calculate(o,h,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:p,to:h}}interpolate(o){return o}}class hc{constructor(o){this.specification=o}possiblyEvaluate(o,h,p,y){if(o.value!==void 0){if(o.expression.kind==="constant"){const b=o.expression.evaluate(h,null,{},p,y);return this._calculate(b,b,b,h)}return this._calculate(o.expression.evaluate(new ur(Math.floor(h.zoom-1),h)),o.expression.evaluate(new ur(Math.floor(h.zoom),h)),o.expression.evaluate(new ur(Math.floor(h.zoom+1),h)),h)}}_calculate(o,h,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:p,to:h}}interpolate(o){return o}}class bp{constructor(o){this.specification=o}possiblyEvaluate(o,h,p,y){return!!o.expression.evaluate(h,null,{},p,y)}interpolate(){return!1}}class go{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in o){const p=o[h];p.specification.overridable&&this.overridableProperties.push(h);const y=this.defaultPropertyValues[h]=new uc(p,void 0),b=this.defaultTransitionablePropertyValues[h]=new Th(p);this.defaultTransitioningPropertyValues[h]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=y.possiblyEvaluate({})}}}St("DataDrivenProperty",Ft),St("DataConstantProperty",kt),St("CrossFadedDataDrivenProperty",Lh),St("CrossFadedProperty",hc),St("ColorRampProperty",bp);const xp="-transition";class _s extends Dn{constructor(o,h){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),h.layout&&(this._unevaluatedLayout=new Rm(h.layout)),h.paint)){this._transitionablePaint=new vp(h.paint);for(const p in o.paint)this.setPaintProperty(p,o.paint[p],{validate:!1});for(const p in o.layout)this.setLayoutProperty(p,o.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cc(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,h,p={}){h!=null&&this._validate(o_,`layers.${this.id}.layout.${o}`,o,h,p)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,h):this.visibility=h)}getPaintProperty(o){return o.endsWith(xp)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,h,p={}){if(h!=null&&this._validate(yp,`layers.${this.id}.paint.${o}`,o,h,p))return!1;if(o.endsWith(xp))return this._transitionablePaint.setTransition(o.slice(0,-11),h||void 0),!1;{const y=this._transitionablePaint._values[o],b=y.property.specification["property-type"]==="cross-faded-data-driven",x=y.value.isDataDriven(),I=y.value;this._transitionablePaint.setValue(o,h),this._handleSpecialPaintPropertyUpdate(o);const L=this._transitionablePaint._values[o].value;return L.isDataDriven()||x||b||this._handleOverridablePaintPropertyUpdate(o,I,L)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,h,p){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,h){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,h)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Ce(o,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(o,h,p,y,b={}){return(!b||b.validate!==!1)&&fu(this,o.call(Ll,{key:h,layerType:this.type,objectKey:p,value:y,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const h=this.paint.get(o);if(h instanceof ys&&uu(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const Nm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fc{constructor(o,h){this._structArray=o,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Cr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,h){return o._trim(),h&&(o.isTransferred=!0,h.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const h=Object.create(this.prototype);return h.arrayBuffer=o.arrayBuffer,h.length=o.length,h.capacity=o.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gr(l,o=1){let h=0,p=0;return{members:l.map(y=>{const b=Nm[y.type].BYTES_PER_ELEMENT,x=h=Om(h,Math.max(o,b)),I=y.components||1;return p=Math.max(p,b),h+=b*I,{name:y.name,type:y.type,components:I,offset:x}}),size:Om(h,Math.max(p,o)),alignment:o}}function Om(l,o){return Math.ceil(l/o)*o}class pc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h){const p=this.length;return this.resize(p+1),this.emplace(p,o,h)}emplace(o,h,p){const y=2*o;return this.int16[y+0]=h,this.int16[y+1]=p,o}}pc.prototype.bytesPerElement=4,St("StructArrayLayout2i4",pc);class ya extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,h,p)}emplace(o,h,p,y){const b=3*o;return this.int16[b+0]=h,this.int16[b+1]=p,this.int16[b+2]=y,o}}ya.prototype.bytesPerElement=6,St("StructArrayLayout3i6",ya);class wp extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,p,y)}emplace(o,h,p,y,b){const x=4*o;return this.int16[x+0]=h,this.int16[x+1]=p,this.int16[x+2]=y,this.int16[x+3]=b,o}}wp.prototype.bytesPerElement=8,St("StructArrayLayout4i8",wp);class Sp extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,h,p,y,b,x)}emplace(o,h,p,y,b,x,I){const L=6*o;return this.int16[L+0]=h,this.int16[L+1]=p,this.int16[L+2]=y,this.int16[L+3]=b,this.int16[L+4]=x,this.int16[L+5]=I,o}}Sp.prototype.bytesPerElement=12,St("StructArrayLayout2i4i12",Sp);class Ep extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,h,p,y,b,x)}emplace(o,h,p,y,b,x,I){const L=4*o,A=8*o;return this.int16[L+0]=h,this.int16[L+1]=p,this.uint8[A+4]=y,this.uint8[A+5]=b,this.uint8[A+6]=x,this.uint8[A+7]=I,o}}Ep.prototype.bytesPerElement=8,St("StructArrayLayout2i4ub8",Ep);class dc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h){const p=this.length;return this.resize(p+1),this.emplace(p,o,h)}emplace(o,h,p){const y=2*o;return this.float32[y+0]=h,this.float32[y+1]=p,o}}dc.prototype.bytesPerElement=8,St("StructArrayLayout2f8",dc);class Ph extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x,I,L,A,N){const O=this.length;return this.resize(O+1),this.emplace(O,o,h,p,y,b,x,I,L,A,N)}emplace(o,h,p,y,b,x,I,L,A,N,O){const G=10*o;return this.uint16[G+0]=h,this.uint16[G+1]=p,this.uint16[G+2]=y,this.uint16[G+3]=b,this.uint16[G+4]=x,this.uint16[G+5]=I,this.uint16[G+6]=L,this.uint16[G+7]=A,this.uint16[G+8]=N,this.uint16[G+9]=O,o}}Ph.prototype.bytesPerElement=20,St("StructArrayLayout10ui20",Ph);class Ip extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x,I,L,A,N,O,G){const H=this.length;return this.resize(H+1),this.emplace(H,o,h,p,y,b,x,I,L,A,N,O,G)}emplace(o,h,p,y,b,x,I,L,A,N,O,G,H){const K=12*o;return this.int16[K+0]=h,this.int16[K+1]=p,this.int16[K+2]=y,this.int16[K+3]=b,this.uint16[K+4]=x,this.uint16[K+5]=I,this.uint16[K+6]=L,this.uint16[K+7]=A,this.int16[K+8]=N,this.int16[K+9]=O,this.int16[K+10]=G,this.int16[K+11]=H,o}}Ip.prototype.bytesPerElement=24,St("StructArrayLayout4i4ui4i24",Ip);class Cp extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,h,p)}emplace(o,h,p,y){const b=3*o;return this.float32[b+0]=h,this.float32[b+1]=p,this.float32[b+2]=y,o}}Cp.prototype.bytesPerElement=12,St("StructArrayLayout3f12",Cp);class _a extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint32[1*o+0]=h,o}}_a.prototype.bytesPerElement=4,St("StructArrayLayout1ul4",_a);class Mh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x,I,L,A){const N=this.length;return this.resize(N+1),this.emplace(N,o,h,p,y,b,x,I,L,A)}emplace(o,h,p,y,b,x,I,L,A,N){const O=10*o,G=5*o;return this.int16[O+0]=h,this.int16[O+1]=p,this.int16[O+2]=y,this.int16[O+3]=b,this.int16[O+4]=x,this.int16[O+5]=I,this.uint32[G+3]=L,this.uint16[O+8]=A,this.uint16[O+9]=N,o}}Mh.prototype.bytesPerElement=20,St("StructArrayLayout6i1ul2ui20",Mh);class mc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,h,p,y,b,x)}emplace(o,h,p,y,b,x,I){const L=6*o;return this.int16[L+0]=h,this.int16[L+1]=p,this.int16[L+2]=y,this.int16[L+3]=b,this.int16[L+4]=x,this.int16[L+5]=I,o}}mc.prototype.bytesPerElement=12,St("StructArrayLayout2i2i2i12",mc);class Ah extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b){const x=this.length;return this.resize(x+1),this.emplace(x,o,h,p,y,b)}emplace(o,h,p,y,b,x){const I=4*o,L=8*o;return this.float32[I+0]=h,this.float32[I+1]=p,this.float32[I+2]=y,this.int16[L+6]=b,this.int16[L+7]=x,o}}Ah.prototype.bytesPerElement=16,St("StructArrayLayout2f1f2i16",Ah);class gc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,p,y)}emplace(o,h,p,y,b){const x=12*o,I=3*o;return this.uint8[x+0]=h,this.uint8[x+1]=p,this.float32[I+1]=y,this.float32[I+2]=b,o}}gc.prototype.bytesPerElement=12,St("StructArrayLayout2ub2f12",gc);class kh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,h,p)}emplace(o,h,p,y){const b=3*o;return this.uint16[b+0]=h,this.uint16[b+1]=p,this.uint16[b+2]=y,o}}kh.prototype.bytesPerElement=6,St("StructArrayLayout3ui6",kh);class gu extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x,I,L,A,N,O,G,H,K,ee,ae,pe){const De=this.length;return this.resize(De+1),this.emplace(De,o,h,p,y,b,x,I,L,A,N,O,G,H,K,ee,ae,pe)}emplace(o,h,p,y,b,x,I,L,A,N,O,G,H,K,ee,ae,pe,De){const ye=24*o,Ee=12*o,Ye=48*o;return this.int16[ye+0]=h,this.int16[ye+1]=p,this.uint16[ye+2]=y,this.uint16[ye+3]=b,this.uint32[Ee+2]=x,this.uint32[Ee+3]=I,this.uint32[Ee+4]=L,this.uint16[ye+10]=A,this.uint16[ye+11]=N,this.uint16[ye+12]=O,this.float32[Ee+7]=G,this.float32[Ee+8]=H,this.uint8[Ye+36]=K,this.uint8[Ye+37]=ee,this.uint8[Ye+38]=ae,this.uint32[Ee+10]=pe,this.int16[ye+22]=De,o}}gu.prototype.bytesPerElement=48,St("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gu);class Pl extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,p,y,b,x,I,L,A,N,O,G,H,K,ee,ae,pe,De,ye,Ee,Ye,Je,bt,Ct,vt,yt,ct,Et){const dt=this.length;return this.resize(dt+1),this.emplace(dt,o,h,p,y,b,x,I,L,A,N,O,G,H,K,ee,ae,pe,De,ye,Ee,Ye,Je,bt,Ct,vt,yt,ct,Et)}emplace(o,h,p,y,b,x,I,L,A,N,O,G,H,K,ee,ae,pe,De,ye,Ee,Ye,Je,bt,Ct,vt,yt,ct,Et,dt){const nt=32*o,zt=16*o;return this.int16[nt+0]=h,this.int16[nt+1]=p,this.int16[nt+2]=y,this.int16[nt+3]=b,this.int16[nt+4]=x,this.int16[nt+5]=I,this.int16[nt+6]=L,this.int16[nt+7]=A,this.uint16[nt+8]=N,this.uint16[nt+9]=O,this.uint16[nt+10]=G,this.uint16[nt+11]=H,this.uint16[nt+12]=K,this.uint16[nt+13]=ee,this.uint16[nt+14]=ae,this.uint16[nt+15]=pe,this.uint16[nt+16]=De,this.uint16[nt+17]=ye,this.uint16[nt+18]=Ee,this.uint16[nt+19]=Ye,this.uint16[nt+20]=Je,this.uint16[nt+21]=bt,this.uint16[nt+22]=Ct,this.uint32[zt+12]=vt,this.float32[zt+13]=yt,this.float32[zt+14]=ct,this.uint16[nt+30]=Et,this.uint16[nt+31]=dt,o}}Pl.prototype.bytesPerElement=64,St("StructArrayLayout8i15ui1ul2f2ui64",Pl);class Dh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.float32[1*o+0]=h,o}}Dh.prototype.bytesPerElement=4,St("StructArrayLayout1f4",Dh);class Rh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,h,p)}emplace(o,h,p,y){const b=3*o;return this.uint16[6*o+0]=h,this.float32[b+1]=p,this.float32[b+2]=y,o}}Rh.prototype.bytesPerElement=12,St("StructArrayLayout1ui2f12",Rh);class Ml extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,h,p)}emplace(o,h,p,y){const b=4*o;return this.uint32[2*o+0]=h,this.uint16[b+2]=p,this.uint16[b+3]=y,o}}Ml.prototype.bytesPerElement=8,St("StructArrayLayout1ul2ui8",Ml);class Tp extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h){const p=this.length;return this.resize(p+1),this.emplace(p,o,h)}emplace(o,h,p){const y=2*o;return this.uint16[y+0]=h,this.uint16[y+1]=p,o}}Tp.prototype.bytesPerElement=4,St("StructArrayLayout2ui4",Tp);class Lp extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint16[1*o+0]=h,o}}Lp.prototype.bytesPerElement=2,St("StructArrayLayout1ui2",Lp);class Nh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,p,y)}emplace(o,h,p,y,b){const x=4*o;return this.float32[x+0]=h,this.float32[x+1]=p,this.float32[x+2]=y,this.float32[x+3]=b,o}}Nh.prototype.bytesPerElement=16,St("StructArrayLayout4f16",Nh);class zm extends fc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new E(this.anchorPointX,this.anchorPointY)}}zm.prototype.size=20;class _ extends Mh{get(o){return new zm(this,o)}}St("CollisionBoxArray",_);class s extends fc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}s.prototype.size=48;class f extends gu{get(o){return new s(this,o)}}St("PlacedSymbolArray",f);class d extends fc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class g extends Pl{get(o){return new d(this,o)}}St("SymbolInstanceArray",g);class v extends Dh{getoffsetX(o){return this.float32[1*o+0]}}St("GlyphOffsetArray",v);class C extends ya{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}St("SymbolLineVertexArray",C);class T extends fc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}T.prototype.size=12;class M extends Rh{get(o){return new T(this,o)}}St("TextAnchorOffsetArray",M);class R extends fc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}R.prototype.size=8;class z extends Ml{get(o){return new R(this,o)}}St("FeatureIndexArray",z);class F extends pc{}class X extends pc{}class ie extends pc{}class re extends Sp{}class ue extends Ep{}class $ extends dc{}class ve extends Ph{}class Fe extends Ip{}class he extends Cp{}class Ie extends _a{}class Be extends mc{}class Ge extends gc{}class He extends kh{}class et extends Tp{}const $e=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ut}=$e;class ft{constructor(o=[]){this.segments=o}prepareSegment(o,h,p,y){let b=this.segments[this.segments.length-1];return o>ft.MAX_VERTEX_ARRAY_LENGTH&&Ke(`Max vertices per segment is ${ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>ft.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==y)&&(b={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},y!==void 0&&(b.sortKey=y),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const h in o.vaos)o.vaos[h].destroy()}static simpleSegment(o,h,p,y){return new ft([{vertexOffset:o,primitiveOffset:h,vertexLength:p,primitiveLength:y,vaos:{},sortKey:0}])}}function nn(l,o){return 256*(l=oe(Math.floor(l),0,255))+oe(Math.floor(o),0,255)}ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,St("SegmentVector",ft);const pt=Gr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Bt={exports:{}},rn={exports:{}};rn.exports=function(l,o){var h,p,y,b,x,I,L,A;for(p=l.length-(h=3&l.length),y=o,x=3432918353,I=461845907,A=0;A<p;)L=255&l.charCodeAt(A)|(255&l.charCodeAt(++A))<<8|(255&l.charCodeAt(++A))<<16|(255&l.charCodeAt(++A))<<24,++A,y=27492+(65535&(b=5*(65535&(y=(y^=L=(65535&(L=(L=(65535&L)*x+(((L>>>16)*x&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(L=0,h){case 3:L^=(255&l.charCodeAt(A+2))<<16;case 2:L^=(255&l.charCodeAt(A+1))<<8;case 1:y^=L=(65535&(L=(L=(65535&(L^=255&l.charCodeAt(A)))*x+(((L>>>16)*x&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var Sn=rn.exports,jt={exports:{}};jt.exports=function(l,o){for(var h,p=l.length,y=o^p,b=0;p>=4;)h=1540483477*(65535&(h=255&l.charCodeAt(b)|(255&l.charCodeAt(++b))<<8|(255&l.charCodeAt(++b))<<16|(255&l.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++b;switch(p){case 3:y^=(255&l.charCodeAt(b+2))<<16;case 2:y^=(255&l.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var an=Sn,fn=jt.exports;Bt.exports=an,Bt.exports.murmur3=an,Bt.exports.murmur2=fn;var Tr=m(Bt.exports);class Gn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,h,p,y){this.ids.push(Ro(o)),this.positions.push(h,p,y)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Ro(o);let p=0,y=this.ids.length-1;for(;p<y;){const x=p+y>>1;this.ids[x]>=h?y=x:p=x+1}const b=[];for(;this.ids[p]===h;)b.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return b}static serialize(o,h){const p=new Float64Array(o.ids),y=new Uint32Array(o.positions);return li(p,y,0,p.length-1),h&&h.push(p.buffer,y.buffer),{ids:p,positions:y}}static deserialize(o){const h=new Gn;return h.ids=o.ids,h.positions=o.positions,h.indexed=!0,h}}function Ro(l){const o=+l;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:Tr(String(l))}function li(l,o,h,p){for(;h<p;){const y=l[h+p>>1];let b=h-1,x=p+1;for(;;){do b++;while(l[b]<y);do x--;while(l[x]>y);if(b>=x)break;gr(l,b,x),gr(o,3*b,3*x),gr(o,3*b+1,3*x+1),gr(o,3*b+2,3*x+2)}x-h<p-x?(li(l,o,h,x),h=x+1):(li(l,o,x+1,p),p=x)}}function gr(l,o,h){const p=l[o];l[o]=l[h],l[h]=p}St("FeaturePositionMap",Gn);class ui{constructor(o,h){this.gl=o.gl,this.location=h}}class No extends ui{constructor(o,h){super(o,h),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Gs extends ui{constructor(o,h){super(o,h),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class Za extends ui{constructor(o,h){super(o,h),this.current=Vn.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const yc=new Float32Array(16);function Xa(l){return[nn(255*l.r,255*l.g),nn(255*l.b,255*l.a)]}class qs{constructor(o,h,p){this.value=o,this.uniformNames=h.map(y=>`u_${y}`),this.type=p}setUniform(o,h,p){o.set(p.constantOr(this.value))}getBinding(o,h,p){return this.type==="color"?new Za(o,h):new No(o,h)}}class $r{constructor(o,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=o.tlbr}setUniform(o,h,p,y){const b=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&o.set(b)}getBinding(o,h,p){return p.substr(0,9)==="u_pattern"?new Gs(o,h):new No(o,h)}}class yr{constructor(o,h,p,y){this.expression=o,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(b=>({name:`a_${b}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,h,p,y,b){const x=this.paintVertexArray.length,I=this.expression.evaluate(new ur(0),h,{},y,[],b);this.paintVertexArray.resize(o),this._setPaintValue(x,o,I)}updatePaintArray(o,h,p,y){const b=this.expression.evaluate({zoom:0},p,y);this._setPaintValue(o,h,b)}_setPaintValue(o,h,p){if(this.type==="color"){const y=Xa(p);for(let b=o;b<h;b++)this.paintVertexArray.emplace(b,y[0],y[1])}else{for(let y=o;y<h;y++)this.paintVertexArray.emplace(y,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cr{constructor(o,h,p,y,b,x){this.expression=o,this.uniformNames=h.map(I=>`u_${I}_t`),this.type=p,this.useIntegerZoom=y,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=h.map(I=>({name:`a_${I}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(o,h,p,y,b){const x=this.expression.evaluate(new ur(this.zoom),h,{},y,[],b),I=this.expression.evaluate(new ur(this.zoom+1),h,{},y,[],b),L=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(L,o,x,I)}updatePaintArray(o,h,p,y){const b=this.expression.evaluate({zoom:this.zoom},p,y),x=this.expression.evaluate({zoom:this.zoom+1},p,y);this._setPaintValue(o,h,b,x)}_setPaintValue(o,h,p,y){if(this.type==="color"){const b=Xa(p),x=Xa(y);for(let I=o;I<h;I++)this.paintVertexArray.emplace(I,b[0],b[1],x[0],x[1])}else{for(let b=o;b<h;b++)this.paintVertexArray.emplace(b,p,y);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(y))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,y=oe(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);o.set(y)}getBinding(o,h,p){return new No(o,h)}}class es{constructor(o,h,p,y,b,x){this.expression=o,this.type=h,this.useIntegerZoom=p,this.zoom=y,this.layerId=x,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(o,h,p){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(y,o,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(o,h,p,y,b){this._setPaintValues(o,h,p.patterns&&p.patterns[this.layerId],b)}_setPaintValues(o,h,p,y){if(!y||!p)return;const{min:b,mid:x,max:I}=p,L=y[b],A=y[x],N=y[I];if(L&&A&&N)for(let O=o;O<h;O++)this.zoomInPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],A.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],A.pixelRatio,N.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,pt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,pt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ei{constructor(o,h,p){this.binders={},this._buffers=[];const y=[];for(const b in o.paint._values){if(!p(b))continue;const x=o.paint.get(b);if(!(x instanceof ys&&uu(x.property.specification)))continue;const I=ts(b,o.type),L=x.value,A=x.property.specification.type,N=x.property.useIntegerZoom,O=x.property.specification["property-type"],G=O==="cross-faded"||O==="cross-faded-data-driven";if(L.kind==="constant")this.binders[b]=G?new $r(L.value,I):new qs(L.value,I,A),y.push(`/u_${b}`);else if(L.kind==="source"||G){const H=ti(b,A,"source");this.binders[b]=G?new es(L,A,N,h,H,o.id):new yr(L,I,A,H),y.push(`/a_${b}`)}else{const H=ti(b,A,"composite");this.binders[b]=new cr(L,I,A,N,h,H),y.push(`/z_${b}`)}}this.cacheKey=y.sort().join("")}getMaxValue(o){const h=this.binders[o];return h instanceof yr||h instanceof cr?h.maxValue:0}populatePaintArrays(o,h,p,y,b){for(const x in this.binders){const I=this.binders[x];(I instanceof yr||I instanceof cr||I instanceof es)&&I.populatePaintArray(o,h,p,y,b)}}setConstantPatternPositions(o,h){for(const p in this.binders){const y=this.binders[p];y instanceof $r&&y.setConstantPatternPositions(o,h)}}updatePaintArrays(o,h,p,y,b){let x=!1;for(const I in o){const L=h.getPositions(I);for(const A of L){const N=p.feature(A.index);for(const O in this.binders){const G=this.binders[O];if((G instanceof yr||G instanceof cr||G instanceof es)&&G.expression.isStateDependent===!0){const H=y.paint.get(O);G.expression=H.value,G.updatePaintArray(A.start,A.end,N,o[I],b),x=!0}}}}return x}defines(){const o=[];for(const h in this.binders){const p=this.binders[h];(p instanceof qs||p instanceof $r)&&o.push(...p.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return o}getBinderAttributes(){const o=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof yr||p instanceof cr)for(let y=0;y<p.paintVertexAttributes.length;y++)o.push(p.paintVertexAttributes[y].name);else if(p instanceof es)for(let y=0;y<pt.members.length;y++)o.push(pt.members[y].name)}return o}getBinderUniforms(){const o=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof qs||p instanceof $r||p instanceof cr)for(const y of p.uniformNames)o.push(y)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,h){const p=[];for(const y in this.binders){const b=this.binders[y];if(b instanceof qs||b instanceof $r||b instanceof cr){for(const x of b.uniformNames)if(h[x]){const I=b.getBinding(o,h[x],x);p.push({name:x,property:y,binding:I})}}}return p}setUniforms(o,h,p,y){for(const{name:b,property:x,binding:I}of h)this.binders[x].setUniform(I,y,p.get(x),b)}updatePaintBuffers(o){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(o&&p instanceof es){const y=o.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(p instanceof yr||p instanceof cr)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(o){for(const h in this.binders){const p=this.binders[h];(p instanceof yr||p instanceof cr||p instanceof es)&&p.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const h=this.binders[o];(h instanceof yr||h instanceof cr||h instanceof es)&&h.destroy()}}}class _r{constructor(o,h,p=()=>!0){this.programConfigurations={};for(const y of o)this.programConfigurations[y.id]=new ei(y,h,p);this.needsUpload=!1,this._featureMap=new Gn,this._bufferOffset=0}populatePaintArrays(o,h,p,y,b,x){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,h,y,b,x);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,h,p,y){for(const b of p)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(o,this._featureMap,h,b,y)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function ts(l,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}function ti(l,o,h){const p={color:{source:dc,composite:Nh},number:{source:Dh,composite:dc}},y=function(b){return{"line-pattern":{source:ve,composite:ve},"fill-pattern":{source:ve,composite:ve},"fill-extrusion-pattern":{source:ve,composite:ve}}[b]}(l);return y&&y[h]||p[o][h]}St("ConstantBinder",qs),St("CrossFadedConstantBinder",$r),St("SourceExpressionBinder",yr),St("CrossFadedCompositeBinder",es),St("CompositeExpressionBinder",cr),St("ProgramConfiguration",ei,{omit:["_buffers"]}),St("ProgramConfigurationSet",_r);const Nr=8192,Pp=Math.pow(2,14)-1,Fm=-Pp-1;function Al(l){const o=Nr/l.extent,h=l.loadGeometry();for(let p=0;p<h.length;p++){const y=h[p];for(let b=0;b<y.length;b++){const x=y[b],I=Math.round(x.x*o),L=Math.round(x.y*o);x.x=oe(I,Fm,Pp),x.y=oe(L,Fm,Pp),(I<x.x||I>x.x+1||L<x.y||L>x.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function kl(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?Al(l):[]}}function Oh(l,o,h,p,y){l.emplaceBack(2*o+(p+1)/2,2*h+(y+1)/2)}class Ya{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new X,this.indexArray=new He,this.segments=new ft,this.programConfigurations=new _r(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,p){const y=this.layers[0],b=[];let x=null,I=!1;y.type==="circle"&&(x=y.layout.get("circle-sort-key"),I=!x.isConstant());for(const{feature:L,id:A,index:N,sourceLayerIndex:O}of o){const G=this.layers[0]._featureFilter.needGeometry,H=kl(L,G);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),H,p))continue;const K=I?x.evaluate(H,{},p):void 0,ee={id:A,properties:L.properties,type:L.type,sourceLayerIndex:O,index:N,geometry:G?H.geometry:Al(L),patterns:{},sortKey:K};b.push(ee)}I&&b.sort((L,A)=>L.sortKey-A.sortKey);for(const L of b){const{geometry:A,index:N,sourceLayerIndex:O}=L,G=o[N].feature;this.addFeature(L,A,N,p),h.featureIndex.insert(G,A,N,O,this.index)}}update(o,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ut),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,h,p,y){for(const b of h)for(const x of b){const I=x.x,L=x.y;if(I<0||I>=Nr||L<0||L>=Nr)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),N=A.vertexLength;Oh(this.layoutVertexArray,I,L,-1,-1),Oh(this.layoutVertexArray,I,L,1,-1),Oh(this.layoutVertexArray,I,L,1,1),Oh(this.layoutVertexArray,I,L,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,{},y)}}function Mp(l,o){for(let h=0;h<l.length;h++)if(Fh(o,l[h]))return!0;for(let h=0;h<o.length;h++)if(Fh(l,o[h]))return!0;return!!zh(l,o)}function Bm(l,o,h){return!!Fh(l,o)||!!a_(o,l,h)}function Ap(l,o){if(l.length===1)return C1(o,l[0]);for(let h=0;h<o.length;h++){const p=o[h];for(let y=0;y<p.length;y++)if(Fh(l,p[y]))return!0}for(let h=0;h<l.length;h++)if(C1(o,l[h]))return!0;for(let h=0;h<o.length;h++)if(zh(l,o[h]))return!0;return!1}function kp(l,o,h){if(l.length>1){if(zh(l,o))return!0;for(let p=0;p<o.length;p++)if(a_(o[p],l,h))return!0}for(let p=0;p<l.length;p++)if(a_(l[p],o,h))return!0;return!1}function zh(l,o){if(l.length===0||o.length===0)return!1;for(let h=0;h<l.length-1;h++){const p=l[h],y=l[h+1];for(let b=0;b<o.length-1;b++)if(Dp(p,y,o[b],o[b+1]))return!0}return!1}function Dp(l,o,h,p){return Se(l,h,p)!==Se(o,h,p)&&Se(l,o,h)!==Se(l,o,p)}function a_(l,o,h){const p=h*h;if(o.length===1)return l.distSqr(o[0])<p;for(let y=1;y<o.length;y++)if(I1(l,o[y-1],o[y])<p)return!0;return!1}function I1(l,o,h){const p=o.distSqr(h);if(p===0)return l.distSqr(o);const y=((l.x-o.x)*(h.x-o.x)+(l.y-o.y)*(h.y-o.y))/p;return l.distSqr(y<0?o:y>1?h:h.sub(o)._mult(y)._add(o))}function C1(l,o){let h,p,y,b=!1;for(let x=0;x<l.length;x++){h=l[x];for(let I=0,L=h.length-1;I<h.length;L=I++)p=h[I],y=h[L],p.y>o.y!=y.y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b)}return b}function Fh(l,o){let h=!1;for(let p=0,y=l.length-1;p<l.length;y=p++){const b=l[p],x=l[y];b.y>o.y!=x.y>o.y&&o.x<(x.x-b.x)*(o.y-b.y)/(x.y-b.y)+b.x&&(h=!h)}return h}function XC(l,o,h){const p=h[0],y=h[2];if(l.x<p.x&&o.x<p.x||l.x>y.x&&o.x>y.x||l.y<p.y&&o.y<p.y||l.y>y.y&&o.y>y.y)return!1;const b=Se(l,o,h[0]);return b!==Se(l,o,h[1])||b!==Se(l,o,h[2])||b!==Se(l,o,h[3])}function Rp(l,o,h){const p=o.paint.get(l).value;return p.kind==="constant"?p.value:h.programConfigurations.get(o.id).getMaxValue(l)}function Vm(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Um(l,o,h,p,y){if(!o[0]&&!o[1])return l;const b=E.convert(o)._mult(y);h==="viewport"&&b._rotate(-p);const x=[];for(let I=0;I<l.length;I++)x.push(l[I].sub(b));return x}let T1,L1;St("CircleBucket",Ya,{omit:["layers"]});var YC={get paint(){return L1=L1||new go({"circle-radius":new Ft(Oe.paint_circle["circle-radius"]),"circle-color":new Ft(Oe.paint_circle["circle-color"]),"circle-blur":new Ft(Oe.paint_circle["circle-blur"]),"circle-opacity":new Ft(Oe.paint_circle["circle-opacity"]),"circle-translate":new kt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new kt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft(Oe.paint_circle["circle-stroke-opacity"])})},get layout(){return T1=T1||new go({"circle-sort-key":new Ft(Oe.layout_circle["circle-sort-key"])})}},yo=1e-6,Bh=typeof Float32Array<"u"?Float32Array:Array;function l_(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function P1(l,o,h){var p=o[0],y=o[1],b=o[2],x=o[3],I=o[4],L=o[5],A=o[6],N=o[7],O=o[8],G=o[9],H=o[10],K=o[11],ee=o[12],ae=o[13],pe=o[14],De=o[15],ye=h[0],Ee=h[1],Ye=h[2],Je=h[3];return l[0]=ye*p+Ee*I+Ye*O+Je*ee,l[1]=ye*y+Ee*L+Ye*G+Je*ae,l[2]=ye*b+Ee*A+Ye*H+Je*pe,l[3]=ye*x+Ee*N+Ye*K+Je*De,l[4]=(ye=h[4])*p+(Ee=h[5])*I+(Ye=h[6])*O+(Je=h[7])*ee,l[5]=ye*y+Ee*L+Ye*G+Je*ae,l[6]=ye*b+Ee*A+Ye*H+Je*pe,l[7]=ye*x+Ee*N+Ye*K+Je*De,l[8]=(ye=h[8])*p+(Ee=h[9])*I+(Ye=h[10])*O+(Je=h[11])*ee,l[9]=ye*y+Ee*L+Ye*G+Je*ae,l[10]=ye*b+Ee*A+Ye*H+Je*pe,l[11]=ye*x+Ee*N+Ye*K+Je*De,l[12]=(ye=h[12])*p+(Ee=h[13])*I+(Ye=h[14])*O+(Je=h[15])*ee,l[13]=ye*y+Ee*L+Ye*G+Je*ae,l[14]=ye*b+Ee*A+Ye*H+Je*pe,l[15]=ye*x+Ee*N+Ye*K+Je*De,l}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var Np,KC=P1;function Gm(l,o,h){var p=o[0],y=o[1],b=o[2],x=o[3];return l[0]=h[0]*p+h[4]*y+h[8]*b+h[12]*x,l[1]=h[1]*p+h[5]*y+h[9]*b+h[13]*x,l[2]=h[2]*p+h[6]*y+h[10]*b+h[14]*x,l[3]=h[3]*p+h[7]*y+h[11]*b+h[15]*x,l}Np=new Bh(4),Bh!=Float32Array&&(Np[0]=0,Np[1]=0,Np[2]=0,Np[3]=0);class JC extends _s{constructor(o){super(o,YC)}createBucket(o){return new Ya(o)}queryRadius(o){const h=o;return Rp("circle-radius",this,h)+Rp("circle-stroke-width",this,h)+Vm(this.paint.get("circle-translate"))}queryIntersectsFeature(o,h,p,y,b,x,I,L){const A=Um(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,I),N=this.paint.get("circle-radius").evaluate(h,p)+this.paint.get("circle-stroke-width").evaluate(h,p),O=this.paint.get("circle-pitch-alignment")==="map",G=O?A:function(K,ee){return K.map(ae=>M1(ae,ee))}(A,L),H=O?N*I:N;for(const K of y)for(const ee of K){const ae=O?ee:M1(ee,L);let pe=H;const De=Gm([],[ee.x,ee.y,0,1],L);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?pe*=De[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(pe*=x.cameraToCenterDistance/De[3]),Bm(G,ae,pe))return!0}return!1}}function M1(l,o){const h=Gm([],[l.x,l.y,0,1],o);return new E(h[0]/h[3],h[1]/h[3])}class A1 extends Ya{}let k1;St("HeatmapBucket",A1,{omit:["layers"]});var QC={get paint(){return k1=k1||new go({"heatmap-radius":new Ft(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bp(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kt(Oe.paint_heatmap["heatmap-opacity"])})}};function u_(l,{width:o,height:h},p,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==o*h*p)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${o*h*p}`)}else y=new Uint8Array(o*h*p);return l.width=o,l.height=h,l.data=y,l}function D1(l,{width:o,height:h},p){if(o===l.width&&h===l.height)return;const y=u_({},{width:o,height:h},p);c_(l,y,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,o),height:Math.min(l.height,h)},p),l.width=o,l.height=h,l.data=y.data}function c_(l,o,h,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>l.width||y.height>l.height||h.x>l.width-y.width||h.y>l.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const x=l.data,I=o.data;if(x===I)throw new Error("srcData equals dstData, so image is already copied");for(let L=0;L<y.height;L++){const A=((h.y+L)*l.width+h.x)*b,N=((p.y+L)*o.width+p.x)*b;for(let O=0;O<y.width*b;O++)I[N+O]=x[A+O]}return o}class Op{constructor(o,h){u_(this,o,1,h)}resize(o){D1(this,o,1)}clone(){return new Op({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,p,y,b){c_(o,h,p,y,b,1)}}class vs{constructor(o,h){u_(this,o,4,h)}resize(o){D1(this,o,4)}replace(o,h){h?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,p,y,b){c_(o,h,p,y,b,4)}}function R1(l){const o={},h=l.resolution||256,p=l.clips?l.clips.length:1,y=l.image||new vs({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const b=(x,I,L)=>{o[l.evaluationKey]=L;const A=l.expression.evaluate(o);y.data[x+I+0]=Math.floor(255*A.r/A.a),y.data[x+I+1]=Math.floor(255*A.g/A.a),y.data[x+I+2]=Math.floor(255*A.b/A.a),y.data[x+I+3]=Math.floor(255*A.a)};if(l.clips)for(let x=0,I=0;x<p;++x,I+=4*h)for(let L=0,A=0;L<h;L++,A+=4){const N=L/(h-1),{start:O,end:G}=l.clips[x];b(I,A,O*(1-N)+G*N)}else for(let x=0,I=0;x<h;x++,I+=4)b(0,I,x/(h-1));return y}St("AlphaImage",Op),St("RGBAImage",vs);class $C extends _s{createBucket(o){return new A1(o)}constructor(o){super(o,QC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=R1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let N1;var eT={get paint(){return N1=N1||new go({"hillshade-illumination-direction":new kt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kt(Oe.paint_hillshade["hillshade-accent-color"])})}};class tT extends _s{constructor(o){super(o,eT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const nT=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:rT}=nT;var h_={exports:{}};function qm(l,o,h){h=h||2;var p,y,b,x,I,L,A,N=o&&o.length,O=N?o[0]*h:l.length,G=O1(l,0,O,h,!0),H=[];if(!G||G.next===G.prev)return H;if(N&&(G=function(ee,ae,pe,De){var ye,Ee,Ye,Je=[];for(ye=0,Ee=ae.length;ye<Ee;ye++)(Ye=O1(ee,ae[ye]*De,ye<Ee-1?ae[ye+1]*De:ee.length,De,!1))===Ye.next&&(Ye.steiner=!0),Je.push(hT(Ye));for(Je.sort(lT),ye=0;ye<Je.length;ye++)pe=uT(Je[ye],pe);return pe}(l,o,G,h)),l.length>80*h){p=b=l[0],y=x=l[1];for(var K=h;K<O;K+=h)(I=l[K])<p&&(p=I),(L=l[K+1])<y&&(y=L),I>b&&(b=I),L>x&&(x=L);A=(A=Math.max(b-p,x-y))!==0?32767/A:0}return zp(G,H,h,p,y,A,0),H}function O1(l,o,h,p,y){var b,x;if(y===d_(l,o,h,p)>0)for(b=o;b<h;b+=p)x=B1(b,l[b],l[b+1],x);else for(b=h-p;b>=o;b-=p)x=B1(b,l[b],l[b+1],x);return x&&jm(x,x.next)&&(Bp(x),x=x.next),x}function _c(l,o){if(!l)return l;o||(o=l);var h,p=l;do if(h=!1,p.steiner||!jm(p,p.next)&&qr(p.prev,p,p.next)!==0)p=p.next;else{if(Bp(p),(p=o=p.prev)===p.next)break;h=!0}while(h||p!==o);return o}function zp(l,o,h,p,y,b,x){if(l){!x&&b&&function(N,O,G,H){var K=N;do K.z===0&&(K.z=f_(K.x,K.y,O,G,H)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next;while(K!==N);K.prevZ.nextZ=null,K.prevZ=null,function(ee){var ae,pe,De,ye,Ee,Ye,Je,bt,Ct=1;do{for(pe=ee,ee=null,Ee=null,Ye=0;pe;){for(Ye++,De=pe,Je=0,ae=0;ae<Ct&&(Je++,De=De.nextZ);ae++);for(bt=Ct;Je>0||bt>0&&De;)Je!==0&&(bt===0||!De||pe.z<=De.z)?(ye=pe,pe=pe.nextZ,Je--):(ye=De,De=De.nextZ,bt--),Ee?Ee.nextZ=ye:ee=ye,ye.prevZ=Ee,Ee=ye;pe=De}Ee.nextZ=null,Ct*=2}while(Ye>1)}(K)}(l,p,y,b);for(var I,L,A=l;l.prev!==l.next;)if(I=l.prev,L=l.next,b?oT(l,p,y,b):iT(l))o.push(I.i/h|0),o.push(l.i/h|0),o.push(L.i/h|0),Bp(l),l=L.next,A=L.next;else if((l=L)===A){x?x===1?zp(l=sT(_c(l),o,h),o,h,p,y,b,2):x===2&&aT(l,o,h,p,y,b):zp(_c(l),o,h,p,y,b,1);break}}}function iT(l){var o=l.prev,h=l,p=l.next;if(qr(o,h,p)>=0)return!1;for(var y=o.x,b=h.x,x=p.x,I=o.y,L=h.y,A=p.y,N=y<b?y<x?y:x:b<x?b:x,O=I<L?I<A?I:A:L<A?L:A,G=y>b?y>x?y:x:b>x?b:x,H=I>L?I>A?I:A:L>A?L:A,K=p.next;K!==o;){if(K.x>=N&&K.x<=G&&K.y>=O&&K.y<=H&&Vh(y,I,b,L,x,A,K.x,K.y)&&qr(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function oT(l,o,h,p){var y=l.prev,b=l,x=l.next;if(qr(y,b,x)>=0)return!1;for(var I=y.x,L=b.x,A=x.x,N=y.y,O=b.y,G=x.y,H=I<L?I<A?I:A:L<A?L:A,K=N<O?N<G?N:G:O<G?O:G,ee=I>L?I>A?I:A:L>A?L:A,ae=N>O?N>G?N:G:O>G?O:G,pe=f_(H,K,o,h,p),De=f_(ee,ae,o,h,p),ye=l.prevZ,Ee=l.nextZ;ye&&ye.z>=pe&&Ee&&Ee.z<=De;){if(ye.x>=H&&ye.x<=ee&&ye.y>=K&&ye.y<=ae&&ye!==y&&ye!==x&&Vh(I,N,L,O,A,G,ye.x,ye.y)&&qr(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Ee.x>=H&&Ee.x<=ee&&Ee.y>=K&&Ee.y<=ae&&Ee!==y&&Ee!==x&&Vh(I,N,L,O,A,G,Ee.x,Ee.y)&&qr(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;ye&&ye.z>=pe;){if(ye.x>=H&&ye.x<=ee&&ye.y>=K&&ye.y<=ae&&ye!==y&&ye!==x&&Vh(I,N,L,O,A,G,ye.x,ye.y)&&qr(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Ee&&Ee.z<=De;){if(Ee.x>=H&&Ee.x<=ee&&Ee.y>=K&&Ee.y<=ae&&Ee!==y&&Ee!==x&&Vh(I,N,L,O,A,G,Ee.x,Ee.y)&&qr(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function sT(l,o,h){var p=l;do{var y=p.prev,b=p.next.next;!jm(y,b)&&z1(y,p,p.next,b)&&Fp(y,b)&&Fp(b,y)&&(o.push(y.i/h|0),o.push(p.i/h|0),o.push(b.i/h|0),Bp(p),Bp(p.next),p=l=b),p=p.next}while(p!==l);return _c(p)}function aT(l,o,h,p,y,b){var x=l;do{for(var I=x.next.next;I!==x.prev;){if(x.i!==I.i&&fT(x,I)){var L=F1(x,I);return x=_c(x,x.next),L=_c(L,L.next),zp(x,o,h,p,y,b,0),void zp(L,o,h,p,y,b,0)}I=I.next}x=x.next}while(x!==l)}function lT(l,o){return l.x-o.x}function uT(l,o){var h=function(y,b){var x,I=b,L=y.x,A=y.y,N=-1/0;do{if(A<=I.y&&A>=I.next.y&&I.next.y!==I.y){var O=I.x+(A-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(O<=L&&O>N&&(N=O,x=I.x<I.next.x?I:I.next,O===L))return x}I=I.next}while(I!==b);if(!x)return null;var G,H=x,K=x.x,ee=x.y,ae=1/0;I=x;do L>=I.x&&I.x>=K&&L!==I.x&&Vh(A<ee?L:N,A,K,ee,A<ee?N:L,A,I.x,I.y)&&(G=Math.abs(A-I.y)/(L-I.x),Fp(I,y)&&(G<ae||G===ae&&(I.x>x.x||I.x===x.x&&cT(x,I)))&&(x=I,ae=G)),I=I.next;while(I!==H);return x}(l,o);if(!h)return o;var p=F1(h,l);return _c(p,p.next),_c(h,h.next)}function cT(l,o){return qr(l.prev,l,o.prev)<0&&qr(o.next,l,l.next)<0}function f_(l,o,h,p,y){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-h)*y|0)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-p)*y|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function hT(l){var o=l,h=l;do(o.x<h.x||o.x===h.x&&o.y<h.y)&&(h=o),o=o.next;while(o!==l);return h}function Vh(l,o,h,p,y,b,x,I){return(y-x)*(o-I)>=(l-x)*(b-I)&&(l-x)*(p-I)>=(h-x)*(o-I)&&(h-x)*(b-I)>=(y-x)*(p-I)}function fT(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(h,p){var y=h;do{if(y.i!==h.i&&y.next.i!==h.i&&y.i!==p.i&&y.next.i!==p.i&&z1(y,y.next,h,p))return!0;y=y.next}while(y!==h);return!1}(l,o)&&(Fp(l,o)&&Fp(o,l)&&function(h,p){var y=h,b=!1,x=(h.x+p.x)/2,I=(h.y+p.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&x<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==h);return b}(l,o)&&(qr(l.prev,l,o.prev)||qr(l,o.prev,o))||jm(l,o)&&qr(l.prev,l,l.next)>0&&qr(o.prev,o,o.next)>0)}function qr(l,o,h){return(o.y-l.y)*(h.x-o.x)-(o.x-l.x)*(h.y-o.y)}function jm(l,o){return l.x===o.x&&l.y===o.y}function z1(l,o,h,p){var y=Hm(qr(l,o,h)),b=Hm(qr(l,o,p)),x=Hm(qr(h,p,l)),I=Hm(qr(h,p,o));return y!==b&&x!==I||!(y!==0||!Wm(l,h,o))||!(b!==0||!Wm(l,p,o))||!(x!==0||!Wm(h,l,p))||!(I!==0||!Wm(h,o,p))}function Wm(l,o,h){return o.x<=Math.max(l.x,h.x)&&o.x>=Math.min(l.x,h.x)&&o.y<=Math.max(l.y,h.y)&&o.y>=Math.min(l.y,h.y)}function Hm(l){return l>0?1:l<0?-1:0}function Fp(l,o){return qr(l.prev,l,l.next)<0?qr(l,o,l.next)>=0&&qr(l,l.prev,o)>=0:qr(l,o,l.prev)<0||qr(l,l.next,o)<0}function F1(l,o){var h=new p_(l.i,l.x,l.y),p=new p_(o.i,o.x,o.y),y=l.next,b=o.prev;return l.next=o,o.prev=l,h.next=y,y.prev=h,p.next=h,h.prev=p,b.next=p,p.prev=b,p}function B1(l,o,h,p){var y=new p_(l,o,h);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function Bp(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function p_(l,o,h){this.i=l,this.x=o,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function d_(l,o,h,p){for(var y=0,b=o,x=h-p;b<h;b+=p)y+=(l[x]-l[b])*(l[b+1]+l[x+1]),x=b;return y}h_.exports=qm,h_.exports.default=qm,qm.deviation=function(l,o,h,p){var y=o&&o.length,b=Math.abs(d_(l,0,y?o[0]*h:l.length,h));if(y)for(var x=0,I=o.length;x<I;x++)b-=Math.abs(d_(l,o[x]*h,x<I-1?o[x+1]*h:l.length,h));var L=0;for(x=0;x<p.length;x+=3){var A=p[x]*h,N=p[x+1]*h,O=p[x+2]*h;L+=Math.abs((l[A]-l[O])*(l[N+1]-l[A+1])-(l[A]-l[N])*(l[O+1]-l[A+1]))}return b===0&&L===0?0:Math.abs((L-b)/b)},qm.flatten=function(l){for(var o=l[0][0].length,h={vertices:[],holes:[],dimensions:o},p=0,y=0;y<l.length;y++){for(var b=0;b<l[y].length;b++)for(var x=0;x<o;x++)h.vertices.push(l[y][b][x]);y>0&&h.holes.push(p+=l[y-1].length)}return h};var V1=m(h_.exports);function pT(l,o,h,p,y){U1(l,o,h||0,p||l.length-1,y||dT)}function U1(l,o,h,p,y){for(;p>h;){if(p-h>600){var b=p-h+1,x=o-h+1,I=Math.log(b),L=.5*Math.exp(2*I/3),A=.5*Math.sqrt(I*L*(b-L)/b)*(x-b/2<0?-1:1);U1(l,o,Math.max(h,Math.floor(o-x*L/b+A)),Math.min(p,Math.floor(o+(b-x)*L/b+A)),y)}var N=l[o],O=h,G=p;for(Vp(l,h,o),y(l[p],N)>0&&Vp(l,h,p);O<G;){for(Vp(l,O,G),O++,G--;y(l[O],N)<0;)O++;for(;y(l[G],N)>0;)G--}y(l[h],N)===0?Vp(l,h,G):Vp(l,++G,p),G<=o&&(h=G+1),o<=G&&(p=G-1)}}function Vp(l,o,h){var p=l[o];l[o]=l[h],l[h]=p}function dT(l,o){return l<o?-1:l>o?1:0}function m_(l,o){const h=l.length;if(h<=1)return[l];const p=[];let y,b;for(let x=0;x<h;x++){const I=Ze(l[x]);I!==0&&(l[x].area=Math.abs(I),b===void 0&&(b=I<0),b===I<0?(y&&p.push(y),y=[l[x]]):y.push(l[x]))}if(y&&p.push(y),o>1)for(let x=0;x<p.length;x++)p[x].length<=o||(pT(p[x],o,1,p[x].length-1,mT),p[x]=p[x].slice(0,o));return p}function mT(l,o){return o.area-l.area}function g_(l,o,h){const p=h.patternDependencies;let y=!1;for(const b of o){const x=b.paint.get(`${l}-pattern`);x.isConstant()||(y=!0);const I=x.constantOr(null);I&&(y=!0,p[I.to]=!0,p[I.from]=!0)}return y}function y_(l,o,h,p,y){const b=y.patternDependencies;for(const x of o){const I=x.paint.get(`${l}-pattern`).value;if(I.kind!=="constant"){let L=I.evaluate({zoom:p-1},h,{},y.availableImages),A=I.evaluate({zoom:p},h,{},y.availableImages),N=I.evaluate({zoom:p+1},h,{},y.availableImages);L=L&&L.name?L.name:L,A=A&&A.name?A.name:A,N=N&&N.name?N.name:N,b[L]=!0,b[A]=!0,b[N]=!0,h.patterns[x.id]={min:L,mid:A,max:N}}}return h}class __{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ie,this.indexArray=new He,this.indexArray2=new et,this.programConfigurations=new _r(o.layers,o.zoom),this.segments=new ft,this.segments2=new ft,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,p){this.hasPattern=g_("fill",this.layers,h);const y=this.layers[0].layout.get("fill-sort-key"),b=!y.isConstant(),x=[];for(const{feature:I,id:L,index:A,sourceLayerIndex:N}of o){const O=this.layers[0]._featureFilter.needGeometry,G=kl(I,O);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),G,p))continue;const H=b?y.evaluate(G,{},p,h.availableImages):void 0,K={id:L,properties:I.properties,type:I.type,sourceLayerIndex:N,index:A,geometry:O?G.geometry:Al(I),patterns:{},sortKey:H};x.push(K)}b&&x.sort((I,L)=>I.sortKey-L.sortKey);for(const I of x){const{geometry:L,index:A,sourceLayerIndex:N}=I;if(this.hasPattern){const O=y_("fill",this.layers,I,this.zoom,h);this.patternFeatures.push(O)}else this.addFeature(I,L,A,p,{});h.featureIndex.insert(o[A].feature,L,A,N,this.index)}}update(o,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,p)}addFeatures(o,h,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,rT),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,h,p,y,b){for(const x of m_(h,500)){let I=0;for(const H of x)I+=H.length;const L=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),A=L.vertexLength,N=[],O=[];for(const H of x){if(H.length===0)continue;H!==x[0]&&O.push(N.length/2);const K=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),ee=K.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(ee+H.length-1,ee),N.push(H[0].x),N.push(H[0].y);for(let ae=1;ae<H.length;ae++)this.layoutVertexArray.emplaceBack(H[ae].x,H[ae].y),this.indexArray2.emplaceBack(ee+ae-1,ee+ae),N.push(H[ae].x),N.push(H[ae].y);K.vertexLength+=H.length,K.primitiveLength+=H.length}const G=V1(N,O);for(let H=0;H<G.length;H+=3)this.indexArray.emplaceBack(A+G[H],A+G[H+1],A+G[H+2]);L.vertexLength+=I,L.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,b,y)}}let G1,q1;St("FillBucket",__,{omit:["layers","patternFeatures"]});var gT={get paint(){return q1=q1||new go({"fill-antialias":new kt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Ft(Oe.paint_fill["fill-opacity"]),"fill-color":new Ft(Oe.paint_fill["fill-color"]),"fill-outline-color":new Ft(Oe.paint_fill["fill-outline-color"]),"fill-translate":new kt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new kt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lh(Oe.paint_fill["fill-pattern"])})},get layout(){return G1=G1||new go({"fill-sort-key":new Ft(Oe.layout_fill["fill-sort-key"])})}};class yT extends _s{constructor(o){super(o,gT)}recalculate(o,h){super.recalculate(o,h);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new __(o)}queryRadius(){return Vm(this.paint.get("fill-translate"))}queryIntersectsFeature(o,h,p,y,b,x,I){return Ap(Um(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,I),y)}isTileClipped(){return!0}}const _T=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),vT=Gr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bT}=_T;var yu={},xT=w,j1=Uh;function Uh(l,o,h,p,y){this.properties={},this.extent=h,this.type=0,this._pbf=l,this._geometry=-1,this._keys=p,this._values=y,l.readFields(wT,this,o)}function wT(l,o,h){l==1?o.id=h.readVarint():l==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var x=y._keys[p.readVarint()],I=y._values[p.readVarint()];y.properties[x]=I}}(h,o):l==3?o.type=h.readVarint():l==4&&(o._geometry=h.pos)}function ST(l){for(var o,h,p=0,y=0,b=l.length,x=b-1;y<b;x=y++)p+=((h=l[x]).x-(o=l[y]).x)*(o.y+h.y);return p}Uh.types=["Unknown","Point","LineString","Polygon"],Uh.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,h=l.readVarint()+l.pos,p=1,y=0,b=0,x=0,I=[];l.pos<h;){if(y<=0){var L=l.readVarint();p=7&L,y=L>>3}if(y--,p===1||p===2)b+=l.readSVarint(),x+=l.readSVarint(),p===1&&(o&&I.push(o),o=[]),o.push(new xT(b,x));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Uh.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,h=1,p=0,y=0,b=0,x=1/0,I=-1/0,L=1/0,A=-1/0;l.pos<o;){if(p<=0){var N=l.readVarint();h=7&N,p=N>>3}if(p--,h===1||h===2)(y+=l.readSVarint())<x&&(x=y),y>I&&(I=y),(b+=l.readSVarint())<L&&(L=b),b>A&&(A=b);else if(h!==7)throw new Error("unknown command "+h)}return[x,L,I,A]},Uh.prototype.toGeoJSON=function(l,o,h){var p,y,b=this.extent*Math.pow(2,h),x=this.extent*l,I=this.extent*o,L=this.loadGeometry(),A=Uh.types[this.type];function N(H){for(var K=0;K<H.length;K++){var ee=H[K];H[K]=[360*(ee.x+x)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(p=0;p<L.length;p++)O[p]=L[p][0];N(L=O);break;case 2:for(p=0;p<L.length;p++)N(L[p]);break;case 3:for(L=function(H){var K=H.length;if(K<=1)return[H];for(var ee,ae,pe=[],De=0;De<K;De++){var ye=ST(H[De]);ye!==0&&(ae===void 0&&(ae=ye<0),ae===ye<0?(ee&&pe.push(ee),ee=[H[De]]):ee.push(H[De]))}return ee&&pe.push(ee),pe}(L),p=0;p<L.length;p++)for(y=0;y<L[p].length;y++)N(L[p][y])}L.length===1?L=L[0]:A="Multi"+A;var G={type:"Feature",geometry:{type:A,coordinates:L},properties:this.properties};return"id"in this&&(G.id=this.id),G};var ET=j1,W1=H1;function H1(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(IT,this,o),this.length=this._features.length}function IT(l,o,h){l===15?o.version=h.readVarint():l===1?o.name=h.readString():l===5?o.extent=h.readVarint():l===2?o._features.push(h.pos):l===3?o._keys.push(h.readString()):l===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var x=p.readVarint()>>3;y=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}return y}(h))}H1.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new ET(this._pbf,o,this.extent,this._keys,this._values)};var CT=W1;function TT(l,o,h){if(l===3){var p=new CT(h,h.readVarint()+h.pos);p.length&&(o[p.name]=p)}}yu.VectorTile=function(l,o){this.layers=l.readFields(TT,{},o)},yu.VectorTileFeature=j1,yu.VectorTileLayer=W1;const LT=yu.VectorTileFeature.types,v_=Math.pow(2,13);function Up(l,o,h,p,y,b,x,I){l.emplaceBack(o,h,2*Math.floor(p*v_)+x,y*v_*2,b*v_*2,Math.round(I))}class b_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new re,this.centroidVertexArray=new F,this.indexArray=new He,this.programConfigurations=new _r(o.layers,o.zoom),this.segments=new ft,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,p){this.features=[],this.hasPattern=g_("fill-extrusion",this.layers,h);for(const{feature:y,id:b,index:x,sourceLayerIndex:I}of o){const L=this.layers[0]._featureFilter.needGeometry,A=kl(y,L);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),A,p))continue;const N={id:b,sourceLayerIndex:I,index:x,geometry:L?A.geometry:Al(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(y_("fill-extrusion",this.layers,N,this.zoom,h)):this.addFeature(N,N.geometry,x,p,{}),h.featureIndex.insert(y,N.geometry,x,I,this.index,!0)}}addFeatures(o,h,p){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,h,p)}}update(o,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,bT),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,vT.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,h,p,y,b){const x={x:0,y:0,vertexCount:0};for(const I of m_(h,500)){let L=0;for(const K of I)L+=K.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const K of I){if(K.length===0||MT(K))continue;let ee=0;for(let ae=0;ae<K.length;ae++){const pe=K[ae];if(ae>=1){const De=K[ae-1];if(!PT(pe,De)){A.vertexLength+4>ft.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ye=pe.sub(De)._perp()._unit(),Ee=De.dist(pe);ee+Ee>32768&&(ee=0),Up(this.layoutVertexArray,pe.x,pe.y,ye.x,ye.y,0,0,ee),Up(this.layoutVertexArray,pe.x,pe.y,ye.x,ye.y,0,1,ee),x.x+=2*pe.x,x.y+=2*pe.y,x.vertexCount+=2,ee+=Ee,Up(this.layoutVertexArray,De.x,De.y,ye.x,ye.y,0,0,ee),Up(this.layoutVertexArray,De.x,De.y,ye.x,ye.y,0,1,ee),x.x+=2*De.x,x.y+=2*De.y,x.vertexCount+=2;const Ye=A.vertexLength;this.indexArray.emplaceBack(Ye,Ye+2,Ye+1),this.indexArray.emplaceBack(Ye+1,Ye+2,Ye+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+L>ft.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),LT[o.type]!=="Polygon")continue;const N=[],O=[],G=A.vertexLength;for(const K of I)if(K.length!==0){K!==I[0]&&O.push(N.length/2);for(let ee=0;ee<K.length;ee++){const ae=K[ee];Up(this.layoutVertexArray,ae.x,ae.y,0,0,1,1,0),x.x+=ae.x,x.y+=ae.y,x.vertexCount+=1,N.push(ae.x),N.push(ae.y)}}const H=V1(N,O);for(let K=0;K<H.length;K+=3)this.indexArray.emplaceBack(G+H[K],G+H[K+2],G+H[K+1]);A.primitiveLength+=H.length/3,A.vertexLength+=L}for(let I=0;I<x.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,b,y)}}function PT(l,o){return l.x===o.x&&(l.x<0||l.x>Nr)||l.y===o.y&&(l.y<0||l.y>Nr)}function MT(l){return l.every(o=>o.x<0)||l.every(o=>o.x>Nr)||l.every(o=>o.y<0)||l.every(o=>o.y>Nr)}let Z1;St("FillExtrusionBucket",b_,{omit:["layers","features"]});var AT={get paint(){return Z1=Z1||new go({"fill-extrusion-opacity":new kt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lh(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new kt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class kT extends _s{constructor(o){super(o,AT)}createBucket(o){return new b_(o)}queryRadius(){return Vm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,h,p,y,b,x,I,L){const A=Um(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,I),N=this.paint.get("fill-extrusion-height").evaluate(h,p),O=this.paint.get("fill-extrusion-base").evaluate(h,p),G=function(K,ee,ae,pe){const De=[];for(const ye of K){const Ee=[ye.x,ye.y,0,1];Gm(Ee,Ee,ee),De.push(new E(Ee[0]/Ee[3],Ee[1]/Ee[3]))}return De}(A,L),H=function(K,ee,ae,pe){const De=[],ye=[],Ee=pe[8]*ee,Ye=pe[9]*ee,Je=pe[10]*ee,bt=pe[11]*ee,Ct=pe[8]*ae,vt=pe[9]*ae,yt=pe[10]*ae,ct=pe[11]*ae;for(const Et of K){const dt=[],nt=[];for(const zt of Et){const Pt=zt.x,pn=zt.y,ir=pe[0]*Pt+pe[4]*pn+pe[12],hr=pe[1]*Pt+pe[5]*pn+pe[13],hi=pe[2]*Pt+pe[6]*pn+pe[14],ns=pe[3]*Pt+pe[7]*pn+pe[15],_o=hi+Je,ni=ns+bt,Mi=ir+Ct,Fi=hr+vt,vo=hi+yt,bo=ns+ct,fi=new E((ir+Ee)/ni,(hr+Ye)/ni);fi.z=_o/ni,dt.push(fi);const pi=new E(Mi/bo,Fi/bo);pi.z=vo/bo,nt.push(pi)}De.push(dt),ye.push(nt)}return[De,ye]}(y,O,N,L);return function(K,ee,ae){let pe=1/0;Ap(ae,ee)&&(pe=X1(ae,ee[0]));for(let De=0;De<ee.length;De++){const ye=ee[De],Ee=K[De];for(let Ye=0;Ye<ye.length-1;Ye++){const Je=ye[Ye],bt=[Je,ye[Ye+1],Ee[Ye+1],Ee[Ye],Je];Mp(ae,bt)&&(pe=Math.min(pe,X1(ae,bt)))}}return pe!==1/0&&pe}(H[0],H[1],G)}}function Gp(l,o){return l.x*o.x+l.y*o.y}function X1(l,o){if(l.length===1){let h=0;const p=o[h++];let y;for(;!y||p.equals(y);)if(y=o[h++],!y)return 1/0;for(;h<o.length;h++){const b=o[h],x=l[0],I=y.sub(p),L=b.sub(p),A=x.sub(p),N=Gp(I,I),O=Gp(I,L),G=Gp(L,L),H=Gp(A,I),K=Gp(A,L),ee=N*G-O*O,ae=(G*H-O*K)/ee,pe=(N*K-O*H)/ee,De=p.z*(1-ae-pe)+y.z*ae+b.z*pe;if(isFinite(De))return De}return 1/0}{let h=1/0;for(const p of o)h=Math.min(h,p.z);return h}}const DT=Gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:RT}=DT,NT=Gr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:OT}=NT,zT=yu.VectorTileFeature.types,FT=Math.cos(Math.PI/180*37.5),Y1=Math.pow(2,14)/.5;class x_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new ue,this.layoutVertexArray2=new $,this.indexArray=new He,this.programConfigurations=new _r(o.layers,o.zoom),this.segments=new ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,p){this.hasPattern=g_("line",this.layers,h);const y=this.layers[0].layout.get("line-sort-key"),b=!y.isConstant(),x=[];for(const{feature:I,id:L,index:A,sourceLayerIndex:N}of o){const O=this.layers[0]._featureFilter.needGeometry,G=kl(I,O);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),G,p))continue;const H=b?y.evaluate(G,{},p):void 0,K={id:L,properties:I.properties,type:I.type,sourceLayerIndex:N,index:A,geometry:O?G.geometry:Al(I),patterns:{},sortKey:H};x.push(K)}b&&x.sort((I,L)=>I.sortKey-L.sortKey);for(const I of x){const{geometry:L,index:A,sourceLayerIndex:N}=I;if(this.hasPattern){const O=y_("line",this.layers,I,this.zoom,h);this.patternFeatures.push(O)}else this.addFeature(I,L,A,p,{});h.featureIndex.insert(o[A].feature,L,A,N,this.index)}}update(o,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,p)}addFeatures(o,h,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,OT)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,RT),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,h,p,y,b){const x=this.layers[0].layout,I=x.get("line-join").evaluate(o,{}),L=x.get("line-cap"),A=x.get("line-miter-limit"),N=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const O of h)this.addLine(O,o,I,L,A,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,b,y)}addLine(o,h,p,y,b,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<o.length-1;pe++)this.totalDistance+=o[pe].dist(o[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=zT[h.type]==="Polygon";let L=o.length;for(;L>=2&&o[L-1].equals(o[L-2]);)L--;let A=0;for(;A<L-1&&o[A].equals(o[A+1]);)A++;if(L<(I?3:2))return;p==="bevel"&&(b=1.05);const N=this.overscaling<=16?15*Nr/(512*this.overscaling):0,O=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let G,H,K,ee,ae;this.e1=this.e2=-1,I&&(G=o[L-2],ae=o[A].sub(G)._unit()._perp());for(let pe=A;pe<L;pe++){if(K=pe===L-1?I?o[A+1]:void 0:o[pe+1],K&&o[pe].equals(K))continue;ae&&(ee=ae),G&&(H=G),G=o[pe],ae=K?K.sub(G)._unit()._perp():ee,ee=ee||ae;let De=ee.add(ae);De.x===0&&De.y===0||De._unit();const ye=ee.x*ae.x+ee.y*ae.y,Ee=De.x*ae.x+De.y*ae.y,Ye=Ee!==0?1/Ee:1/0,Je=2*Math.sqrt(2-2*Ee),bt=Ee<FT&&H&&K,Ct=ee.x*ae.y-ee.y*ae.x>0;if(bt&&pe>A){const ct=G.dist(H);if(ct>2*N){const Et=G.sub(G.sub(H)._mult(N/ct)._round());this.updateDistance(H,Et),this.addCurrentVertex(Et,ee,0,0,O),H=Et}}const vt=H&&K;let yt=vt?p:I?"butt":y;if(vt&&yt==="round"&&(Ye<x?yt="miter":Ye<=2&&(yt="fakeround")),yt==="miter"&&Ye>b&&(yt="bevel"),yt==="bevel"&&(Ye>2&&(yt="flipbevel"),Ye<b&&(yt="miter")),H&&this.updateDistance(H,G),yt==="miter")De._mult(Ye),this.addCurrentVertex(G,De,0,0,O);else if(yt==="flipbevel"){if(Ye>100)De=ae.mult(-1);else{const ct=Ye*ee.add(ae).mag()/ee.sub(ae).mag();De._perp()._mult(ct*(Ct?-1:1))}this.addCurrentVertex(G,De,0,0,O),this.addCurrentVertex(G,De.mult(-1),0,0,O)}else if(yt==="bevel"||yt==="fakeround"){const ct=-Math.sqrt(Ye*Ye-1),Et=Ct?ct:0,dt=Ct?0:ct;if(H&&this.addCurrentVertex(G,ee,Et,dt,O),yt==="fakeround"){const nt=Math.round(180*Je/Math.PI/20);for(let zt=1;zt<nt;zt++){let Pt=zt/nt;if(Pt!==.5){const ir=Pt-.5;Pt+=Pt*ir*(Pt-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*ir*ir+(.848013+ye*(.215638*ye-1.06021)))}const pn=ae.sub(ee)._mult(Pt)._add(ee)._unit()._mult(Ct?-1:1);this.addHalfVertex(G,pn.x,pn.y,!1,Ct,0,O)}}K&&this.addCurrentVertex(G,ae,-Et,-dt,O)}else if(yt==="butt")this.addCurrentVertex(G,De,0,0,O);else if(yt==="square"){const ct=H?1:-1;this.addCurrentVertex(G,De,ct,ct,O)}else yt==="round"&&(H&&(this.addCurrentVertex(G,ee,0,0,O),this.addCurrentVertex(G,ee,1,1,O,!0)),K&&(this.addCurrentVertex(G,ae,-1,-1,O,!0),this.addCurrentVertex(G,ae,0,0,O)));if(bt&&pe<L-1){const ct=G.dist(K);if(ct>2*N){const Et=G.add(K.sub(G)._mult(N/ct)._round());this.updateDistance(G,Et),this.addCurrentVertex(Et,ae,0,0,O),G=Et}}}}addCurrentVertex(o,h,p,y,b,x=!1){const I=h.y*y-h.x,L=-h.y-h.x*y;this.addHalfVertex(o,h.x+h.y*p,h.y-h.x*p,x,!1,p,b),this.addHalfVertex(o,I,L,x,!0,-y,b),this.distance>Y1/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,h,p,y,b,x))}addHalfVertex({x:o,y:h},p,y,b,x,I,L){const A=.5*(this.lineClips?this.scaledDistance*(Y1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(h<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*y)+128,1+(I===0?0:I<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),L.primitiveLength++),x?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,h){this.distance+=o.dist(h),this.updateScaledDistance()}}let K1,J1;St("LineBucket",x_,{omit:["layers","patternFeatures"]});var Q1={get paint(){return J1=J1||new go({"line-opacity":new Ft(Oe.paint_line["line-opacity"]),"line-color":new Ft(Oe.paint_line["line-color"]),"line-translate":new kt(Oe.paint_line["line-translate"]),"line-translate-anchor":new kt(Oe.paint_line["line-translate-anchor"]),"line-width":new Ft(Oe.paint_line["line-width"]),"line-gap-width":new Ft(Oe.paint_line["line-gap-width"]),"line-offset":new Ft(Oe.paint_line["line-offset"]),"line-blur":new Ft(Oe.paint_line["line-blur"]),"line-dasharray":new hc(Oe.paint_line["line-dasharray"]),"line-pattern":new Lh(Oe.paint_line["line-pattern"]),"line-gradient":new bp(Oe.paint_line["line-gradient"])})},get layout(){return K1=K1||new go({"line-cap":new kt(Oe.layout_line["line-cap"]),"line-join":new Ft(Oe.layout_line["line-join"]),"line-miter-limit":new kt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new kt(Oe.layout_line["line-round-limit"]),"line-sort-key":new Ft(Oe.layout_line["line-sort-key"])})}};class BT extends Ft{possiblyEvaluate(o,h){return h=new ur(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(o,h)}evaluate(o,h,p,y){return h=se({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(o,h,p,y)}}let Zm;class VT extends _s{constructor(o){super(o,Q1),this.gradientVersion=0,Zm||(Zm=new BT(Q1.paint.properties["line-width"].specification),Zm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof rc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,h){super.recalculate(o,h),this.paint._values["line-floorwidth"]=Zm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new x_(o)}queryRadius(o){const h=o,p=$1(Rp("line-width",this,h),Rp("line-gap-width",this,h)),y=Rp("line-offset",this,h);return p/2+Math.abs(y)+Vm(this.paint.get("line-translate"))}queryIntersectsFeature(o,h,p,y,b,x,I){const L=Um(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,I),A=I/2*$1(this.paint.get("line-width").evaluate(h,p),this.paint.get("line-gap-width").evaluate(h,p)),N=this.paint.get("line-offset").evaluate(h,p);return N&&(y=function(O,G){const H=[];for(let K=0;K<O.length;K++){const ee=O[K],ae=[];for(let pe=0;pe<ee.length;pe++){const De=ee[pe-1],ye=ee[pe],Ee=ee[pe+1],Ye=pe===0?new E(0,0):ye.sub(De)._unit()._perp(),Je=pe===ee.length-1?new E(0,0):Ee.sub(ye)._unit()._perp(),bt=Ye._add(Je)._unit(),Ct=bt.x*Je.x+bt.y*Je.y;Ct!==0&&bt._mult(1/Ct),ae.push(bt._mult(G)._add(ye))}H.push(ae)}return H}(y,N*I)),function(O,G,H){for(let K=0;K<G.length;K++){const ee=G[K];if(O.length>=3){for(let ae=0;ae<ee.length;ae++)if(Fh(O,ee[ae]))return!0}if(kp(O,ee,H))return!0}return!1}(L,y,A)}isTileClipped(){return!0}}function $1(l,o){return o>0?o+2*l:l}const UT=Gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),GT=Gr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qT=Gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Gr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const eb=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jT=Gr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function WT(l,o,h){return l.sections.forEach(p=>{p.text=function(y,b,x){const I=b.layout.get("text-transform").evaluate(x,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),Ha.applyArabicShaping&&(y=Ha.applyArabicShaping(y)),y}(p.text,o,h)}),l}Gr([{name:"triangle",components:3,type:"Uint16"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gr([{type:"Float32",name:"offsetX"}]),Gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ci=24,tb=Yn,nb=function(l,o,h,p,y){var b,x,I=8*y-p-1,L=(1<<I)-1,A=L>>1,N=-7,O=h?y-1:0,G=h?-1:1,H=l[o+O];for(O+=G,b=H&(1<<-N)-1,H>>=-N,N+=I;N>0;b=256*b+l[o+O],O+=G,N-=8);for(x=b&(1<<-N)-1,b>>=-N,N+=p;N>0;x=256*x+l[o+O],O+=G,N-=8);if(b===0)b=1-A;else{if(b===L)return x?NaN:1/0*(H?-1:1);x+=Math.pow(2,p),b-=A}return(H?-1:1)*x*Math.pow(2,b-p)},rb=function(l,o,h,p,y,b){var x,I,L,A=8*b-y-1,N=(1<<A)-1,O=N>>1,G=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=p?0:b-1,K=p?1:-1,ee=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,x=N):(x=Math.floor(Math.log(o)/Math.LN2),o*(L=Math.pow(2,-x))<1&&(x--,L*=2),(o+=x+O>=1?G/L:G*Math.pow(2,1-O))*L>=2&&(x++,L/=2),x+O>=N?(I=0,x=N):x+O>=1?(I=(o*L-1)*Math.pow(2,y),x+=O):(I=o*Math.pow(2,O-1)*Math.pow(2,y),x=0));y>=8;l[h+H]=255&I,H+=K,I/=256,y-=8);for(x=x<<y|I,A+=y;A>0;l[h+H]=255&x,H+=K,x/=256,A-=8);l[h+H-K]|=128*ee};function Yn(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}Yn.Varint=0,Yn.Fixed64=1,Yn.Bytes=2,Yn.Fixed32=5;var w_=4294967296,ib=1/w_,ob=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Dl(l){return l.type===Yn.Bytes?l.readVarint()+l.pos:l.pos+1}function Gh(l,o,h){return h?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}function sb(l,o,h){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));h.realloc(p);for(var y=h.pos-1;y>=l;y--)h.buf[y+p]=h.buf[y]}function HT(l,o){for(var h=0;h<l.length;h++)o.writeVarint(l[h])}function ZT(l,o){for(var h=0;h<l.length;h++)o.writeSVarint(l[h])}function XT(l,o){for(var h=0;h<l.length;h++)o.writeFloat(l[h])}function YT(l,o){for(var h=0;h<l.length;h++)o.writeDouble(l[h])}function KT(l,o){for(var h=0;h<l.length;h++)o.writeBoolean(l[h])}function JT(l,o){for(var h=0;h<l.length;h++)o.writeFixed32(l[h])}function QT(l,o){for(var h=0;h<l.length;h++)o.writeSFixed32(l[h])}function $T(l,o){for(var h=0;h<l.length;h++)o.writeFixed64(l[h])}function eL(l,o){for(var h=0;h<l.length;h++)o.writeSFixed64(l[h])}function Xm(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function qh(l,o,h){l[h]=o,l[h+1]=o>>>8,l[h+2]=o>>>16,l[h+3]=o>>>24}function ab(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}Yn.prototype={destroy:function(){this.buf=null},readFields:function(l,o,h){for(h=h||this.length;this.pos<h;){var p=this.readVarint(),y=p>>3,b=this.pos;this.type=7&p,l(y,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=Xm(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=ab(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=Xm(this.buf,this.pos)+Xm(this.buf,this.pos+4)*w_;return this.pos+=8,l},readSFixed64:function(){var l=Xm(this.buf,this.pos)+ab(this.buf,this.pos+4)*w_;return this.pos+=8,l},readFloat:function(){var l=nb(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=nb(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,h,p=this.buf;return o=127&(h=p[this.pos++]),h<128?o:(o|=(127&(h=p[this.pos++]))<<7,h<128?o:(o|=(127&(h=p[this.pos++]))<<14,h<128?o:(o|=(127&(h=p[this.pos++]))<<21,h<128?o:function(y,b,x){var I,L,A=x.buf;if(I=(112&(L=A[x.pos++]))>>4,L<128||(I|=(127&(L=A[x.pos++]))<<3,L<128)||(I|=(127&(L=A[x.pos++]))<<10,L<128)||(I|=(127&(L=A[x.pos++]))<<17,L<128)||(I|=(127&(L=A[x.pos++]))<<24,L<128)||(I|=(1&(L=A[x.pos++]))<<31,L<128))return Gh(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(h=p[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&ob?function(h,p,y){return ob.decode(h.subarray(p,y))}(this.buf,o,l):function(h,p,y){for(var b="",x=p;x<y;){var I,L,A,N=h[x],O=null,G=N>239?4:N>223?3:N>191?2:1;if(x+G>y)break;G===1?N<128&&(O=N):G===2?(192&(I=h[x+1]))==128&&(O=(31&N)<<6|63&I)<=127&&(O=null):G===3?(L=h[x+2],(192&(I=h[x+1]))==128&&(192&L)==128&&((O=(15&N)<<12|(63&I)<<6|63&L)<=2047||O>=55296&&O<=57343)&&(O=null)):G===4&&(L=h[x+2],A=h[x+3],(192&(I=h[x+1]))==128&&(192&L)==128&&(192&A)==128&&((O=(15&N)<<18|(63&I)<<12|(63&L)<<6|63&A)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,G=1):O>65535&&(O-=65536,b+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),b+=String.fromCharCode(O),x+=G}return b}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==Yn.Bytes)return l.push(this.readVarint(o));var h=Dl(this);for(l=l||[];this.pos<h;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==Yn.Bytes)return l.push(this.readSVarint());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==Yn.Bytes)return l.push(this.readBoolean());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==Yn.Bytes)return l.push(this.readFloat());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==Yn.Bytes)return l.push(this.readDouble());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==Yn.Bytes)return l.push(this.readFixed32());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==Yn.Bytes)return l.push(this.readSFixed32());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==Yn.Bytes)return l.push(this.readFixed64());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==Yn.Bytes)return l.push(this.readSFixed64());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===Yn.Varint)for(;this.buf[this.pos++]>127;);else if(o===Yn.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Yn.Fixed32)this.pos+=4;else{if(o!==Yn.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var h=new Uint8Array(o);h.set(this.buf),this.buf=h,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),qh(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),qh(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),qh(this.buf,-1&l,this.pos),qh(this.buf,Math.floor(l*ib),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),qh(this.buf,-1&l,this.pos),qh(this.buf,Math.floor(l*ib),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,h){var p,y;if(o>=0?(p=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(b,x,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(p,0,h),function(b,x){var I=(7&b)<<4;x.buf[x.pos++]|=I|((b>>>=3)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b)))))}(y,h)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(!!l)},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(p,y,b){for(var x,I,L=0;L<y.length;L++){if((x=y.charCodeAt(L))>55295&&x<57344){if(!I){x>56319||L+1===y.length?(p[b++]=239,p[b++]=191,p[b++]=189):I=x;continue}if(x<56320){p[b++]=239,p[b++]=191,p[b++]=189,I=x;continue}x=I-55296<<10|x-56320|65536,I=null}else I&&(p[b++]=239,p[b++]=191,p[b++]=189,I=null);x<128?p[b++]=x:(x<2048?p[b++]=x>>6|192:(x<65536?p[b++]=x>>12|224:(p[b++]=x>>18|240,p[b++]=x>>12&63|128),p[b++]=x>>6&63|128),p[b++]=63&x|128)}return b}(this.buf,l,this.pos);var h=this.pos-o;h>=128&&sb(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h},writeFloat:function(l){this.realloc(4),rb(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),rb(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var h=0;h<o;h++)this.buf[this.pos++]=l[h]},writeRawMessage:function(l,o){this.pos++;var h=this.pos;l(o,this);var p=this.pos-h;p>=128&&sb(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeMessage:function(l,o,h){this.writeTag(l,Yn.Bytes),this.writeRawMessage(o,h)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,HT,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,ZT,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,KT,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,XT,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,YT,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,JT,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,QT,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,$T,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,eL,o)},writeBytesField:function(l,o){this.writeTag(l,Yn.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,Yn.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,Yn.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,Yn.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,Yn.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,Yn.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,Yn.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,Yn.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,Yn.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,Yn.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,!!o)}};var S_=m(tb);const E_=3;function tL(l,o,h){l===1&&h.readMessage(nL,o)}function nL(l,o,h){if(l===3){const{id:p,bitmap:y,width:b,height:x,left:I,top:L,advance:A}=h.readMessage(rL,{});o.push({id:p,bitmap:new Op({width:b+2*E_,height:x+2*E_},y),metrics:{width:b,height:x,left:I,top:L,advance:A}})}}function rL(l,o,h){l===1?o.id=h.readVarint():l===2?o.bitmap=h.readBytes():l===3?o.width=h.readVarint():l===4?o.height=h.readVarint():l===5?o.left=h.readSVarint():l===6?o.top=h.readSVarint():l===7&&(o.advance=h.readVarint())}const lb=E_;function ub(l){let o=0,h=0;for(const x of l)o+=x.w*x.h,h=Math.max(h,x.w);l.sort((x,I)=>I.h-x.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),h),h:1/0}];let y=0,b=0;for(const x of l)for(let I=p.length-1;I>=0;I--){const L=p[I];if(!(x.w>L.w||x.h>L.h)){if(x.x=L.x,x.y=L.y,b=Math.max(b,x.y+x.h),y=Math.max(y,x.x+x.w),x.w===L.w&&x.h===L.h){const A=p.pop();I<p.length&&(p[I]=A)}else x.h===L.h?(L.x+=x.w,L.w-=x.w):x.w===L.w?(L.y+=x.h,L.h-=x.h):(p.push({x:L.x+x.w,y:L.y,w:L.w-x.w,h:x.h}),L.y+=x.h,L.h-=x.h);break}}return{w:y,h:b,fill:o/(y*b)||0}}const Oo=1;class I_{constructor(o,{pixelRatio:h,version:p,stretchX:y,stretchY:b,content:x}){this.paddedRect=o,this.pixelRatio=h,this.stretchX=y,this.stretchY=b,this.content=x,this.version=p}get tl(){return[this.paddedRect.x+Oo,this.paddedRect.y+Oo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Oo,this.paddedRect.y+this.paddedRect.h-Oo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Oo)/this.pixelRatio,(this.paddedRect.h-2*Oo)/this.pixelRatio]}}class cb{constructor(o,h){const p={},y={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,p,b),this.addImages(h,y,b);const{w:x,h:I}=ub(b),L=new vs({width:x||1,height:I||1});for(const A in o){const N=o[A],O=p[A].paddedRect;vs.copy(N.data,L,{x:0,y:0},{x:O.x+Oo,y:O.y+Oo},N.data)}for(const A in h){const N=h[A],O=y[A].paddedRect,G=O.x+Oo,H=O.y+Oo,K=N.data.width,ee=N.data.height;vs.copy(N.data,L,{x:0,y:0},{x:G,y:H},N.data),vs.copy(N.data,L,{x:0,y:ee-1},{x:G,y:H-1},{width:K,height:1}),vs.copy(N.data,L,{x:0,y:0},{x:G,y:H+ee},{width:K,height:1}),vs.copy(N.data,L,{x:K-1,y:0},{x:G-1,y:H},{width:1,height:ee}),vs.copy(N.data,L,{x:0,y:0},{x:G+K,y:H},{width:1,height:ee})}this.image=L,this.iconPositions=p,this.patternPositions=y}addImages(o,h,p){for(const y in o){const b=o[y],x={x:0,y:0,w:b.data.width+2*Oo,h:b.data.height+2*Oo};p.push(x),h[y]=new I_(x,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(o,h){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in o.updatedImages)this.patchUpdatedImage(this.iconPositions[p],o.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],o.getImage(p),h)}patchUpdatedImage(o,h,p){if(!o||!h||o.version===h.version)return;o.version=h.version;const[y,b]=o.tl;p.update(h.data,void 0,{x:y,y:b})}}var _u;St("ImagePosition",I_),St("ImageAtlas",cb),c.ah=void 0,(_u=c.ah||(c.ah={}))[_u.none=0]="none",_u[_u.horizontal=1]="horizontal",_u[_u.vertical=2]="vertical",_u[_u.horizontalOnly=3]="horizontalOnly";const jp=-17;class Wp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,h){const p=new Wp;return p.scale=o||1,p.fontStack=h,p}static forImage(o){const h=new Wp;return h.imageName=o,h}}class jh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,h){const p=new jh;for(let y=0;y<o.sections.length;y++){const b=o.sections[y];b.image?p.addImageSection(b):p.addTextSection(b,h)}return p}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let h="";for(let p=0;p<o.length;p++){const y=o.charCodeAt(p+1)||null,b=o.charCodeAt(p-1)||null;h+=y&&_p(y)&&!qp[o[p+1]]||b&&_p(b)&&!qp[o[p-1]]||!qp[o[p]]?o[p]:qp[o[p]]}return h}(this.text)}trim(){let o=0;for(let p=0;p<this.text.length&&Km[this.text.charCodeAt(p)];p++)o++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=o&&Km[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(o,h),this.sectionIndex=this.sectionIndex.slice(o,h)}substring(o,h){const p=new jh;return p.text=this.text.substring(o,h),p.sectionIndex=this.sectionIndex.slice(o,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,h)=>Math.max(o,this.sections[h].scale),0)}addTextSection(o,h){this.text+=o.text,this.sections.push(Wp.forText(o.scale,o.fontStack||h));const p=this.sections.length-1;for(let y=0;y<o.text.length;++y)this.sectionIndex.push(p)}addImageSection(o){const h=o.image?o.image.name:"";if(h.length===0)return void Ke("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Wp.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ym(l,o,h,p,y,b,x,I,L,A,N,O,G,H,K,ee){const ae=jh.fromFeature(l,y);let pe;O===c.ah.vertical&&ae.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:ye}=Ha;if(De&&ae.sections.length===1){pe=[];const Je=De(ae.toString(),C_(ae,A,b,o,p,H,K));for(const bt of Je){const Ct=new jh;Ct.text=bt,Ct.sections=ae.sections;for(let vt=0;vt<bt.length;vt++)Ct.sectionIndex.push(0);pe.push(Ct)}}else if(ye){pe=[];const Je=ye(ae.text,ae.sectionIndex,C_(ae,A,b,o,p,H,K));for(const bt of Je){const Ct=new jh;Ct.text=bt[0],Ct.sectionIndex=bt[1],Ct.sections=ae.sections,pe.push(Ct)}}else pe=function(Je,bt){const Ct=[],vt=Je.text;let yt=0;for(const ct of bt)Ct.push(Je.substring(yt,ct)),yt=ct;return yt<vt.length&&Ct.push(Je.substring(yt,vt.length)),Ct}(ae,C_(ae,A,b,o,p,H,K));const Ee=[],Ye={positionedLines:Ee,text:ae.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Je,bt,Ct,vt,yt,ct,Et,dt,nt,zt,Pt,pn){let ir=0,hr=jp,hi=0,ns=0;const _o=dt==="right"?1:dt==="left"?0:.5;let ni=0;for(const fi of yt){fi.trim();const pi=fi.getMaxScale(),eo=(pi-1)*ci,xo={positionedGlyphs:[],lineOffset:0};Je.positionedLines[ni]=xo;const to=xo.positionedGlyphs;let zo=0;if(!fi.length()){hr+=ct,++ni;continue}for(let di=0;di<fi.length();di++){const vn=fi.getSection(di),no=fi.getSectionIndex(di),Bi=fi.getCharCode(di);let mi=0,js=null,va=null,ba=null,Rl=ci;const Ws=!(nt===c.ah.horizontal||!Pt&&!Ih(Bi)||Pt&&(Km[Bi]||(Mi=Bi,_t.Arabic(Mi)||_t["Arabic Supplement"](Mi)||_t["Arabic Extended-A"](Mi)||_t["Arabic Presentation Forms-A"](Mi)||_t["Arabic Presentation Forms-B"](Mi))));if(vn.imageName){const xs=vt[vn.imageName];if(!xs)continue;ba=vn.imageName,Je.iconsInText=Je.iconsInText||!0,va=xs.paddedRect;const Bo=xs.displaySize;vn.scale=vn.scale*ci/pn,js={width:Bo[0],height:Bo[1],left:Oo,top:-lb,advance:Ws?Bo[1]:Bo[0]},mi=eo+(ci-Bo[1]*vn.scale),Rl=js.advance;const Nl=Ws?Bo[0]*vn.scale-ci*pi:Bo[1]*vn.scale-ci*pi;Nl>0&&Nl>zo&&(zo=Nl)}else{const xs=Ct[vn.fontStack],Bo=xs&&xs[Bi];if(Bo&&Bo.rect)va=Bo.rect,js=Bo.metrics;else{const Nl=bt[vn.fontStack],Kp=Nl&&Nl[Bi];if(!Kp)continue;js=Kp.metrics}mi=(pi-vn.scale)*ci}Ws?(Je.verticalizable=!0,to.push({glyph:Bi,imageName:ba,x:ir,y:hr+mi,vertical:Ws,scale:vn.scale,fontStack:vn.fontStack,sectionIndex:no,metrics:js,rect:va}),ir+=Rl*vn.scale+zt):(to.push({glyph:Bi,imageName:ba,x:ir,y:hr+mi,vertical:Ws,scale:vn.scale,fontStack:vn.fontStack,sectionIndex:no,metrics:js,rect:va}),ir+=js.advance*vn.scale+zt)}to.length!==0&&(hi=Math.max(ir-zt,hi),sL(to,0,to.length-1,_o,zo)),ir=0;const Fo=ct*pi+zo;xo.lineOffset=Math.max(zo,eo),hr+=Fo,ns=Math.max(Fo,ns),++ni}var Mi;const Fi=hr-jp,{horizontalAlign:vo,verticalAlign:bo}=T_(Et);(function(fi,pi,eo,xo,to,zo,Fo,di,vn){const no=(pi-eo)*to;let Bi=0;Bi=zo!==Fo?-di*xo-jp:(-xo*vn+.5)*Fo;for(const mi of fi)for(const js of mi.positionedGlyphs)js.x+=no,js.y+=Bi})(Je.positionedLines,_o,vo,bo,hi,ns,ct,Fi,yt.length),Je.top+=-bo*Fi,Je.bottom=Je.top+Fi,Je.left+=-vo*hi,Je.right=Je.left+hi}(Ye,o,h,p,pe,x,I,L,O,A,G,ee),!function(Je){for(const bt of Je)if(bt.positionedGlyphs.length!==0)return!1;return!0}(Ee)&&Ye}const Km={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},iL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hb(l,o,h,p,y,b){if(o.imageName){const x=p[o.imageName];return x?x.displaySize[0]*o.scale*ci/b+y:0}{const x=h[o.fontStack],I=x&&x[l];return I?I.metrics.advance*o.scale+y:0}}function fb(l,o,h,p){const y=Math.pow(l-o,2);return p?l<o?y/2:2*y:y+Math.abs(h)*h}function oL(l,o,h){let p=0;return l===10&&(p-=1e4),h&&(p+=150),l!==40&&l!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function pb(l,o,h,p,y,b){let x=null,I=fb(o,h,y,b);for(const L of p){const A=fb(o-L.x,h,y,b)+L.badness;A<=I&&(x=L,I=A)}return{index:l,x:o,priorBreak:x,badness:I}}function db(l){return l?db(l.priorBreak).concat(l.index):[]}function C_(l,o,h,p,y,b,x){if(b!=="point")return[];if(!l)return[];const I=[],L=function(G,H,K,ee,ae,pe){let De=0;for(let ye=0;ye<G.length();ye++){const Ee=G.getSection(ye);De+=hb(G.getCharCode(ye),Ee,ee,ae,H,pe)}return De/Math.max(1,Math.ceil(De/K))}(l,o,h,p,y,x),A=l.text.indexOf("​")>=0;let N=0;for(let G=0;G<l.length();G++){const H=l.getSection(G),K=l.getCharCode(G);if(Km[K]||(N+=hb(K,H,p,y,o,x)),G<l.length()-1){const ee=!((O=K)<11904||!(_t["Bopomofo Extended"](O)||_t.Bopomofo(O)||_t["CJK Compatibility Forms"](O)||_t["CJK Compatibility Ideographs"](O)||_t["CJK Compatibility"](O)||_t["CJK Radicals Supplement"](O)||_t["CJK Strokes"](O)||_t["CJK Symbols and Punctuation"](O)||_t["CJK Unified Ideographs Extension A"](O)||_t["CJK Unified Ideographs"](O)||_t["Enclosed CJK Letters and Months"](O)||_t["Halfwidth and Fullwidth Forms"](O)||_t.Hiragana(O)||_t["Ideographic Description Characters"](O)||_t["Kangxi Radicals"](O)||_t["Katakana Phonetic Extensions"](O)||_t.Katakana(O)||_t["Vertical Forms"](O)||_t["Yi Radicals"](O)||_t["Yi Syllables"](O)));(iL[K]||ee||H.imageName)&&I.push(pb(G+1,N,L,I,oL(K,l.getCharCode(G+1),ee&&A),!1))}}var O;return db(pb(l.length(),N,L,I,0,!0))}function T_(l){let o=.5,h=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:o,verticalAlign:h}}function sL(l,o,h,p,y){if(!p&&!y)return;const b=l[h],x=(l[h].x+b.metrics.advance*b.scale)*p;for(let I=o;I<=h;I++)l[I].x-=x,l[I].y+=y}function aL(l,o,h){const{horizontalAlign:p,verticalAlign:y}=T_(h),b=o[0]-l.displaySize[0]*p,x=o[1]-l.displaySize[1]*y;return{image:l,top:x,bottom:x+l.displaySize[1],left:b,right:b+l.displaySize[0]}}function mb(l,o,h,p,y,b){const x=l.image;let I;if(x.content){const ae=x.content,pe=x.pixelRatio||1;I=[ae[0]/pe,ae[1]/pe,x.displaySize[0]-ae[2]/pe,x.displaySize[1]-ae[3]/pe]}const L=o.left*b,A=o.right*b;let N,O,G,H;h==="width"||h==="both"?(H=y[0]+L-p[3],O=y[0]+A+p[1]):(H=y[0]+(L+A-x.displaySize[0])/2,O=H+x.displaySize[0]);const K=o.top*b,ee=o.bottom*b;return h==="height"||h==="both"?(N=y[1]+K-p[0],G=y[1]+ee+p[2]):(N=y[1]+(K+ee-x.displaySize[1])/2,G=N+x.displaySize[1]),{image:x,top:N,right:O,bottom:G,left:H,collisionPadding:I}}const Hp=255,Ka=128,vu=Hp*Ka;function gb(l,o){const{expression:h}=o;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new ur(l+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:y}=h;let b=0;for(;b<p.length&&p[b]<=l;)b++;b=Math.max(0,b-1);let x=b;for(;x<p.length&&p[x]<l+1;)x++;x=Math.min(p.length-1,x);const I=p[b],L=p[x];return h.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:L,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:L,minSize:h.evaluate(new ur(I)),maxSize:h.evaluate(new ur(L)),interpolationType:y}}}function L_(l,o,h){let p="never";const y=l.get(o);return y?p=y:l.get(h)&&(p="always"),p}const lL=yu.VectorTileFeature.types,uL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jm(l,o,h,p,y,b,x,I,L,A,N,O,G){const H=I?Math.min(vu,Math.round(I[0])):0,K=I?Math.min(vu,Math.round(I[1])):0;l.emplaceBack(o,h,Math.round(32*p),Math.round(32*y),b,x,(H<<1)+(L?1:0),K,16*A,16*N,256*O,256*G)}function P_(l,o,h){l.emplaceBack(o.x,o.y,h),l.emplaceBack(o.x,o.y,h),l.emplaceBack(o.x,o.y,h),l.emplaceBack(o.x,o.y,h)}function cL(l){for(const o of l.sections)if(s_(o.text))return!0;return!1}class M_{constructor(o){this.layoutVertexArray=new Fe,this.indexArray=new He,this.programConfigurations=o,this.segments=new ft,this.dynamicLayoutVertexArray=new he,this.opacityVertexArray=new Ie,this.hasVisibleVertices=!1,this.placedSymbolArray=new f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,h,p,y){this.isEmpty()||(p&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,UT.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,GT.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,uL,!0),this.opacityVertexBuffer.itemSize=1),(p||y)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}St("SymbolBuffers",M_);class A_{constructor(o,h,p){this.layoutVertexArray=new o,this.layoutAttributes=h,this.indexArray=new p,this.segments=new ft,this.collisionVertexArray=new Ge}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,qT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}St("CollisionBuffers",A_);class Wh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(x=>x.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=l_([]),this.placementViewportMatrix=l_([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gb(this.zoom,h["text-size"]),this.iconSizeData=gb(this.zoom,h["icon-size"]);const p=this.layers[0].layout,y=p.get("symbol-sort-key"),b=p.get("symbol-z-order");this.canOverlap=L_(p,"text-overlap","text-allow-overlap")!=="never"||L_(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(x=>c.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=o.sourceID}createArrays(){this.text=new M_(new _r(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new M_(new _r(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new v,this.lineVertexArray=new C,this.symbolInstances=new g,this.textAnchorOffsets=new M}calculateGlyphDependencies(o,h,p,y,b){for(let x=0;x<o.length;x++)if(h[o.charCodeAt(x)]=!0,(p||y)&&b){const I=qp[o.charAt(x)];I&&(h[I.charCodeAt(0)]=!0)}}populate(o,h,p){const y=this.layers[0],b=y.layout,x=b.get("text-font"),I=b.get("text-field"),L=b.get("icon-image"),A=(I.value.kind!=="constant"||I.value.value instanceof Ao&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),N=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,O=b.get("symbol-sort-key");if(this.features=[],!A&&!N)return;const G=h.iconDependencies,H=h.glyphDependencies,K=h.availableImages,ee=new ur(this.zoom);for(const{feature:ae,id:pe,index:De,sourceLayerIndex:ye}of o){const Ee=y._featureFilter.needGeometry,Ye=kl(ae,Ee);if(!y._featureFilter.filter(ee,Ye,p))continue;let Je,bt;if(Ee||(Ye.geometry=Al(ae)),A){const vt=y.getValueAndResolveTokens("text-field",Ye,p,K),yt=Ao.factory(vt),ct=this.hasRTLText=this.hasRTLText||cL(yt);(!ct||Ha.getRTLTextPluginStatus()==="unavailable"||ct&&Ha.isParsed())&&(Je=WT(yt,y,Ye))}if(N){const vt=y.getValueAndResolveTokens("icon-image",Ye,p,K);bt=vt instanceof $o?vt:$o.fromString(vt)}if(!Je&&!bt)continue;const Ct=this.sortFeaturesByKey?O.evaluate(Ye,{},p):void 0;if(this.features.push({id:pe,text:Je,icon:bt,index:De,sourceLayerIndex:ye,geometry:Ye.geometry,properties:ae.properties,type:lL[ae.type],sortKey:Ct}),bt&&(G[bt.name]=!0),Je){const vt=x.evaluate(Ye,{},p).join(","),yt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const ct of Je.sections)if(ct.image)G[ct.image.name]=!0;else{const Et=mu(Je.toString()),dt=ct.fontStack||vt,nt=H[dt]=H[dt]||{};this.calculateGlyphDependencies(ct.text,nt,yt,this.allowVerticalPlacement,Et)}}}b.get("symbol-placement")==="line"&&(this.features=function(ae){const pe={},De={},ye=[];let Ee=0;function Ye(vt){ye.push(ae[vt]),Ee++}function Je(vt,yt,ct){const Et=De[vt];return delete De[vt],De[yt]=Et,ye[Et].geometry[0].pop(),ye[Et].geometry[0]=ye[Et].geometry[0].concat(ct[0]),Et}function bt(vt,yt,ct){const Et=pe[yt];return delete pe[yt],pe[vt]=Et,ye[Et].geometry[0].shift(),ye[Et].geometry[0]=ct[0].concat(ye[Et].geometry[0]),Et}function Ct(vt,yt,ct){const Et=ct?yt[0][yt[0].length-1]:yt[0][0];return`${vt}:${Et.x}:${Et.y}`}for(let vt=0;vt<ae.length;vt++){const yt=ae[vt],ct=yt.geometry,Et=yt.text?yt.text.toString():null;if(!Et){Ye(vt);continue}const dt=Ct(Et,ct),nt=Ct(Et,ct,!0);if(dt in De&&nt in pe&&De[dt]!==pe[nt]){const zt=bt(dt,nt,ct),Pt=Je(dt,nt,ye[zt].geometry);delete pe[dt],delete De[nt],De[Ct(Et,ye[Pt].geometry,!0)]=Pt,ye[zt].geometry=null}else dt in De?Je(dt,nt,ct):nt in pe?bt(dt,nt,ct):(Ye(vt),pe[dt]=Ee-1,De[nt]=Ee-1)}return ye.filter(vt=>vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,pe)=>ae.sortKey-pe.sortKey)}update(o,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(o,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,h){const p=this.lineVertexArray.length;if(o.segment!==void 0){let y=o.dist(h[o.segment+1]),b=o.dist(h[o.segment]);const x={};for(let I=o.segment+1;I<h.length;I++)x[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:y},I<h.length-1&&(y+=h[I+1].dist(h[I]));for(let I=o.segment||0;I>=0;I--)x[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:b},I>0&&(b+=h[I-1].dist(h[I]));for(let I=0;I<h.length;I++){const L=x[I];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(o,h,p,y,b,x,I,L,A,N,O,G){const H=o.indexArray,K=o.layoutVertexArray,ee=o.segments.prepareSegment(4*h.length,K,H,this.canOverlap?x.sortKey:void 0),ae=this.glyphOffsetArray.length,pe=ee.vertexLength,De=this.allowVerticalPlacement&&I===c.ah.vertical?Math.PI/2:0,ye=x.text&&x.text.sections;for(let Ee=0;Ee<h.length;Ee++){const{tl:Ye,tr:Je,bl:bt,br:Ct,tex:vt,pixelOffsetTL:yt,pixelOffsetBR:ct,minFontScaleX:Et,minFontScaleY:dt,glyphOffset:nt,isSDF:zt,sectionIndex:Pt}=h[Ee],pn=ee.vertexLength,ir=nt[1];Jm(K,L.x,L.y,Ye.x,ir+Ye.y,vt.x,vt.y,p,zt,yt.x,yt.y,Et,dt),Jm(K,L.x,L.y,Je.x,ir+Je.y,vt.x+vt.w,vt.y,p,zt,ct.x,yt.y,Et,dt),Jm(K,L.x,L.y,bt.x,ir+bt.y,vt.x,vt.y+vt.h,p,zt,yt.x,ct.y,Et,dt),Jm(K,L.x,L.y,Ct.x,ir+Ct.y,vt.x+vt.w,vt.y+vt.h,p,zt,ct.x,ct.y,Et,dt),P_(o.dynamicLayoutVertexArray,L,De),H.emplaceBack(pn,pn+1,pn+2),H.emplaceBack(pn+1,pn+2,pn+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nt[0]),Ee!==h.length-1&&Pt===h[Ee+1].sectionIndex||o.programConfigurations.populatePaintArrays(K.length,x,x.index,{},G,ye&&ye[Pt])}o.placedSymbolArray.emplaceBack(L.x,L.y,ae,this.glyphOffsetArray.length-ae,pe,A,N,L.segment,p?p[0]:0,p?p[1]:0,y[0],y[1],I,0,!1,0,O)}_addCollisionDebugVertex(o,h,p,y,b,x){return h.emplaceBack(0,0),o.emplaceBack(p.x,p.y,y,b,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(o,h,p,y,b,x,I){const L=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),A=L.vertexLength,N=b.layoutVertexArray,O=b.collisionVertexArray,G=I.anchorX,H=I.anchorY;this._addCollisionDebugVertex(N,O,x,G,H,new E(o,h)),this._addCollisionDebugVertex(N,O,x,G,H,new E(p,h)),this._addCollisionDebugVertex(N,O,x,G,H,new E(p,y)),this._addCollisionDebugVertex(N,O,x,G,H,new E(o,y)),L.vertexLength+=4;const K=b.indexArray;K.emplaceBack(A,A+1),K.emplaceBack(A+1,A+2),K.emplaceBack(A+2,A+3),K.emplaceBack(A+3,A),L.primitiveLength+=4}addDebugCollisionBoxes(o,h,p,y){for(let b=o;b<h;b++){const x=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,y?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new A_(Be,eb.members,et),this.iconCollisionBox=new A_(Be,eb.members,et);for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(o,h,p,y,b,x,I,L,A){const N={};for(let O=h;O<p;O++){const G=o.get(O);N.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.textFeatureIndex=G.featureIndex;break}for(let O=y;O<b;O++){const G=o.get(O);N.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.verticalTextFeatureIndex=G.featureIndex;break}for(let O=x;O<I;O++){const G=o.get(O);N.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.iconFeatureIndex=G.featureIndex;break}for(let O=L;O<A;O++){const G=o.get(O);N.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.verticalIconFeatureIndex=G.featureIndex;break}return N}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,h){const p=o.placedSymbolArray.get(h),y=p.vertexStartIndex+4*p.numGlyphs;for(let b=p.vertexStartIndex;b<y;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(o),p=Math.cos(o),y=[],b=[],x=[];for(let I=0;I<this.symbolInstances.length;++I){x.push(I);const L=this.symbolInstances.get(I);y.push(0|Math.round(h*L.anchorX+p*L.anchorY)),b.push(L.featureIndex)}return x.sort((I,L)=>y[I]-y[L]||b[L]-b[I]),x}addToSortKeyRanges(o,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((y,b,x)=>{y>=0&&x.indexOf(y)===b&&this.addIndicesForPlacedSymbol(this.text,y)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yb,_b;St("SymbolBucket",Wh,{omit:["layers","collisionBoxArray","features","compareText"]}),Wh.MAX_GLYPHS=65535,Wh.addDynamicAttributes=P_;var k_={get paint(){return _b=_b||new go({"icon-opacity":new Ft(Oe.paint_symbol["icon-opacity"]),"icon-color":new Ft(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Ft(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new kt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new kt(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ft(Oe.paint_symbol["text-opacity"]),"text-color":new Ft(Oe.paint_symbol["text-color"],{runtimeType:Rr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ft(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Ft(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft(Oe.paint_symbol["text-halo-blur"]),"text-translate":new kt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new kt(Oe.paint_symbol["text-translate-anchor"])})},get layout(){return yb=yb||new go({"symbol-placement":new kt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new kt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kt(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new kt(Oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new kt(Oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new kt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new kt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft(Oe.layout_symbol["icon-size"]),"icon-text-fit":new kt(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft(Oe.layout_symbol["icon-image"]),"icon-rotate":new Ft(Oe.layout_symbol["icon-rotate"]),"icon-padding":new Ft(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new kt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Ft(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Ft(Oe.layout_symbol["text-field"]),"text-font":new Ft(Oe.layout_symbol["text-font"]),"text-size":new Ft(Oe.layout_symbol["text-size"]),"text-max-width":new Ft(Oe.layout_symbol["text-max-width"]),"text-line-height":new kt(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Ft(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Ft(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kt(Oe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ft(Oe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ft(Oe.layout_symbol["text-anchor"]),"text-max-angle":new kt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new kt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Ft(Oe.layout_symbol["text-rotate"]),"text-padding":new kt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new kt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Ft(Oe.layout_symbol["text-transform"]),"text-offset":new Ft(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new kt(Oe.layout_symbol["text-allow-overlap"]),"text-overlap":new kt(Oe.layout_symbol["text-overlap"]),"text-ignore-placement":new kt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new kt(Oe.layout_symbol["text-optional"])})}};class vb{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Kr,this.defaultValue=o}evaluate(o){if(o.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(o.formattedSection))return h.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}St("FormatSectionOverride",vb,{omit:["defaultValue"]});class Qm extends _s{constructor(o){super(o,k_)}recalculate(o,h){if(super.recalculate(o,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const y=[];for(const b of p)y.indexOf(b)<0&&y.push(b);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,h,p,y){const b=this.layout.get(o).evaluate(h,{},p,y),x=this._unevaluatedLayout._values[o];return x.isDataDriven()||$n(x.value)||!b?b:function(I,L){return L.replace(/{([^{}]+)}/g,(A,N)=>I&&N in I?String(I[N]):"")}(h.properties,b)}createBucket(o){return new Wh(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of k_.paint.overridableProperties){if(!Qm.hasPaintOverride(this.layout,o))continue;const h=this.paint.get(o),p=new vb(h),y=new rr(p,h.property.specification);let b=null;b=h.value.kind==="constant"||h.value.kind==="source"?new dh("source",y):new up("composite",y,h.value.zoomStops),this.paint._values[o]=new ys(h.property,b,h.parameters)}}_handleOverridablePaintPropertyUpdate(o,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&Qm.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,h){const p=o.get("text-field"),y=k_.paint.properties[h];let b=!1;const x=I=>{for(const L of I)if(y.overrides&&y.overrides.hasOverride(L))return void(b=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Ao)x(p.value.value.sections);else if(p.value.kind==="source"){const I=A=>{b||(A instanceof Ua&&Qr(A.value)===Vr?x(A.value.sections):A instanceof fh?x(A.sections):A.eachChild(I))},L=p.value;L._styleExpression&&I(L._styleExpression.expression)}return b}}let bb;var hL={get paint(){return bb=bb||new go({"background-color":new kt(Oe.paint_background["background-color"]),"background-pattern":new hc(Oe.paint_background["background-pattern"]),"background-opacity":new kt(Oe.paint_background["background-opacity"])})}};class fL extends _s{constructor(o){super(o,hL)}}let xb;var pL={get paint(){return xb=xb||new go({"raster-opacity":new kt(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new kt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new kt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new kt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new kt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new kt(Oe.paint_raster["raster-fade-duration"])})}};class dL extends _s{constructor(o){super(o,pL)}}class mL extends _s{constructor(o){super(o,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class gL{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const D_=63710088e-1;class bu{constructor(o,h){if(isNaN(o)||isNaN(h))throw new Error(`Invalid LngLat object: (${o}, ${h})`);if(this.lng=+o,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bu(_e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const h=Math.PI/180,p=this.lat*h,y=o.lat*h,b=Math.sin(p)*Math.sin(y)+Math.cos(p)*Math.cos(y)*Math.cos((o.lng-this.lng)*h);return D_*Math.acos(Math.min(b,1))}static convert(o){if(o instanceof bu)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new bu(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new bu(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wb=2*Math.PI*D_;function Sb(l){return wb*Math.cos(l*Math.PI/180)}function Eb(l){return(180+l)/360}function Ib(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Cb(l,o){return l/Sb(o)}function R_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}class $m{constructor(o,h,p=0){this.x=+o,this.y=+h,this.z=+p}static fromLngLat(o,h=0){const p=bu.convert(o);return new $m(Eb(p.lng),Ib(p.lat),Cb(h,p.lat))}toLngLat(){return new bu(360*this.x-180,R_(this.y))}toAltitude(){return this.z*Sb(R_(this.y))}meterInMercatorCoordinateUnits(){return 1/wb*(o=R_(this.y),1/Math.cos(o*Math.PI/180));var o}}function Tb(l,o,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[l*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}class N_{constructor(o,h,p){if(o<0||o>25||p<0||p>=Math.pow(2,o)||h<0||h>=Math.pow(2,o))throw new Error(`x=${h}, y=${p}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=h,this.y=p,this.key=Zp(0,o,o,h,p)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,h,p){const y=(x=this.y,I=this.z,L=Tb(256*(b=this.x),256*(x=Math.pow(2,I)-x-1),I),A=Tb(256*(b+1),256*(x+1),I),L[0]+","+L[1]+","+A[0]+","+A[1]);var b,x,I,L,A;const N=function(O,G,H){let K,ee="";for(let ae=O;ae>0;ae--)K=1<<ae-1,ee+=(G&K?1:0)+(H&K?2:0);return ee}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,y)}isChildOf(o){const h=this.z-o.z;return h>0&&o.x===this.x>>h&&o.y===this.y>>h}getTilePoint(o){const h=Math.pow(2,this.z);return new E((o.x*h-this.x)*Nr,(o.y*h-this.y)*Nr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lb{constructor(o,h){this.wrap=o,this.canonical=h,this.key=Zp(o,h.z,h.z,h.x,h.y)}}class bs{constructor(o,h,p,y,b){if(o<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${p}`);this.overscaledZ=o,this.wrap=h,this.canonical=new N_(p,+y,+b),this.key=Zp(h,o,p,y,b)}clone(){return new bs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-o;return o>this.canonical.z?new bs(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bs(o,this.wrap,o,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(o,h){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-o;return o>this.canonical.z?Zp(this.wrap*+h,o,this.canonical.z,this.canonical.x,this.canonical.y):Zp(this.wrap*+h,o,o,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const h=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>h&&o.canonical.y===this.canonical.y>>h}children(o){if(this.overscaledZ>=o)return[new bs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,y=2*this.canonical.y;return[new bs(h,this.wrap,h,p,y),new bs(h,this.wrap,h,p+1,y),new bs(h,this.wrap,h,p,y+1),new bs(h,this.wrap,h,p+1,y+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new bs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new bs(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new $m(o.x-this.wrap,o.y))}}function Zp(l,o,h,p,y){(l*=2)<0&&(l=-1*l-1);const b=1<<h;return(b*b*l+b*y+p).toString(36)+h.toString(36)+o.toString(36)}St("CanonicalTileID",N_),St("OverscaledTileID",bs,{omit:["posMatrix"]});class Pb{constructor(o,h,p,y=1,b=1,x=1,I=0){if(this.uid=o,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Ke(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const L=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=b,this.blueFactor=x,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<L;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(L,A)]=this.data[this._idx(L-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,L)]=this.data[this._idx(A,L-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(L,-1)]=this.data[this._idx(L-1,0)],this.data[this._idx(-1,L)]=this.data[this._idx(0,L-1)],this.data[this._idx(L,L)]=this.data[this._idx(L-1,L-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<L;A++)for(let N=0;N<L;N++){const O=this.get(A,N);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(o,h){const p=new Uint8Array(this.data.buffer),y=4*this._idx(o,h);return this.unpack(p[y],p[y+1],p[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,h){if(o<-1||o>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(o+1)}unpack(o,h,p){return o*this.redFactor+h*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new vs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,h,p){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let y=h*this.dim,b=h*this.dim+this.dim,x=p*this.dim,I=p*this.dim+this.dim;switch(h){case-1:y=b-1;break;case 1:b=y+1}switch(p){case-1:x=I-1;break;case 1:I=x+1}const L=-h*this.dim,A=-p*this.dim;for(let N=x;N<I;N++)for(let O=y;O<b;O++)this.data[this._idx(O,N)]=o.data[this._idx(O+L,N+A)]}}St("DEMData",Pb);class Mb{constructor(o){this._stringToNumber={},this._numberToString=[];for(let h=0;h<o.length;h++){const p=o[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class Ab{constructor(o,h,p,y,b){this.type="Feature",this._vectorTileFeature=o,o._z=h,o._x=p,o._y=y,this.properties=o.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(o[h]=this[h]);return o}}class kb{constructor(o,h){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new lc(Nr,16,0),this.grid3D=new lc(Nr,16,0),this.featureIndexArray=new z,this.promoteId=h}insert(o,h,p,y,b,x){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,y,b);const L=x?this.grid3D:this.grid;for(let A=0;A<h.length;A++){const N=h[A],O=[1/0,1/0,-1/0,-1/0];for(let G=0;G<N.length;G++){const H=N[G];O[0]=Math.min(O[0],H.x),O[1]=Math.min(O[1],H.y),O[2]=Math.max(O[2],H.x),O[3]=Math.max(O[3],H.y)}O[0]<Nr&&O[1]<Nr&&O[2]>=0&&O[3]>=0&&L.insert(I,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new yu.VectorTile(new S_(this.rawTileData)).layers,this.sourceLayerCoder=new Mb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,h,p,y){this.loadVTLayers();const b=o.params||{},x=Nr/o.tileSize/o.scale,I=_h(b.filter),L=o.queryGeometry,A=o.queryPadding*x,N=Rb(L),O=this.grid.query(N.minX-A,N.minY-A,N.maxX+A,N.maxY+A),G=Rb(o.cameraQueryGeometry),H=this.grid3D.query(G.minX-A,G.minY-A,G.maxX+A,G.maxY+A,(ae,pe,De,ye)=>function(Ee,Ye,Je,bt,Ct){for(const yt of Ee)if(Ye<=yt.x&&Je<=yt.y&&bt>=yt.x&&Ct>=yt.y)return!0;const vt=[new E(Ye,Je),new E(Ye,Ct),new E(bt,Ct),new E(bt,Je)];if(Ee.length>2){for(const yt of vt)if(Fh(Ee,yt))return!0}for(let yt=0;yt<Ee.length-1;yt++)if(XC(Ee[yt],Ee[yt+1],vt))return!0;return!1}(o.cameraQueryGeometry,ae-A,pe-A,De+A,ye+A));for(const ae of H)O.push(ae);O.sort(yL);const K={};let ee;for(let ae=0;ae<O.length;ae++){const pe=O[ae];if(pe===ee)continue;ee=pe;const De=this.featureIndexArray.get(pe);let ye=null;this.loadMatchingFeature(K,De.bucketIndex,De.sourceLayerIndex,De.featureIndex,I,b.layers,b.availableImages,h,p,y,(Ee,Ye,Je)=>(ye||(ye=Al(Ee)),Ye.queryIntersectsFeature(L,Ee,Je,ye,this.z,o.transform,x,o.pixelPosMatrix)))}return K}loadMatchingFeature(o,h,p,y,b,x,I,L,A,N,O){const G=this.bucketLayerIDs[h];if(x&&!function(ae,pe){for(let De=0;De<ae.length;De++)if(pe.indexOf(ae[De])>=0)return!0;return!1}(x,G))return;const H=this.sourceLayerCoder.decode(p),K=this.vtLayers[H].feature(y);if(b.needGeometry){const ae=kl(K,!0);if(!b.filter(new ur(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!b.filter(new ur(this.tileID.overscaledZ),K))return;const ee=this.getId(K,H);for(let ae=0;ae<G.length;ae++){const pe=G[ae];if(x&&x.indexOf(pe)<0)continue;const De=L[pe];if(!De)continue;let ye={};ee&&N&&(ye=N.getState(De.sourceLayer||"_geojsonTileLayer",ee));const Ee=se({},A[pe]);Ee.paint=Db(Ee.paint,De.paint,K,ye,I),Ee.layout=Db(Ee.layout,De.layout,K,ye,I);const Ye=!O||O(K,De,ye);if(!Ye)continue;const Je=new Ab(K,this.z,this.x,this.y,ee);Je.layer=Ee;let bt=o[pe];bt===void 0&&(bt=o[pe]=[]),bt.push({featureIndex:y,feature:Je,intersectionZ:Ye})}}lookupSymbolFeatures(o,h,p,y,b,x,I,L){const A={};this.loadVTLayers();const N=_h(b);for(const O of o)this.loadMatchingFeature(A,p,y,O,N,x,I,L,h);return A}hasLayer(o){for(const h of this.bucketLayerIDs)for(const p of h)if(o===p)return!0;return!1}getId(o,h){let p=o.id;return this.promoteId&&(p=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof p=="boolean"&&(p=Number(p))),p}}function Db(l,o,h,p,y){return me(l,(b,x)=>{const I=o instanceof cc?o.get(x):null;return I&&I.evaluate?I.evaluate(h,p,y):I})}function Rb(l){let o=1/0,h=1/0,p=-1/0,y=-1/0;for(const b of l)o=Math.min(o,b.x),h=Math.min(h,b.y),p=Math.max(p,b.x),y=Math.max(y,b.y);return{minX:o,minY:h,maxX:p,maxY:y}}function yL(l,o){return o-l}function Nb(l,o,h,p,y){const b=[];for(let x=0;x<l.length;x++){const I=l[x];let L;for(let A=0;A<I.length-1;A++){let N=I[A],O=I[A+1];N.x<o&&O.x<o||(N.x<o?N=new E(o,N.y+(o-N.x)/(O.x-N.x)*(O.y-N.y))._round():O.x<o&&(O=new E(o,N.y+(o-N.x)/(O.x-N.x)*(O.y-N.y))._round()),N.y<h&&O.y<h||(N.y<h?N=new E(N.x+(h-N.y)/(O.y-N.y)*(O.x-N.x),h)._round():O.y<h&&(O=new E(N.x+(h-N.y)/(O.y-N.y)*(O.x-N.x),h)._round()),N.x>=p&&O.x>=p||(N.x>=p?N=new E(p,N.y+(p-N.x)/(O.x-N.x)*(O.y-N.y))._round():O.x>=p&&(O=new E(p,N.y+(p-N.x)/(O.x-N.x)*(O.y-N.y))._round()),N.y>=y&&O.y>=y||(N.y>=y?N=new E(N.x+(y-N.y)/(O.y-N.y)*(O.x-N.x),y)._round():O.y>=y&&(O=new E(N.x+(y-N.y)/(O.y-N.y)*(O.x-N.x),y)._round()),L&&N.equals(L[L.length-1])||(L=[N],b.push(L)),L.push(O)))))}}return b}St("FeatureIndex",kb,{omit:["rawTileData","sourceLayerCoder"]});class xu extends E{constructor(o,h,p,y){super(o,h),this.angle=p,y!==void 0&&(this.segment=y)}clone(){return new xu(this.x,this.y,this.angle,this.segment)}}function Ob(l,o,h,p,y){if(o.segment===void 0||h===0)return!0;let b=o,x=o.segment+1,I=0;for(;I>-h/2;){if(x--,x<0)return!1;I-=l[x].dist(b),b=l[x]}I+=l[x].dist(l[x+1]),x++;const L=[];let A=0;for(;I<h/2;){const N=l[x],O=l[x+1];if(!O)return!1;let G=l[x-1].angleTo(N)-N.angleTo(O);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:I,angleDelta:G}),A+=G;I-L[0].distance>p;)A-=L.shift().angleDelta;if(A>y)return!1;x++,I+=N.dist(O)}return!0}function zb(l){let o=0;for(let h=0;h<l.length-1;h++)o+=l[h].dist(l[h+1]);return o}function Fb(l,o,h){return l?.6*o*h:0}function Bb(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function _L(l,o,h,p,y,b){const x=Fb(h,y,b),I=Bb(h,p)*b;let L=0;const A=zb(l)/2;for(let N=0;N<l.length-1;N++){const O=l[N],G=l[N+1],H=O.dist(G);if(L+H>A){const K=(A-L)/H,ee=Qi.number(O.x,G.x,K),ae=Qi.number(O.y,G.y,K),pe=new xu(ee,ae,G.angleTo(O),N);return pe._round(),!x||Ob(l,pe,I,x,o)?pe:void 0}L+=H}}function vL(l,o,h,p,y,b,x,I,L){const A=Fb(p,b,x),N=Bb(p,y),O=N*x,G=l[0].x===0||l[0].x===L||l[0].y===0||l[0].y===L;return o-O<o/4&&(o=O+o/4),Vb(l,G?o/2*I%o:(N/2+2*b)*x*I%o,o,A,h,O,G,!1,L)}function Vb(l,o,h,p,y,b,x,I,L){const A=b/2,N=zb(l);let O=0,G=o-h,H=[];for(let K=0;K<l.length-1;K++){const ee=l[K],ae=l[K+1],pe=ee.dist(ae),De=ae.angleTo(ee);for(;G+h<O+pe;){G+=h;const ye=(G-O)/pe,Ee=Qi.number(ee.x,ae.x,ye),Ye=Qi.number(ee.y,ae.y,ye);if(Ee>=0&&Ee<L&&Ye>=0&&Ye<L&&G-A>=0&&G+A<=N){const Je=new xu(Ee,Ye,De,K);Je._round(),p&&!Ob(l,Je,b,p,y)||H.push(Je)}}O+=pe}return I||H.length||x||(H=Vb(l,O/2,h,p,y,b,x,!0,L)),H}St("Anchor",xu);const Hh=Oo;function Ub(l,o,h,p){const y=[],b=l.image,x=b.pixelRatio,I=b.paddedRect.w-2*Hh,L=b.paddedRect.h-2*Hh,A=l.right-l.left,N=l.bottom-l.top,O=b.stretchX||[[0,I]],G=b.stretchY||[[0,L]],H=(ct,Et)=>ct+Et[1]-Et[0],K=O.reduce(H,0),ee=G.reduce(H,0),ae=I-K,pe=L-ee;let De=0,ye=K,Ee=0,Ye=ee,Je=0,bt=ae,Ct=0,vt=pe;if(b.content&&p){const ct=b.content;De=eg(O,0,ct[0]),Ee=eg(G,0,ct[1]),ye=eg(O,ct[0],ct[2]),Ye=eg(G,ct[1],ct[3]),Je=ct[0]-De,Ct=ct[1]-Ee,bt=ct[2]-ct[0]-ye,vt=ct[3]-ct[1]-Ye}const yt=(ct,Et,dt,nt)=>{const zt=tg(ct.stretch-De,ye,A,l.left),Pt=ng(ct.fixed-Je,bt,ct.stretch,K),pn=tg(Et.stretch-Ee,Ye,N,l.top),ir=ng(Et.fixed-Ct,vt,Et.stretch,ee),hr=tg(dt.stretch-De,ye,A,l.left),hi=ng(dt.fixed-Je,bt,dt.stretch,K),ns=tg(nt.stretch-Ee,Ye,N,l.top),_o=ng(nt.fixed-Ct,vt,nt.stretch,ee),ni=new E(zt,pn),Mi=new E(hr,pn),Fi=new E(hr,ns),vo=new E(zt,ns),bo=new E(Pt/x,ir/x),fi=new E(hi/x,_o/x),pi=o*Math.PI/180;if(pi){const to=Math.sin(pi),zo=Math.cos(pi),Fo=[zo,-to,to,zo];ni._matMult(Fo),Mi._matMult(Fo),vo._matMult(Fo),Fi._matMult(Fo)}const eo=ct.stretch+ct.fixed,xo=Et.stretch+Et.fixed;return{tl:ni,tr:Mi,bl:vo,br:Fi,tex:{x:b.paddedRect.x+Hh+eo,y:b.paddedRect.y+Hh+xo,w:dt.stretch+dt.fixed-eo,h:nt.stretch+nt.fixed-xo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bo,pixelOffsetBR:fi,minFontScaleX:bt/x/A,minFontScaleY:vt/x/N,isSDF:h}};if(p&&(b.stretchX||b.stretchY)){const ct=Gb(O,ae,K),Et=Gb(G,pe,ee);for(let dt=0;dt<ct.length-1;dt++){const nt=ct[dt],zt=ct[dt+1];for(let Pt=0;Pt<Et.length-1;Pt++)y.push(yt(nt,Et[Pt],zt,Et[Pt+1]))}}else y.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:L+1}));return y}function eg(l,o,h){let p=0;for(const y of l)p+=Math.max(o,Math.min(h,y[1]))-Math.max(o,Math.min(h,y[0]));return p}function Gb(l,o,h){const p=[{fixed:-Hh,stretch:0}];for(const[y,b]of l){const x=p[p.length-1];p.push({fixed:y-x.stretch,stretch:x.stretch}),p.push({fixed:y-x.stretch,stretch:x.stretch+(b-y)})}return p.push({fixed:o+Hh,stretch:h}),p}function tg(l,o,h,p){return l/o*h+p}function ng(l,o,h,p){return l-o*h/p}class rg{constructor(o,h,p,y,b,x,I,L,A,N){if(this.boxStartIndex=o.length,A){let O=x.top,G=x.bottom;const H=x.collisionPadding;H&&(O-=H[1],G+=H[3]);let K=G-O;K>0&&(K=Math.max(10,K),this.circleDiameter=K)}else{let O=x.top*I-L[0],G=x.bottom*I+L[2],H=x.left*I-L[3],K=x.right*I+L[1];const ee=x.collisionPadding;if(ee&&(H-=ee[0]*I,O-=ee[1]*I,K+=ee[2]*I,G+=ee[3]*I),N){const ae=new E(H,O),pe=new E(K,O),De=new E(H,G),ye=new E(K,G),Ee=N*Math.PI/180;ae._rotate(Ee),pe._rotate(Ee),De._rotate(Ee),ye._rotate(Ee),H=Math.min(ae.x,pe.x,De.x,ye.x),K=Math.max(ae.x,pe.x,De.x,ye.x),O=Math.min(ae.y,pe.y,De.y,ye.y),G=Math.max(ae.y,pe.y,De.y,ye.y)}o.emplaceBack(h.x,h.y,H,O,K,G,p,y,b)}this.boxEndIndex=o.length}}class bL{constructor(o=[],h=xL){if(this.data=o,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:h,compare:p}=this,y=h[o];for(;o>0;){const b=o-1>>1,x=h[b];if(p(y,x)>=0)break;h[o]=x,o=b}h[o]=y}_down(o){const{data:h,compare:p}=this,y=this.length>>1,b=h[o];for(;o<y;){let x=1+(o<<1),I=h[x];const L=x+1;if(L<this.length&&p(h[L],I)<0&&(x=L,I=h[L]),p(I,b)>=0)break;h[o]=I,o=x}h[o]=b}}function xL(l,o){return l<o?-1:l>o?1:0}function wL(l,o=1,h=!1){let p=1/0,y=1/0,b=-1/0,x=-1/0;const I=l[0];for(let H=0;H<I.length;H++){const K=I[H];(!H||K.x<p)&&(p=K.x),(!H||K.y<y)&&(y=K.y),(!H||K.x>b)&&(b=K.x),(!H||K.y>x)&&(x=K.y)}const L=Math.min(b-p,x-y);let A=L/2;const N=new bL([],SL);if(L===0)return new E(p,y);for(let H=p;H<b;H+=L)for(let K=y;K<x;K+=L)N.push(new Zh(H+A,K+A,A,l));let O=function(H){let K=0,ee=0,ae=0;const pe=H[0];for(let De=0,ye=pe.length,Ee=ye-1;De<ye;Ee=De++){const Ye=pe[De],Je=pe[Ee],bt=Ye.x*Je.y-Je.x*Ye.y;ee+=(Ye.x+Je.x)*bt,ae+=(Ye.y+Je.y)*bt,K+=3*bt}return new Zh(ee/K,ae/K,0,H)}(l),G=N.length;for(;N.length;){const H=N.pop();(H.d>O.d||!O.d)&&(O=H,h&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,G)),H.max-O.d<=o||(A=H.h/2,N.push(new Zh(H.p.x-A,H.p.y-A,A,l)),N.push(new Zh(H.p.x+A,H.p.y-A,A,l)),N.push(new Zh(H.p.x-A,H.p.y+A,A,l)),N.push(new Zh(H.p.x+A,H.p.y+A,A,l)),G+=4)}return h&&(console.log(`num probes: ${G}`),console.log(`best distance: ${O.d}`)),O.p}function SL(l,o){return o.max-l.max}function Zh(l,o,h,p){this.p=new E(l,o),this.h=h,this.d=function(y,b){let x=!1,I=1/0;for(let L=0;L<b.length;L++){const A=b[L];for(let N=0,O=A.length,G=O-1;N<O;G=N++){const H=A[N],K=A[G];H.y>y.y!=K.y>y.y&&y.x<(K.x-H.x)*(y.y-H.y)/(K.y-H.y)+H.x&&(x=!x),I=Math.min(I,I1(y,H,K))}}return(x?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var zi;c.ap=void 0,(zi=c.ap||(c.ap={}))[zi.center=1]="center",zi[zi.left=2]="left",zi[zi.right=3]="right",zi[zi.top=4]="top",zi[zi.bottom=5]="bottom",zi[zi["top-left"]=6]="top-left",zi[zi["top-right"]=7]="top-right",zi[zi["bottom-left"]=8]="bottom-left",zi[zi["bottom-right"]=9]="bottom-right";const wu=7,O_=Number.POSITIVE_INFINITY;function qb(l,o){return o[1]!==O_?function(h,p,y){let b=0,x=0;switch(p=Math.abs(p),y=Math.abs(y),h){case"top-right":case"top-left":case"top":x=y-wu;break;case"bottom-right":case"bottom-left":case"bottom":x=-y+wu}switch(h){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,x]}(l,o[0],o[1]):function(h,p){let y=0,b=0;p<0&&(p=0);const x=p/Math.SQRT2;switch(h){case"top-right":case"top-left":b=x-wu;break;case"bottom-right":case"bottom-left":b=-x+wu;break;case"bottom":b=-p+wu;break;case"top":b=p-wu}switch(h){case"top-right":case"bottom-right":y=-x;break;case"top-left":case"bottom-left":y=x;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(l,o[0])}function jb(l,o,h){var p;const y=l.layout,b=(p=y.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(o,{},h);if(b){const I=b.values,L=[];for(let A=0;A<I.length;A+=2){const N=L[A]=I[A],O=I[A+1].map(G=>G*ci);N.startsWith("top")?O[1]-=wu:N.startsWith("bottom")&&(O[1]+=wu),L[A+1]=O}return new Qo(L)}const x=y.get("text-variable-anchor");if(x){let I;I=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(o,{},h)*ci,O_]:y.get("text-offset").evaluate(o,{},h).map(A=>A*ci);const L=[];for(const A of x)L.push(A,qb(A,I));return new Qo(L)}return null}function z_(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EL(l,o,h,p,y,b,x,I,L,A,N){let O=b.textMaxSize.evaluate(o,{});O===void 0&&(O=x);const G=l.layers[0].layout,H=G.get("icon-offset").evaluate(o,{},N),K=Hb(h.horizontal),ee=x/24,ae=l.tilePixelRatio*ee,pe=l.tilePixelRatio*O/24,De=l.tilePixelRatio*I,ye=l.tilePixelRatio*G.get("symbol-spacing"),Ee=G.get("text-padding")*l.tilePixelRatio,Ye=function(nt,zt,Pt,pn=1){const ir=nt.get("icon-padding").evaluate(zt,{},Pt),hr=ir&&ir.values;return[hr[0]*pn,hr[1]*pn,hr[2]*pn,hr[3]*pn]}(G,o,N,l.tilePixelRatio),Je=G.get("text-max-angle")/180*Math.PI,bt=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",Ct=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",vt=G.get("symbol-placement"),yt=ye/2,ct=G.get("icon-text-fit");let Et;p&&ct!=="none"&&(l.allowVerticalPlacement&&h.vertical&&(Et=mb(p,h.vertical,ct,G.get("icon-text-fit-padding"),H,ee)),K&&(p=mb(p,K,ct,G.get("icon-text-fit-padding"),H,ee)));const dt=(nt,zt)=>{zt.x<0||zt.x>=Nr||zt.y<0||zt.y>=Nr||function(Pt,pn,ir,hr,hi,ns,_o,ni,Mi,Fi,vo,bo,fi,pi,eo,xo,to,zo,Fo,di,vn,no,Bi,mi,js){const va=Pt.addToLineVertexArray(pn,ir);let ba,Rl,Ws,xs,Bo=0,Nl=0,Kp=0,Kb=0,W_=-1,H_=-1;const Ol={};let Jb=Tr("");if(Pt.allowVerticalPlacement&&hr.vertical){const ro=ni.layout.get("text-rotate").evaluate(vn,{},mi)+90;Ws=new rg(Mi,pn,Fi,vo,bo,hr.vertical,fi,pi,eo,ro),_o&&(xs=new rg(Mi,pn,Fi,vo,bo,_o,to,zo,eo,ro))}if(hi){const ro=ni.layout.get("icon-rotate").evaluate(vn,{}),ws=ni.layout.get("icon-text-fit")!=="none",vc=Ub(hi,ro,Bi,ws),wa=_o?Ub(_o,ro,Bi,ws):void 0;Rl=new rg(Mi,pn,Fi,vo,bo,hi,to,zo,!1,ro),Bo=4*vc.length;const bc=Pt.iconSizeData;let Ja=null;bc.kind==="source"?(Ja=[Ka*ni.layout.get("icon-size").evaluate(vn,{})],Ja[0]>vu&&Ke(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Hp}. Reduce your "icon-size".`)):bc.kind==="composite"&&(Ja=[Ka*no.compositeIconSizes[0].evaluate(vn,{},mi),Ka*no.compositeIconSizes[1].evaluate(vn,{},mi)],(Ja[0]>vu||Ja[1]>vu)&&Ke(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Hp}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,vc,Ja,di,Fo,vn,c.ah.none,pn,va.lineStartIndex,va.lineLength,-1,mi),W_=Pt.icon.placedSymbolArray.length-1,wa&&(Nl=4*wa.length,Pt.addSymbols(Pt.icon,wa,Ja,di,Fo,vn,c.ah.vertical,pn,va.lineStartIndex,va.lineLength,-1,mi),H_=Pt.icon.placedSymbolArray.length-1)}const Qb=Object.keys(hr.horizontal);for(const ro of Qb){const ws=hr.horizontal[ro];if(!ba){Jb=Tr(ws.text);const wa=ni.layout.get("text-rotate").evaluate(vn,{},mi);ba=new rg(Mi,pn,Fi,vo,bo,ws,fi,pi,eo,wa)}const vc=ws.positionedLines.length===1;if(Kp+=Wb(Pt,pn,ws,ns,ni,eo,vn,xo,va,hr.vertical?c.ah.horizontal:c.ah.horizontalOnly,vc?Qb:[ro],Ol,W_,no,mi),vc)break}hr.vertical&&(Kb+=Wb(Pt,pn,hr.vertical,ns,ni,eo,vn,xo,va,c.ah.vertical,["vertical"],Ol,H_,no,mi));const TL=ba?ba.boxStartIndex:Pt.collisionBoxArray.length,LL=ba?ba.boxEndIndex:Pt.collisionBoxArray.length,PL=Ws?Ws.boxStartIndex:Pt.collisionBoxArray.length,ML=Ws?Ws.boxEndIndex:Pt.collisionBoxArray.length,AL=Rl?Rl.boxStartIndex:Pt.collisionBoxArray.length,kL=Rl?Rl.boxEndIndex:Pt.collisionBoxArray.length,DL=xs?xs.boxStartIndex:Pt.collisionBoxArray.length,RL=xs?xs.boxEndIndex:Pt.collisionBoxArray.length;let xa=-1;const og=(ro,ws)=>ro&&ro.circleDiameter?Math.max(ro.circleDiameter,ws):ws;xa=og(ba,xa),xa=og(Ws,xa),xa=og(Rl,xa),xa=og(xs,xa);const $b=xa>-1?1:0;$b&&(xa*=js/ci),Pt.glyphOffsetArray.length>=Wh.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,vn.sortKey);const NL=jb(ni,vn,mi),[OL,zL]=function(ro,ws){const vc=ro.length,wa=ws==null?void 0:ws.values;if((wa==null?void 0:wa.length)>0)for(let bc=0;bc<wa.length;bc+=2){const Ja=wa[bc+1];ro.emplaceBack(c.ap[wa[bc]],Ja[0],Ja[1])}return[vc,ro.length]}(Pt.textAnchorOffsets,NL);Pt.symbolInstances.emplaceBack(pn.x,pn.y,Ol.right>=0?Ol.right:-1,Ol.center>=0?Ol.center:-1,Ol.left>=0?Ol.left:-1,Ol.vertical||-1,W_,H_,Jb,TL,LL,PL,ML,AL,kL,DL,RL,Fi,Kp,Kb,Bo,Nl,$b,0,fi,xa,OL,zL)}(l,zt,nt,h,p,y,Et,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,ae,[Ee,Ee,Ee,Ee],bt,L,De,Ye,Ct,H,o,b,A,N,x)};if(vt==="line")for(const nt of Nb(o.geometry,0,0,Nr,Nr)){const zt=vL(nt,ye,Je,h.vertical||K,p,24,pe,l.overscaling,Nr);for(const Pt of zt)K&&IL(l,K.text,yt,Pt)||dt(nt,Pt)}else if(vt==="line-center"){for(const nt of o.geometry)if(nt.length>1){const zt=_L(nt,Je,h.vertical||K,p,24,pe);zt&&dt(nt,zt)}}else if(o.type==="Polygon")for(const nt of m_(o.geometry,0)){const zt=wL(nt,16);dt(nt[0],new xu(zt.x,zt.y,0))}else if(o.type==="LineString")for(const nt of o.geometry)dt(nt,new xu(nt[0].x,nt[0].y,0));else if(o.type==="Point")for(const nt of o.geometry)for(const zt of nt)dt([zt],new xu(zt.x,zt.y,0))}function Wb(l,o,h,p,y,b,x,I,L,A,N,O,G,H,K){const ee=function(De,ye,Ee,Ye,Je,bt,Ct,vt){const yt=Ye.layout.get("text-rotate").evaluate(bt,{})*Math.PI/180,ct=[];for(const Et of ye.positionedLines)for(const dt of Et.positionedGlyphs){if(!dt.rect)continue;const nt=dt.rect||{};let zt=lb+1,Pt=!0,pn=1,ir=0;const hr=(Je||vt)&&dt.vertical,hi=dt.metrics.advance*dt.scale/2;if(vt&&ye.verticalizable&&(ir=Et.lineOffset/2-(dt.imageName?-(ci-dt.metrics.width*dt.scale)/2:(dt.scale-1)*ci)),dt.imageName){const di=Ct[dt.imageName];Pt=di.sdf,pn=di.pixelRatio,zt=Oo/pn}const ns=Je?[dt.x+hi,dt.y]:[0,0];let _o=Je?[0,0]:[dt.x+hi+Ee[0],dt.y+Ee[1]-ir],ni=[0,0];hr&&(ni=_o,_o=[0,0]);const Mi=dt.metrics.isDoubleResolution?2:1,Fi=(dt.metrics.left-zt)*dt.scale-hi+_o[0],vo=(-dt.metrics.top-zt)*dt.scale+_o[1],bo=Fi+nt.w/Mi*dt.scale/pn,fi=vo+nt.h/Mi*dt.scale/pn,pi=new E(Fi,vo),eo=new E(bo,vo),xo=new E(Fi,fi),to=new E(bo,fi);if(hr){const di=new E(-hi,hi-jp),vn=-Math.PI/2,no=ci/2-hi,Bi=new E(5-jp-no,-(dt.imageName?no:0)),mi=new E(...ni);pi._rotateAround(vn,di)._add(Bi)._add(mi),eo._rotateAround(vn,di)._add(Bi)._add(mi),xo._rotateAround(vn,di)._add(Bi)._add(mi),to._rotateAround(vn,di)._add(Bi)._add(mi)}if(yt){const di=Math.sin(yt),vn=Math.cos(yt),no=[vn,-di,di,vn];pi._matMult(no),eo._matMult(no),xo._matMult(no),to._matMult(no)}const zo=new E(0,0),Fo=new E(0,0);ct.push({tl:pi,tr:eo,bl:xo,br:to,tex:nt,writingMode:ye.writingMode,glyphOffset:ns,sectionIndex:dt.sectionIndex,isSDF:Pt,pixelOffsetTL:zo,pixelOffsetBR:Fo,minFontScaleX:0,minFontScaleY:0})}return ct}(0,h,I,y,b,x,p,l.allowVerticalPlacement),ae=l.textSizeData;let pe=null;ae.kind==="source"?(pe=[Ka*y.layout.get("text-size").evaluate(x,{})],pe[0]>vu&&Ke(`${l.layerIds[0]}: Value for "text-size" is >= ${Hp}. Reduce your "text-size".`)):ae.kind==="composite"&&(pe=[Ka*H.compositeTextSizes[0].evaluate(x,{},K),Ka*H.compositeTextSizes[1].evaluate(x,{},K)],(pe[0]>vu||pe[1]>vu)&&Ke(`${l.layerIds[0]}: Value for "text-size" is >= ${Hp}. Reduce your "text-size".`)),l.addSymbols(l.text,ee,pe,I,b,x,A,o,L.lineStartIndex,L.lineLength,G,K);for(const De of N)O[De]=l.text.placedSymbolArray.length-1;return 4*ee.length}function Hb(l){for(const o in l)return l[o];return null}function IL(l,o,h,p){const y=l.compareText;if(o in y){const b=y[o];for(let x=b.length-1;x>=0;x--)if(p.dist(b[x])<h)return!0}else y[o]=[];return y[o].push(p),!1}const Zb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class F_{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,p]=new Uint8Array(o,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=p>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const b=Zb[15&p];if(!b)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(o,2,1),[I]=new Uint32Array(o,4,1);return new F_(I,x,b,o)}constructor(o,h=64,p=Float64Array,y){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=p,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=Zb.indexOf(this.ArrayType),x=2*o*this.ArrayType.BYTES_PER_ELEMENT,I=o*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-I%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${p}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+L,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+x+I+L),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+L,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=o)}add(o,h){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=o,this.coords[this._pos++]=h,p}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return B_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,h,p,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:x,nodeSize:I}=this,L=[0,b.length-1,0],A=[];for(;L.length;){const N=L.pop()||0,O=L.pop()||0,G=L.pop()||0;if(O-G<=I){for(let ae=G;ae<=O;ae++){const pe=x[2*ae],De=x[2*ae+1];pe>=o&&pe<=p&&De>=h&&De<=y&&A.push(b[ae])}continue}const H=G+O>>1,K=x[2*H],ee=x[2*H+1];K>=o&&K<=p&&ee>=h&&ee<=y&&A.push(b[H]),(N===0?o<=K:h<=ee)&&(L.push(G),L.push(H-1),L.push(1-N)),(N===0?p>=K:y>=ee)&&(L.push(H+1),L.push(O),L.push(1-N))}return A}within(o,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:b,nodeSize:x}=this,I=[0,y.length-1,0],L=[],A=p*p;for(;I.length;){const N=I.pop()||0,O=I.pop()||0,G=I.pop()||0;if(O-G<=x){for(let ae=G;ae<=O;ae++)Yb(b[2*ae],b[2*ae+1],o,h)<=A&&L.push(y[ae]);continue}const H=G+O>>1,K=b[2*H],ee=b[2*H+1];Yb(K,ee,o,h)<=A&&L.push(y[H]),(N===0?o-p<=K:h-p<=ee)&&(I.push(G),I.push(H-1),I.push(1-N)),(N===0?o+p>=K:h+p>=ee)&&(I.push(H+1),I.push(O),I.push(1-N))}return L}}function B_(l,o,h,p,y,b){if(y-p<=h)return;const x=p+y>>1;Xb(l,o,x,p,y,b),B_(l,o,h,p,x-1,1-b),B_(l,o,h,x+1,y,1-b)}function Xb(l,o,h,p,y,b){for(;y>p;){if(y-p>600){const A=y-p+1,N=h-p+1,O=Math.log(A),G=.5*Math.exp(2*O/3),H=.5*Math.sqrt(O*G*(A-G)/A)*(N-A/2<0?-1:1);Xb(l,o,h,Math.max(p,Math.floor(h-N*G/A+H)),Math.min(y,Math.floor(h+(A-N)*G/A+H)),b)}const x=o[2*h+b];let I=p,L=y;for(Xp(l,o,p,h),o[2*y+b]>x&&Xp(l,o,p,y);I<L;){for(Xp(l,o,I,L),I++,L--;o[2*I+b]<x;)I++;for(;o[2*L+b]>x;)L--}o[2*p+b]===x?Xp(l,o,p,L):(L++,Xp(l,o,L,y)),L<=h&&(p=L+1),h<=L&&(y=L-1)}}function Xp(l,o,h,p){V_(l,h,p),V_(o,2*h,2*p),V_(o,2*h+1,2*p+1)}function V_(l,o,h){const p=l[o];l[o]=l[h],l[h]=p}function Yb(l,o,h,p){const y=l-h,b=o-p;return y*y+b*b}var U_;c.bd=void 0,(U_=c.bd||(c.bd={})).create="create",U_.load="load",U_.fullLoad="fullLoad";let ig=null,Yp=[];const G_=1e3/60,q_="loadTime",j_="fullLoadTime",CL={mark(l){performance.mark(l)},frame(l){const o=l;ig!=null&&Yp.push(o-ig),ig=o},clearMetrics(){ig=null,Yp=[],performance.clearMeasures(q_),performance.clearMeasures(j_);for(const l in c.bd)performance.clearMarks(c.bd[l])},getPerformanceMetrics(){performance.measure(q_,c.bd.create,c.bd.load),performance.measure(j_,c.bd.create,c.bd.fullLoad);const l=performance.getEntriesByName(q_)[0].duration,o=performance.getEntriesByName(j_)[0].duration,h=Yp.length,p=1/(Yp.reduce((b,x)=>b+x,0)/h/1e3),y=Yp.filter(b=>b>G_).reduce((b,x)=>b+(x-G_)/G_,0);return{loadTime:l,fullLoadTime:o,fps:p,percentDroppedFrames:y/(h+y)*100,totalFrames:h}}};c.$=ft,c.A=Bh,c.B=function(l){if(qe==null){const o=l.navigator?l.navigator.userAgent:null;qe=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return qe},c.C=class{constructor(l,o){this.target=l,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new gL(()=>this.process()),this.subscription=function(h,p,y,b){return h.addEventListener(p,y,!1),{unsubscribe:()=>{h.removeEventListener(p,y,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=tt(self)?l:window}registerMessageHandler(l,o){this.messageHandlers[l]=o}sendAsync(l,o){return new Promise((h,p)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[y]={resolve:h,reject:p},o&&o.signal.addEventListener("abort",()=>{delete this.resolveRejects[y];const I={id:y,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const b=[],x=Object.assign(Object.assign({},l),{id:y,sourceMapId:this.mapId,origin:location.origin,data:pu(l.data,b)});this.target.postMessage(x,{transfer:b})})}receive(l){const o=l.data,h=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[h];const p=this.abortControllers[h];return delete this.abortControllers[h],void(p&&p.abort())}if(tt(self)||o.mustQueue)return this.tasks[h]=o,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,o)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),o=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(l,o)}processTask(l,o){return u(this,void 0,void 0,function*(){if(o.type==="<response>"){const y=this.resolveRejects[l];return delete this.resolveRejects[l],y?void(o.error?y.reject(du(o.error)):y.resolve(du(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=du(o.data),p=new AbortController;this.abortControllers[l]=p;try{const y=yield this.messageHandlers[o.type](o.sourceMapId,h,p);this.completeTask(l,null,y)}catch(y){this.completeTask(l,y)}})}completeTask(l,o,h){const p=[];delete this.abortControllers[l];const y={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?pu(o):null,data:pu(h,p)};this.target.postMessage(y,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.D=kt,c.E=Dn,c.F=function(){var l=new Bh(16);return Bh!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},c.G=kn,c.H=function(l,o,h){var p,y,b,x,I,L,A,N,O,G,H,K,ee=h[0],ae=h[1],pe=h[2];return o===l?(l[12]=o[0]*ee+o[4]*ae+o[8]*pe+o[12],l[13]=o[1]*ee+o[5]*ae+o[9]*pe+o[13],l[14]=o[2]*ee+o[6]*ae+o[10]*pe+o[14],l[15]=o[3]*ee+o[7]*ae+o[11]*pe+o[15]):(y=o[1],b=o[2],x=o[3],I=o[4],L=o[5],A=o[6],N=o[7],O=o[8],G=o[9],H=o[10],K=o[11],l[0]=p=o[0],l[1]=y,l[2]=b,l[3]=x,l[4]=I,l[5]=L,l[6]=A,l[7]=N,l[8]=O,l[9]=G,l[10]=H,l[11]=K,l[12]=p*ee+I*ae+O*pe+o[12],l[13]=y*ee+L*ae+G*pe+o[13],l[14]=b*ee+A*ae+H*pe+o[14],l[15]=x*ee+N*ae+K*pe+o[15]),l},c.I=I_,c.J=function(l,o,h){var p=h[0],y=h[1],b=h[2];return l[0]=o[0]*p,l[1]=o[1]*p,l[2]=o[2]*p,l[3]=o[3]*p,l[4]=o[4]*y,l[5]=o[5]*y,l[6]=o[6]*y,l[7]=o[7]*y,l[8]=o[8]*b,l[9]=o[9]*b,l[10]=o[10]*b,l[11]=o[11]*b,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},c.K=P1,c.L=function(l,o){const h={};for(let p=0;p<o.length;p++){const y=o[p];y in l&&(h[y]=l[y])}return h},c.M=bu,c.N=Eb,c.O=Ib,c.P=E,c.Q=bs,c.R=vs,c.S=te,c.T=vp,c.U=U,c.V=un,c.W=Nr,c.X=Gr,c.Y=$m,c.Z=class extends wp{},c._=u,c.a=yn,c.a$=function(l,o,h){return l[0]=o[0]*h[0],l[1]=o[1]*h[1],l[2]=o[2]*h[2],l[3]=o[3]*h[3],l},c.a0=N_,c.a1=rt,c.a2=l=>{const o=window.document.createElement("video");return o.muted=!0,new Promise(h=>{o.onloadstart=()=>{h(o)};for(const p of l){const y=window.document.createElement("source");dr(p)||(o.crossOrigin="Anonymous"),y.src=p,o.appendChild(y)}})},c.a3=function(){return ce++},c.a4=_,c.a5=Wh,c.a6=_h,c.a7=kl,c.a8=ur,c.a9=Ab,c.aA=Z,c.aB=function(l,o){if(!l)return[{command:"setStyle",args:[o]}];let h=[];try{if(!ln(l.version,o.version))return[{command:"setStyle",args:[o]}];ln(l.center,o.center)||h.push({command:"setCenter",args:[o.center]}),ln(l.zoom,o.zoom)||h.push({command:"setZoom",args:[o.zoom]}),ln(l.bearing,o.bearing)||h.push({command:"setBearing",args:[o.bearing]}),ln(l.pitch,o.pitch)||h.push({command:"setPitch",args:[o.pitch]}),ln(l.sprite,o.sprite)||h.push({command:"setSprite",args:[o.sprite]}),ln(l.glyphs,o.glyphs)||h.push({command:"setGlyphs",args:[o.glyphs]}),ln(l.transition,o.transition)||h.push({command:"setTransition",args:[o.transition]}),ln(l.light,o.light)||h.push({command:"setLight",args:[o.light]}),ln(l.terrain,o.terrain)||h.push({command:"setTerrain",args:[o.terrain]}),ln(l.sky,o.sky)||h.push({command:"setSky",args:[o.sky]});const p={},y=[];(function(x,I,L,A){let N;for(N in I=I||{},x=x||{})Object.prototype.hasOwnProperty.call(x,N)&&(Object.prototype.hasOwnProperty.call(I,N)||ps(N,L,A));for(N in I)Object.prototype.hasOwnProperty.call(I,N)&&(Object.prototype.hasOwnProperty.call(x,N)?ln(x[N],I[N])||(x[N].type==="geojson"&&I[N].type==="geojson"&&Va(x,I,N)?er(L,{command:"setGeoJSONSourceData",args:[N,I[N].data]}):Os(N,I,L,A)):Mo(N,I,L))})(l.sources,o.sources,y,p);const b=[];l.layers&&l.layers.forEach(x=>{"source"in x&&p[x.source]?h.push({command:"removeLayer",args:[x.id]}):b.push(x)}),h=h.concat(y),function(x,I,L){I=I||[];const A=(x=x||[]).map(xl),N=I.map(xl),O=x.reduce(ds,{}),G=I.reduce(ds,{}),H=A.slice(),K=Object.create(null);let ee,ae,pe,De,ye;for(let Ee=0,Ye=0;Ee<A.length;Ee++)ee=A[Ee],Object.prototype.hasOwnProperty.call(G,ee)?Ye++:(er(L,{command:"removeLayer",args:[ee]}),H.splice(H.indexOf(ee,Ye),1));for(let Ee=0,Ye=0;Ee<N.length;Ee++)ee=N[N.length-1-Ee],H[H.length-1-Ee]!==ee&&(Object.prototype.hasOwnProperty.call(O,ee)?(er(L,{command:"removeLayer",args:[ee]}),H.splice(H.lastIndexOf(ee,H.length-Ye),1)):Ye++,De=H[H.length-Ee],er(L,{command:"addLayer",args:[G[ee],De]}),H.splice(H.length-Ee,0,ee),K[ee]=!0);for(let Ee=0;Ee<N.length;Ee++)if(ee=N[Ee],ae=O[ee],pe=G[ee],!K[ee]&&!ln(ae,pe))if(ln(ae.source,pe.source)&&ln(ae["source-layer"],pe["source-layer"])&&ln(ae.type,pe.type)){for(ye in Pi(ae.layout,pe.layout,L,ee,null,"setLayoutProperty"),Pi(ae.paint,pe.paint,L,ee,null,"setPaintProperty"),ln(ae.filter,pe.filter)||er(L,{command:"setFilter",args:[ee,pe.filter]}),ln(ae.minzoom,pe.minzoom)&&ln(ae.maxzoom,pe.maxzoom)||er(L,{command:"setLayerZoomRange",args:[ee,pe.minzoom,pe.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?Pi(ae[ye],pe[ye],L,ee,ye.slice(6),"setPaintProperty"):ln(ae[ye],pe[ye])||er(L,{command:"setLayerProperty",args:[ee,ye,pe[ye]]}));for(ye in pe)Object.prototype.hasOwnProperty.call(pe,ye)&&!Object.prototype.hasOwnProperty.call(ae,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?Pi(ae[ye],pe[ye],L,ee,ye.slice(6),"setPaintProperty"):ln(ae[ye],pe[ye])||er(L,{command:"setLayerProperty",args:[ee,ye,pe[ye]]}))}else er(L,{command:"removeLayer",args:[ee]}),De=H[H.lastIndexOf(ee)+1],er(L,{command:"addLayer",args:[pe,De]})}(b,o.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:"setStyle",args:[o]}]}return h},c.aC=function(l){const o=[],h=l.id;return h===void 0&&o.push({message:`layers.${h}: missing required property "id"`}),l.render===void 0&&o.push({message:`layers.${h}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&o.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),o},c.aD=function l(o,h){if(Array.isArray(o)){if(!Array.isArray(h)||o.length!==h.length)return!1;for(let p=0;p<o.length;p++)if(!l(o[p],h[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&h!==null){if(typeof h!="object"||Object.keys(o).length!==Object.keys(h).length)return!1;for(const p in o)if(!l(o[p],h[p]))return!1;return!0}return o===h},c.aE=me,c.aF=Ce,c.aG=class extends ui{constructor(l,o){super(l,o),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},c.aH=No,c.aI=class extends ui{constructor(l,o){super(l,o),this.current=yc}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let o=1;o<16;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},c.aJ=Gs,c.aK=class extends ui{constructor(l,o){super(l,o),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},c.aL=class extends ui{constructor(l,o){super(l,o),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},c.aM=Za,c.aN=function(l,o,h,p,y,b,x){var I=1/(o-h),L=1/(p-y),A=1/(b-x);return l[0]=-2*I,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*L,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*A,l[11]=0,l[12]=(o+h)*I,l[13]=(y+p)*L,l[14]=(x+b)*A,l[15]=1,l},c.aO=Vn,c.aP=KC,c.aQ=class extends Ah{},c.aR=jT,c.aS=class extends kh{},c.aT=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},c.aU=R1,c.aV=F,c.aW=class extends Lp{},c.aX=He,c.aY=function(l,o){return l[0]===o[0]&&l[1]===o[1]&&l[2]===o[2]&&l[3]===o[3]&&l[4]===o[4]&&l[5]===o[5]&&l[6]===o[6]&&l[7]===o[7]&&l[8]===o[8]&&l[9]===o[9]&&l[10]===o[10]&&l[11]===o[11]&&l[12]===o[12]&&l[13]===o[13]&&l[14]===o[14]&&l[15]===o[15]},c.aZ=function(l,o){var h=l[0],p=l[1],y=l[2],b=l[3],x=l[4],I=l[5],L=l[6],A=l[7],N=l[8],O=l[9],G=l[10],H=l[11],K=l[12],ee=l[13],ae=l[14],pe=l[15],De=o[0],ye=o[1],Ee=o[2],Ye=o[3],Je=o[4],bt=o[5],Ct=o[6],vt=o[7],yt=o[8],ct=o[9],Et=o[10],dt=o[11],nt=o[12],zt=o[13],Pt=o[14],pn=o[15];return Math.abs(h-De)<=yo*Math.max(1,Math.abs(h),Math.abs(De))&&Math.abs(p-ye)<=yo*Math.max(1,Math.abs(p),Math.abs(ye))&&Math.abs(y-Ee)<=yo*Math.max(1,Math.abs(y),Math.abs(Ee))&&Math.abs(b-Ye)<=yo*Math.max(1,Math.abs(b),Math.abs(Ye))&&Math.abs(x-Je)<=yo*Math.max(1,Math.abs(x),Math.abs(Je))&&Math.abs(I-bt)<=yo*Math.max(1,Math.abs(I),Math.abs(bt))&&Math.abs(L-Ct)<=yo*Math.max(1,Math.abs(L),Math.abs(Ct))&&Math.abs(A-vt)<=yo*Math.max(1,Math.abs(A),Math.abs(vt))&&Math.abs(N-yt)<=yo*Math.max(1,Math.abs(N),Math.abs(yt))&&Math.abs(O-ct)<=yo*Math.max(1,Math.abs(O),Math.abs(ct))&&Math.abs(G-Et)<=yo*Math.max(1,Math.abs(G),Math.abs(Et))&&Math.abs(H-dt)<=yo*Math.max(1,Math.abs(H),Math.abs(dt))&&Math.abs(K-nt)<=yo*Math.max(1,Math.abs(K),Math.abs(nt))&&Math.abs(ee-zt)<=yo*Math.max(1,Math.abs(ee),Math.abs(zt))&&Math.abs(ae-Pt)<=yo*Math.max(1,Math.abs(ae),Math.abs(Pt))&&Math.abs(pe-pn)<=yo*Math.max(1,Math.abs(pe),Math.abs(pn))},c.a_=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},c.aa=function(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,y,b)=>{const x=y||b;return o[p]=!x||x.toLowerCase(),""}),o["max-age"]){const h=parseInt(o["max-age"],10);isNaN(h)?delete o["max-age"]:o["max-age"]=h}return o},c.ab=function(l,o){const h=[];for(const p in l)p in o||h.push(p);return h},c.ac=oe,c.ad=function(l,o,h){var p=Math.sin(h),y=Math.cos(h),b=o[0],x=o[1],I=o[2],L=o[3],A=o[4],N=o[5],O=o[6],G=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=b*y+A*p,l[1]=x*y+N*p,l[2]=I*y+O*p,l[3]=L*y+G*p,l[4]=A*y-b*p,l[5]=N*y-x*p,l[6]=O*y-I*p,l[7]=G*y-L*p,l},c.ae=function(l){var o=new Bh(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},c.af=Gm,c.ag=function(l,o){let h=0,p=0;if(l.kind==="constant")p=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:y,minZoom:b,maxZoom:x}=l,I=y?oe(Oi.interpolationFactor(y,o,b,x),0,1):0;l.kind==="camera"?p=Qi.number(l.minSize,l.maxSize,I):h=I}return{uSizeT:h,uSize:p}},c.ai=function(l,{uSize:o,uSizeT:h},{lowerSize:p,upperSize:y}){return l.kind==="source"?p/Ka:l.kind==="composite"?Qi.number(p/Ka,y/Ka,h):o},c.aj=P_,c.ak=function(l,o,h,p){const y=o.y-l.y,b=o.x-l.x,x=p.y-h.y,I=p.x-h.x,L=x*b-I*y;if(L===0)return null;const A=(I*(l.y-h.y)-x*(l.x-h.x))/L;return new E(l.x+A*b,l.y+A*y)},c.al=Nb,c.am=Mp,c.an=l_,c.ao=ci,c.aq=L_,c.ar=function(l,o){var h=o[0],p=o[1],y=o[2],b=o[3],x=o[4],I=o[5],L=o[6],A=o[7],N=o[8],O=o[9],G=o[10],H=o[11],K=o[12],ee=o[13],ae=o[14],pe=o[15],De=h*I-p*x,ye=h*L-y*x,Ee=h*A-b*x,Ye=p*L-y*I,Je=p*A-b*I,bt=y*A-b*L,Ct=N*ee-O*K,vt=N*ae-G*K,yt=N*pe-H*K,ct=O*ae-G*ee,Et=O*pe-H*ee,dt=G*pe-H*ae,nt=De*dt-ye*Et+Ee*ct+Ye*yt-Je*vt+bt*Ct;return nt?(l[0]=(I*dt-L*Et+A*ct)*(nt=1/nt),l[1]=(y*Et-p*dt-b*ct)*nt,l[2]=(ee*bt-ae*Je+pe*Ye)*nt,l[3]=(G*Je-O*bt-H*Ye)*nt,l[4]=(L*yt-x*dt-A*vt)*nt,l[5]=(h*dt-y*yt+b*vt)*nt,l[6]=(ae*Ee-K*bt-pe*ye)*nt,l[7]=(N*bt-G*Ee+H*ye)*nt,l[8]=(x*Et-I*yt+A*Ct)*nt,l[9]=(p*yt-h*Et-b*Ct)*nt,l[10]=(K*Je-ee*Ee+pe*De)*nt,l[11]=(O*Ee-N*Je-H*De)*nt,l[12]=(I*vt-x*ct-L*Ct)*nt,l[13]=(h*ct-p*vt+y*Ct)*nt,l[14]=(ee*ye-K*Ye-ae*De)*nt,l[15]=(N*Ye-O*ye+G*De)*nt,l):null},c.as=z_,c.at=T_,c.au=F_,c.av=function(){const l={},o=Oe.$version;for(const h in Oe.$root){const p=Oe.$root[h];if(p.required){let y=null;y=h==="version"?o:p.type==="array"?[]:{},y!=null&&(l[h]=y)}}return l},c.aw=Lm,c.ax=kr,c.ay=function(l){l=l.slice();const o=Object.create(null);for(let h=0;h<l.length;h++)o[l[h].id]=l[h];for(let h=0;h<l.length;h++)"ref"in l[h]&&(l[h]=Dr(l[h],o[l[h].ref]));return l},c.az=function(l){if(l.type==="custom")return new mL(l);switch(l.type){case"background":return new fL(l);case"circle":return new JC(l);case"fill":return new yT(l);case"fill-extrusion":return new kT(l);case"heatmap":return new $C(l);case"hillshade":return new tT(l);case"line":return new VT(l);case"raster":return new dL(l);case"symbol":return new Qm(l)}},c.b=Ot,c.b0=function(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]+l[3]*o[3]},c.b1=_e,c.b2=Lb,c.b3=Cb,c.b4=function(l,o,h,p,y){var b,x=1/Math.tan(o/2);return l[0]=x/h,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=x,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,y!=null&&y!==1/0?(l[10]=(y+p)*(b=1/(p-y)),l[14]=2*y*p*b):(l[10]=-1,l[14]=-2*p),l},c.b5=function(l,o,h){var p=Math.sin(h),y=Math.cos(h),b=o[4],x=o[5],I=o[6],L=o[7],A=o[8],N=o[9],O=o[10],G=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=b*y+A*p,l[5]=x*y+N*p,l[6]=I*y+O*p,l[7]=L*y+G*p,l[8]=A*y-b*p,l[9]=N*y-x*p,l[10]=O*y-I*p,l[11]=G*y-L*p,l},c.b6=W,c.b7=Y,c.b8=function(l){return l*Math.PI/180},c.b9=function(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},c.bA=Ha,c.ba=class extends ya{},c.bb=D_,c.bc=CL,c.be=wr,c.bf=function(l,o){yn.REGISTERED_PROTOCOLS[l]=o},c.bg=function(l){delete yn.REGISTERED_PROTOCOLS[l]},c.bh=function(l,o){const h={};for(let y=0;y<l.length;y++){const b=o&&o[l[y].id]||r_(l[y]);o&&(o[l[y].id]=b);let x=h[b];x||(x=h[b]=[]),x.push(l[y])}const p=[];for(const y in h)p.push(h[y]);return p},c.bi=St,c.bj=Mb,c.bk=kb,c.bl=cb,c.bm=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=Nr/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const o=l.bucket.layers[0],h=o.layout,p=o._unevaluatedLayout._values,y={layoutIconSize:p["icon-size"].possiblyEvaluate(new ur(l.bucket.zoom+1),l.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new ur(l.bucket.zoom+1),l.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new ur(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:N}=l.bucket.textSizeData;y.compositeTextSizes=[p["text-size"].possiblyEvaluate(new ur(A),l.canonical),p["text-size"].possiblyEvaluate(new ur(N),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:N}=l.bucket.iconSizeData;y.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new ur(A),l.canonical),p["icon-size"].possiblyEvaluate(new ur(N),l.canonical)]}const b=h.get("text-line-height")*ci,x=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",I=h.get("text-keep-upright"),L=h.get("text-size");for(const A of l.bucket.features){const N=h.get("text-font").evaluate(A,{},l.canonical).join(","),O=L.evaluate(A,{},l.canonical),G=y.layoutTextSize.evaluate(A,{},l.canonical),H=y.layoutIconSize.evaluate(A,{},l.canonical),K={horizontal:{},vertical:void 0},ee=A.text;let ae,pe=[0,0];if(ee){const Ee=ee.toString(),Ye=h.get("text-letter-spacing").evaluate(A,{},l.canonical)*ci,Je=Pm(Ee)?Ye:0,bt=h.get("text-anchor").evaluate(A,{},l.canonical),Ct=jb(o,A,l.canonical);if(!Ct){const dt=h.get("text-radial-offset").evaluate(A,{},l.canonical);pe=dt?qb(bt,[dt*ci,O_]):h.get("text-offset").evaluate(A,{},l.canonical).map(nt=>nt*ci)}let vt=x?"center":h.get("text-justify").evaluate(A,{},l.canonical);const yt=h.get("symbol-placement"),ct=yt==="point"?h.get("text-max-width").evaluate(A,{},l.canonical)*ci:0,Et=()=>{l.bucket.allowVerticalPlacement&&mu(Ee)&&(K.vertical=Ym(ee,l.glyphMap,l.glyphPositions,l.imagePositions,N,ct,b,bt,"left",Je,pe,c.ah.vertical,!0,yt,G,O))};if(!x&&Ct){const dt=new Set;if(vt==="auto")for(let zt=0;zt<Ct.values.length;zt+=2)dt.add(z_(Ct.values[zt]));else dt.add(vt);let nt=!1;for(const zt of dt)if(!K.horizontal[zt])if(nt)K.horizontal[zt]=K.horizontal[0];else{const Pt=Ym(ee,l.glyphMap,l.glyphPositions,l.imagePositions,N,ct,b,"center",zt,Je,pe,c.ah.horizontal,!1,yt,G,O);Pt&&(K.horizontal[zt]=Pt,nt=Pt.positionedLines.length===1)}Et()}else{vt==="auto"&&(vt=z_(bt));const dt=Ym(ee,l.glyphMap,l.glyphPositions,l.imagePositions,N,ct,b,bt,vt,Je,pe,c.ah.horizontal,!1,yt,G,O);dt&&(K.horizontal[vt]=dt),Et(),mu(Ee)&&x&&I&&(K.vertical=Ym(ee,l.glyphMap,l.glyphPositions,l.imagePositions,N,ct,b,bt,vt,Je,pe,c.ah.vertical,!1,yt,G,O))}}let De=!1;if(A.icon&&A.icon.name){const Ee=l.imageMap[A.icon.name];Ee&&(ae=aL(l.imagePositions[A.icon.name],h.get("icon-offset").evaluate(A,{},l.canonical),h.get("icon-anchor").evaluate(A,{},l.canonical)),De=!!Ee.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=De:l.bucket.sdfIcons!==De&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ee.pixelRatio!==l.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const ye=Hb(K.horizontal)||K.vertical;l.bucket.iconsInText=!!ye&&ye.iconsInText,(ye||ae)&&EL(l.bucket,A,K,ae,l.imageMap,y,G,H,pe,De,l.canonical)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},c.bn=x_,c.bo=__,c.bp=b_,c.bq=yu,c.br=S_,c.bs=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},c.bt=function(l,o,h,p,y){return u(this,void 0,void 0,function*(){if(U())try{return yield un(l,o,h,p,y)}catch{}return function(b,x,I,L,A){const N=b.width,O=b.height;qt&&At||(qt=new OffscreenCanvas(N,O),At=qt.getContext("2d",{willReadFrequently:!0})),qt.width=N,qt.height=O,At.drawImage(b,0,0,N,O);const G=At.getImageData(x,I,L,A);return At.clearRect(0,0,N,O),G.data}(l,o,h,p,y)})},c.bu=Pb,c.bv=m,c.bw=w,c.bx=tb,c.by=Cl,c.bz=function(l){return l.message===hn},c.c=Tn,c.d=l=>u(void 0,void 0,void 0,function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(o)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=se,c.f=l=>new Promise((o,h)=>{const p=new Image;p.onload=()=>{o(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=wt})},p.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(l)],{type:"image/png"});p.src=l.byteLength?URL.createObjectURL(y):wt}),c.g=_n,c.h=(l,o)=>Sr(se(l,{type:"json"}),o),c.i=tt,c.j=It,c.k=Pe,c.l=(l,o)=>Sr(se(l,{type:"arrayBuffer"}),o),c.m=Sr,c.n=function(l){return new S_(l).readFields(tL,[])},c.o=Op,c.p=ub,c.q=go,c.r=i_,c.s=dr,c.t=fu,c.u=_t,c.v=Oe,c.w=Ke,c.x=Ll,c.y=function([l,o,h]){return o+=90,o*=Math.PI/180,h*=Math.PI/180,{x:l*Math.cos(o)*Math.sin(h),y:l*Math.sin(o)*Math.sin(h),z:l*Math.cos(h)}},c.z=Qi}),i("worker",["./shared"],function(c){class u{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,q){for(const ne of B){this._layerConfigs[ne.id]=ne;const xe=this._layers[ne.id]=c.az(ne);xe._featureFilter=c.a6(xe.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of q)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const J=c.bh(Object.values(this._layerConfigs),this.keyCache);for(const ne of J){const xe=ne.map(We=>this._layers[We.id]),Q=xe[0];if(Q.visibility==="none")continue;const we=Q.source||"";let de=this.familiesBySource[we];de||(de=this.familiesBySource[we]={});const Ae=Q.sourceLayer||"_geojsonTileLayer";let Ue=de[Ae];Ue||(Ue=de[Ae]=[]),Ue.push(xe)}}}class m{constructor(B){const q={},J=[];for(const we in B){const de=B[we],Ae=q[we]={};for(const Ue in de){const We=de[+Ue];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const Xe={x:0,y:0,w:We.bitmap.width+2,h:We.bitmap.height+2};J.push(Xe),Ae[Ue]={rect:Xe,metrics:We.metrics}}}const{w:ne,h:xe}=c.p(J),Q=new c.o({width:ne||1,height:xe||1});for(const we in B){const de=B[we];for(const Ae in de){const Ue=de[+Ae];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const We=q[we][Ae].rect;c.o.copy(Ue.bitmap,Q,{x:0,y:0},{x:We.x+1,y:We.y+1},Ue.bitmap)}}this.image=Q,this.positions=q}}c.bi("GlyphAtlas",m);class w{constructor(B){this.tileID=new c.Q(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[]}parse(B,q,J,ne){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=B,this.collisionBoxArray=new c.a4;const xe=new c.bj(Object.keys(B.layers).sort()),Q=new c.bk(this.tileID,this.promoteId);Q.bucketLayerIDs=[];const we={},de={featureIndex:Q,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},Ae=q.familiesBySource[this.source];for(const sn in Ae){const Er=B.layers[sn];if(!Er)continue;Er.version===1&&c.w(`Vector tile source "${this.source}" layer "${sn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ai=xe.encode(sn),Ji=[];for(let fo=0;fo<Er.length;fo++){const bi=Er.feature(fo),zs=Q.getId(bi,sn);Ji.push({feature:bi,id:zs,index:fo,sourceLayerIndex:ai})}for(const fo of Ae[sn]){const bi=fo[0];bi.source!==this.source&&c.w(`layer.source = ${bi.source} does not equal this.source = ${this.source}`),bi.minzoom&&this.zoom<Math.floor(bi.minzoom)||bi.maxzoom&&this.zoom>=bi.maxzoom||bi.visibility!=="none"&&(S(fo,this.zoom,J),(we[bi.id]=bi.createBucket({index:Q.bucketLayerIDs.length,layers:fo,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ai,sourceID:this.source})).populate(Ji,de,this.tileID.canonical),Q.bucketLayerIDs.push(fo.map(zs=>zs.id)))}}const Ue=c.aE(de.glyphDependencies,sn=>Object.keys(sn).map(Number));this.inFlightDependencies.forEach(sn=>sn==null?void 0:sn.abort()),this.inFlightDependencies=[];let We=Promise.resolve({});if(Object.keys(Ue).length){const sn=new AbortController;this.inFlightDependencies.push(sn),We=ne.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},sn)}const Xe=Object.keys(de.iconDependencies);let Tt=Promise.resolve({});if(Xe.length){const sn=new AbortController;this.inFlightDependencies.push(sn),Tt=ne.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},sn)}const Dt=Object.keys(de.patternDependencies);let Ht=Promise.resolve({});if(Dt.length){const sn=new AbortController;this.inFlightDependencies.push(sn),Ht=ne.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},sn)}const[Zt,xn,Xn]=yield Promise.all([We,Tt,Ht]),lr=new m(Zt),Jr=new c.bl(xn,Xn);for(const sn in we){const Er=we[sn];Er instanceof c.a5?(S(Er.layers,this.zoom,J),c.bm({bucket:Er,glyphMap:Zt,glyphPositions:lr.positions,imageMap:xn,imagePositions:Jr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Er.hasPattern&&(Er instanceof c.bn||Er instanceof c.bo||Er instanceof c.bp)&&(S(Er.layers,this.zoom,J),Er.addFeatures(de,this.tileID.canonical,Jr.patternPositions))}return this.status="done",{buckets:Object.values(we).filter(sn=>!sn.isEmpty()),featureIndex:Q,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:lr.image,imageAtlas:Jr,glyphMap:this.returnDependencies?Zt:null,iconMap:this.returnDependencies?xn:null,glyphPositions:this.returnDependencies?lr.positions:null}})}}function S(le,B,q){const J=new c.a8(B);for(const ne of le)ne.recalculate(J,q)}class E{constructor(B,q,J){this.actor=B,this.layerIndex=q,this.availableImages=J,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(B,q){return c._(this,void 0,void 0,function*(){const J=yield c.l(B.request,q);try{return{vectorTile:new c.bq.VectorTile(new c.br(J.data)),rawData:J.data,cacheControl:J.cacheControl,expires:J.expires}}catch(ne){const xe=new Uint8Array(J.data);let Q=`Unable to parse the tile at ${B.request.url}, `;throw Q+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.messge}`,new Error(Q)}})}loadTile(B){return c._(this,void 0,void 0,function*(){const q=B.uid,J=!!(B&&B.request&&B.request.collectResourceTiming)&&new c.bs(B.request),ne=new w(B);this.loading[q]=ne;const xe=new AbortController;ne.abort=xe;try{const Q=yield this.loadVectorTile(B,xe);if(delete this.loading[q],!Q)return null;const we=Q.rawData,de={};Q.expires&&(de.expires=Q.expires),Q.cacheControl&&(de.cacheControl=Q.cacheControl);const Ae={};if(J){const We=J.finish();We&&(Ae.resourceTiming=JSON.parse(JSON.stringify(We)))}ne.vectorTile=Q.vectorTile;const Ue=ne.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[q]=ne,this.fetching[q]={rawTileData:we,cacheControl:de,resourceTiming:Ae};try{const We=yield Ue;return c.e({rawTileData:we.slice(0)},We,de,Ae)}finally{delete this.fetching[q]}}catch(Q){throw delete this.loading[q],ne.status="done",this.loaded[q]=ne,Q}})}reloadTile(B){return c._(this,void 0,void 0,function*(){const q=B.uid;if(!this.loaded||!this.loaded[q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const J=this.loaded[q];if(J.showCollisionBoxes=B.showCollisionBoxes,J.status==="parsing"){const ne=yield J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor);let xe;if(this.fetching[q]){const{rawTileData:Q,cacheControl:we,resourceTiming:de}=this.fetching[q];delete this.fetching[q],xe=c.e({rawTileData:Q.slice(0)},ne,we,de)}else xe=ne;return xe}if(J.status==="done"&&J.vectorTile)return J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(B){return c._(this,void 0,void 0,function*(){const q=this.loading,J=B.uid;q&&q[J]&&q[J].abort&&(q[J].abort.abort(),delete q[J])})}removeTile(B){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[B.uid]&&delete this.loaded[B.uid]})}}class P{constructor(){this.loaded={}}loadTile(B){return c._(this,void 0,void 0,function*(){const{uid:q,encoding:J,rawImageData:ne,redFactor:xe,greenFactor:Q,blueFactor:we,baseShift:de}=B,Ae=ne.width+2,Ue=ne.height+2,We=c.b(ne)?new c.R({width:Ae,height:Ue},yield c.bt(ne,-1,-1,Ae,Ue)):ne,Xe=new c.bu(q,We,J,xe,Q,we,de);return this.loaded=this.loaded||{},this.loaded[q]=Xe,Xe})}removeTile(B){const q=this.loaded,J=B.uid;q&&q[J]&&delete q[J]}}function D(le,B){if(le.length!==0){k(le[0],B);for(var q=1;q<le.length;q++)k(le[q],!B)}}function k(le,B){for(var q=0,J=0,ne=0,xe=le.length,Q=xe-1;ne<xe;Q=ne++){var we=(le[ne][0]-le[Q][0])*(le[Q][1]+le[ne][1]),de=q+we;J+=Math.abs(q)>=Math.abs(we)?q-de+we:we-de+q,q=de}q+J>=0!=!!B&&le.reverse()}var V=c.bv(function le(B,q){var J,ne=B&&B.type;if(ne==="FeatureCollection")for(J=0;J<B.features.length;J++)le(B.features[J],q);else if(ne==="GeometryCollection")for(J=0;J<B.geometries.length;J++)le(B.geometries[J],q);else if(ne==="Feature")le(B.geometry,q);else if(ne==="Polygon")D(B.coordinates,q);else if(ne==="MultiPolygon")for(J=0;J<B.coordinates.length;J++)D(B.coordinates[J],q);return B});const j=c.bq.VectorTileFeature.prototype.toGeoJSON;var te={exports:{}},U=c.bw,W=c.bq.VectorTileFeature,Y=oe;function oe(le,B){this.options=B||{},this.features=le,this.length=le.length}function _e(le,B){this.id=typeof le.id=="number"?le.id:void 0,this.type=le.type,this.rawGeometry=le.type===1?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=B||4096}oe.prototype.feature=function(le){return new _e(this.features[le],this.options.extent)},_e.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var B=0;B<le.length;B++){for(var q=le[B],J=[],ne=0;ne<q.length;ne++)J.push(new U(q[ne][0],q[ne][1]));this.geometry.push(J)}return this.geometry},_e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,B=1/0,q=-1/0,J=1/0,ne=-1/0,xe=0;xe<le.length;xe++)for(var Q=le[xe],we=0;we<Q.length;we++){var de=Q[we];B=Math.min(B,de.x),q=Math.max(q,de.x),J=Math.min(J,de.y),ne=Math.max(ne,de.y)}return[B,J,q,ne]},_e.prototype.toGeoJSON=W.prototype.toGeoJSON;var se=c.bx,ce=Y;function me(le){var B=new se;return function(q,J){for(var ne in q.layers)J.writeMessage(3,Ce,q.layers[ne])}(le,B),B.finish()}function Ce(le,B){var q;B.writeVarintField(15,le.version||1),B.writeStringField(1,le.name||""),B.writeVarintField(5,le.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<le.length;q++)J.feature=le.feature(q),B.writeMessage(2,Z,J);var ne=J.keys;for(q=0;q<ne.length;q++)B.writeStringField(3,ne[q]);var xe=J.values;for(q=0;q<xe.length;q++)B.writeMessage(4,tt,xe[q])}function Z(le,B){var q=le.feature;q.id!==void 0&&B.writeVarintField(1,q.id),B.writeMessage(2,fe,le),B.writeVarintField(3,q.type),B.writeMessage(4,Ze,q)}function fe(le,B){var q=le.feature,J=le.keys,ne=le.values,xe=le.keycache,Q=le.valuecache;for(var we in q.properties){var de=q.properties[we],Ae=xe[we];if(de!==null){Ae===void 0&&(J.push(we),xe[we]=Ae=J.length-1),B.writeVarint(Ae);var Ue=typeof de;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(de=JSON.stringify(de));var We=Ue+":"+de,Xe=Q[We];Xe===void 0&&(ne.push(de),Q[We]=Xe=ne.length-1),B.writeVarint(Xe)}}}function Ke(le,B){return(B<<3)+(7&le)}function Se(le){return le<<1^le>>31}function Ze(le,B){for(var q=le.loadGeometry(),J=le.type,ne=0,xe=0,Q=q.length,we=0;we<Q;we++){var de=q[we],Ae=1;J===1&&(Ae=de.length),B.writeVarint(Ke(1,Ae));for(var Ue=J===3?de.length-1:de.length,We=0;We<Ue;We++){We===1&&J!==1&&B.writeVarint(Ke(2,Ue-1));var Xe=de[We].x-ne,Tt=de[We].y-xe;B.writeVarint(Se(Xe)),B.writeVarint(Se(Tt)),ne+=Xe,xe+=Tt}J===3&&B.writeVarint(Ke(7,1))}}function tt(le,B){var q=typeof le;q==="string"?B.writeStringField(1,le):q==="boolean"?B.writeBooleanField(7,le):q==="number"&&(le%1!=0?B.writeDoubleField(3,le):le<0?B.writeSVarintField(6,le):B.writeVarintField(5,le))}te.exports=me,te.exports.fromVectorTileJs=me,te.exports.fromGeojsonVt=function(le,B){B=B||{};var q={};for(var J in le)q[J]=new ce(le[J].features,B),q[J].name=J,q[J].version=B.version,q[J].extent=B.extent;return me({layers:q})},te.exports.GeoJSONWrapper=ce;var qe=c.bv(te.exports);const Ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},wt=Math.fround||(un=new Float32Array(1),le=>(un[0]=+le,un[0]));var un;const qt=3,At=5,hn=6;class Tn{constructor(B){this.options=Object.assign(Object.create(Ot),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:q,minZoom:J,maxZoom:ne}=this.options;q&&console.time("total time");const xe=`prepare ${B.length} points`;q&&console.time(xe),this.points=B;const Q=[];for(let de=0;de<B.length;de++){const Ae=B[de];if(!Ae.geometry)continue;const[Ue,We]=Ae.geometry.coordinates,Xe=wt(kn(Ue)),Tt=wt(wr(We));Q.push(Xe,Tt,1/0,de,-1,1),this.options.reduce&&Q.push(0)}let we=this.trees[ne+1]=this._createTree(Q);q&&console.timeEnd(xe);for(let de=ne;de>=J;de--){const Ae=+Date.now();we=this.trees[de]=this._createTree(this._cluster(we,de)),q&&console.log("z%d: %d clusters in %dms",de,we.numItems,+Date.now()-Ae)}return q&&console.timeEnd("total time"),this}getClusters(B,q){let J=((B[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,B[1]));let xe=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)J=-180,xe=180;else if(J>xe){const We=this.getClusters([J,ne,180,Q],q),Xe=this.getClusters([-180,ne,xe,Q],q);return We.concat(Xe)}const we=this.trees[this._limitZoom(q)],de=we.range(kn(J),wr(Q),kn(xe),wr(ne)),Ae=we.data,Ue=[];for(const We of de){const Xe=this.stride*We;Ue.push(Ae[Xe+At]>1?yn(Ae,Xe,this.clusterProps):this.points[Ae[Xe+qt]])}return Ue}getChildren(B){const q=this._getOriginId(B),J=this._getOriginZoom(B),ne="No cluster with the specified id.",xe=this.trees[J];if(!xe)throw new Error(ne);const Q=xe.data;if(q*this.stride>=Q.length)throw new Error(ne);const we=this.options.radius/(this.options.extent*Math.pow(2,J-1)),de=xe.within(Q[q*this.stride],Q[q*this.stride+1],we),Ae=[];for(const Ue of de){const We=Ue*this.stride;Q[We+4]===B&&Ae.push(Q[We+At]>1?yn(Q,We,this.clusterProps):this.points[Q[We+qt]])}if(Ae.length===0)throw new Error(ne);return Ae}getLeaves(B,q,J){const ne=[];return this._appendLeaves(ne,B,q=q||10,J=J||0,0),ne}getTile(B,q,J){const ne=this.trees[this._limitZoom(B)],xe=Math.pow(2,B),{extent:Q,radius:we}=this.options,de=we/Q,Ae=(J-de)/xe,Ue=(J+1+de)/xe,We={features:[]};return this._addTileFeatures(ne.range((q-de)/xe,Ae,(q+1+de)/xe,Ue),ne.data,q,J,xe,We),q===0&&this._addTileFeatures(ne.range(1-de/xe,Ae,1,Ue),ne.data,xe,J,xe,We),q===xe-1&&this._addTileFeatures(ne.range(0,Ae,de/xe,Ue),ne.data,-1,J,xe,We),We.features.length?We:null}getClusterExpansionZoom(B){let q=this._getOriginZoom(B)-1;for(;q<=this.options.maxZoom;){const J=this.getChildren(B);if(q++,J.length!==1)break;B=J[0].properties.cluster_id}return q}_appendLeaves(B,q,J,ne,xe){const Q=this.getChildren(q);for(const we of Q){const de=we.properties;if(de&&de.cluster?xe+de.point_count<=ne?xe+=de.point_count:xe=this._appendLeaves(B,de.cluster_id,J,ne,xe):xe<ne?xe++:B.push(we),B.length===J)break}return xe}_createTree(B){const q=new c.au(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<B.length;J+=this.stride)q.add(B[J],B[J+1]);return q.finish(),q.data=B,q}_addTileFeatures(B,q,J,ne,xe,Q){for(const we of B){const de=we*this.stride,Ae=q[de+At]>1;let Ue,We,Xe;if(Ae)Ue=_n(q,de,this.clusterProps),We=q[de],Xe=q[de+1];else{const Ht=this.points[q[de+qt]];Ue=Ht.properties;const[Zt,xn]=Ht.geometry.coordinates;We=kn(Zt),Xe=wr(xn)}const Tt={type:1,geometry:[[Math.round(this.options.extent*(We*xe-J)),Math.round(this.options.extent*(Xe*xe-ne))]],tags:Ue};let Dt;Dt=Ae||this.options.generateId?q[de+qt]:this.points[q[de+qt]].id,Dt!==void 0&&(Tt.id=Dt),Q.features.push(Tt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,q){const{radius:J,extent:ne,reduce:xe,minPoints:Q}=this.options,we=J/(ne*Math.pow(2,q)),de=B.data,Ae=[],Ue=this.stride;for(let We=0;We<de.length;We+=Ue){if(de[We+2]<=q)continue;de[We+2]=q;const Xe=de[We],Tt=de[We+1],Dt=B.within(de[We],de[We+1],we),Ht=de[We+At];let Zt=Ht;for(const xn of Dt){const Xn=xn*Ue;de[Xn+2]>q&&(Zt+=de[Xn+At])}if(Zt>Ht&&Zt>=Q){let xn,Xn=Xe*Ht,lr=Tt*Ht,Jr=-1;const sn=((We/Ue|0)<<5)+(q+1)+this.points.length;for(const Er of Dt){const ai=Er*Ue;if(de[ai+2]<=q)continue;de[ai+2]=q;const Ji=de[ai+At];Xn+=de[ai]*Ji,lr+=de[ai+1]*Ji,de[ai+4]=sn,xe&&(xn||(xn=this._map(de,We,!0),Jr=this.clusterProps.length,this.clusterProps.push(xn)),xe(xn,this._map(de,ai)))}de[We+4]=sn,Ae.push(Xn/Zt,lr/Zt,1/0,sn,-1,Zt),xe&&Ae.push(Jr)}else{for(let xn=0;xn<Ue;xn++)Ae.push(de[We+xn]);if(Zt>1)for(const xn of Dt){const Xn=xn*Ue;if(!(de[Xn+2]<=q)){de[Xn+2]=q;for(let lr=0;lr<Ue;lr++)Ae.push(de[Xn+lr])}}}}return Ae}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,q,J){if(B[q+At]>1){const Q=this.clusterProps[B[q+hn]];return J?Object.assign({},Q):Q}const ne=this.points[B[q+qt]].properties,xe=this.options.map(ne);return J&&xe===ne?Object.assign({},xe):xe}}function yn(le,B,q){return{type:"Feature",id:le[B+qt],properties:_n(le,B,q),geometry:{type:"Point",coordinates:[(J=le[B],360*(J-.5)),kr(le[B+1])]}};var J}function _n(le,B,q){const J=le[B+At],ne=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,xe=le[B+hn],Q=xe===-1?{}:Object.assign({},q[xe]);return Object.assign(Q,{cluster:!0,cluster_id:le[B+qt],point_count:J,point_count_abbreviated:ne})}function kn(le){return le/360+.5}function wr(le){const B=Math.sin(le*Math.PI/180),q=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return q<0?0:q>1?1:q}function kr(le){const B=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Sr(le,B,q,J){for(var ne,xe=J,Q=q-B>>1,we=q-B,de=le[B],Ae=le[B+1],Ue=le[q],We=le[q+1],Xe=B+3;Xe<q;Xe+=3){var Tt=dr(le[Xe],le[Xe+1],de,Ae,Ue,We);if(Tt>xe)ne=Xe,xe=Tt;else if(Tt===xe){var Dt=Math.abs(Xe-Q);Dt<we&&(ne=Xe,we=Dt)}}xe>J&&(ne-B>3&&Sr(le,B,ne,J),le[ne+2]=xe,q-ne>3&&Sr(le,ne,q,J))}function dr(le,B,q,J,ne,xe){var Q=ne-q,we=xe-J;if(Q!==0||we!==0){var de=((le-q)*Q+(B-J)*we)/(Q*Q+we*we);de>1?(q=ne,J=xe):de>0&&(q+=Q*de,J+=we*de)}return(Q=le-q)*Q+(we=B-J)*we}function Qe(le,B,q,J){var ne={id:le===void 0?null:le,type:B,geometry:q,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(xe){var Q=xe.geometry,we=xe.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")ge(xe,Q);else if(we==="Polygon"||we==="MultiLineString")for(var de=0;de<Q.length;de++)ge(xe,Q[de]);else if(we==="MultiPolygon")for(de=0;de<Q.length;de++)for(var Ae=0;Ae<Q[de].length;Ae++)ge(xe,Q[de][Ae])}(ne),ne}function ge(le,B){for(var q=0;q<B.length;q+=3)le.minX=Math.min(le.minX,B[q]),le.minY=Math.min(le.minY,B[q+1]),le.maxX=Math.max(le.maxX,B[q]),le.maxY=Math.max(le.maxY,B[q+1])}function Pe(le,B,q,J){if(B.geometry){var ne=B.geometry.coordinates,xe=B.geometry.type,Q=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),we=[],de=B.id;if(q.promoteId?de=B.properties[q.promoteId]:q.generateId&&(de=J||0),xe==="Point")It(ne,we);else if(xe==="MultiPoint")for(var Ae=0;Ae<ne.length;Ae++)It(ne[Ae],we);else if(xe==="LineString")Dn(ne,we,Q,!1);else if(xe==="MultiLineString"){if(q.lineMetrics){for(Ae=0;Ae<ne.length;Ae++)Dn(ne[Ae],we=[],Q,!1),le.push(Qe(de,"LineString",we,B.properties));return}Oe(ne,we,Q,!1)}else if(xe==="Polygon")Oe(ne,we,Q,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(Ae=0;Ae<B.geometry.geometries.length;Ae++)Pe(le,{id:de,geometry:B.geometry.geometries[Ae],properties:B.properties},q,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ae=0;Ae<ne.length;Ae++){var Ue=[];Oe(ne[Ae],Ue,Q,!0),we.push(Ue)}}le.push(Qe(de,xe,we,B.properties))}}function It(le,B){B.push(Yt(le[0])),B.push(Dr(le[1])),B.push(0)}function Dn(le,B,q,J){for(var ne,xe,Q=0,we=0;we<le.length;we++){var de=Yt(le[we][0]),Ae=Dr(le[we][1]);B.push(de),B.push(Ae),B.push(0),we>0&&(Q+=J?(ne*Ae-de*xe)/2:Math.sqrt(Math.pow(de-ne,2)+Math.pow(Ae-xe,2))),ne=de,xe=Ae}var Ue=B.length-3;B[2]=1,Sr(B,0,Ue,q),B[Ue+2]=1,B.size=Math.abs(Q),B.start=0,B.end=B.size}function Oe(le,B,q,J){for(var ne=0;ne<le.length;ne++){var xe=[];Dn(le[ne],xe,q,J),B.push(xe)}}function Yt(le){return le/360+.5}function Dr(le){var B=Math.sin(le*Math.PI/180),q=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return q<0?0:q>1?1:q}function ln(le,B,q,J,ne,xe,Q,we){if(J/=B,xe>=(q/=B)&&Q<J)return le;if(Q<q||xe>=J)return null;for(var de=[],Ae=0;Ae<le.length;Ae++){var Ue=le[Ae],We=Ue.geometry,Xe=Ue.type,Tt=ne===0?Ue.minX:Ue.minY,Dt=ne===0?Ue.maxX:Ue.maxY;if(Tt>=q&&Dt<J)de.push(Ue);else if(!(Dt<q||Tt>=J)){var Ht=[];if(Xe==="Point"||Xe==="MultiPoint")er(We,Ht,q,J,ne);else if(Xe==="LineString")Mo(We,Ht,q,J,ne,!1,we.lineMetrics);else if(Xe==="MultiLineString")Os(We,Ht,q,J,ne,!1);else if(Xe==="Polygon")Os(We,Ht,q,J,ne,!0);else if(Xe==="MultiPolygon")for(var Zt=0;Zt<We.length;Zt++){var xn=[];Os(We[Zt],xn,q,J,ne,!0),xn.length&&Ht.push(xn)}if(Ht.length){if(we.lineMetrics&&Xe==="LineString"){for(Zt=0;Zt<Ht.length;Zt++)de.push(Qe(Ue.id,Xe,Ht[Zt],Ue.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(Ht.length===1?(Xe="LineString",Ht=Ht[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=Ht.length===3?"Point":"MultiPoint"),de.push(Qe(Ue.id,Xe,Ht,Ue.tags))}}}return de.length?de:null}function er(le,B,q,J,ne){for(var xe=0;xe<le.length;xe+=3){var Q=le[xe+ne];Q>=q&&Q<=J&&(B.push(le[xe]),B.push(le[xe+1]),B.push(le[xe+2]))}}function Mo(le,B,q,J,ne,xe,Q){for(var we,de,Ae=ps(le),Ue=ne===0?Pi:xl,We=le.start,Xe=0;Xe<le.length-3;Xe+=3){var Tt=le[Xe],Dt=le[Xe+1],Ht=le[Xe+2],Zt=le[Xe+3],xn=le[Xe+4],Xn=ne===0?Tt:Dt,lr=ne===0?Zt:xn,Jr=!1;Q&&(we=Math.sqrt(Math.pow(Tt-Zt,2)+Math.pow(Dt-xn,2))),Xn<q?lr>q&&(de=Ue(Ae,Tt,Dt,Zt,xn,q),Q&&(Ae.start=We+we*de)):Xn>J?lr<J&&(de=Ue(Ae,Tt,Dt,Zt,xn,J),Q&&(Ae.start=We+we*de)):Va(Ae,Tt,Dt,Ht),lr<q&&Xn>=q&&(de=Ue(Ae,Tt,Dt,Zt,xn,q),Jr=!0),lr>J&&Xn<=J&&(de=Ue(Ae,Tt,Dt,Zt,xn,J),Jr=!0),!xe&&Jr&&(Q&&(Ae.end=We+we*de),B.push(Ae),Ae=ps(le)),Q&&(We+=we)}var sn=le.length-3;Tt=le[sn],Dt=le[sn+1],Ht=le[sn+2],(Xn=ne===0?Tt:Dt)>=q&&Xn<=J&&Va(Ae,Tt,Dt,Ht),sn=Ae.length-3,xe&&sn>=3&&(Ae[sn]!==Ae[0]||Ae[sn+1]!==Ae[1])&&Va(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&B.push(Ae)}function ps(le){var B=[];return B.size=le.size,B.start=le.start,B.end=le.end,B}function Os(le,B,q,J,ne,xe){for(var Q=0;Q<le.length;Q++)Mo(le[Q],B,q,J,ne,xe,!1)}function Va(le,B,q,J){le.push(B),le.push(q),le.push(J)}function Pi(le,B,q,J,ne,xe){var Q=(xe-B)/(J-B);return le.push(xe),le.push(q+(ne-q)*Q),le.push(1),Q}function xl(le,B,q,J,ne,xe){var Q=(xe-q)/(ne-q);return le.push(B+(J-B)*Q),le.push(xe),le.push(1),Q}function ds(le,B){for(var q=[],J=0;J<le.length;J++){var ne,xe=le[J],Q=xe.type;if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")ne=rt(xe.geometry,B);else if(Q==="MultiLineString"||Q==="Polygon"){ne=[];for(var we=0;we<xe.geometry.length;we++)ne.push(rt(xe.geometry[we],B))}else if(Q==="MultiPolygon")for(ne=[],we=0;we<xe.geometry.length;we++){for(var de=[],Ae=0;Ae<xe.geometry[we].length;Ae++)de.push(rt(xe.geometry[we][Ae],B));ne.push(de)}q.push(Qe(xe.id,Q,ne,xe.tags))}return q}function rt(le,B){var q=[];q.size=le.size,le.start!==void 0&&(q.start=le.start,q.end=le.end);for(var J=0;J<le.length;J+=3)q.push(le[J]+B,le[J+1],le[J+2]);return q}function Ko(le,B){if(le.transformed)return le;var q,J,ne,xe=1<<le.z,Q=le.x,we=le.y;for(q=0;q<le.features.length;q++){var de=le.features[q],Ae=de.geometry,Ue=de.type;if(de.geometry=[],Ue===1)for(J=0;J<Ae.length;J+=2)de.geometry.push(Ki(Ae[J],Ae[J+1],B,xe,Q,we));else for(J=0;J<Ae.length;J++){var We=[];for(ne=0;ne<Ae[J].length;ne+=2)We.push(Ki(Ae[J][ne],Ae[J][ne+1],B,xe,Q,we));de.geometry.push(We)}}return le.transformed=!0,le}function Ki(le,B,q,J,ne,xe){return[Math.round(q*(le*J-ne)),Math.round(q*(B*J-xe))]}function wl(le,B,q,J,ne){for(var xe=B===ne.maxZoom?0:ne.tolerance/((1<<B)*ne.extent),Q={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:J,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<le.length;we++){Q.numFeatures++,Kr(Q,le[we],xe,ne);var de=le[we].minX,Ae=le[we].minY,Ue=le[we].maxX,We=le[we].maxY;de<Q.minX&&(Q.minX=de),Ae<Q.minY&&(Q.minY=Ae),Ue>Q.maxX&&(Q.maxX=Ue),We>Q.maxY&&(Q.maxY=We)}return Q}function Kr(le,B,q,J){var ne=B.geometry,xe=B.type,Q=[];if(xe==="Point"||xe==="MultiPoint")for(var we=0;we<ne.length;we+=3)Q.push(ne[we]),Q.push(ne[we+1]),le.numPoints++,le.numSimplified++;else if(xe==="LineString")ht(Q,ne,le,q,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(we=0;we<ne.length;we++)ht(Q,ne[we],le,q,xe==="Polygon",we===0);else if(xe==="MultiPolygon")for(var de=0;de<ne.length;de++){var Ae=ne[de];for(we=0;we<Ae.length;we++)ht(Q,Ae[we],le,q,!0,we===0)}if(Q.length){var Ue=B.tags||null;if(xe==="LineString"&&J.lineMetrics){for(var We in Ue={},B.tags)Ue[We]=B.tags[We];Ue.mapbox_clip_start=ne.start/ne.size,Ue.mapbox_clip_end=ne.end/ne.size}var Xe={geometry:Q,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Ue};B.id!==null&&(Xe.id=B.id),le.features.push(Xe)}}function ht(le,B,q,J,ne,xe){var Q=J*J;if(J>0&&B.size<(ne?Q:J))q.numPoints+=B.length/3;else{for(var we=[],de=0;de<B.length;de+=3)(J===0||B[de+2]>Q)&&(q.numSimplified++,we.push(B[de]),we.push(B[de+1])),q.numPoints++;ne&&function(Ae,Ue){for(var We=0,Xe=0,Tt=Ae.length,Dt=Tt-2;Xe<Tt;Dt=Xe,Xe+=2)We+=(Ae[Xe]-Ae[Dt])*(Ae[Xe+1]+Ae[Dt+1]);if(We>0===Ue)for(Xe=0,Tt=Ae.length;Xe<Tt/2;Xe+=2){var Ht=Ae[Xe],Zt=Ae[Xe+1];Ae[Xe]=Ae[Tt-2-Xe],Ae[Xe+1]=Ae[Tt-1-Xe],Ae[Tt-2-Xe]=Ht,Ae[Tt-1-Xe]=Zt}}(we,xe),le.push(we)}}function tn(le,B){var q=(B=this.options=function(ne,xe){for(var Q in xe)ne[Q]=xe[Q];return ne}(Object.create(this.options),B)).debug;if(q&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ne,xe){var Q=[];if(ne.type==="FeatureCollection")for(var we=0;we<ne.features.length;we++)Pe(Q,ne.features[we],xe,we);else Pe(Q,ne.type==="Feature"?ne:{geometry:ne},xe);return Q}(le,B);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(ne,xe){var Q=xe.buffer/xe.extent,we=ne,de=ln(ne,1,-1-Q,Q,0,-1,2,xe),Ae=ln(ne,1,1-Q,2+Q,0,-1,2,xe);return(de||Ae)&&(we=ln(ne,1,-Q,1+Q,0,-1,2,xe)||[],de&&(we=ds(de,1).concat(we)),Ae&&(we=we.concat(ds(Ae,-1)))),we}(J,B),J.length&&this.splitTile(J,0,0,0),q&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $t(le,B,q){return 32*((1<<le)*q+B)+le}function Rr(le,B){return B?le.properties[B]:le.id}function Jo(le,B){if(le==null)return!0;if(le.type==="Feature")return Rr(le,B)!=null;if(le.type==="FeatureCollection"){const q=new Set;for(const J of le.features){const ne=Rr(J,B);if(ne==null||q.has(ne))return!1;q.add(ne)}return!0}return!1}function Kt(le,B){const q=new Map;if(le!=null)if(le.type==="Feature")q.set(Rr(le,B),le);else for(const J of le.features)q.set(Rr(J,B),J);return q}tn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},tn.prototype.splitTile=function(le,B,q,J,ne,xe,Q){for(var we=[le,B,q,J],de=this.options,Ae=de.debug;we.length;){J=we.pop(),q=we.pop(),B=we.pop(),le=we.pop();var Ue=1<<B,We=$t(B,q,J),Xe=this.tiles[We];if(!Xe&&(Ae>1&&console.time("creation"),Xe=this.tiles[We]=wl(le,B,q,J,de),this.tileCoords.push({z:B,x:q,y:J}),Ae)){Ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,q,J,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var Tt="z"+B;this.stats[Tt]=(this.stats[Tt]||0)+1,this.total++}if(Xe.source=le,ne){if(B===de.maxZoom||B===ne)continue;var Dt=1<<ne-B;if(q!==Math.floor(xe/Dt)||J!==Math.floor(Q/Dt))continue}else if(B===de.indexMaxZoom||Xe.numPoints<=de.indexMaxPoints)continue;if(Xe.source=null,le.length!==0){Ae>1&&console.time("clipping");var Ht,Zt,xn,Xn,lr,Jr,sn=.5*de.buffer/de.extent,Er=.5-sn,ai=.5+sn,Ji=1+sn;Ht=Zt=xn=Xn=null,lr=ln(le,Ue,q-sn,q+ai,0,Xe.minX,Xe.maxX,de),Jr=ln(le,Ue,q+Er,q+Ji,0,Xe.minX,Xe.maxX,de),le=null,lr&&(Ht=ln(lr,Ue,J-sn,J+ai,1,Xe.minY,Xe.maxY,de),Zt=ln(lr,Ue,J+Er,J+Ji,1,Xe.minY,Xe.maxY,de),lr=null),Jr&&(xn=ln(Jr,Ue,J-sn,J+ai,1,Xe.minY,Xe.maxY,de),Xn=ln(Jr,Ue,J+Er,J+Ji,1,Xe.minY,Xe.maxY,de),Jr=null),Ae>1&&console.timeEnd("clipping"),we.push(Ht||[],B+1,2*q,2*J),we.push(Zt||[],B+1,2*q,2*J+1),we.push(xn||[],B+1,2*q+1,2*J),we.push(Xn||[],B+1,2*q+1,2*J+1)}}},tn.prototype.getTile=function(le,B,q){var J=this.options,ne=J.extent,xe=J.debug;if(le<0||le>24)return null;var Q=1<<le,we=$t(le,B=(B%Q+Q)%Q,q);if(this.tiles[we])return Ko(this.tiles[we],ne);xe>1&&console.log("drilling down to z%d-%d-%d",le,B,q);for(var de,Ae=le,Ue=B,We=q;!de&&Ae>0;)Ae--,Ue=Math.floor(Ue/2),We=Math.floor(We/2),de=this.tiles[$t(Ae,Ue,We)];return de&&de.source?(xe>1&&console.log("found parent tile z%d-%d-%d",Ae,Ue,We),xe>1&&console.time("drilling down"),this.splitTile(de.source,Ae,Ue,We,le,B,q),xe>1&&console.timeEnd("drilling down"),this.tiles[we]?Ko(this.tiles[we],ne):null):null};class ga extends E{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(B,q){return c._(this,void 0,void 0,function*(){const J=B.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ne=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!ne)return null;const xe=new class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.W,this.length=we.length,this._features=we}feature(we){return new class{constructor(de){this._feature=de,this.extent=c.W,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){const de=[];for(const Ae of this._feature.geometry)de.push([new c.P(Ae[0],Ae[1])]);return de}{const de=[];for(const Ae of this._feature.geometry){const Ue=[];for(const We of Ae)Ue.push(new c.P(We[0],We[1]));de.push(Ue)}return de}}toGeoJSON(de,Ae,Ue){return j.call(this,de,Ae,Ue)}}(this._features[we])}}(ne.features);let Q=qe(xe);return Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),{vectorTile:xe,rawData:Q.buffer}})}loadData(B){return c._(this,void 0,void 0,function*(){var q;(q=this._pendingRequest)===null||q===void 0||q.abort();const J=!!(B&&B.request&&B.request.collectResourceTiming)&&new c.bs(B.request);this._pendingRequest=new AbortController;try{let ne=yield this.loadGeoJSON(B,this._pendingRequest);if(delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(V(ne,!0),B.filter){const Q=c.by(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(de=>`${de.key}: ${de.message}`).join(", "));ne={type:"FeatureCollection",features:ne.features.filter(de=>Q.value.evaluate({zoom:0},de))}}this._geoJSONIndex=B.cluster?new Tn(function({superclusterOptions:Q,clusterProperties:we}){if(!we||!Q)return Q;const de={},Ae={},Ue={accumulated:null,zoom:0},We={properties:null},Xe=Object.keys(we);for(const Tt of Xe){const[Dt,Ht]=we[Tt],Zt=c.by(Ht),xn=c.by(typeof Dt=="string"?[Dt,["accumulated"],["get",Tt]]:Dt);de[Tt]=Zt.value,Ae[Tt]=xn.value}return Q.map=Tt=>{We.properties=Tt;const Dt={};for(const Ht of Xe)Dt[Ht]=de[Ht].evaluate(Ue,We);return Dt},Q.reduce=(Tt,Dt)=>{We.properties=Dt;for(const Ht of Xe)Ue.accumulated=Tt[Ht],Tt[Ht]=Ae[Ht].evaluate(Ue,We)},Q}(B)).load(ne.features):function(Q,we){return new tn(Q,we)}(ne,B.geojsonVtOptions),this.loaded={};const xe={};if(J){const Q=J.finish();Q&&(xe.resourceTiming={},xe.resourceTiming[B.source]=JSON.parse(JSON.stringify(Q)))}return xe}catch(ne){if(delete this._pendingRequest,c.bz(ne))return{abandoned:!0};throw ne}})}reloadTile(B){const q=this.loaded;return q&&q[B.uid]?super.reloadTile(B):this.loadTile(B)}loadGeoJSON(B,q){return c._(this,void 0,void 0,function*(){const{promoteId:J}=B;if(B.request){const ne=yield c.h(B.request,q);return this._dataUpdateable=Jo(ne.data,J)?Kt(ne.data,J):void 0,ne.data}if(typeof B.data=="string")try{const ne=JSON.parse(B.data);return this._dataUpdateable=Jo(ne,J)?Kt(ne,J):void 0,ne}catch{throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`)}if(!B.dataDiff)throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${B.source}`);return function(ne,xe,Q){var we,de,Ae,Ue;if(xe.removeAll&&ne.clear(),xe.remove)for(const We of xe.remove)ne.delete(We);if(xe.add)for(const We of xe.add){const Xe=Rr(We,Q);Xe!=null&&ne.set(Xe,We)}if(xe.update)for(const We of xe.update){let Xe=ne.get(We.id);if(Xe==null)continue;const Tt=!We.removeAllProperties&&(((we=We.removeProperties)===null||we===void 0?void 0:we.length)>0||((de=We.addOrUpdateProperties)===null||de===void 0?void 0:de.length)>0);if((We.newGeometry||We.removeAllProperties||Tt)&&(Xe=Object.assign({},Xe),ne.set(We.id,Xe),Tt&&(Xe.properties=Object.assign({},Xe.properties))),We.newGeometry&&(Xe.geometry=We.newGeometry),We.removeAllProperties)Xe.properties={};else if(((Ae=We.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0)for(const Dt of We.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,Dt)&&delete Xe.properties[Dt];if(((Ue=We.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:Dt,value:Ht}of We.addOrUpdateProperties)Xe.properties[Dt]=Ht}}(this._dataUpdateable,B.dataDiff,J),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(B){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(B){return this._geoJSONIndex.getClusterExpansionZoom(B.clusterId)}getClusterChildren(B){return this._geoJSONIndex.getChildren(B.clusterId)}getClusterLeaves(B){return this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset)}}class Vr{constructor(B){this.self=B,this.actor=new c.C(B),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(q,J)=>{if(this.externalWorkerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.externalWorkerSourceTypes[q]=J},this.self.addProtocol=c.bf,this.self.removeProtocol=c.bg,this.self.registerRTLTextPlugin=q=>{if(c.bA.isParsed())throw new Error("RTL text plugin already registered.");c.bA.setMethods(q)},this.actor.registerMessageHandler("LDT",(q,J)=>this._getDEMWorkerSource(q,J.source).loadTile(J)),this.actor.registerMessageHandler("RDT",(q,J)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(q,J.source).removeTile(J)})),this.actor.registerMessageHandler("GCEZ",(q,J)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterExpansionZoom(J)})),this.actor.registerMessageHandler("GCC",(q,J)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterChildren(J)})),this.actor.registerMessageHandler("GCL",(q,J)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterLeaves(J)})),this.actor.registerMessageHandler("LD",(q,J)=>this._getWorkerSource(q,J.type,J.source).loadData(J)),this.actor.registerMessageHandler("LT",(q,J)=>this._getWorkerSource(q,J.type,J.source).loadTile(J)),this.actor.registerMessageHandler("RT",(q,J)=>this._getWorkerSource(q,J.type,J.source).reloadTile(J)),this.actor.registerMessageHandler("AT",(q,J)=>this._getWorkerSource(q,J.type,J.source).abortTile(J)),this.actor.registerMessageHandler("RMT",(q,J)=>this._getWorkerSource(q,J.type,J.source).removeTile(J)),this.actor.registerMessageHandler("RS",(q,J)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[q]||!this.workerSources[q][J.type]||!this.workerSources[q][J.type][J.source])return;const ne=this.workerSources[q][J.type][J.source];delete this.workerSources[q][J.type][J.source],ne.removeSource!==void 0&&ne.removeSource(J)})),this.actor.registerMessageHandler("RM",q=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q]})),this.actor.registerMessageHandler("SR",(q,J)=>c._(this,void 0,void 0,function*(){this.referrer=J})),this.actor.registerMessageHandler("SRPS",(q,J)=>this._syncRTLPluginState(q,J)),this.actor.registerMessageHandler("IS",(q,J)=>c._(this,void 0,void 0,function*(){this.self.importScripts(J)})),this.actor.registerMessageHandler("SI",(q,J)=>this._setImages(q,J)),this.actor.registerMessageHandler("UL",(q,J)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(q).update(J.layers,J.removedIds)})),this.actor.registerMessageHandler("SL",(q,J)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(q).replace(J)}))}_setImages(B,q){return c._(this,void 0,void 0,function*(){this.availableImages[B]=q;for(const J in this.workerSources[B]){const ne=this.workerSources[B][J];for(const xe in ne)ne[xe].availableImages=q}})}_syncRTLPluginState(B,q){return c._(this,void 0,void 0,function*(){if(c.bA.isParsed())return c.bA.getState();if(q.pluginStatus!=="loading")return c.bA.setState(q),q;const J=q.pluginURL;if(this.self.importScripts(J),c.bA.isParsed()){const ne={pluginStatus:"loaded",pluginURL:J};return c.bA.setState(ne),ne}throw c.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${J}`)})}_getAvailableImages(B){let q=this.availableImages[B];return q||(q=[]),q}_getLayerIndex(B){let q=this.layerIndexes[B];return q||(q=this.layerIndexes[B]=new u),q}_getWorkerSource(B,q,J){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][q]||(this.workerSources[B][q]={}),!this.workerSources[B][q][J]){const ne={sendAsync:(xe,Q)=>(xe.targetMapId=B,this.actor.sendAsync(xe,Q))};switch(q){case"vector":this.workerSources[B][q][J]=new E(ne,this._getLayerIndex(B),this._getAvailableImages(B));break;case"geojson":this.workerSources[B][q][J]=new ga(ne,this._getLayerIndex(B),this._getAvailableImages(B));break;default:this.workerSources[B][q][J]=new this.externalWorkerSourceTypes[q](ne,this._getLayerIndex(B),this._getAvailableImages(B))}}return this.workerSources[B][q][J]}_getDEMWorkerSource(B,q){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][q]||(this.demWorkerSources[B][q]=new P),this.demWorkerSources[B][q]}}return c.i(self)&&(self.worker=new Vr(self)),Vr}),i("index",["exports","./shared"],function(c,u){var m="4.1.3";let w,S;const E={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:_=>new Promise((s,f)=>{const d=requestAnimationFrame(s);_.signal.addEventListener("abort",()=>{cancelAnimationFrame(d),f(u.c())})}),getImageData(_,s=0){return this.getImageCanvasContext(_).getImageData(-s,-s,_.width+2*s,_.height+2*s)},getImageCanvasContext(_){const s=window.document.createElement("canvas"),f=s.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return s.width=_.width,s.height=_.height,f.drawImage(_,0,0,_.width,_.height),f},resolveURL:_=>(w||(w=document.createElement("a")),w.href=_,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class P{static testProp(s){if(!P.docStyle)return s[0];for(let f=0;f<s.length;f++)if(s[f]in P.docStyle)return s[f];return s[0]}static create(s,f,d){const g=window.document.createElement(s);return f!==void 0&&(g.className=f),d&&d.appendChild(g),g}static createNS(s,f){return window.document.createElementNS(s,f)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(s,f){s.style[P.transformProp]=f}static addEventListener(s,f,d,g={}){s.addEventListener(f,d,"passive"in g?g:g.capture)}static removeEventListener(s,f,d,g={}){s.removeEventListener(f,d,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(s){const f=s.getBoundingClientRect();return{x:f.width/s.offsetWidth||1,y:f.height/s.offsetHeight||1,boundingClientRect:f}}static getPoint(s,f,d){const g=f.boundingClientRect;return new u.P((d.clientX-g.left)/f.x-s.clientLeft,(d.clientY-g.top)/f.y-s.clientTop)}static mousePos(s,f){const d=P.getScale(s);return P.getPoint(s,d,f)}static touchPos(s,f){const d=[],g=P.getScale(s);for(let v=0;v<f.length;v++)d.push(P.getPoint(s,g,f[v]));return d}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const D={supported:!1,testSupport:function(_){!j&&V&&(te?U(_):k=_)}};let k,V,j=!1,te=!1;function U(_){const s=_.createTexture();_.bindTexture(_.TEXTURE_2D,s);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,V),_.isContextLost())return;D.supported=!0}catch{}_.deleteTexture(s),j=!0}var W;typeof document<"u"&&(V=document.createElement("img"),V.onload=function(){k&&U(k),k=null,te=!0},V.onerror=function(){j=!0,k=null},V.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let s,f,d,g;_.resetRequestQueue=()=>{s=[],f=0,d=0,g={}},_.addThrottleControl=M=>{const R=d++;return g[R]=M,R},_.removeThrottleControl=M=>{delete g[M],C()},_.getImage=(M,R,z=!0)=>new Promise((F,X)=>{D.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),u.e(M,{type:"image"}),s.push({abortController:R,requestParameters:M,supportImageRefresh:z,state:"queued",onError:ie=>{X(ie)},onSuccess:ie=>{F(ie)}}),C()});const v=M=>u._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:R,supportImageRefresh:z,onError:F,onSuccess:X,abortController:ie}=M,re=z===!1&&!u.i(self)&&!u.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((ve,Fe)=>ve&&Fe==="accept",!0));f++;const ue=re?T(R,ie):u.m(R,ie);try{const ve=yield ue;delete M.abortController,M.state="completed",ve.data instanceof HTMLImageElement||u.b(ve.data)?X(ve):ve.data&&X({data:yield($=ve.data,typeof createImageBitmap=="function"?u.d($):u.f($)),cacheControl:ve.cacheControl,expires:ve.expires})}catch(ve){delete M.abortController,F(ve)}finally{f--,C()}var $}),C=()=>{const M=(()=>{for(const R of Object.keys(g))if(g[R]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=f;R<M&&s.length>0;R++){const z=s.shift();z.abortController.signal.aborted?R--:v(z)}},T=(M,R)=>new Promise((z,F)=>{const X=new Image,ie=M.url,re=M.credentials;re&&re==="include"?X.crossOrigin="use-credentials":(re&&re==="same-origin"||!u.s(ie))&&(X.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{X.src="",F(u.c())}),X.fetchPriority="high",X.onload=()=>{X.onerror=X.onload=null,z({data:X})},X.onerror=()=>{X.onerror=X.onload=null,R.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},X.src=ie})}(W||(W={})),W.resetRequestQueue();class Y{constructor(s){this._transformRequestFn=s}transformRequest(s,f){return this._transformRequestFn&&this._transformRequestFn(s,f)||{url:s}}normalizeSpriteURL(s,f,d){const g=function(v){const C=v.match(oe);if(!C)throw new Error(`Unable to parse URL "${v}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(s);return g.path+=`${f}${d}`,function(v){const C=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${C}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const oe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _e(_){var s=new u.A(3);return s[0]=_[0],s[1]=_[1],s[2]=_[2],s}var se,ce=function(_,s,f){return _[0]=s[0]-f[0],_[1]=s[1]-f[1],_[2]=s[2]-f[2],_};se=new u.A(3),u.A!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0);var me=function(_){var s=_[0],f=_[1];return s*s+f*f};function Ce(_){const s=[];if(typeof _=="string")s.push({id:"default",url:_});else if(_&&_.length>0){const f=[];for(const{id:d,url:g}of _){const v=`${d}${g}`;f.indexOf(v)===-1&&(f.push(v),s.push({id:d,url:g}))}}return s}(function(){var _=new u.A(2);u.A!=Float32Array&&(_[0]=0,_[1]=0)})();class Z{constructor(s,f,d,g){this.context=s,this.format=d,this.texture=s.gl.createTexture(),this.update(f,g)}update(s,f,d){const{width:g,height:v}=s,C=!(this.size&&this.size[0]===g&&this.size[1]===v||d),{context:T}=this,{gl:M}=T;if(this.useMipmap=!!(f&&f.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!f||f.premultiply!==!1)),C)this.size=[g,v],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||u.b(s)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,s):M.texImage2D(M.TEXTURE_2D,0,this.format,g,v,0,this.format,M.UNSIGNED_BYTE,s.data);else{const{x:R,y:z}=d||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||u.b(s)?M.texSubImage2D(M.TEXTURE_2D,0,R,z,M.RGBA,M.UNSIGNED_BYTE,s):M.texSubImage2D(M.TEXTURE_2D,0,R,z,g,v,M.RGBA,M.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(s,f,d){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),d!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,d||s),this.filter=s),f!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,f),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function fe(_){const{userImage:s}=_;return!!(s&&s.render&&s.render())&&(_.data.replace(new Uint8Array(s.data.buffer)),!0)}class Ke extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:f,promiseResolve:d}of this.requestors)d(this._getImagesForIds(f));this.requestors=[]}}getImage(s){const f=this.images[s];if(f&&!f.data&&f.spriteData){const d=f.spriteData;f.data=new u.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),f.spriteData=null}return f}addImage(s,f){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,f)&&(this.images[s]=f)}_validate(s,f){let d=!0;const g=f.data||f.spriteData;return this._validateStretch(f.stretchX,g&&g.width)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "stretchX" value`))),d=!1),this._validateStretch(f.stretchY,g&&g.height)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "stretchY" value`))),d=!1),this._validateContent(f.content,f)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "content" value`))),d=!1),d}_validateStretch(s,f){if(!s)return!0;let d=0;for(const g of s){if(g[0]<d||g[1]<g[0]||f<g[1])return!1;d=g[1]}return!0}_validateContent(s,f){if(!s)return!0;if(s.length!==4)return!1;const d=f.spriteData,g=d&&d.width||f.data.width,v=d&&d.height||f.data.height;return!(s[0]<0||g<s[0]||s[1]<0||v<s[1]||s[2]<0||g<s[2]||s[3]<0||v<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,f,d=!0){const g=this.getImage(s);if(d&&(g.data.width!==f.data.width||g.data.height!==f.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=g.version+1,this.images[s]=f,this.updatedImages[s]=!0}removeImage(s){const f=this.images[s];delete this.images[s],delete this.patterns[s],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((f,d)=>{let g=!0;if(!this.isLoaded())for(const v of s)this.images[v]||(g=!1);this.isLoaded()||g?f(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:f})})}_getImagesForIds(s){const f={};for(const d of s){let g=this.getImage(d);g||(this.fire(new u.k("styleimagemissing",{id:d})),g=this.getImage(d)),g?f[d]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:u.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:s,height:f}=this.atlasImage;return{width:s,height:f}}getPattern(s){const f=this.patterns[s],d=this.getImage(s);if(!d)return null;if(f&&f.position.version===d.version)return f.position;if(f)f.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},v=new u.I(g,d);this.patterns[s]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const f=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Z(s,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:f,h:d}=u.p(s),g=this.atlasImage;g.resize({width:f||1,height:d||1});for(const v in this.patterns){const{bin:C}=this.patterns[v],T=C.x+1,M=C.y+1,R=this.getImage(v).data,z=R.width,F=R.height;u.R.copy(R,g,{x:0,y:0},{x:T,y:M},{width:z,height:F}),u.R.copy(R,g,{x:0,y:F-1},{x:T,y:M-1},{width:z,height:1}),u.R.copy(R,g,{x:0,y:0},{x:T,y:M+F},{width:z,height:1}),u.R.copy(R,g,{x:z-1,y:0},{x:T-1,y:M},{width:1,height:F}),u.R.copy(R,g,{x:0,y:0},{x:T+z,y:M},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const f of s){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const d=this.getImage(f);d||u.w(`Image with ID: "${f}" was not found`),fe(d)&&this.updateImage(f,d)}}}const Se=1e20;function Ze(_,s,f,d,g,v,C,T,M){for(let R=s;R<s+d;R++)tt(_,f*v+R,v,g,C,T,M);for(let R=f;R<f+g;R++)tt(_,R*v+s,1,d,C,T,M)}function tt(_,s,f,d,g,v,C){v[0]=0,C[0]=-Se,C[1]=Se,g[0]=_[s];for(let T=1,M=0,R=0;T<d;T++){g[T]=_[s+T*f];const z=T*T;do{const F=v[M];R=(g[T]-g[F]+z-F*F)/(T-F)/2}while(R<=C[M]&&--M>-1);M++,v[M]=T,C[M]=R,C[M+1]=Se}for(let T=0,M=0;T<d;T++){for(;C[M+1]<T;)M++;const R=v[M],z=T-R;_[s+T*f]=g[R]+z*z}}class qe{constructor(s,f){this.requestManager=s,this.localIdeographFontFamily=f,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return u._(this,void 0,void 0,function*(){const f=[];for(const v in s)for(const C of s[v])f.push(this._getAndCacheGlyphsPromise(v,C));const d=yield Promise.all(f),g={};for(const{stack:v,id:C,glyph:T}of d)g[v]||(g[v]={}),g[v][C]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return g})}_getAndCacheGlyphsPromise(s,f){return u._(this,void 0,void 0,function*(){let d=this.entries[s];d||(d=this.entries[s]={glyphs:{},requests:{},ranges:{}});let g=d.glyphs[f];if(g!==void 0)return{stack:s,id:f,glyph:g};if(g=this._tinySDF(d,s,f),g)return d.glyphs[f]=g,{stack:s,id:f,glyph:g};const v=Math.floor(f/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[v])return{stack:s,id:f,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[v]){const T=qe.loadGlyphRange(s,v,this.url,this.requestManager);d.requests[v]=T}const C=yield d.requests[v];for(const T in C)this._doesCharSupportLocalGlyph(+T)||(d.glyphs[+T]=C[+T]);return d.ranges[v]=!0,{stack:s,id:f,glyph:C[f]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(u.u["CJK Unified Ideographs"](s)||u.u["Hangul Syllables"](s)||u.u.Hiragana(s)||u.u.Katakana(s))}_tinySDF(s,f,d){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let v=s.tinySDF;if(!v){let T="400";/bold/i.test(f)?T="900":/medium/i.test(f)?T="500":/light/i.test(f)&&(T="200"),v=s.tinySDF=new qe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:T})}const C=v.draw(String.fromCharCode(d));return{id:d,bitmap:new u.o({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}qe.loadGlyphRange=function(_,s,f,d){return u._(this,void 0,void 0,function*(){const g=256*s,v=g+255,C=d.transformRequest(f.replace("{fontstack}",_).replace("{range}",`${g}-${v}`),"Glyphs"),T=yield u.l(C,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${s}, ${g}-${v}`);const M={};for(const R of u.n(T.data))M[R.id]=R;return M})},qe.TinySDF=class{constructor({fontSize:_=24,buffer:s=3,radius:f=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:v="normal",fontStyle:C="normal"}={}){this.buffer=s,this.cutoff=d,this.radius=f;const T=this.size=_+4*s,M=this._createCanvas(T),R=this.ctx=M.getContext("2d",{willReadFrequently:!0});R.font=`${C} ${v} ${_}px ${g}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(_){const s=document.createElement("canvas");return s.width=s.height=_,s}draw(_){const{width:s,actualBoundingBoxAscent:f,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:v}=this.ctx.measureText(_),C=Math.ceil(f),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-g))),M=Math.min(this.size-this.buffer,C+Math.ceil(d)),R=T+2*this.buffer,z=M+2*this.buffer,F=Math.max(R*z,0),X=new Uint8ClampedArray(F),ie={data:X,width:R,height:z,glyphWidth:T,glyphHeight:M,glyphTop:C,glyphLeft:0,glyphAdvance:s};if(T===0||M===0)return ie;const{ctx:re,buffer:ue,gridInner:$,gridOuter:ve}=this;re.clearRect(ue,ue,T,M),re.fillText(_,ue,ue+C);const Fe=re.getImageData(ue,ue,T,M);ve.fill(Se,0,F),$.fill(0,0,F);for(let he=0;he<M;he++)for(let Ie=0;Ie<T;Ie++){const Be=Fe.data[4*(he*T+Ie)+3]/255;if(Be===0)continue;const Ge=(he+ue)*R+Ie+ue;if(Be===1)ve[Ge]=0,$[Ge]=Se;else{const He=.5-Be;ve[Ge]=He>0?He*He:0,$[Ge]=He<0?He*He:0}}Ze(ve,0,0,R,z,R,this.f,this.v,this.z),Ze($,ue,ue,T,M,R,this.f,this.v,this.z);for(let he=0;he<F;he++){const Ie=Math.sqrt(ve[he])-Math.sqrt($[he]);X[he]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return ie}};class Ot{constructor(){this.specification=u.v.light.position}possiblyEvaluate(s,f){return u.y(s.expression.evaluate(f))}interpolate(s,f,d){return{x:u.z.number(s.x,f.x,d),y:u.z.number(s.y,f.y,d),z:u.z.number(s.z,f.z,d)}}}let wt;class un extends u.E{constructor(s){super(),wt=wt||new u.q({anchor:new u.D(u.v.light.anchor),position:new Ot,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(wt),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,f={}){if(!this._validate(u.r,s,f))for(const d in s){const g=s[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,f,d){return(!d||d.validate!==!1)&&u.t(this,s.call(u.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}class qt{constructor(s,f){this.width=s,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,f){const d=s.join(",")+String(f);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(s,f)),this.dashEntry[d]}getDashRanges(s,f,d){const g=[];let v=s.length%2==1?-s[s.length-1]*d:0,C=s[0]*d,T=!0;g.push({left:v,right:C,isDash:T,zeroLength:s[0]===0});let M=s[0];for(let R=1;R<s.length;R++){T=!T;const z=s[R];v=M*d,M+=z,C=M*d,g.push({left:v,right:C,isDash:T,zeroLength:z===0})}return g}addRoundDash(s,f,d){const g=f/2;for(let v=-d;v<=d;v++){const C=this.width*(this.nextRow+d+v);let T=0,M=s[T];for(let R=0;R<this.width;R++){R/M.right>1&&(M=s[++T]);const z=Math.abs(R-M.left),F=Math.abs(R-M.right),X=Math.min(z,F);let ie;const re=v/d*(g+1);if(M.isDash){const ue=g-Math.abs(re);ie=Math.sqrt(X*X+ue*ue)}else ie=g-Math.sqrt(X*X+re*re);this.data[C+R]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(s){for(let T=s.length-1;T>=0;--T){const M=s[T],R=s[T+1];M.zeroLength?s.splice(T,1):R&&R.isDash===M.isDash&&(R.left=M.left,s.splice(T,1))}const f=s[0],d=s[s.length-1];f.isDash===d.isDash&&(f.left=d.left-this.width,d.right=f.right+this.width);const g=this.width*this.nextRow;let v=0,C=s[v];for(let T=0;T<this.width;T++){T/C.right>1&&(C=s[++v]);const M=Math.abs(T-C.left),R=Math.abs(T-C.right),z=Math.min(M,R);this.data[g+T]=Math.max(0,Math.min(255,(C.isDash?z:-z)+128))}}addDash(s,f){const d=f?7:0,g=2*d+1;if(this.nextRow+g>this.height)return u.w("LineAtlas out of space"),null;let v=0;for(let T=0;T<s.length;T++)v+=s[T];if(v!==0){const T=this.width/v,M=this.getDashRanges(s,this.width,T);f?this.addRoundDash(M,T,d):this.addRegularDash(M)}const C={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:v};return this.nextRow+=g,this.dirty=!0,C}bind(s){const f=s.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const At="maplibre_preloaded_worker_pool";class hn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<hn.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[At]}numActive(){return Object.keys(this.active).length}}const Tn=Math.floor(E.hardwareConcurrency/2);let yn,_n;function kn(){return yn||(yn=new hn),yn}hn.workerCount=u.B(globalThis)?Math.max(Math.min(Tn,3),1):1;class wr{constructor(s,f){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=f;const d=this.workerPool.acquire(f);for(let g=0;g<d.length;g++){const v=new u.C(d[g],f);v.name=`Worker ${g}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,f){const d=[];for(const g of this.actors)d.push(g.sendAsync({type:s,data:f}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,f){for(const d of this.actors)d.registerMessageHandler(s,f)}}function kr(){return _n||(_n=new wr(kn(),u.G),_n.registerMessageHandler("GR",(_,s,f)=>u.m(s,f))),_n}function Sr(_,s){const f=u.F();return u.H(f,f,[1,1,0]),u.J(f,f,[.5*_.width,.5*_.height,1]),u.K(f,f,_.calculatePosMatrix(s.toUnwrapped()))}function dr(_,s,f,d,g,v){const C=function(F,X,ie){if(F)for(const re of F){const ue=X[re];if(ue&&ue.source===ie&&ue.type==="fill-extrusion")return!0}else for(const re in X){const ue=X[re];if(ue.source===ie&&ue.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,_.id),T=v.maxPitchScaleFactor(),M=_.tilesIn(d,T,C);M.sort(Qe);const R=[];for(const F of M)R.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(s,f,_._state,F.queryGeometry,F.cameraQueryGeometry,F.scale,g,v,T,Sr(_.transform,F.tileID))});const z=function(F){const X={},ie={};for(const re of F){const ue=re.queryResults,$=re.wrappedTileID,ve=ie[$]=ie[$]||{};for(const Fe in ue){const he=ue[Fe],Ie=ve[Fe]=ve[Fe]||{},Be=X[Fe]=X[Fe]||[];for(const Ge of he)Ie[Ge.featureIndex]||(Ie[Ge.featureIndex]=!0,Be.push(Ge))}}return X}(R);for(const F in z)z[F].forEach(X=>{const ie=X.feature,re=_.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=re});return z}function Qe(_,s){const f=_.tileID,d=s.tileID;return f.overscaledZ-d.overscaledZ||f.canonical.y-d.canonical.y||f.wrap-d.wrap||f.canonical.x-d.canonical.x}function ge(_,s,f){return u._(this,void 0,void 0,function*(){let d=_;if(_.url?d=(yield u.h(s.transformRequest(_.url,"Source"),f)).data:yield E.frameAsync(f),!d)return null;const g=u.L(u.e(d,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(g.vectorLayerIds=d.vector_layers.map(v=>v.id)),g})}class Pe{constructor(s,f){s&&(f?this.setSouthWest(s).setNorthEast(f):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof u.M?new u.M(s.lng,s.lat):u.M.convert(s),this}setSouthWest(s){return this._sw=s instanceof u.M?new u.M(s.lng,s.lat):u.M.convert(s),this}extend(s){const f=this._sw,d=this._ne;let g,v;if(s instanceof u.M)g=s,v=s;else{if(!(s instanceof Pe))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Pe.convert(s)):this.extend(u.M.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(u.M.convert(s)):this;if(g=s._sw,v=s._ne,!g||!v)return this}return f||d?(f.lng=Math.min(g.lng,f.lng),f.lat=Math.min(g.lat,f.lat),d.lng=Math.max(v.lng,d.lng),d.lat=Math.max(v.lat,d.lat)):(this._sw=new u.M(g.lng,g.lat),this._ne=new u.M(v.lng,v.lat)),this}getCenter(){return new u.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.M(this.getWest(),this.getNorth())}getSouthEast(){return new u.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:f,lat:d}=u.M.convert(s);let g=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(s){return s instanceof Pe?s:s&&new Pe(s)}static fromLngLat(s,f=0){const d=360*f/40075017,g=d/Math.cos(Math.PI/180*s.lat);return new Pe(new u.M(s.lng-g,s.lat-d),new u.M(s.lng+g,s.lat+d))}}class It{constructor(s,f,d){this.bounds=Pe.convert(this.validateBounds(s)),this.minzoom=f||0,this.maxzoom=d||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const f=Math.pow(2,s.z),d=Math.floor(u.N(this.bounds.getWest())*f),g=Math.floor(u.O(this.bounds.getNorth())*f),v=Math.ceil(u.N(this.bounds.getEast())*f),C=Math.ceil(u.O(this.bounds.getSouth())*f);return s.x>=d&&s.x<v&&s.y>=g&&s.y<C}}class Dn extends u.E{constructor(s,f,d,g){if(super(),this.id=s,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.L(f,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield ge(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(u.e(this,s),s.bounds&&(this.tileBounds=new It(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new u.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(f,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((v,C)=>{s.reloadPromise={resolve:v,reject:C}})}else s.actor=this.dispatcher.getActor(),g="LT";s.abortController=new AbortController;try{const v=yield s.actor.sendAsync({type:g,data:d},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,v)}catch(v){if(delete s.abortController,s.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,f){if(f&&f.resourceTiming&&(s.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&s.setExpiryData(f),s.loadVectorData(f,this.map.painter),s.reloadPromise){const d=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(d.resolve).catch(d.reject)}}abortTile(s){return u._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return u._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Oe extends u.E{constructor(s,f,d,g){super(),this.id=s,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},f),u.e(this,u.L(f,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield ge(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(u.e(this,s),s.bounds&&(this.tileBounds=new It(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new u.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return u.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const d=yield W.getImage(this.map._requestManager.transformRequest(f,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&s.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const g=this.map.painter.context,v=g.gl,C=d.data;s.texture=this.map.painter.getTileTexture(C.width),s.texture?s.texture.update(C,{useMipmap:!0}):(s.texture=new Z(g,C,v.RGBA,{useMipmap:!0}),s.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),s.state="loaded"}}catch(d){if(delete s.abortController,s.aborted)s.state="unloaded";else if(d)throw s.state="errored",d}})}abortTile(s){return u._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return u._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class Yt extends Oe{constructor(s,f,d,g){super(s,f,d,g),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(f,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const g=yield W.getImage(d,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){const v=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const C=u.b(v)&&u.S()?v:yield this.readImageNow(v),T={type:this.type,uid:s.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const M=yield s.actor.sendAsync({type:"LDT",data:T});s.dem=M,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}readImageNow(s){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.U()){const f=s.width+2,d=s.height+2;try{return new u.R({width:f,height:d},yield u.V(s,-1,-1,f,d))}catch{}}return E.getImageData(s,1)})}_getNeighboringTiles(s){const f=s.canonical,d=Math.pow(2,f.z),g=(f.x-1+d)%d,v=f.x===0?s.wrap-1:s.wrap,C=(f.x+1+d)%d,T=f.x+1===d?s.wrap+1:s.wrap,M={};return M[new u.Q(s.overscaledZ,v,f.z,g,f.y).key]={backfilled:!1},M[new u.Q(s.overscaledZ,T,f.z,C,f.y).key]={backfilled:!1},f.y>0&&(M[new u.Q(s.overscaledZ,v,f.z,g,f.y-1).key]={backfilled:!1},M[new u.Q(s.overscaledZ,s.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},M[new u.Q(s.overscaledZ,T,f.z,C,f.y-1).key]={backfilled:!1}),f.y+1<d&&(M[new u.Q(s.overscaledZ,v,f.z,g,f.y+1).key]={backfilled:!1},M[new u.Q(s.overscaledZ,s.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},M[new u.Q(s.overscaledZ,T,f.z,C,f.y+1).key]={backfilled:!1}),M}unloadTile(s){return u._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class Dr extends u.E{constructor(s,f,d,g){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(g),this._data=f.data,this._options=u.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const v=u.W/this.tileSize;this.workerOptions=u.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*v,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*v,extent:u.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:u.W,radius:(f.clusterRadius||50)*v,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,f,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:f,offset:d}})}_updateWorkerData(s){return u._(this,void 0,void 0,function*(){const f=u.e({type:this.type},this.workerOptions);s?f.dataDiff=s:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(E.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let g=null;d.resourceTiming&&d.resourceTiming[this.id]&&(g=d.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&u.e(v,{resourceTiming:g}),this.fire(new u.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(d))}})}loaded(){return this._pendingLoads===0}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.actor?"RT":"LT";s.actor=this.actor;const d={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const g=yield this.actor.sendAsync({type:f,data:d},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(g,this.map.painter,f==="RT")})}abortTile(s){return u._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return u._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ln=u.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class er extends u.E{constructor(s,f,d,g){super(),this.id=s,this.dispatcher=d,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=f}load(s){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield W.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,s&&(this.coordinates=s),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new u.j(f))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const f=s.map(u.Y.fromLngLat);this.tileID=function(g){let v=1/0,C=1/0,T=-1/0,M=-1/0;for(const X of g)v=Math.min(v,X.x),C=Math.min(C,X.y),T=Math.max(T,X.x),M=Math.max(M,X.y);const R=Math.max(T-v,M-C),z=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),F=Math.pow(2,z);return new u.a0(z,Math.floor((v+T)/2*F),Math.floor((C+M)/2*F))}(f),this.minzoom=this.maxzoom=this.tileID.z;const d=f.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new u.Z,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,u.W,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,u.W),this._boundsArray.emplaceBack(d[2].x,d[2].y,u.W,u.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Z(s,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let d=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Mo extends er{constructor(s,f,d,g){super(s,f,d,g),this.roundZoom=!0,this.type="video",this.options=f}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const f of s.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield u.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new u.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const f=this.video.seekable;s<f.start(0)||s>f.end(0)?this.fire(new u.j(new u.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new Z(s,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let d=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ps extends er{constructor(s,f,d,g){super(s,f,d,g),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(C=>typeof C!="number"))||this.fire(new u.j(new u.a1(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a1(`sources.${s}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new u.j(new u.a1(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a1(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a1(`sources.${s}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,d=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Z(f,this.canvas,d.RGBA,{premultiply:!0});let g=!1;for(const v in this.tiles){const C=this.tiles[v];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,g=!0)}g&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Os={},Va=_=>{switch(_){case"geojson":return Dr;case"image":return er;case"raster":return Oe;case"raster-dem":return Yt;case"vector":return Dn;case"video":return Mo;case"canvas":return ps}return Os[_]},Pi="RTLPluginLoaded";class xl extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=kr()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return u._(this,arguments,void 0,function*(f,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=E.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(Pi))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ds=null;function rt(){return ds||(ds=new xl),ds}class Ko{constructor(s,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=u.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const f=s+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,f,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,v){const C={};if(!v)return C;for(const T of g){const M=T.layerIds.map(R=>v.getLayer(R)).filter(Boolean);if(M.length!==0){T.layers=M,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(R=>M.filter(z=>z.id===R)[0]));for(const R of M)C[R.id]=T}}return C}(s.buckets,f.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof u.a5){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof u.a5&&v.hasRTLText){this.hasRTLText=!0,rt().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(g).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new u.a4}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(s)}const f=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Z(s,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Z(s,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,f,d,g,v,C,T,M,R,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:v,scale:C,tileSize:this.tileSize,pixelPosMatrix:z,transform:M,params:T,queryPadding:this.queryPadding*R},s,f,d):{}}querySourceFeatures(s,f){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),v=f&&f.sourceLayer?f.sourceLayer:"",C=g._geojsonTileLayer||g[v];if(!C)return;const T=u.a6(f&&f.filter),{z:M,x:R,y:z}=this.tileID.canonical,F={z:M,x:R,y:z};for(let X=0;X<C.length;X++){const ie=C.feature(X);if(T.needGeometry){const $=u.a7(ie,!0);if(!T.filter(new u.a8(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!T.filter(new u.a8(this.tileID.overscaledZ),ie))continue;const re=d.getId(ie,v),ue=new u.a9(ie,M,R,z,re);ue.tile=F,s.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const f=this.expirationTime;if(s.cacheControl){const d=u.aa(s.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(f)if(this.expirationTime<f)g=!0;else{const v=this.expirationTime-f;v?this.expirationTime=d+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!f.style.hasLayer(g))continue;const v=this.buckets[g],C=v.layers[0].sourceLayer||"_geojsonTileLayer",T=d[C],M=s[C];if(!T||!M||Object.keys(M).length===0)continue;v.update(M,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=f&&f.style&&f.style.getLayer(g);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<E.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=E.now()+s}setDependencies(s,f){const d={};for(const g of f)d[g]=!0;this.dependencies[s]=d}hasDependency(s,f){for(const d of s){const g=this.dependencies[d];if(g){for(const v of f)if(g[v])return!0}}return!1}}class Ki{constructor(s,f){this.max=s,this.onRemove=f,this.reset()}reset(){for(const s in this.data)for(const f of this.data[s])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(s,f,d){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:f,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},d)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const f=this.data[s].shift();return f.timeout&&clearTimeout(f.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),f.value}getByKey(s){const f=this.data[s];return f?f[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,f){if(!this.has(s))return this;const d=s.wrapped().key,g=f===void 0?0:this.data[d].indexOf(f),v=this.data[d][g];return this.data[d].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(s){const f=[];for(const d in this.data)for(const g of this.data[d])s(g.value)||f.push(g);for(const d of f)this.remove(d.value.tileID,d)}}class wl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,f,d){const g=String(f);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},u.e(this.stateChanges[s][g],d),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==g&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const v in this.state[s][g])d[v]||(this.deletedStates[s][g][v]=null)}else for(const v in d)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][v]===null&&delete this.deletedStates[s][g][v]}removeFeatureState(s,f,d){if(this.deletedStates[s]===null)return;const g=String(f);if(this.deletedStates[s]=this.deletedStates[s]||{},d&&f!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][d]=null);else if(f!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(d in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][d]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,f){const d=String(f),g=u.e({},(this.state[s]||{})[d],(this.stateChanges[s]||{})[d]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][f];if(v===null)return{};for(const C in v)delete g[C]}return g}initializeTileState(s,f){s.setFeatureState(this.state,f)}coalesceChanges(s,f){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const C in this.stateChanges[g])this.state[g][C]||(this.state[g][C]={}),u.e(this.state[g][C],this.stateChanges[g][C]),v[C]=this.state[g][C];d[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const C in this.state[g])v[C]={},this.state[g][C]={};else for(const C in this.deletedStates[g]){if(this.deletedStates[g][C]===null)this.state[g][C]={};else for(const T of Object.keys(this.deletedStates[g][C]))delete this.state[g][C][T];v[C]=this.state[g][C]}d[g]=d[g]||{},u.e(d[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in s)s[g].setFeatureState(d,f)}}class Kr extends u.E{constructor(s,f,d){super(),this.id=s,this.dispatcher=d,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,v,C,T)=>{const M=new(Va(v.type))(g,v,C,T);if(M.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${M.id}`);return M})(s,f,d,this),this._tiles={},this._cache=new Ki(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new wl,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const f=this._tiles[s];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,f,d){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,f,d)}catch(g){s.state="errored",g.status!==404?this._source.fire(new u.j(g,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new u.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const d=this._tiles[f];d.upload(s),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(ht).map(s=>s.key)}getRenderableIds(s){const f=[];for(const d in this._tiles)this._isIdRenderable(d,s)&&f.push(this._tiles[d]);return s?f.sort((d,g)=>{const v=d.tileID,C=g.tileID,T=new u.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),M=new u.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-C.overscaledZ||M.y-T.y||M.x-T.x}).map(d=>d.tileID.key):f.map(d=>d.tileID).sort(ht).map(d=>d.key)}hasRenderableParent(s){const f=this.findLoadedParent(s,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(s,f){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(f||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,f){return u._(this,void 0,void 0,function*(){const d=this._tiles[s];d&&(d.state!=="loading"&&(d.state=f),yield this._loadTile(d,s,f))})}_tileLoaded(s,f,d){s.timeAdded=E.now(),d==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(f,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const f=this.getRenderableIds();for(let g=0;g<f.length;g++){const v=f[g];if(s.neighboringTiles&&s.neighboringTiles[v]){const C=this.getTileByID(v);d(s,C),d(C,s)}}function d(g,v){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let C=v.tileID.canonical.x-g.tileID.canonical.x;const T=v.tileID.canonical.y-g.tileID.canonical.y,M=Math.pow(2,g.tileID.canonical.z),R=v.tileID.key;C===0&&T===0||Math.abs(T)>1||(Math.abs(C)>1&&(Math.abs(C+M)===1?C+=M:Math.abs(C-M)===1&&(C-=M)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,C,T),g.neighboringTiles&&g.neighboringTiles[R]&&(g.neighboringTiles[R].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,f,d,g){for(const v in this._tiles){let C=this._tiles[v];if(g[v]||!C.hasData()||C.tileID.overscaledZ<=f||C.tileID.overscaledZ>d)continue;let T=C.tileID;for(;C&&C.tileID.overscaledZ>f+1;){const R=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[R.key],C&&C.hasData()&&(T=R)}let M=T;for(;M.overscaledZ>f;)if(M=M.scaledTo(M.overscaledZ-1),s[M.key]){g[T.key]=T;break}}}findLoadedParent(s,f){if(s.key in this._loadedParentTiles){const d=this._loadedParentTiles[s.key];return d&&d.tileID.overscaledZ>=f?d:null}for(let d=s.overscaledZ-1;d>=f;d--){const g=s.scaledTo(d),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(s){const f=this._tiles[s.key];return f&&f.hasData()?f:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const f=Math.ceil(s.width/this._source.tileSize)+1,d=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(f*d*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(s){const f=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,f){const d={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+f),d[v.tileID.key]=v}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s,f){if(!this._sourceLoaded||this._paused)return;let d;this.transform=s,this.terrain=f,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new u.Q(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(d=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(d=d.filter(z=>this._source.hasTile(z)))):d=[];const g=s.coveringZoomLevel(this._source),v=Math.max(g-Kr.maxOverzooming,this._source.minzoom),C=Math.max(g+Kr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const F of d)if(F.canonical.z>this._source.minzoom){const X=F.scaledTo(F.canonical.z-1);z[X.key]=X;const ie=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));z[ie.key]=ie}d=d.concat(Object.values(z))}const T=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(d,g);if(tn(this._source.type)){const z={},F={},X=Object.keys(M),ie=E.now();for(const re of X){const ue=M[re],$=this._tiles[re];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=ie)continue;const ve=this.findLoadedParent(ue,v);ve&&(this._addTile(ve.tileID),z[ve.tileID.key]=ve.tileID),F[re]=ue}this._retainLoadedChildren(F,g,C,M);for(const re in z)M[re]||(this._coveredTiles[re]=!0,M[re]=z[re]);if(f){const re={},ue={};for(const $ of d)this._tiles[$.key].hasData()?re[$.key]=$:ue[$.key]=$;for(const $ in ue){const ve=ue[$].children(this._source.maxzoom);this._tiles[ve[0].key]&&this._tiles[ve[1].key]&&this._tiles[ve[2].key]&&this._tiles[ve[3].key]&&(re[ve[0].key]=M[ve[0].key]=ve[0],re[ve[1].key]=M[ve[1].key]=ve[1],re[ve[2].key]=M[ve[2].key]=ve[2],re[ve[3].key]=M[ve[3].key]=ve[3],delete ue[$])}for(const $ in ue){const ve=this.findLoadedParent(ue[$],this._source.minzoom);if(ve){re[ve.tileID.key]=M[ve.tileID.key]=ve.tileID;for(const Fe in re)re[Fe].isChildOf(ve.tileID)&&delete re[Fe]}}for(const $ in this._tiles)re[$]||(this._coveredTiles[$]=!0)}}for(const z in M)this._tiles[z].clearFadeHold();const R=u.ab(this._tiles,M);for(const z of R){const F=this._tiles[z];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,f){const d={},g={},v=Math.max(f-Kr.maxOverzooming,this._source.minzoom),C=Math.max(f+Kr.maxUnderzooming,this._source.minzoom),T={};for(const M of s){const R=this._addTile(M);d[M.key]=M,R.hasData()||f<this._source.maxzoom&&(T[M.key]=M)}this._retainLoadedChildren(T,f,C,d);for(const M of s){let R=this._tiles[M.key];if(R.hasData())continue;if(f+1>this._source.maxzoom){const F=M.children(this._source.maxzoom)[0],X=this.getTile(F);if(X&&X.hasData()){d[F.key]=F;continue}}else{const F=M.children(this._source.maxzoom);if(d[F[0].key]&&d[F[1].key]&&d[F[2].key]&&d[F[3].key])continue}let z=R.wasRequested();for(let F=M.overscaledZ-1;F>=v;--F){const X=M.scaledTo(F);if(g[X.key])break;if(g[X.key]=!0,R=this.getTile(X),!R&&z&&(R=this._addTile(X)),R){const ie=R.hasData();if((z||ie)&&(d[X.key]=X),z=R.wasRequested(),ie)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const f=[];let d,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}f.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;g=v}for(const v of f)this._loadedParentTiles[v]=d}}_addTile(s){let f=this._tiles[s.key];if(f)return f;f=this._cache.getAndRemove(s),f&&(this._setTileReloadTimer(s.key,f),f.tileID=s,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,f)));const d=f;return f||(f=new Ko(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(f,s.key,f.state)),f.uses++,this._tiles[s.key]=f,d||this._source.fire(new u.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(s,f){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const d=f.getExpiryTimeout();d&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},d))}_removeTile(s){const f=this._tiles[s];f&&(f.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(s){const f=s.sourceDataType;s.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,f,d){const g=[],v=this.transform;if(!v)return g;const C=d?v.getCameraQueryGeometry(s):s,T=s.map(re=>v.pointCoordinate(re,this.terrain)),M=C.map(re=>v.pointCoordinate(re,this.terrain)),R=this.getIds();let z=1/0,F=1/0,X=-1/0,ie=-1/0;for(const re of M)z=Math.min(z,re.x),F=Math.min(F,re.y),X=Math.max(X,re.x),ie=Math.max(ie,re.y);for(let re=0;re<R.length;re++){const ue=this._tiles[R[re]];if(ue.holdingForFade())continue;const $=ue.tileID,ve=Math.pow(2,v.zoom-ue.tileID.overscaledZ),Fe=f*ue.queryPadding*u.W/ue.tileSize/ve,he=[$.getTilePoint(new u.Y(z,F)),$.getTilePoint(new u.Y(X,ie))];if(he[0].x-Fe<u.W&&he[0].y-Fe<u.W&&he[1].x+Fe>=0&&he[1].y+Fe>=0){const Ie=T.map(Ge=>$.getTilePoint(Ge)),Be=M.map(Ge=>$.getTilePoint(Ge));g.push({tile:ue,tileID:$,queryGeometry:Ie,cameraQueryGeometry:Be,scale:ve})}}return g}getVisibleCoordinates(s){const f=this.getRenderableIds(s).map(d=>this._tiles[d].tileID);for(const d of f)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(tn(this._source.type)){const s=E.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=s)return!0}return!1}setFeatureState(s,f,d){this._state.updateState(s=s||"_geojsonTileLayer",f,d)}removeFeatureState(s,f,d){this._state.removeFeatureState(s=s||"_geojsonTileLayer",f,d)}getFeatureState(s,f){return this._state.getState(s=s||"_geojsonTileLayer",f)}setDependencies(s,f,d){const g=this._tiles[s];g&&g.setDependencies(f,d)}reloadTilesForDependencies(s,f){for(const d in this._tiles)this._tiles[d].hasDependency(s,f)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(s,f))}}function ht(_,s){const f=Math.abs(2*_.wrap)-+(_.wrap<0),d=Math.abs(2*s.wrap)-+(s.wrap<0);return _.overscaledZ-s.overscaledZ||d-f||s.canonical.y-_.canonical.y||s.canonical.x-_.canonical.x}function tn(_){return _==="raster"||_==="image"||_==="video"}Kr.maxOverzooming=10,Kr.maxUnderzooming=3;class $t{constructor(s,f){this.reset(s,f)}reset(s,f){this.points=s||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=u.ac(s,0,1);let f=1,d=this._distances[f];const g=s*this.paddedLength+this.padding;for(;d<g&&f<this._distances.length;)d=this._distances[++f];const v=f-1,C=this._distances[v],T=d-C,M=T>0?(g-C)/T:0;return this.points[v].mult(1-M).add(this.points[f].mult(M))}}function Rr(_,s){let f=!0;return _==="always"||_!=="never"&&s!=="never"||(f=!1),f}class Jo{constructor(s,f,d){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/d),this.yCellCount=Math.ceil(f/d);for(let C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=f,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,f,d,g,v){this._forEachCell(f,d,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(f),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(s,f,d,g){this._forEachCell(f-g,d-g,f+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(f),this.circles.push(d),this.circles.push(g)}_insertBoxCell(s,f,d,g,v,C){this.boxCells[v].push(C)}_insertCircleCell(s,f,d,g,v,C){this.circleCells[v].push(C)}_query(s,f,d,g,v,C,T){if(d<0||s>this.width||g<0||f>this.height)return[];const M=[];if(s<=0&&f<=0&&this.width<=d&&this.height<=g){if(v)return[{key:null,x1:s,y1:f,x2:d,y2:g}];for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],F=this.circles[3*R+1],X=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:z-X,y1:F-X,x2:z+X,y2:F+X})}}else this._forEachCell(s,f,d,g,this._queryCell,M,{hitTest:v,overlapMode:C,seenUids:{box:{},circle:{}}},T);return M}query(s,f,d,g){return this._query(s,f,d,g,!1,null)}hitTest(s,f,d,g,v,C){return this._query(s,f,d,g,!0,v,C).length>0}hitTestCircle(s,f,d,g,v){const C=s-d,T=s+d,M=f-d,R=f+d;if(T<0||C>this.width||R<0||M>this.height)return!1;const z=[];return this._forEachCell(C,M,T,R,this._queryCellCircle,z,{hitTest:!0,overlapMode:g,circle:{x:s,y:f,radius:d},seenUids:{box:{},circle:{}}},v),z.length>0}_queryCell(s,f,d,g,v,C,T,M){const{seenUids:R,hitTest:z,overlapMode:F}=T,X=this.boxCells[v];if(X!==null){const re=this.bboxes;for(const ue of X)if(!R.box[ue]){R.box[ue]=!0;const $=4*ue,ve=this.boxKeys[ue];if(s<=re[$+2]&&f<=re[$+3]&&d>=re[$+0]&&g>=re[$+1]&&(!M||M(ve))&&(!z||!Rr(F,ve.overlapMode))&&(C.push({key:ve,x1:re[$],y1:re[$+1],x2:re[$+2],y2:re[$+3]}),z))return!0}}const ie=this.circleCells[v];if(ie!==null){const re=this.circles;for(const ue of ie)if(!R.circle[ue]){R.circle[ue]=!0;const $=3*ue,ve=this.circleKeys[ue];if(this._circleAndRectCollide(re[$],re[$+1],re[$+2],s,f,d,g)&&(!M||M(ve))&&(!z||!Rr(F,ve.overlapMode))){const Fe=re[$],he=re[$+1],Ie=re[$+2];if(C.push({key:ve,x1:Fe-Ie,y1:he-Ie,x2:Fe+Ie,y2:he+Ie}),z)return!0}}}return!1}_queryCellCircle(s,f,d,g,v,C,T,M){const{circle:R,seenUids:z,overlapMode:F}=T,X=this.boxCells[v];if(X!==null){const re=this.bboxes;for(const ue of X)if(!z.box[ue]){z.box[ue]=!0;const $=4*ue,ve=this.boxKeys[ue];if(this._circleAndRectCollide(R.x,R.y,R.radius,re[$+0],re[$+1],re[$+2],re[$+3])&&(!M||M(ve))&&!Rr(F,ve.overlapMode))return C.push(!0),!0}}const ie=this.circleCells[v];if(ie!==null){const re=this.circles;for(const ue of ie)if(!z.circle[ue]){z.circle[ue]=!0;const $=3*ue,ve=this.circleKeys[ue];if(this._circlesCollide(re[$],re[$+1],re[$+2],R.x,R.y,R.radius)&&(!M||M(ve))&&!Rr(F,ve.overlapMode))return C.push(!0),!0}}}_forEachCell(s,f,d,g,v,C,T,M){const R=this._convertToXCellCoord(s),z=this._convertToYCellCoord(f),F=this._convertToXCellCoord(d),X=this._convertToYCellCoord(g);for(let ie=R;ie<=F;ie++)for(let re=z;re<=X;re++)if(v.call(this,s,f,d,g,this.xCellCount*re+ie,C,T,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,f,d,g,v,C){const T=g-s,M=v-f,R=d+C;return R*R>T*T+M*M}_circleAndRectCollide(s,f,d,g,v,C,T){const M=(C-g)/2,R=Math.abs(s-(g+M));if(R>M+d)return!1;const z=(T-v)/2,F=Math.abs(f-(v+z));if(F>z+d)return!1;if(R<=M||F<=z)return!0;const X=R-M,ie=F-z;return X*X+ie*ie<=d*d}}function Kt(_,s,f,d,g){const v=u.F();return s?(u.J(v,v,[1/g,1/g,1]),f||u.ad(v,v,d.angle)):u.K(v,d.labelPlaneMatrix,_),v}function ga(_,s,f,d,g){if(s){const v=u.ae(_);return u.J(v,v,[g,g,1]),f||u.ad(v,v,-d.angle),v}return d.glCoordMatrix}function Vr(_,s,f){let d;f?(d=[_.x,_.y,f(_.x,_.y),1],u.af(d,d,s)):(d=[_.x,_.y,0,1],Tt(d,d,s));const g=d[3];return{point:new u.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function le(_,s){return .5+_/s*.5}function B(_,s){const f=_[0]/_[3],d=_[1]/_[3];return f>=-s[0]&&f<=s[0]&&d>=-s[1]&&d<=s[1]}function q(_,s,f,d,g,v,C,T,M,R){const z=d?_.textSizeData:_.iconSizeData,F=u.ag(z,f.transform.zoom),X=[256/f.width*2+1,256/f.height*2+1],ie=d?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ie.clear();const re=_.lineVertexArray,ue=d?_.text.placedSymbolArray:_.icon.placedSymbolArray,$=f.transform.width/f.transform.height;let ve=!1;for(let Fe=0;Fe<ue.length;Fe++){const he=ue.get(Fe);if(he.hidden||he.writingMode===u.ah.vertical&&!ve){Xe(he.numGlyphs,ie);continue}let Ie;if(ve=!1,R?(Ie=[he.anchorX,he.anchorY,R(he.anchorX,he.anchorY),1],u.af(Ie,Ie,s)):(Ie=[he.anchorX,he.anchorY,0,1],Tt(Ie,Ie,s)),!B(Ie,X)){Xe(he.numGlyphs,ie);continue}const Be=le(f.transform.cameraToCenterDistance,Ie[3]),Ge=u.ai(z,F,he),He=C?Ge/Be:Ge*Be,et=new u.P(he.anchorX,he.anchorY),$e=Vr(et,g,R).point,ut={projections:{},offsets:{}},ft=xe(he,He,!1,T,s,g,v,_.glyphOffsetArray,re,ie,$e,et,ut,$,M,R);ve=ft.useVertical,(ft.notEnoughRoom||ve||ft.needsFlipping&&xe(he,He,!0,T,s,g,v,_.glyphOffsetArray,re,ie,$e,et,ut,$,M,R).notEnoughRoom)&&Xe(he.numGlyphs,ie)}d?_.text.dynamicLayoutVertexBuffer.updateData(ie):_.icon.dynamicLayoutVertexBuffer.updateData(ie)}function J(_,s,f,d,g,v,C,T,M,R,z,F,X){const ie=T.glyphStartIndex+T.numGlyphs,re=T.lineStartIndex,ue=T.lineStartIndex+T.lineLength,$=s.getoffsetX(T.glyphStartIndex),ve=s.getoffsetX(ie-1),Fe=Ue(_*$,f,d,g,v,C,T.segment,re,ue,M,R,z,F,X);if(!Fe)return null;const he=Ue(_*ve,f,d,g,v,C,T.segment,re,ue,M,R,z,F,X);return he?{first:Fe,last:he}:null}function ne(_,s,f,d){return _===u.ah.horizontal&&Math.abs(f.y-s.y)>Math.abs(f.x-s.x)*d?{useVertical:!0}:(_===u.ah.vertical?s.y<f.y:s.x>f.x)?{needsFlipping:!0}:null}function xe(_,s,f,d,g,v,C,T,M,R,z,F,X,ie,re,ue){const $=s/24,ve=_.lineOffsetX*$,Fe=_.lineOffsetY*$;let he;if(_.numGlyphs>1){const Ie=_.glyphStartIndex+_.numGlyphs,Be=_.lineStartIndex,Ge=_.lineStartIndex+_.lineLength,He=J($,T,ve,Fe,f,z,F,_,M,v,X,re,ue);if(!He)return{notEnoughRoom:!0};const et=Vr(He.first.point,C,ue).point,$e=Vr(He.last.point,C,ue).point;if(d&&!f){const ut=ne(_.writingMode,et,$e,ie);if(ut)return ut}he=[He.first];for(let ut=_.glyphStartIndex+1;ut<Ie-1;ut++)he.push(Ue($*T.getoffsetX(ut),ve,Fe,f,z,F,_.segment,Be,Ge,M,v,X,re,ue));he.push(He.last)}else{if(d&&!f){const Be=Vr(F,g,ue).point,Ge=_.lineStartIndex+_.segment+1,He=new u.P(M.getx(Ge),M.gety(Ge)),et=Vr(He,g,ue),$e=et.signedDistanceFromCamera>0?et.point:Q(F,He,Be,1,g,ue),ut=ne(_.writingMode,Be,$e,ie);if(ut)return ut}const Ie=Ue($*T.getoffsetX(_.glyphStartIndex),ve,Fe,f,z,F,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,M,v,X,re,ue);if(!Ie)return{notEnoughRoom:!0};he=[Ie]}for(const Ie of he)u.aj(R,Ie.point,Ie.angle);return{}}function Q(_,s,f,d,g,v){const C=Vr(_.add(_.sub(s)._unit()),g,v).point,T=f.sub(C);return f.add(T._mult(d/T.mag()))}function we(_,s){const{projectionCache:f,lineVertexArray:d,labelPlaneMatrix:g,tileAnchorPoint:v,distanceFromAnchor:C,getElevation:T,previousVertex:M,direction:R,absOffsetX:z}=s;if(f.projections[_])return f.projections[_];const F=new u.P(d.getx(_),d.gety(_)),X=Vr(F,g,T);if(X.signedDistanceFromCamera>0)return f.projections[_]=X.point,X.point;const ie=_-R;return Q(C===0?v:new u.P(d.getx(ie),d.gety(ie)),F,M,z-C+1,g,T)}function de(_,s,f){return _._unit()._perp()._mult(s*f)}function Ae(_,s,f,d,g,v,C,T){const{projectionCache:M,direction:R}=T;if(M.offsets[_])return M.offsets[_];const z=f.add(s);if(_+R<d||_+R>=g)return M.offsets[_]=z,z;const F=we(_+R,T),X=de(F.sub(f),C,R),ie=f.add(X),re=F.add(X);return M.offsets[_]=u.ak(v,z,ie,re)||z,M.offsets[_]}function Ue(_,s,f,d,g,v,C,T,M,R,z,F,X,ie){const re=d?_-s:_+s;let ue=re>0?1:-1,$=0;d&&(ue*=-1,$=Math.PI),ue<0&&($+=Math.PI);let ve,Fe,he=ue>0?T+C:T+C+1,Ie=g,Be=g,Ge=0,He=0;const et=Math.abs(re),$e=[];let ut;for(;Ge+He<=et;){if(he+=ue,he<T||he>=M)return null;Ge+=He,Be=Ie,Fe=ve;const pt={projectionCache:F,lineVertexArray:R,labelPlaneMatrix:z,tileAnchorPoint:v,distanceFromAnchor:Ge,getElevation:ie,previousVertex:Be,direction:ue,absOffsetX:et};if(Ie=we(he,pt),f===0)$e.push(Be),ut=Ie.sub(Be);else{let Bt;const rn=Ie.sub(Be);Bt=rn.mag()===0?de(we(he+ue,pt).sub(Ie),f,ue):de(rn,f,ue),Fe||(Fe=Be.add(Bt)),ve=Ae(he,Bt,Ie,T,M,Fe,f,pt),$e.push(Fe),ut=ve.sub(Fe)}He=ut.mag()}const ft=ut._mult((et-Ge)/He)._add(Fe||Be),nn=$+Math.atan2(Ie.y-Be.y,Ie.x-Be.x);return $e.push(ft),{point:ft,angle:X?nn:0,path:$e}}const We=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xe(_,s){for(let f=0;f<_;f++){const d=s.length;s.resize(d+4),s.float32.set(We,3*d)}}function Tt(_,s,f){const d=s[0],g=s[1];return _[0]=f[0]*d+f[4]*g+f[12],_[1]=f[1]*d+f[5]*g+f[13],_[3]=f[3]*d+f[7]*g+f[15],_}const Dt=100;class Ht{constructor(s,f=new Jo(s.width+200,s.height+200,25),d=new Jo(s.width+200,s.height+200,25)){this.transform=s,this.grid=f,this.ignoredGrid=d,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Dt,this.screenBottomBoundary=s.height+Dt,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,f,d,g,v,C){const T=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY,C),M=d*T.perspectiveRatio,R=s.x1*M+T.point.x,z=s.y1*M+T.point.y,F=s.x2*M+T.point.x,X=s.y2*M+T.point.y;return!this.isInsideGrid(R,z,F,X)||f!=="always"&&this.grid.hitTest(R,z,F,X,f,v)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[R,z,F,X],offscreen:this.isOffscreen(R,z,F,X)}}placeCollisionCircles(s,f,d,g,v,C,T,M,R,z,F,X,ie,re){const ue=[],$=new u.P(f.anchorX,f.anchorY),ve=Vr($,C,re),Fe=le(this.transform.cameraToCenterDistance,ve.signedDistanceFromCamera),he=(z?v/Fe:v*Fe)/u.ao,Ie=Vr($,T,re).point,Be=J(he,g,f.lineOffsetX*he,f.lineOffsetY*he,!1,Ie,$,f,d,T,{projections:{},offsets:{}},!1,re);let Ge=!1,He=!1,et=!0;if(Be){const $e=.5*X*Fe+ie,ut=new u.P(-100,-100),ft=new u.P(this.screenRightBoundary,this.screenBottomBoundary),nn=new $t,pt=Be.first,Bt=Be.last;let rn=[];for(let an=pt.path.length-1;an>=1;an--)rn.push(pt.path[an]);for(let an=1;an<Bt.path.length;an++)rn.push(Bt.path[an]);const Sn=2.5*$e;if(M){const an=rn.map(fn=>Vr(fn,M,re));rn=an.some(fn=>fn.signedDistanceFromCamera<=0)?[]:an.map(fn=>fn.point)}let jt=[];if(rn.length>0){const an=rn[0].clone(),fn=rn[0].clone();for(let Tr=1;Tr<rn.length;Tr++)an.x=Math.min(an.x,rn[Tr].x),an.y=Math.min(an.y,rn[Tr].y),fn.x=Math.max(fn.x,rn[Tr].x),fn.y=Math.max(fn.y,rn[Tr].y);jt=an.x>=ut.x&&fn.x<=ft.x&&an.y>=ut.y&&fn.y<=ft.y?[rn]:fn.x<ut.x||an.x>ft.x||fn.y<ut.y||an.y>ft.y?[]:u.al([rn],ut.x,ut.y,ft.x,ft.y)}for(const an of jt){nn.reset(an,.25*$e);let fn=0;fn=nn.length<=.5*$e?1:Math.ceil(nn.paddedLength/Sn)+1;for(let Tr=0;Tr<fn;Tr++){const Gn=Tr/Math.max(fn-1,1),Ro=nn.lerp(Gn),li=Ro.x+Dt,gr=Ro.y+Dt;ue.push(li,gr,$e,0);const ui=li-$e,No=gr-$e,Gs=li+$e,Za=gr+$e;if(et=et&&this.isOffscreen(ui,No,Gs,Za),He=He||this.isInsideGrid(ui,No,Gs,Za),s!=="always"&&this.grid.hitTestCircle(li,gr,$e,s,F)&&(Ge=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ge}}}}return{circles:!R&&Ge||!He||Fe<this.perspectiveRatioCutoff?[]:ue,offscreen:et,collisionDetected:Ge}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let d=1/0,g=1/0,v=-1/0,C=-1/0;for(const z of s){const F=new u.P(z.x+Dt,z.y+Dt);d=Math.min(d,F.x),g=Math.min(g,F.y),v=Math.max(v,F.x),C=Math.max(C,F.y),f.push(F)}const T=this.grid.query(d,g,v,C).concat(this.ignoredGrid.query(d,g,v,C)),M={},R={};for(const z of T){const F=z.key;if(M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]={}),M[F.bucketInstanceId][F.featureIndex])continue;const X=[new u.P(z.x1,z.y1),new u.P(z.x2,z.y1),new u.P(z.x2,z.y2),new u.P(z.x1,z.y2)];u.am(f,X)&&(M[F.bucketInstanceId][F.featureIndex]=!0,R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(s,f,d,g,v,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:C,overlapMode:f},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,f,d,g,v,C){const T=d?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:v,collisionGroupID:C,overlapMode:f};for(let R=0;R<s.length;R+=4)T.insertCircle(M,s[R],s[R+1],s[R+2])}projectAndGetPerspectiveRatio(s,f,d,g){let v;return g?(v=[f,d,g(f,d),1],u.af(v,v,s)):(v=[f,d,0,1],Tt(v,v,s)),{point:new u.P((v[0]/v[3]+1)/2*this.transform.width+Dt,(-v[1]/v[3]+1)/2*this.transform.height+Dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(s,f,d,g){return d<Dt||s>=this.screenRightBoundary||g<Dt||f>this.screenBottomBoundary}isInsideGrid(s,f,d,g){return d>=0&&s<this.gridRightBoundary&&g>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const s=u.an([]);return u.H(s,s,[-100,-100,0]),s}}function Zt(_,s,f){return s*(u.W/(_.tileSize*Math.pow(2,f-_.tileID.overscaledZ)))}class xn{constructor(s,f,d,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?f:-f))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Xn{constructor(s,f,d,g,v){this.text=new xn(s?s.text:null,f,d,v),this.icon=new xn(s?s.icon:null,f,g,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class lr{constructor(s,f,d){this.text=s,this.icon=f,this.skipFade=d}}class Jr{constructor(){this.invProjMatrix=u.F(),this.viewportMatrix=u.F(),this.circles=[]}}class sn{constructor(s,f,d,g,v){this.bucketInstanceId=s,this.featureIndex=f,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=v}}class Er{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const f=++this.maxGroupID;this.collisionGroups[s]={ID:f,predicate:d=>d.collisionGroupID===f}}return this.collisionGroups[s]}}function ai(_,s,f,d,g){const{horizontalAlign:v,verticalAlign:C}=u.at(_);return new u.P(-(v-.5)*s+d[0]*g,-(C-.5)*f+d[1]*g)}function Ji(_,s,f,d,g,v){const{x1:C,x2:T,y1:M,y2:R,anchorPointX:z,anchorPointY:F}=_,X=new u.P(s,f);return d&&X._rotate(g?v:-v),{x1:C+X.x,y1:M+X.y,x2:T+X.x,y2:R+X.y,anchorPointX:z,anchorPointY:F}}class fo{constructor(s,f,d,g,v){this.transform=s.clone(),this.terrain=f,this.collisionIndex=new Ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Er(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,f,d,g){const v=d.getBucket(f),C=d.latestFeatureIndex;if(!v||!C||f.id!==v.layerIds[0])return;const T=d.collisionBoxArray,M=v.layers[0].layout,R=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/u.W,F=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),X=M.get("text-pitch-alignment")==="map",ie=M.get("text-rotation-alignment")==="map",re=Zt(d,1,this.transform.zoom),ue=Kt(F,X,ie,this.transform,re);let $=null;if(X){const Fe=ga(F,X,ie,this.transform,re);$=u.K([],this.transform.labelPlaneMatrix,Fe)}this.retainedQueryData[v.bucketInstanceId]=new sn(v.bucketInstanceId,C,v.sourceLayerIndex,v.index,d.tileID);const ve={bucket:v,layout:M,posMatrix:F,textLabelPlaneMatrix:ue,labelToScreenMatrix:$,scale:R,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:u.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const Fe of v.sortKeyRanges){const{sortKey:he,symbolInstanceStart:Ie,symbolInstanceEnd:Be}=Fe;s.push({sortKey:he,symbolInstanceStart:Ie,symbolInstanceEnd:Be,parameters:ve})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(s,f,d,g,v,C,T,M,R,z,F,X,ie,re,ue,$){const ve=u.ap[s.textAnchor],Fe=[s.textOffset0,s.textOffset1],he=ai(ve,d,g,Fe,v),Ie=this.collisionIndex.placeCollisionBox(Ji(f,he.x,he.y,C,T,this.transform.angle),F,M,R,z.predicate,$);if((!ue||this.collisionIndex.placeCollisionBox(Ji(ue,he.x,he.y,C,T,this.transform.angle),F,M,R,z.predicate,$).box.length!==0)&&Ie.box.length>0){let Be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Be=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:Fe,width:d,height:g,anchor:ve,textBoxScale:v,prevAnchor:Be},this.markUsedJustification(ie,ve,X,re),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,re,X),this.placedOrientations[X.crossTileID]=re),{shift:he,placedGlyphBoxes:Ie}}}placeLayerBucketPart(s,f,d){const{bucket:g,layout:v,posMatrix:C,textLabelPlaneMatrix:T,labelToScreenMatrix:M,textPixelRatio:R,holdingForFade:z,collisionBoxArray:F,partiallyEvaluatedTextSize:X,collisionGroup:ie}=s.parameters,re=v.get("text-optional"),ue=v.get("icon-optional"),$=u.aq(v,"text-overlap","text-allow-overlap"),ve=$==="always",Fe=u.aq(v,"icon-overlap","icon-allow-overlap"),he=Fe==="always",Ie=v.get("text-rotation-alignment")==="map",Be=v.get("text-pitch-alignment")==="map",Ge=v.get("icon-text-fit")!=="none",He=v.get("symbol-z-order")==="viewport-y",et=ve&&(he||!g.hasIconData()||ue),$e=he&&(ve||!g.hasTextData()||re);!g.collisionArrays&&F&&g.deserializeCollisionBoxes(F);const ut=this.retainedQueryData[g.bucketInstanceId].tileID,ft=this.terrain?(pt,Bt)=>this.terrain.getElevation(ut,pt,Bt):null,nn=(pt,Bt)=>{var rn,Sn;if(f[pt.crossTileID])return;if(z)return void(this.placements[pt.crossTileID]=new lr(!1,!1,!1));let jt=!1,an=!1,fn=!0,Tr=null,Gn={box:null,offscreen:null},Ro={box:null,offscreen:null},li=null,gr=null,ui=null,No=0,Gs=0,Za=0;Bt.textFeatureIndex?No=Bt.textFeatureIndex:pt.useRuntimeCollisionCircles&&(No=pt.featureIndex),Bt.verticalTextFeatureIndex&&(Gs=Bt.verticalTextFeatureIndex);const yc=Bt.textBox;if(yc){const $r=ei=>{let _r=u.ah.horizontal;if(g.allowVerticalPlacement&&!ei&&this.prevPlacement){const ts=this.prevPlacement.placedOrientations[pt.crossTileID];ts&&(this.placedOrientations[pt.crossTileID]=ts,_r=ts,this.markUsedOrientation(g,_r,pt))}return _r},yr=(ei,_r)=>{if(g.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const ts of g.writingModes)if(ts===u.ah.vertical?(Gn=_r(),Ro=Gn):Gn=ei(),Gn&&Gn.box&&Gn.box.length)break}else Gn=ei()},cr=pt.textAnchorOffsetStartIndex,es=pt.textAnchorOffsetEndIndex;if(es===cr){const ei=(_r,ts)=>{const ti=this.collisionIndex.placeCollisionBox(_r,$,R,C,ie.predicate,ft);return ti&&ti.box&&ti.box.length&&(this.markUsedOrientation(g,ts,pt),this.placedOrientations[pt.crossTileID]=ts),ti};yr(()=>ei(yc,u.ah.horizontal),()=>{const _r=Bt.verticalTextBox;return g.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&_r?ei(_r,u.ah.vertical):{box:null,offscreen:null}}),$r(Gn&&Gn.box&&Gn.box.length)}else{let ei=u.ap[(Sn=(rn=this.prevPlacement)===null||rn===void 0?void 0:rn.variableOffsets[pt.crossTileID])===null||Sn===void 0?void 0:Sn.anchor];const _r=(ti,Nr,Pp)=>{const Fm=ti.x2-ti.x1,Al=ti.y2-ti.y1,kl=pt.textBoxScale,Oh=Ge&&Fe==="never"?Nr:null;let Ya={box:[],offscreen:!1},Mp=$==="never"?1:2,Bm="never";ei&&Mp++;for(let Ap=0;Ap<Mp;Ap++){for(let kp=cr;kp<es;kp++){const zh=g.textAnchorOffsets.get(kp);if(ei&&zh.textAnchor!==ei)continue;const Dp=this.attemptAnchorPlacement(zh,ti,Fm,Al,kl,Ie,Be,R,C,ie,Bm,pt,g,Pp,Oh,ft);if(Dp&&(Ya=Dp.placedGlyphBoxes,Ya&&Ya.box&&Ya.box.length))return jt=!0,Tr=Dp.shift,Ya}ei?ei=null:Bm=$}return Ya};yr(()=>_r(yc,Bt.iconBox,u.ah.horizontal),()=>{const ti=Bt.verticalTextBox;return g.allowVerticalPlacement&&!(Gn&&Gn.box&&Gn.box.length)&&pt.numVerticalGlyphVertices>0&&ti?_r(ti,Bt.verticalIconBox,u.ah.vertical):{box:null,offscreen:null}}),Gn&&(jt=Gn.box,fn=Gn.offscreen);const ts=$r(Gn&&Gn.box);if(!jt&&this.prevPlacement){const ti=this.prevPlacement.variableOffsets[pt.crossTileID];ti&&(this.variableOffsets[pt.crossTileID]=ti,this.markUsedJustification(g,ti.anchor,pt,ts))}}}if(li=Gn,jt=li&&li.box&&li.box.length>0,fn=li&&li.offscreen,pt.useRuntimeCollisionCircles){const $r=g.text.placedSymbolArray.get(pt.centerJustifiedTextSymbolIndex),yr=u.ai(g.textSizeData,X,$r),cr=v.get("text-padding");gr=this.collisionIndex.placeCollisionCircles($,$r,g.lineVertexArray,g.glyphOffsetArray,yr,C,T,M,d,Be,ie.predicate,pt.collisionCircleDiameter,cr,ft),gr.circles.length&&gr.collisionDetected&&!d&&u.w("Collisions detected, but collision boxes are not shown"),jt=ve||gr.circles.length>0&&!gr.collisionDetected,fn=fn&&gr.offscreen}if(Bt.iconFeatureIndex&&(Za=Bt.iconFeatureIndex),Bt.iconBox){const $r=yr=>{const cr=Ge&&Tr?Ji(yr,Tr.x,Tr.y,Ie,Be,this.transform.angle):yr;return this.collisionIndex.placeCollisionBox(cr,Fe,R,C,ie.predicate,ft)};Ro&&Ro.box&&Ro.box.length&&Bt.verticalIconBox?(ui=$r(Bt.verticalIconBox),an=ui.box.length>0):(ui=$r(Bt.iconBox),an=ui.box.length>0),fn=fn&&ui.offscreen}const Xa=re||pt.numHorizontalGlyphVertices===0&&pt.numVerticalGlyphVertices===0,qs=ue||pt.numIconVertices===0;if(Xa||qs?qs?Xa||(an=an&&jt):jt=an&&jt:an=jt=an&&jt,jt&&li&&li.box&&this.collisionIndex.insertCollisionBox(li.box,$,v.get("text-ignore-placement"),g.bucketInstanceId,Ro&&Ro.box&&Gs?Gs:No,ie.ID),an&&ui&&this.collisionIndex.insertCollisionBox(ui.box,Fe,v.get("icon-ignore-placement"),g.bucketInstanceId,Za,ie.ID),gr&&(jt&&this.collisionIndex.insertCollisionCircles(gr.circles,$,v.get("text-ignore-placement"),g.bucketInstanceId,No,ie.ID),d)){const $r=g.bucketInstanceId;let yr=this.collisionCircleArrays[$r];yr===void 0&&(yr=this.collisionCircleArrays[$r]=new Jr);for(let cr=0;cr<gr.circles.length;cr+=4)yr.circles.push(gr.circles[cr+0]),yr.circles.push(gr.circles[cr+1]),yr.circles.push(gr.circles[cr+2]),yr.circles.push(gr.collisionDetected?1:0)}if(pt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[pt.crossTileID]=new lr(jt||et,an||$e,fn||g.justReloaded),f[pt.crossTileID]=!0};if(He){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const pt=g.getSortedSymbolIndexes(this.transform.angle);for(let Bt=pt.length-1;Bt>=0;--Bt){const rn=pt[Bt];nn(g.symbolInstances.get(rn),g.collisionArrays[rn])}}else for(let pt=s.symbolInstanceStart;pt<s.symbolInstanceEnd;pt++)nn(g.symbolInstances.get(pt),g.collisionArrays[pt]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const pt=this.collisionCircleArrays[g.bucketInstanceId];u.ar(pt.invProjMatrix,C),pt.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,f,d,g){let v;v=g===u.ah.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[u.as(f)];const C=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const T of C)T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=v>=0&&T!==v?0:d.crossTileID)}markUsedOrientation(s,f,d){const g=f===u.ah.horizontal||f===u.ah.horizontalOnly?f:0,v=f===u.ah.vertical?f:0,C=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const T of C)s.text.placedSymbolArray.get(T).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let d=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const g=f?f.symbolFadeChange(s):1,v=f?f.opacities:{},C=f?f.variableOffsets:{},T=f?f.placedOrientations:{};for(const M in this.placements){const R=this.placements[M],z=v[M];z?(this.opacities[M]=new Xn(z,g,R.text,R.icon),d=d||R.text!==z.text.placed||R.icon!==z.icon.placed):(this.opacities[M]=new Xn(null,g,R.text,R.icon,R.skipFade),d=d||R.text||R.icon)}for(const M in v){const R=v[M];if(!this.opacities[M]){const z=new Xn(R,g,!1,!1);z.isHidden()||(this.opacities[M]=z,d=d||R.text.placed||R.icon.placed)}}for(const M in C)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=C[M]);for(const M in T)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=T[M]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:s)}updateLayerOpacities(s,f){const d={};for(const g of f){const v=g.getBucket(s);v&&g.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,d,g.collisionBoxArray)}}updateBucketOpacities(s,f,d){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0],v=g.layout,C=new Xn(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),M=v.get("icon-allow-overlap"),R=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",X=v.get("icon-text-fit")!=="none",ie=new Xn(null,0,T&&(M||!s.hasIconData()||v.get("icon-optional")),M&&(T||!s.hasTextData()||v.get("text-optional")),!0);!s.collisionArrays&&d&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(d);const re=(ue,$,ve)=>{for(let Fe=0;Fe<$/4;Fe++)ue.opacityVertexArray.emplaceBack(ve);ue.hasVisibleVertices=ue.hasVisibleVertices||ve!==Yu};for(let ue=0;ue<s.symbolInstances.length;ue++){const $=s.symbolInstances.get(ue),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:Fe,crossTileID:he}=$;let Ie=this.opacities[he];f[he]?Ie=C:Ie||(Ie=ie,this.opacities[he]=Ie),f[he]=!0;const Be=$.numIconVertices>0,Ge=this.placedOrientations[$.crossTileID],He=Ge===u.ah.vertical,et=Ge===u.ah.horizontal||Ge===u.ah.horizontalOnly;if(ve>0||Fe>0){const $e=po(Ie.text);re(s.text,ve,He?Yu:$e),re(s.text,Fe,et?Yu:$e);const ut=Ie.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(pt=>{pt>=0&&(s.text.placedSymbolArray.get(pt).hidden=ut||He?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=ut||et?1:0);const ft=this.variableOffsets[$.crossTileID];ft&&this.markUsedJustification(s,ft.anchor,$,Ge);const nn=this.placedOrientations[$.crossTileID];nn&&(this.markUsedJustification(s,"left",$,nn),this.markUsedOrientation(s,nn,$))}if(Be){const $e=po(Ie.icon),ut=!(X&&$.verticalPlacedIconSymbolIndex&&He);$.placedIconSymbolIndex>=0&&(re(s.icon,$.numIconVertices,ut?$e:Yu),s.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=Ie.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(re(s.icon,$.numVerticalIconVertices,ut?Yu:$e),s.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=Ie.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const $e=s.collisionArrays[ue];if($e){let ut=new u.P(0,0);if($e.textBox||$e.verticalTextBox){let nn=!0;if(R){const pt=this.variableOffsets[he];pt?(ut=ai(pt.anchor,pt.width,pt.height,pt.textOffset,pt.textBoxScale),z&&ut._rotate(F?this.transform.angle:-this.transform.angle)):nn=!1}$e.textBox&&bi(s.textCollisionBox.collisionVertexArray,Ie.text.placed,!nn||He,ut.x,ut.y),$e.verticalTextBox&&bi(s.textCollisionBox.collisionVertexArray,Ie.text.placed,!nn||et,ut.x,ut.y)}const ft=!!(!et&&$e.verticalIconBox);$e.iconBox&&bi(s.iconCollisionBox.collisionVertexArray,Ie.icon.placed,ft,X?ut.x:0,X?ut.y:0),$e.verticalIconBox&&bi(s.iconCollisionBox.collisionVertexArray,Ie.icon.placed,!ft,X?ut.x:0,X?ut.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ue.invProjMatrix,s.placementViewportMatrix=ue.viewportMatrix,s.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,f){const d=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*d>s}setStale(){this.stale=!0}}function bi(_,s,f,d,g){_.emplaceBack(s?1:0,f?1:0,d||0,g||0),_.emplaceBack(s?1:0,f?1:0,d||0,g||0),_.emplaceBack(s?1:0,f?1:0,d||0,g||0),_.emplaceBack(s?1:0,f?1:0,d||0,g||0)}const zs=Math.pow(2,25),tm=Math.pow(2,24),Gy=Math.pow(2,17),Vn=Math.pow(2,16),Jf=Math.pow(2,9),Qf=Math.pow(2,8),Ao=Math.pow(2,1);function po(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const s=_.placed?1:0,f=Math.floor(127*_.opacity);return f*zs+s*tm+f*Gy+s*Vn+f*Jf+s*Qf+f*Ao+s}const Yu=0;class Qo{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,f,d,g,v){const C=this._bucketParts;for(;this._currentTileIndex<s.length;)if(f.getBucketParts(C,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((T,M)=>T.sortKey-M.sortKey));this._currentPartIndex<C.length;)if(f.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,v())return!0;return!1}}class $o{constructor(s,f,d,g,v,C,T,M){this.placement=new fo(s,f,C,T,M),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,f,d){const g=E.now(),v=()=>!this._forceFullPlacement&&E.now()-g>2;for(;this._currentPlacementIndex>=0;){const C=f[s[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=T)&&(!C.maxzoom||C.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Qo(C)),this._inProgressLayer.continuePlacement(d[C.source],this.placement,this._showCollisionBoxes,C,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const iu=512/u.W/2;class Jc{constructor(s,f,d){this.tileID=s,this.bucketInstanceId=d,this._symbolsByKey={};const g=new Map;for(let v=0;v<f.length;v++){const C=f.get(v),T=C.key,M=g.get(T);M?M.push(C):g.set(T,[C])}for(const[v,C]of g){const T={positions:C.map(M=>({x:Math.floor(M.anchorX*iu),y:Math.floor(M.anchorY*iu)})),crossTileIDs:C.map(M=>M.crossTileID)};if(T.positions.length>128){const M=new u.au(T.positions.length,16,Uint16Array);for(const{x:R,y:z}of T.positions)M.add(R,z);M.finish(),delete T.positions,T.index=M}this._symbolsByKey[v]=T}}getScaledCoordinates(s,f){const{x:d,y:g,z:v}=this.tileID.canonical,{x:C,y:T,z:M}=f.canonical,R=iu/Math.pow(2,M-v),z=(T*u.W+s.anchorY)*R,F=g*u.W*iu;return{x:Math.floor((C*u.W+s.anchorX)*R-d*u.W*iu),y:Math.floor(z-F)}}findMatches(s,f,d){const g=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let v=0;v<s.length;v++){const C=s.get(v);if(C.crossTileID)continue;const T=this._symbolsByKey[C.key];if(!T)continue;const M=this.getScaledCoordinates(C,f);if(T.index){const R=T.index.range(M.x-g,M.y-g,M.x+g,M.y+g).sort();for(const z of R){const F=T.crossTileIDs[z];if(!d[F]){d[F]=!0,C.crossTileID=F;break}}}else if(T.positions)for(let R=0;R<T.positions.length;R++){const z=T.positions[R],F=T.crossTileIDs[R];if(Math.abs(z.x-M.x)<=g&&Math.abs(z.y-M.y)<=g&&!d[F]){d[F]=!0,C.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Qr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ku{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const f=Math.round((s-this.lng)/360);if(f!==0)for(const d in this.indexes){const g=this.indexes[d],v={};for(const C in g){const T=g[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),v[T.tileID.key]=T}this.indexes[d]=v}this.lng=s}addBucket(s,f,d){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<f.symbolInstances.length;v++)f.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const C=this.indexes[v];if(Number(v)>s.overscaledZ)for(const T in C){const M=C[T];M.tileID.isChildOf(s)&&M.findMatches(f.symbolInstances,s,g)}else{const T=C[s.scaledTo(Number(v)).key];T&&T.findMatches(f.symbolInstances,s,g)}}for(let v=0;v<f.symbolInstances.length;v++){const C=f.symbolInstances.get(v);C.crossTileID||(C.crossTileID=d.generate(),g[C.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Jc(s,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(s,f){for(const d of f.getCrossTileIDsLists())for(const g of d)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let f=!1;for(const d in this.indexes){const g=this.indexes[d];for(const v in g)s[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[v]),delete g[v],f=!0)}return f}}class Ua{constructor(){this.layerIndexes={},this.crossTileIDs=new Qr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,f,d){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new Ku);let v=!1;const C={};g.handleWrapJump(d);for(const T of f){const M=T.getBucket(s);M&&s.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(T.tileID,M,this.crossTileIDs)&&(v=!0),C[M.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(v=!0),v}pruneUnusedLayers(s){const f={};s.forEach(d=>{f[d]=!0});for(const d in this.layerIndexes)f[d]||delete this.layerIndexes[d]}}const mr=(_,s)=>u.t(_,s&&s.filter(f=>f.identifier!=="source.canvas")),Qc=u.av();class ko extends u.E{constructor(s,f={}){super(),this._rtlPluginLoaded=()=>{for(const d in this.sourceCaches){const g=this.sourceCaches[d].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[d].reload()}},this.map=s,this.dispatcher=new wr(kn(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(d,g)=>this.getGlyphs(d,g)),this.dispatcher.registerMessageHandler("GI",(d,g)=>this.getImages(d,g)),this.imageManager=new Ke,this.imageManager.setEventedParent(this),this.glyphManager=new qe(s._requestManager,f.localIdeographFontFamily),this.lineAtlas=new qt(256,512),this.crossTileSymbolIndex=new Ua,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.ax()),rt().on(Pi,this._rtlPluginLoaded),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const g=this.sourceCaches[d.sourceId];if(!g)return;const v=g.getSource();if(v&&v.vectorLayerIds)for(const C in this._layers){const T=this._layers[C];T.source===v.id&&this._validateLayer(T)}})}loadURL(s,f={},d){this.fire(new u.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const g=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController,u.h(g,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,f,d)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new u.j(v))})}loadJSON(s,f={},d){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(s,f,d)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(Qc,{validate:!1})}_load(s,f,d){var g;const v=f.transformStyle?f.transformStyle(d,s):s;if(!f.validate||!mr(this,u.x(v))){this._loaded=!0,this.stylesheet=v;for(const C in v.sources)this.addSource(C,v.sources[C],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new un(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const s=u.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of s){const d=u.az(f);d.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=d}}_loadSprite(s,f=!1,d=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,C,T,M){return u._(this,void 0,void 0,function*(){const R=Ce(v),z=T>1?"@2x":"",F={},X={};for(const{id:ie,url:re}of R){const ue=C.transformRequest(C.normalizeSpriteURL(re,z,".json"),"SpriteJSON");F[ie]=u.h(ue,M);const $=C.transformRequest(C.normalizeSpriteURL(re,z,".png"),"SpriteImage");X[ie]=W.getImage($,M)}return yield Promise.all([...Object.values(F),...Object.values(X)]),function(ie,re){return u._(this,void 0,void 0,function*(){const ue={};for(const $ in ie){ue[$]={};const ve=E.getImageCanvasContext((yield re[$]).data),Fe=(yield ie[$]).data;for(const he in Fe){const{width:Ie,height:Be,x:Ge,y:He,sdf:et,pixelRatio:$e,stretchX:ut,stretchY:ft,content:nn}=Fe[he];ue[$][he]={data:null,pixelRatio:$e,sdf:et,stretchX:ut,stretchY:ft,content:nn,spriteData:{width:Ie,height:Be,x:Ge,y:He,context:ve}}}}return ue})}(F,X)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const C in v){this._spritesImagesIds[C]=[];const T=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(M=>!(M in v)):[];for(const M of T)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in v[C]){const R=C==="default"?M:`${C}:${M}`;this._spritesImagesIds[C].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,v[C][M],!1):this.imageManager.addImage(R,v[C][M]),f&&(this._changedImages[R]=!0)}}}).catch(v=>{this._spriteRequest=null,g=v,this.fire(new u.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),d&&d(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(s){const f=this.sourceCaches[s.source];if(!f)return;const d=s.sourceLayer;if(!d)return;const g=f.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(d)===-1)&&this.fire(new u.j(new Error(`Source layer "${d}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const f=this._serializedAllLayers();if(!s||s.length===0)return Object.values(f);const d=[];for(const g of s)f[g]&&d.push(f[g]);return d}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const f=Object.keys(this._layers);for(const d of f){const g=this._layers[d];g.type!=="custom"&&(s[d]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const f=this._changed;if(f){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const C in this._updatedSources){const T=this._updatedSources[C];if(T==="reload")this._reloadSource(C);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const d={};for(const g in this.sourceCaches){const v=this.sourceCaches[g];d[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const g in d){const v=this.sourceCaches[g];!!d[g]!=!!v.used&&v.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,f&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,f={}){var d;this._checkLoaded();const g=this.serialize();if(s=f.transformStyle?f.transformStyle(g,s):s,((d=f.validate)===null||d===void 0||d)&&mr(this,u.x(s)))return!1;(s=u.aA(s)).layers=u.ay(s.layers);const v=u.aB(g,s),C=this._getOperationsToPerform(v);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const T of C.operations)T();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const f=[],d=[];for(const g of s)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":f.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":f.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":f.push(()=>{});break;default:d.push(g.command)}return{operations:f,unimplemented:d}}addImage(s,f){if(this.getImage(s))return this.fire(new u.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,f),this._afterImageUpdated(s)}updateImage(s,f){this.imageManager.updateImage(s,f)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new u.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,f,d={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(u.x.source,`sources.${s}`,f,null,d))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const g=this.sourceCaches[s]=new Kr(s,f,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===s)return this.fire(new u.j(new Error(`Source "${s}" cannot be removed while layer "${d}" is using it.`)));const f=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],f.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,f){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const d=this.sourceCaches[s].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(f),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,f,d={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new u.j(new Error(`Layer "${g}" already exists on this map.`)));let v;if(s.type==="custom"){if(mr(this,u.aC(s)))return;v=u.az(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=u.aA(s),s=u.e(s,{source:g})),this._validate(u.x.layer,`layers.${g}`,s,{arrayIndex:-1},d))return;v=u.az(s),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}})}const C=f?this._order.indexOf(f):this._order.length;if(f&&C===-1)this.fire(new u.j(new Error(`Cannot add layer "${g}" before non-existing layer "${f}".`)));else{if(this._order.splice(C,0,g),this._layerOrderChanged=!0,this._layers[g]=v,this._removedLayers[g]&&v.source&&v.type!=="custom"){const T=this._removedLayers[g];delete this._removedLayers[g],T.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,f){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new u.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===f)return;const d=this._order.indexOf(s);this._order.splice(d,1);const g=f?this._order.indexOf(f):this._order.length;f&&g===-1?this.fire(new u.j(new Error(`Cannot move layer "${s}" before non-existing layer "${f}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const f=this._layers[s];if(!f)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${s}".`)));f.setEventedParent(null);const d=this._order.indexOf(s);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=f,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],f.onRemove&&f.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,f,d){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===f&&g.maxzoom===d||(f!=null&&(g.minzoom=f),d!=null&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,f,d={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!u.aD(g.filter,f))return f==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(u.x.filter,`layers.${g.id}.filter`,f,null,d)||(g.filter=u.aA(f),this._updateLayer(g)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return u.aA(this.getLayer(s).filter)}setLayoutProperty(s,f,d,g={}){this._checkLoaded();const v=this.getLayer(s);v?u.aD(v.getLayoutProperty(f),d)||(v.setLayoutProperty(f,d,g),this._updateLayer(v)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,f){const d=this.getLayer(s);if(d)return d.getLayoutProperty(f);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,f,d,g={}){this._checkLoaded();const v=this.getLayer(s);v?u.aD(v.getPaintProperty(f),d)||(v.setPaintProperty(f,d,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,f){return this.getLayer(s).getPaintProperty(f)}setFeatureState(s,f){this._checkLoaded();const d=s.source,g=s.sourceLayer,v=this.sourceCaches[d];if(v===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const C=v.getSource().type;C==="geojson"&&g?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||g?(s.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(g,s.id,f)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,f){this._checkLoaded();const d=s.source,g=this.sourceCaches[d];if(g===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const v=g.getSource().type,C=v==="vector"?s.sourceLayer:void 0;v!=="vector"||C?f&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(C,s.id,f):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const f=s.source,d=s.sourceLayer,g=this.sourceCaches[f];if(g!==void 0)return g.getSource().type!=="vector"||d?(s.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(d,s.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=u.aE(this.sourceCaches,v=>v.serialize()),f=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,g=this.stylesheet;return u.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:f,terrain:d},v=>v!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const f=C=>this._layers[C].type==="fill-extrusion",d={},g=[];for(let C=this._order.length-1;C>=0;C--){const T=this._order[C];if(f(T)){d[T]=C;for(const M of s){const R=M[T];if(R)for(const z of R)g.push(z)}}}g.sort((C,T)=>T.intersectionZ-C.intersectionZ);const v=[];for(let C=this._order.length-1;C>=0;C--){const T=this._order[C];if(f(T))for(let M=g.length-1;M>=0;M--){const R=g[M].feature;if(d[R.layer.id]<C)break;v.push(R),g.pop()}else for(const M of s){const R=M[T];if(R)for(const z of R)v.push(z.feature)}}return v}queryRenderedFeatures(s,f,d){f&&f.filter&&this._validate(u.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const g={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const T of f.layers){const M=this._layers[T];if(!M)return this.fire(new u.j(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];g[M.source]=!0}}const v=[];f.availableImages=this._availableImages;const C=this._serializedAllLayers();for(const T in this.sourceCaches)f.layers&&!g[T]||v.push(dr(this.sourceCaches[T],this._layers,C,s,f,d));return this.placement&&v.push(function(T,M,R,z,F,X,ie){const re={},ue=X.queryRenderedSymbols(z),$=[];for(const ve of Object.keys(ue).map(Number))$.push(ie[ve]);$.sort(Qe);for(const ve of $){const Fe=ve.featureIndex.lookupSymbolFeatures(ue[ve.bucketInstanceId],M,ve.bucketIndex,ve.sourceLayerIndex,F.filter,F.layers,F.availableImages,T);for(const he in Fe){const Ie=re[he]=re[he]||[],Be=Fe[he];Be.sort((Ge,He)=>{const et=ve.featureSortOrder;if(et){const $e=et.indexOf(Ge.featureIndex);return et.indexOf(He.featureIndex)-$e}return He.featureIndex-Ge.featureIndex});for(const Ge of Be)Ie.push(Ge)}}for(const ve in re)re[ve].forEach(Fe=>{const he=Fe.feature,Ie=R[T[ve].source].getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=Ie});return re}(this._layers,C,this.sourceCaches,s,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,f){f&&f.filter&&this._validate(u.x.filter,"querySourceFeatures.filter",f.filter,null,f);const d=this.sourceCaches[s];return d?function(g,v){const C=g.getRenderableIds().map(R=>g.getTileByID(R)),T=[],M={};for(let R=0;R<C.length;R++){const z=C[R],F=z.tileID.canonical.key;M[F]||(M[F]=!0,z.querySourceFeatures(T,v))}return T}(d,f):[]}getLight(){return this.light.getLight()}setLight(s,f={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const C in s)if(!u.aD(s[C],d[C])){g=!0;break}if(!g)return;const v={now:E.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,f),this.light.updateTransitions(v)}_validate(s,f,d,g,v={}){return(!v||v.validate!==!1)&&mr(this,s.call(u.x,u.e({key:f,style:this.serialize(),value:d,styleSpec:u.v},g)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),rt().off(Pi,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const d=this.sourceCaches[f];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const f in this.sourceCaches)this.sourceCaches[f].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,f,d,g,v=!1){let C=!1,T=!1;const M={};for(const R of this._order){const z=this._layers[R];if(z.type!=="symbol")continue;if(!M[z.source]){const X=this.sourceCaches[z.source];M[z.source]=X.getRenderableIds(!0).map(ie=>X.getTileByID(ie)).sort((ie,re)=>re.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(re.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(z,M[z.source],s.center.lng);C=C||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(E.now(),s.zoom))&&(this.pauseablePlacement=new $o(s,this.map.terrain,this._order,v,f,d,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(E.now()),T=!0),C&&this.pauseablePlacement.placement.setStale()),T||C)for(const R of this._order){const z=this._layers[R];z.type==="symbol"&&this.placement.updateLayerOpacities(z,M[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(E.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,f){return u._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[f.source];return g&&g.setDependencies(f.tileID.key,f.type,f.icons),d})}getGlyphs(s,f){return u._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(f.stacks),g=this.sourceCaches[f.source];return g&&g.setDependencies(f.tileID.key,f.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,f={}){this._checkLoaded(),s&&this._validate(u.x.glyphs,"glyphs",s,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,f,d={},g){this._checkLoaded();const v=[{id:s,url:f}],C=[...Ce(this.stylesheet.sprite),...v];this._validate(u.x.sprite,"sprite",C,null,d)||(this.stylesheet.sprite=C,this._loadSprite(v,!0,g))}removeSprite(s){this._checkLoaded();const f=Ce(this.stylesheet.sprite);if(f.find(d=>d.id===s)){if(this._spritesImagesIds[s])for(const d of this._spritesImagesIds[s])this.imageManager.removeImage(d),this._changedImages[d]=!0;f.splice(f.findIndex(d=>d.id===s),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Ce(this.stylesheet.sprite)}setSprite(s,f={},d){this._checkLoaded(),s&&this._validate(u.x.sprite,"sprite",s,null,f)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,d):(this._unloadSprite(),d&&d(null)))}}var $c=u.X([{name:"a_pos",type:"Int16",components:2}]),Fs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ju={prelude:Un(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Un(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Un(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Un(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Un("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Un("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Un(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Un(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Un(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Un(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Un(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Un(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Un(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Un(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Un(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Un(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Un("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Fs),terrainDepth:Un("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Fs),terrainCoords:Un("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Fs)};function Un(_,s){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=s.match(/attribute ([\w]+) ([\w]+)/g),g=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=v?v.concat(g):g,T={};return{fragmentSource:_=_.replace(f,(M,R,z,F,X)=>(T[X]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${X}
varying ${z} ${F} ${X};
#else
uniform ${z} ${F} u_${X};
#endif
`:`
#ifdef HAS_UNIFORM_u_${X}
    ${z} ${F} ${X} = u_${X};
#endif
`)),vertexSource:s=s.replace(f,(M,R,z,F,X)=>{const ie=F==="float"?"vec2":"vec4",re=X.match(/color/)?"color":ie;return T[X]?R==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${z} ${ie} a_${X};
varying ${z} ${F} ${X};
#else
uniform ${z} ${F} u_${X};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${z} ${F} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${re}(a_${X}, u_${X}_t);
#else
    ${z} ${F} ${X} = u_${X};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${z} ${ie} a_${X};
#else
uniform ${z} ${F} u_${X};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${z} ${F} ${X} = a_${X};
#else
    ${z} ${F} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${z} ${F} ${X} = unpack_mix_${re}(a_${X}, u_${X}_t);
#else
    ${z} ${F} ${X} = u_${X};
#endif
`}),staticAttributes:d,staticUniforms:C}}class eh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,f,d,g,v,C,T,M,R){this.context=s;let z=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!z&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(z=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==d||z||this.boundIndexBuffer!==v||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==R?this.freshBind(f,d,g,v,C,T,M,R):(s.bindVertexArray.set(this.vao),T&&T.bind(),v&&v.dynamicDraw&&v.bind(),M&&M.bind(),R&&R.bind())}freshBind(s,f,d,g,v,C,T,M){const R=s.numAttributes,z=this.context,F=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=M,f.enableAttributes(F,s);for(const X of d)X.enableAttributes(F,s);C&&C.enableAttributes(F,s),T&&T.enableAttributes(F,s),M&&M.enableAttributes(F,s),f.bind(),f.setVertexAttribPointers(F,s,v);for(const X of d)X.bind(),X.setVertexAttribPointers(F,s,v);C&&(C.bind(),C.setVertexAttribPointers(F,s,v)),g&&g.bind(),T&&(T.bind(),T.setVertexAttribPointers(F,s,v)),M&&(M.bind(),M.setVertexAttribPointers(F,s,v)),z.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ou(_){const s=[];for(let f=0;f<_.length;f++){if(_[f]===null)continue;const d=_[f].split(" ");s.push(d.pop())}return s}class Ga{constructor(s,f,d,g,v,C){const T=s.gl;this.program=T.createProgram();const M=ou(f.staticAttributes),R=d?d.getBinderAttributes():[],z=M.concat(R),F=Ju.prelude.staticUniforms?ou(Ju.prelude.staticUniforms):[],X=f.staticUniforms?ou(f.staticUniforms):[],ie=d?d.getBinderUniforms():[],re=F.concat(X).concat(ie),ue=[];for(const Ge of re)ue.indexOf(Ge)<0&&ue.push(Ge);const $=d?d.defines():[];v&&$.push("#define OVERDRAW_INSPECTOR;"),C&&$.push("#define TERRAIN3D;");const ve=$.concat(Ju.prelude.fragmentSource,f.fragmentSource).join(`
`),Fe=$.concat(Ju.prelude.vertexSource,f.vertexSource).join(`
`),he=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(he,ve),T.compileShader(he),!T.getShaderParameter(he,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(he)}`);T.attachShader(this.program,he);const Ie=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(Ie,Fe),T.compileShader(Ie),!T.getShaderParameter(Ie,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(Ie)}`);T.attachShader(this.program,Ie),this.attributes={};const Be={};this.numAttributes=z.length;for(let Ge=0;Ge<this.numAttributes;Ge++)z[Ge]&&(T.bindAttribLocation(this.program,Ge,z[Ge]),this.attributes[z[Ge]]=Ge);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(Ie),T.deleteShader(he);for(let Ge=0;Ge<ue.length;Ge++){const He=ue[Ge];if(He&&!Be[He]){const et=T.getUniformLocation(this.program,He);et&&(Be[He]=et)}}this.fixedUniforms=g(s,Be),this.terrainUniforms=((Ge,He)=>({u_depth:new u.aG(Ge,He.u_depth),u_terrain:new u.aG(Ge,He.u_terrain),u_terrain_dim:new u.aH(Ge,He.u_terrain_dim),u_terrain_matrix:new u.aI(Ge,He.u_terrain_matrix),u_terrain_unpack:new u.aJ(Ge,He.u_terrain_unpack),u_terrain_exaggeration:new u.aH(Ge,He.u_terrain_exaggeration)}))(s,Be),this.binderUniforms=d?d.getUniforms(s,Be):[]}draw(s,f,d,g,v,C,T,M,R,z,F,X,ie,re,ue,$,ve,Fe){const he=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(d),s.setStencilMode(g),s.setColorMode(v),s.setCullFace(C),M){s.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,M.depthTexture),s.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,M.texture);for(const Be in this.terrainUniforms)this.terrainUniforms[Be].set(M[Be])}for(const Be in this.fixedUniforms)this.fixedUniforms[Be].set(T[Be]);ue&&ue.setUniforms(s,this.binderUniforms,ie,{zoom:re});let Ie=0;switch(f){case he.LINES:Ie=2;break;case he.TRIANGLES:Ie=3;break;case he.LINE_STRIP:Ie=1}for(const Be of X.get()){const Ge=Be.vaos||(Be.vaos={});(Ge[R]||(Ge[R]=new eh)).bind(s,this,z,ue?ue.getPaintVertexBuffers():[],F,Be.vertexOffset,$,ve,Fe),he.drawElements(f,Be.primitiveLength*Ie,he.UNSIGNED_SHORT,Be.primitiveOffset*Ie*2)}}}function th(_,s,f){const d=1/Zt(f,1,s.transform.tileZoom),g=Math.pow(2,f.tileID.overscaledZ),v=f.tileSize*Math.pow(2,s.transform.tileZoom)/g,C=v*(f.tileID.canonical.x+f.tileID.wrap*g),T=v*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[d,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[C>>16,T>>16],u_pixel_coord_lower:[65535&C,65535&T]}}const Qu=(_,s,f,d)=>{const g=s.style.light,v=g.properties.get("position"),C=[v.x,v.y,v.z],T=function(){var R=new u.A(9);return u.A!=Float32Array&&(R[1]=0,R[2]=0,R[3]=0,R[5]=0,R[6]=0,R[7]=0),R[0]=1,R[4]=1,R[8]=1,R}();g.properties.get("anchor")==="viewport"&&function(R,z){var F=Math.sin(z),X=Math.cos(z);R[0]=X,R[1]=F,R[2]=0,R[3]=-F,R[4]=X,R[5]=0,R[6]=0,R[7]=0,R[8]=1}(T,-s.transform.angle),function(R,z,F){var X=z[0],ie=z[1],re=z[2];R[0]=X*F[0]+ie*F[3]+re*F[6],R[1]=X*F[1]+ie*F[4]+re*F[7],R[2]=X*F[2]+ie*F[5]+re*F[8]}(C,C,T);const M=g.properties.get("color");return{u_matrix:_,u_lightpos:C,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+f,u_opacity:d}},qy=(_,s,f,d,g,v,C)=>u.e(Qu(_,s,f,d),th(v,s,C),{u_height_factor:-Math.pow(2,g.overscaledZ)/C.tileSize/8}),nm=_=>({u_matrix:_}),nh=(_,s,f,d)=>u.e(nm(_),th(f,s,d)),jy=(_,s)=>({u_matrix:_,u_world:s}),rm=(_,s,f,d,g)=>u.e(nh(_,s,f,d),{u_world:g}),Wy=(_,s,f,d)=>{const g=_.transform;let v,C;if(d.paint.get("circle-pitch-alignment")==="map"){const T=Zt(f,1,g.zoom);v=!0,C=[T,T]}else v=!1,C=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(s.posMatrix,f,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:C}},im=(_,s,f)=>{const d=Zt(f,1,s.zoom),g=Math.pow(2,s.zoom-f.tileID.overscaledZ),v=f.tileID.overscaleFactor();return{u_matrix:_,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[s.pixelsToGLUnits[0]/(d*g),s.pixelsToGLUnits[1]/(d*g)],u_overscale_factor:v}},om=(_,s,f=1)=>({u_matrix:_,u_color:s,u_overlay:0,u_overlay_scale:f}),rh=_=>({u_matrix:_}),sm=(_,s,f,d)=>({u_matrix:_,u_extrude_scale:Zt(s,1,f),u_intensity:d});function am(_,s){const f=Math.pow(2,s.canonical.z),d=s.canonical.y;return[new u.Y(0,d/f).toLngLat().lat,new u.Y(0,(d+1)/f).toLngLat().lat]}const ih=(_,s,f,d)=>{const g=_.transform;return{u_matrix:$u(_,s,f,d),u_ratio:1/Zt(s,1,g.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},lm=(_,s,f,d,g)=>u.e(ih(_,s,f,g),{u_image:0,u_image_height:d}),Sl=(_,s,f,d,g)=>{const v=_.transform,C=Do(s,v);return{u_matrix:$u(_,s,f,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Zt(s,1,v.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[C,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},oh=(_,s,f,d,g,v)=>{const C=_.lineAtlas,T=Do(s,_.transform),M=f.layout.get("line-cap")==="round",R=C.getDash(d.from,M),z=C.getDash(d.to,M),F=R.width*g.fromScale,X=z.width*g.toScale;return u.e(ih(_,s,f,v),{u_patternscale_a:[T/F,-R.height/2],u_patternscale_b:[T/X,-z.height/2],u_sdfgamma:C.width/(256*Math.min(F,X)*_.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:z.y,u_mix:g.t})};function Do(_,s){return 1/Zt(_,1,s.tileZoom)}function $u(_,s,f,d){return _.translatePosMatrix(d?d.posMatrix:s.tileID.posMatrix,s,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const sh=(_,s,f,d,g)=>{return{u_matrix:_,u_tl_parent:s,u_scale_parent:f,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(C=g.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(v=g.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:ec(g.paint.get("raster-hue-rotate"))};var v,C};function ec(_){_*=Math.PI/180;const s=Math.sin(_),f=Math.cos(_);return[(2*f+1)/3,(-Math.sqrt(3)*s-f+1)/3,(Math.sqrt(3)*s-f+1)/3]}const tc=(_,s,f,d,g,v,C,T,M,R)=>{const z=g.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:z.width/z.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:C,u_coord_matrix:T,u_is_text:+M,u_pitch_with_map:+d,u_texsize:R,u_texture:0}},nc=(_,s,f,d,g,v,C,T,M,R,z)=>{const F=g.transform;return u.e(tc(_,s,f,d,g,v,C,T,M,R),{u_gamma_scale:d?Math.cos(F._pitch)*F.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+z})},rc=(_,s,f,d,g,v,C,T,M,R)=>u.e(nc(_,s,f,d,g,v,C,T,!0,M,!0),{u_texsize_icon:R,u_texture_icon:1}),Hy=(_,s,f)=>({u_matrix:_,u_opacity:s,u_color:f}),Zy=(_,s,f,d,g,v)=>u.e(function(C,T,M,R){const z=M.imageManager.getPattern(C.from.toString()),F=M.imageManager.getPattern(C.to.toString()),{width:X,height:ie}=M.imageManager.getPixelSize(),re=Math.pow(2,R.tileID.overscaledZ),ue=R.tileSize*Math.pow(2,M.transform.tileZoom)/re,$=ue*(R.tileID.canonical.x+R.tileID.wrap*re),ve=ue*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[X,ie],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/Zt(R,1,M.transform.tileZoom),u_pixel_coord_upper:[$>>16,ve>>16],u_pixel_coord_lower:[65535&$,65535&ve]}}(d,v,f,g),{u_matrix:_,u_opacity:s}),um={fillExtrusion:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_lightpos:new u.aK(_,s.u_lightpos),u_lightintensity:new u.aH(_,s.u_lightintensity),u_lightcolor:new u.aK(_,s.u_lightcolor),u_vertical_gradient:new u.aH(_,s.u_vertical_gradient),u_opacity:new u.aH(_,s.u_opacity)}),fillExtrusionPattern:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_lightpos:new u.aK(_,s.u_lightpos),u_lightintensity:new u.aH(_,s.u_lightintensity),u_lightcolor:new u.aK(_,s.u_lightcolor),u_vertical_gradient:new u.aH(_,s.u_vertical_gradient),u_height_factor:new u.aH(_,s.u_height_factor),u_image:new u.aG(_,s.u_image),u_texsize:new u.aL(_,s.u_texsize),u_pixel_coord_upper:new u.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(_,s.u_pixel_coord_lower),u_scale:new u.aK(_,s.u_scale),u_fade:new u.aH(_,s.u_fade),u_opacity:new u.aH(_,s.u_opacity)}),fill:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix)}),fillPattern:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_image:new u.aG(_,s.u_image),u_texsize:new u.aL(_,s.u_texsize),u_pixel_coord_upper:new u.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(_,s.u_pixel_coord_lower),u_scale:new u.aK(_,s.u_scale),u_fade:new u.aH(_,s.u_fade)}),fillOutline:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_world:new u.aL(_,s.u_world)}),fillOutlinePattern:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_world:new u.aL(_,s.u_world),u_image:new u.aG(_,s.u_image),u_texsize:new u.aL(_,s.u_texsize),u_pixel_coord_upper:new u.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(_,s.u_pixel_coord_lower),u_scale:new u.aK(_,s.u_scale),u_fade:new u.aH(_,s.u_fade)}),circle:(_,s)=>({u_camera_to_center_distance:new u.aH(_,s.u_camera_to_center_distance),u_scale_with_map:new u.aG(_,s.u_scale_with_map),u_pitch_with_map:new u.aG(_,s.u_pitch_with_map),u_extrude_scale:new u.aL(_,s.u_extrude_scale),u_device_pixel_ratio:new u.aH(_,s.u_device_pixel_ratio),u_matrix:new u.aI(_,s.u_matrix)}),collisionBox:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_camera_to_center_distance:new u.aH(_,s.u_camera_to_center_distance),u_pixels_to_tile_units:new u.aH(_,s.u_pixels_to_tile_units),u_extrude_scale:new u.aL(_,s.u_extrude_scale),u_overscale_factor:new u.aH(_,s.u_overscale_factor)}),collisionCircle:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_inv_matrix:new u.aI(_,s.u_inv_matrix),u_camera_to_center_distance:new u.aH(_,s.u_camera_to_center_distance),u_viewport_size:new u.aL(_,s.u_viewport_size)}),debug:(_,s)=>({u_color:new u.aM(_,s.u_color),u_matrix:new u.aI(_,s.u_matrix),u_overlay:new u.aG(_,s.u_overlay),u_overlay_scale:new u.aH(_,s.u_overlay_scale)}),clippingMask:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix)}),heatmap:(_,s)=>({u_extrude_scale:new u.aH(_,s.u_extrude_scale),u_intensity:new u.aH(_,s.u_intensity),u_matrix:new u.aI(_,s.u_matrix)}),heatmapTexture:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_world:new u.aL(_,s.u_world),u_image:new u.aG(_,s.u_image),u_color_ramp:new u.aG(_,s.u_color_ramp),u_opacity:new u.aH(_,s.u_opacity)}),hillshade:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_image:new u.aG(_,s.u_image),u_latrange:new u.aL(_,s.u_latrange),u_light:new u.aL(_,s.u_light),u_shadow:new u.aM(_,s.u_shadow),u_highlight:new u.aM(_,s.u_highlight),u_accent:new u.aM(_,s.u_accent)}),hillshadePrepare:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_image:new u.aG(_,s.u_image),u_dimension:new u.aL(_,s.u_dimension),u_zoom:new u.aH(_,s.u_zoom),u_unpack:new u.aJ(_,s.u_unpack)}),line:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_ratio:new u.aH(_,s.u_ratio),u_device_pixel_ratio:new u.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new u.aL(_,s.u_units_to_pixels)}),lineGradient:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_ratio:new u.aH(_,s.u_ratio),u_device_pixel_ratio:new u.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new u.aL(_,s.u_units_to_pixels),u_image:new u.aG(_,s.u_image),u_image_height:new u.aH(_,s.u_image_height)}),linePattern:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_texsize:new u.aL(_,s.u_texsize),u_ratio:new u.aH(_,s.u_ratio),u_device_pixel_ratio:new u.aH(_,s.u_device_pixel_ratio),u_image:new u.aG(_,s.u_image),u_units_to_pixels:new u.aL(_,s.u_units_to_pixels),u_scale:new u.aK(_,s.u_scale),u_fade:new u.aH(_,s.u_fade)}),lineSDF:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_ratio:new u.aH(_,s.u_ratio),u_device_pixel_ratio:new u.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new u.aL(_,s.u_units_to_pixels),u_patternscale_a:new u.aL(_,s.u_patternscale_a),u_patternscale_b:new u.aL(_,s.u_patternscale_b),u_sdfgamma:new u.aH(_,s.u_sdfgamma),u_image:new u.aG(_,s.u_image),u_tex_y_a:new u.aH(_,s.u_tex_y_a),u_tex_y_b:new u.aH(_,s.u_tex_y_b),u_mix:new u.aH(_,s.u_mix)}),raster:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_tl_parent:new u.aL(_,s.u_tl_parent),u_scale_parent:new u.aH(_,s.u_scale_parent),u_buffer_scale:new u.aH(_,s.u_buffer_scale),u_fade_t:new u.aH(_,s.u_fade_t),u_opacity:new u.aH(_,s.u_opacity),u_image0:new u.aG(_,s.u_image0),u_image1:new u.aG(_,s.u_image1),u_brightness_low:new u.aH(_,s.u_brightness_low),u_brightness_high:new u.aH(_,s.u_brightness_high),u_saturation_factor:new u.aH(_,s.u_saturation_factor),u_contrast_factor:new u.aH(_,s.u_contrast_factor),u_spin_weights:new u.aK(_,s.u_spin_weights)}),symbolIcon:(_,s)=>({u_is_size_zoom_constant:new u.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(_,s.u_is_size_feature_constant),u_size_t:new u.aH(_,s.u_size_t),u_size:new u.aH(_,s.u_size),u_camera_to_center_distance:new u.aH(_,s.u_camera_to_center_distance),u_pitch:new u.aH(_,s.u_pitch),u_rotate_symbol:new u.aG(_,s.u_rotate_symbol),u_aspect_ratio:new u.aH(_,s.u_aspect_ratio),u_fade_change:new u.aH(_,s.u_fade_change),u_matrix:new u.aI(_,s.u_matrix),u_label_plane_matrix:new u.aI(_,s.u_label_plane_matrix),u_coord_matrix:new u.aI(_,s.u_coord_matrix),u_is_text:new u.aG(_,s.u_is_text),u_pitch_with_map:new u.aG(_,s.u_pitch_with_map),u_texsize:new u.aL(_,s.u_texsize),u_texture:new u.aG(_,s.u_texture)}),symbolSDF:(_,s)=>({u_is_size_zoom_constant:new u.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(_,s.u_is_size_feature_constant),u_size_t:new u.aH(_,s.u_size_t),u_size:new u.aH(_,s.u_size),u_camera_to_center_distance:new u.aH(_,s.u_camera_to_center_distance),u_pitch:new u.aH(_,s.u_pitch),u_rotate_symbol:new u.aG(_,s.u_rotate_symbol),u_aspect_ratio:new u.aH(_,s.u_aspect_ratio),u_fade_change:new u.aH(_,s.u_fade_change),u_matrix:new u.aI(_,s.u_matrix),u_label_plane_matrix:new u.aI(_,s.u_label_plane_matrix),u_coord_matrix:new u.aI(_,s.u_coord_matrix),u_is_text:new u.aG(_,s.u_is_text),u_pitch_with_map:new u.aG(_,s.u_pitch_with_map),u_texsize:new u.aL(_,s.u_texsize),u_texture:new u.aG(_,s.u_texture),u_gamma_scale:new u.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new u.aH(_,s.u_device_pixel_ratio),u_is_halo:new u.aG(_,s.u_is_halo)}),symbolTextAndIcon:(_,s)=>({u_is_size_zoom_constant:new u.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(_,s.u_is_size_feature_constant),u_size_t:new u.aH(_,s.u_size_t),u_size:new u.aH(_,s.u_size),u_camera_to_center_distance:new u.aH(_,s.u_camera_to_center_distance),u_pitch:new u.aH(_,s.u_pitch),u_rotate_symbol:new u.aG(_,s.u_rotate_symbol),u_aspect_ratio:new u.aH(_,s.u_aspect_ratio),u_fade_change:new u.aH(_,s.u_fade_change),u_matrix:new u.aI(_,s.u_matrix),u_label_plane_matrix:new u.aI(_,s.u_label_plane_matrix),u_coord_matrix:new u.aI(_,s.u_coord_matrix),u_is_text:new u.aG(_,s.u_is_text),u_pitch_with_map:new u.aG(_,s.u_pitch_with_map),u_texsize:new u.aL(_,s.u_texsize),u_texsize_icon:new u.aL(_,s.u_texsize_icon),u_texture:new u.aG(_,s.u_texture),u_texture_icon:new u.aG(_,s.u_texture_icon),u_gamma_scale:new u.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new u.aH(_,s.u_device_pixel_ratio),u_is_halo:new u.aG(_,s.u_is_halo)}),background:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_opacity:new u.aH(_,s.u_opacity),u_color:new u.aM(_,s.u_color)}),backgroundPattern:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_opacity:new u.aH(_,s.u_opacity),u_image:new u.aG(_,s.u_image),u_pattern_tl_a:new u.aL(_,s.u_pattern_tl_a),u_pattern_br_a:new u.aL(_,s.u_pattern_br_a),u_pattern_tl_b:new u.aL(_,s.u_pattern_tl_b),u_pattern_br_b:new u.aL(_,s.u_pattern_br_b),u_texsize:new u.aL(_,s.u_texsize),u_mix:new u.aH(_,s.u_mix),u_pattern_size_a:new u.aL(_,s.u_pattern_size_a),u_pattern_size_b:new u.aL(_,s.u_pattern_size_b),u_scale_a:new u.aH(_,s.u_scale_a),u_scale_b:new u.aH(_,s.u_scale_b),u_pixel_coord_upper:new u.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(_,s.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aH(_,s.u_tile_units_to_pixels)}),terrain:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_texture:new u.aG(_,s.u_texture),u_ele_delta:new u.aH(_,s.u_ele_delta)}),terrainDepth:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_ele_delta:new u.aH(_,s.u_ele_delta)}),terrainCoords:(_,s)=>({u_matrix:new u.aI(_,s.u_matrix),u_texture:new u.aG(_,s.u_texture),u_terrain_coords_id:new u.aH(_,s.u_terrain_coords_id),u_ele_delta:new u.aH(_,s.u_ele_delta)})};class Xy{constructor(s,f,d){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const El={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ah{constructor(s,f,d,g){this.length=f.length,this.attributes=d,this.itemSize=f.bytesPerElement,this.dynamicDraw=g,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,f){for(let d=0;d<this.attributes.length;d++){const g=f.attributes[this.attributes[d].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,f,d){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],C=f.attributes[v.name];C!==void 0&&s.vertexAttribPointer(C,v.components,s[El[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qi=new WeakMap;function Oi(_){var s;if(Qi.has(_))return Qi.get(_);{const f=(s=_.getParameter(_.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Qi.set(_,f),f}}class Rn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lh extends Rn{getDefault(){return u.aO.transparent}set(s){const f=this.current;(s.r!==f.r||s.g!==f.g||s.b!==f.b||s.a!==f.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class uh extends Rn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class $f extends Rn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class ep extends Rn{getDefault(){return[!0,!0,!0,!0]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||s[3]!==f[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ch extends Rn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class tp extends Rn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class np extends Rn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const f=this.current;(s.func!==f.func||s.ref!==f.ref||s.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class hh extends Rn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class cm extends Rn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=s,this.dirty=!1}}class hm extends Rn{getDefault(){return[0,1]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class su extends Rn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=s,this.dirty=!1}}class Yy extends Rn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ky extends Rn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.BLEND):f.disable(f.BLEND),this.current=s,this.dirty=!1}}class Jy extends Rn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Qy extends Rn{getDefault(){return u.aO.transparent}set(s){const f=this.current;(s.r!==f.r||s.g!==f.g||s.b!==f.b||s.a!==f.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class $y extends Rn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class e_ extends Rn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=s,this.dirty=!1}}class rp extends Rn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class fh extends Rn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class ip extends Rn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class op extends Rn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class au extends Rn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||s[3]!==f[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class fm extends Rn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class pm extends Rn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class sp extends Rn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Il extends Rn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class dm extends Rn{getDefault(){return null}set(s){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class lu extends Rn{getDefault(){return null}set(s){var f;if(s===this.current&&!this.dirty)return;const d=this.gl;Oi(d)?d.bindVertexArray(s):(f=d.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class uu extends Rn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class mm extends Rn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ap extends Rn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Cn extends Rn{constructor(s,f){super(s),this.context=s,this.parent=f}getDefault(){return null}}class ph extends Cn{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class t_ extends Cn{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class gm extends Cn{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ic{constructor(s,f,d,g,v){this.context=s,this.width=f,this.height=d;const C=s.gl,T=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new ph(s,T),g)this.depthAttachment=v?new gm(s,T):new t_(s,T);else if(v)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,f=this.colorAttachment.get();if(f&&s.deleteTexture(f),this.depthAttachment){const d=this.depthAttachment.get();d&&s.deleteRenderbuffer(d)}s.deleteFramebuffer(this.framebuffer)}}class Ur{constructor(s,f,d){this.blendFunction=s,this.blendColor=f,this.mask=d}}Ur.Replace=[1,0],Ur.disabled=new Ur(Ur.Replace,u.aO.transparent,[!1,!1,!1,!1]),Ur.unblended=new Ur(Ur.Replace,u.aO.transparent,[!0,!0,!0,!0]),Ur.alphaBlended=new Ur([1,771],u.aO.transparent,[!0,!0,!0,!0]);class n_{constructor(s){var f,d;if(this.gl=s,this.clearColor=new lh(this),this.clearDepth=new uh(this),this.clearStencil=new $f(this),this.colorMask=new ep(this),this.depthMask=new ch(this),this.stencilMask=new tp(this),this.stencilFunc=new np(this),this.stencilOp=new hh(this),this.stencilTest=new cm(this),this.depthRange=new hm(this),this.depthTest=new su(this),this.depthFunc=new Yy(this),this.blend=new Ky(this),this.blendFunc=new Jy(this),this.blendColor=new Qy(this),this.blendEquation=new $y(this),this.cullFace=new e_(this),this.cullFaceSide=new rp(this),this.frontFace=new fh(this),this.program=new ip(this),this.activeTexture=new op(this),this.viewport=new au(this),this.bindFramebuffer=new fm(this),this.bindRenderbuffer=new pm(this),this.bindTexture=new sp(this),this.bindVertexBuffer=new Il(this),this.bindElementBuffer=new dm(this),this.bindVertexArray=new lu(this),this.pixelStoreUnpack=new uu(this),this.pixelStoreUnpackPremultiplyAlpha=new mm(this),this.pixelStoreUnpackFlipY=new ap(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Oi(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=s.RGBA16F)!==null&&f!==void 0?f:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(d=s.RGB16F)!==null&&d!==void 0?d:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,f){return new Xy(this,s,f)}createVertexBuffer(s,f,d){return new ah(this,s,f,d)}createRenderbuffer(s,f,d){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,s,f,d),this.bindRenderbuffer.set(null),v}createFramebuffer(s,f,d,g){return new ic(this,s,f,d,g)}clear({color:s,depth:f,stencil:d}){const g=this.gl;let v=0;s&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),d!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(v)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){u.aD(s.blendFunction,Ur.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Oi(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var f;return Oi(this.gl)?this.gl.deleteVertexArray(s):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class wn{constructor(s,f,d){this.func=s,this.mask=f,this.range=d}}wn.ReadOnly=!1,wn.ReadWrite=!0,wn.disabled=new wn(519,wn.ReadOnly,[0,1]);const lp=7680;class rr{constructor(s,f,d,g,v,C){this.test=s,this.ref=f,this.mask=d,this.fail=g,this.depthFail=v,this.pass=C}}rr.disabled=new rr({func:519,mask:0},0,0,lp,lp,lp);class $n{constructor(s,f,d){this.enable=s,this.mode=f,this.frontFace=d}}let Cl;function dh(_,s,f,d,g,v,C){const T=_.context,M=T.gl,R=_.useProgram("collisionBox"),z=[];let F=0,X=0;for(let he=0;he<d.length;he++){const Ie=d[he],Be=s.getTile(Ie),Ge=Be.getBucket(f);if(!Ge)continue;let He=Ie.posMatrix;g[0]===0&&g[1]===0||(He=_.translatePosMatrix(Ie.posMatrix,Be,g,v));const et=C?Ge.textCollisionBox:Ge.iconCollisionBox,$e=Ge.collisionCircleArray;if($e.length>0){const ut=u.F(),ft=He;u.aP(ut,Ge.placementInvProjMatrix,_.transform.glCoordMatrix),u.aP(ut,ut,Ge.placementViewportMatrix),z.push({circleArray:$e,circleOffset:X,transform:ft,invTransform:ut,coord:Ie}),F+=$e.length/4,X=F}et&&R.draw(T,M.LINES,wn.disabled,rr.disabled,_.colorModeForRenderPass(),$n.disabled,im(He,_.transform,Be),_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ie),f.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,null,_.transform.zoom,null,null,et.collisionVertexBuffer)}if(!C||!z.length)return;const ie=_.useProgram("collisionCircle"),re=new u.aQ;re.resize(4*F),re._trim();let ue=0;for(const he of z)for(let Ie=0;Ie<he.circleArray.length/4;Ie++){const Be=4*Ie,Ge=he.circleArray[Be+0],He=he.circleArray[Be+1],et=he.circleArray[Be+2],$e=he.circleArray[Be+3];re.emplace(ue++,Ge,He,et,$e,0),re.emplace(ue++,Ge,He,et,$e,1),re.emplace(ue++,Ge,He,et,$e,2),re.emplace(ue++,Ge,He,et,$e,3)}(!Cl||Cl.length<2*F)&&(Cl=function(he){const Ie=2*he,Be=new u.aS;Be.resize(Ie),Be._trim();for(let Ge=0;Ge<Ie;Ge++){const He=6*Ge;Be.uint16[He+0]=4*Ge+0,Be.uint16[He+1]=4*Ge+1,Be.uint16[He+2]=4*Ge+2,Be.uint16[He+3]=4*Ge+2,Be.uint16[He+4]=4*Ge+3,Be.uint16[He+5]=4*Ge+0}return Be}(F));const $=T.createIndexBuffer(Cl,!0),ve=T.createVertexBuffer(re,u.aR.members,!0);for(const he of z){const Ie={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(Fe=_.transform).cameraToCenterDistance,u_viewport_size:[Fe.width,Fe.height]};ie.draw(T,M.TRIANGLES,wn.disabled,rr.disabled,_.colorModeForRenderPass(),$n.disabled,Ie,_.style.map.terrain&&_.style.map.terrain.getTerrainData(he.coord),f.id,ve,$,u.$.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,_.transform.zoom,null,null,null)}var Fe;ve.destroy(),$.destroy()}$n.disabled=new $n(!1,1029,2305),$n.backCCW=new $n(!0,1029,2305);const up=u.an(new Float32Array(16));function ym(_,s,f,d,g,v){const{horizontalAlign:C,verticalAlign:T}=u.at(_);return new u.P((-(C-.5)*s/g+d[0])*v,(-(T-.5)*f/g+d[1])*v)}function mh(_,s,f,d,g,v,C,T,M,R,z){const F=_.text.placedSymbolArray,X=_.text.dynamicLayoutVertexArray,ie=_.icon.dynamicLayoutVertexArray,re={};X.clear();for(let ue=0;ue<F.length;ue++){const $=F.get(ue),ve=$.hidden||!$.crossTileID||_.allowVerticalPlacement&&!$.placedOrientation?null:d[$.crossTileID];if(ve){const Fe=new u.P($.anchorX,$.anchorY),he=Vr(Fe,f?C:v,z),Ie=le(g.cameraToCenterDistance,he.signedDistanceFromCamera);let Be=u.ai(_.textSizeData,M,$)*Ie/u.ao;f&&(Be*=_.tilePixelRatio/T);const{width:Ge,height:He,anchor:et,textOffset:$e,textBoxScale:ut}=ve,ft=ym(et,Ge,He,$e,ut,Be),nn=f?Vr(Fe.add(ft),v,z).point:he.point.add(s?ft.rotate(-g.angle):ft),pt=_.allowVerticalPlacement&&$.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let Bt=0;Bt<$.numGlyphs;Bt++)u.aj(X,nn,pt);R&&$.associatedIconIndex>=0&&(re[$.associatedIconIndex]={shiftedAnchor:nn,angle:pt})}else Xe($.numGlyphs,X)}if(R){ie.clear();const ue=_.icon.placedSymbolArray;for(let $=0;$<ue.length;$++){const ve=ue.get($);if(ve.hidden)Xe(ve.numGlyphs,ie);else{const Fe=re[$];if(Fe)for(let he=0;he<ve.numGlyphs;he++)u.aj(ie,Fe.shiftedAnchor,Fe.angle);else Xe(ve.numGlyphs,ie)}}_.icon.dynamicLayoutVertexBuffer.updateData(ie)}_.text.dynamicLayoutVertexBuffer.updateData(X)}function gh(_,s,f){return f.iconsInText&&s?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function yh(_,s,f,d,g,v,C,T,M,R,z,F){const X=_.context,ie=X.gl,re=_.transform,ue=T==="map",$=M==="map",ve=T!=="viewport"&&f.layout.get("symbol-placement")!=="point",Fe=ue&&!$&&!ve,he=!f.layout.get("symbol-sort-key").isConstant();let Ie=!1;const Be=_.depthModeForSublayer(0,wn.ReadOnly),Ge=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),He=[];for(const et of d){const $e=s.getTile(et),ut=$e.getBucket(f);if(!ut)continue;const ft=g?ut.text:ut.icon;if(!ft||!ft.segments.get().length||!ft.hasVisibleVertices)continue;const nn=ft.programConfigurations.get(f.id),pt=g||ut.sdfIcons,Bt=g?ut.textSizeData:ut.iconSizeData,rn=$||re.pitch!==0,Sn=_.useProgram(gh(pt,g,ut),nn),jt=u.ag(Bt,re.zoom),an=_.style.map.terrain&&_.style.map.terrain.getTerrainData(et);let fn,Tr,Gn,Ro,li=[0,0],gr=null;if(g)Tr=$e.glyphAtlasTexture,Gn=ie.LINEAR,fn=$e.glyphAtlasTexture.size,ut.iconsInText&&(li=$e.imageAtlasTexture.size,gr=$e.imageAtlasTexture,Ro=rn||_.options.rotating||_.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?ie.LINEAR:ie.NEAREST);else{const ei=f.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear;Tr=$e.imageAtlasTexture,Gn=pt||_.options.rotating||_.options.zooming||ei||rn?ie.LINEAR:ie.NEAREST,fn=$e.imageAtlasTexture.size}const ui=Zt($e,1,_.transform.zoom),No=Kt(et.posMatrix,$,ue,_.transform,ui),Gs=ga(et.posMatrix,$,ue,_.transform,ui),Za=Ge&&ut.hasTextData(),yc=f.layout.get("icon-text-fit")!=="none"&&Za&&ut.hasIconData();if(ve){const ei=_.style.map.terrain?(ts,ti)=>_.style.map.terrain.getElevation(et,ts,ti):null,_r=f.layout.get("text-rotation-alignment")==="map";q(ut,et.posMatrix,_,g,No,Gs,$,R,_r,ei)}const Xa=_.translatePosMatrix(et.posMatrix,$e,v,C),qs=ve||g&&Ge||yc?up:No,$r=_.translatePosMatrix(Gs,$e,v,C,!0),yr=pt&&f.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let cr;cr=pt?ut.iconsInText?rc(Bt.kind,jt,Fe,$,_,Xa,qs,$r,fn,li):nc(Bt.kind,jt,Fe,$,_,Xa,qs,$r,g,fn,!0):tc(Bt.kind,jt,Fe,$,_,Xa,qs,$r,g,fn);const es={program:Sn,buffers:ft,uniformValues:cr,atlasTexture:Tr,atlasTextureIcon:gr,atlasInterpolation:Gn,atlasInterpolationIcon:Ro,isSDF:pt,hasHalo:yr};if(he&&ut.canOverlap){Ie=!0;const ei=ft.segments.get();for(const _r of ei)He.push({segments:new u.$([_r]),sortKey:_r.sortKey,state:es,terrainData:an})}else He.push({segments:ft.segments,sortKey:0,state:es,terrainData:an})}Ie&&He.sort((et,$e)=>et.sortKey-$e.sortKey);for(const et of He){const $e=et.state;if(X.activeTexture.set(ie.TEXTURE0),$e.atlasTexture.bind($e.atlasInterpolation,ie.CLAMP_TO_EDGE),$e.atlasTextureIcon&&(X.activeTexture.set(ie.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),$e.isSDF){const ut=$e.uniformValues;$e.hasHalo&&(ut.u_is_halo=1,_m($e.buffers,et.segments,f,_,$e.program,Be,z,F,ut,et.terrainData)),ut.u_is_halo=0}_m($e.buffers,et.segments,f,_,$e.program,Be,z,F,$e.uniformValues,et.terrainData)}}function _m(_,s,f,d,g,v,C,T,M,R){const z=d.context;g.draw(z,z.gl.TRIANGLES,v,C,T,$n.disabled,M,R,f.id,_.layoutVertexBuffer,_.indexBuffer,s,f.paint,d.transform.zoom,_.programConfigurations.get(f.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function _h(_,s,f,d,g){if(!f||!d||!d.imageAtlas)return;const v=d.imageAtlas.patternPositions;let C=v[f.to.toString()],T=v[f.from.toString()];if(!C&&T&&(C=T),!T&&C&&(T=C),!C||!T){const M=g.getPaintProperty(s);C=v[M],T=v[M]}C&&T&&_.setConstantPatternPositions(C,T)}function vm(_,s,f,d,g,v,C){const T=_.context.gl,M="fill-pattern",R=f.paint.get(M),z=R&&R.constantOr(1),F=f.getCrossfadeParameters();let X,ie,re,ue,$;C?(ie=z&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=T.LINES):(ie=z?"fillPattern":"fill",X=T.TRIANGLES);const ve=R.constantOr(null);for(const Fe of d){const he=s.getTile(Fe);if(z&&!he.patternsLoaded())continue;const Ie=he.getBucket(f);if(!Ie)continue;const Be=Ie.programConfigurations.get(f.id),Ge=_.useProgram(ie,Be),He=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Fe);z&&(_.context.activeTexture.set(T.TEXTURE0),he.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Be.updatePaintBuffers(F)),_h(Be,M,ve,he,f);const et=He?Fe:null,$e=_.translatePosMatrix(et?et.posMatrix:Fe.posMatrix,he,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(C){ue=Ie.indexBuffer2,$=Ie.segments2;const ut=[T.drawingBufferWidth,T.drawingBufferHeight];re=ie==="fillOutlinePattern"&&z?rm($e,_,F,he,ut):jy($e,ut)}else ue=Ie.indexBuffer,$=Ie.segments,re=z?nh($e,_,F,he):nm($e);Ge.draw(_.context,X,g,_.stencilModeForClipping(Fe),v,$n.disabled,re,He,f.id,Ie.layoutVertexBuffer,ue,$,f.paint,_.transform.zoom,Be)}}function vh(_,s,f,d,g,v,C){const T=_.context,M=T.gl,R="fill-extrusion-pattern",z=f.paint.get(R),F=z.constantOr(1),X=f.getCrossfadeParameters(),ie=f.paint.get("fill-extrusion-opacity"),re=z.constantOr(null);for(const ue of d){const $=s.getTile(ue),ve=$.getBucket(f);if(!ve)continue;const Fe=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ue),he=ve.programConfigurations.get(f.id),Ie=_.useProgram(F?"fillExtrusionPattern":"fillExtrusion",he);F&&(_.context.activeTexture.set(M.TEXTURE0),$.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),he.updatePaintBuffers(X)),_h(he,R,re,$,f);const Be=_.translatePosMatrix(ue.posMatrix,$,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ge=f.paint.get("fill-extrusion-vertical-gradient"),He=F?qy(Be,_,Ge,ie,ue,X,$):Qu(Be,_,Ge,ie);Ie.draw(T,T.gl.TRIANGLES,g,v,C,$n.backCCW,He,Fe,f.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,f.paint,_.transform.zoom,he,_.style.map.terrain&&ve.centroidVertexBuffer)}}function bh(_,s,f,d,g,v,C){const T=_.context,M=T.gl,R=f.fbo;if(!R)return;const z=_.useProgram("hillshade"),F=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),z.draw(T,M.TRIANGLES,g,v,C,$n.disabled,((X,ie,re,ue)=>{const $=re.paint.get("hillshade-shadow-color"),ve=re.paint.get("hillshade-highlight-color"),Fe=re.paint.get("hillshade-accent-color");let he=re.paint.get("hillshade-illumination-direction")*(Math.PI/180);re.paint.get("hillshade-illumination-anchor")==="viewport"&&(he-=X.transform.angle);const Ie=!X.options.moving;return{u_matrix:ue?ue.posMatrix:X.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),Ie),u_image:0,u_latrange:am(0,ie.tileID),u_light:[re.paint.get("hillshade-exaggeration"),he],u_shadow:$,u_highlight:ve,u_accent:Fe}})(_,f,d,F?s:null),F,d.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function cp(_,s,f,d,g,v){const C=_.context,T=C.gl,M=s.dem;if(M&&M.data){const R=M.dim,z=M.stride,F=M.getPixels();if(C.activeTexture.set(T.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||_.getTileTexture(z),s.demTexture){const ie=s.demTexture;ie.update(F,{premultiply:!1}),ie.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else s.demTexture=new Z(C,F,T.RGBA,{premultiply:!1}),s.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);C.activeTexture.set(T.TEXTURE0);let X=s.fbo;if(!X){const ie=new Z(C,{width:R,height:R,data:null},T.RGBA);ie.bind(T.LINEAR,T.CLAMP_TO_EDGE),X=s.fbo=C.createFramebuffer(R,R,!0,!1),X.colorAttachment.set(ie.texture)}C.bindFramebuffer.set(X.framebuffer),C.viewport.set([0,0,R,R]),_.useProgram("hillshadePrepare").draw(C,T.TRIANGLES,d,g,v,$n.disabled,((ie,re)=>{const ue=re.stride,$=u.F();return u.aN($,0,u.W,-u.W,0,0,1),u.H($,$,[0,-u.W,0]),{u_matrix:$,u_image:1,u_dimension:[ue,ue],u_zoom:ie.overscaledZ,u_unpack:re.getUnpackVector()}})(s.tileID,M),null,f.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function bm(_,s,f,d,g,v){const C=d.paint.get("raster-fade-duration");if(!v&&C>0){const T=E.now(),M=(T-_.timeAdded)/C,R=s?(T-s.timeAdded)/C:-1,z=f.getSource(),F=g.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),X=!s||Math.abs(s.tileID.overscaledZ-F)>Math.abs(_.tileID.overscaledZ-F),ie=X&&_.refreshedUponExpiration?1:u.ac(X?M:1-R,0,1);return _.refreshedUponExpiration&&M>=1&&(_.refreshedUponExpiration=!1),s?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const xm=new u.aO(1,0,0,1),xh=new u.aO(0,1,0,1),hp=new u.aO(0,0,1,1),r_=new u.aO(1,0,1,1),wm=new u.aO(0,1,1,1);function Ir(_,s,f,d){$i(_,0,s+f/2,_.transform.width,f,d)}function qa(_,s,f,d){$i(_,s-f/2,0,f,_.transform.height,d)}function $i(_,s,f,d,g,v){const C=_.context,T=C.gl;T.enable(T.SCISSOR_TEST),T.scissor(s*_.pixelRatio,f*_.pixelRatio,d*_.pixelRatio,g*_.pixelRatio),C.clear({color:v}),T.disable(T.SCISSOR_TEST)}function fp(_,s,f){const d=_.context,g=d.gl,v=f.posMatrix,C=_.useProgram("debug"),T=wn.disabled,M=rr.disabled,R=_.colorModeForRenderPass(),z="$debug",F=_.style.map.terrain&&_.style.map.terrain.getTerrainData(f);d.activeTexture.set(g.TEXTURE0);const X=s.getTileByID(f.key).latestRawTileData,ie=Math.floor((X&&X.byteLength||0)/1024),re=s.getTile(f).tileSize,ue=512/Math.min(re,512)*(f.overscaledZ/_.transform.zoom)*.5;let $=f.canonical.toString();f.overscaledZ!==f.canonical.z&&($+=` => ${f.overscaledZ}`),function(ve,Fe){ve.initDebugOverlayCanvas();const he=ve.debugOverlayCanvas,Ie=ve.context.gl,Be=ve.debugOverlayCanvas.getContext("2d");Be.clearRect(0,0,he.width,he.height),Be.shadowColor="white",Be.shadowBlur=2,Be.lineWidth=1.5,Be.strokeStyle="white",Be.textBaseline="top",Be.font="bold 36px Open Sans, sans-serif",Be.fillText(Fe,5,5),Be.strokeText(Fe,5,5),ve.debugOverlayTexture.update(he),ve.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(_,`${$} ${ie}kB`),C.draw(d,g.TRIANGLES,T,M,Ur.alphaBlended,$n.disabled,om(v,u.aO.transparent,ue),null,z,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),C.draw(d,g.LINE_STRIP,T,M,R,$n.disabled,om(v,u.aO.red),F,z,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function wh(_,s,f){const d=_.context,g=d.gl,v=_.colorModeForRenderPass(),C=new wn(g.LEQUAL,wn.ReadWrite,_.depthRangeFor3D),T=_.useProgram("terrain"),M=s.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,_.width,_.height]);for(const R of f){const z=_.renderToTexture.getTexture(R),F=s.getTerrainData(R.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,z.texture);const X={u_matrix:_.transform.calculatePosMatrix(R.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(_.transform.zoom)};T.draw(d,g.TRIANGLES,C,rr.disabled,v,$n.backCCW,X,F,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class Sm{constructor(s,f){this.context=new n_(s),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Kr.maxUnderzooming+Kr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ua}resize(s,f,d){if(this.width=Math.floor(s*d),this.height=Math.floor(f*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,f=new u.aV;f.emplaceBack(0,0),f.emplaceBack(u.W,0),f.emplaceBack(0,u.W),f.emplaceBack(u.W,u.W),this.tileExtentBuffer=s.createVertexBuffer(f,$c.members),this.tileExtentSegments=u.$.simpleSegment(0,0,4,2);const d=new u.aV;d.emplaceBack(0,0),d.emplaceBack(u.W,0),d.emplaceBack(0,u.W),d.emplaceBack(u.W,u.W),this.debugBuffer=s.createVertexBuffer(d,$c.members),this.debugSegments=u.$.simpleSegment(0,0,4,5);const g=new u.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(u.W,0,u.W,0),g.emplaceBack(0,u.W,0,u.W),g.emplaceBack(u.W,u.W,u.W,u.W),this.rasterBoundsBuffer=s.createVertexBuffer(g,ln.members),this.rasterBoundsSegments=u.$.simpleSegment(0,0,4,2);const v=new u.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,$c.members),this.viewportSegments=u.$.simpleSegment(0,0,4,2);const C=new u.aW;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(C);const T=new u.aX;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);const M=this.context.gl;this.stencilClearMode=new rr({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const s=this.context,f=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=u.F();u.aN(d,0,this.width,this.height,0,0,1),u.J(d,d,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,f.TRIANGLES,wn.disabled,this.stencilClearMode,Ur.disabled,$n.disabled,rh(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,f){if(this.currentStencilSource===s.source||!s.isTileClipped()||!f||!f.length)return;this.currentStencilSource=s.source;const d=this.context,g=d.gl;this.nextStencilID+f.length>256&&this.clearStencil(),d.setColorMode(Ur.disabled),d.setDepthMode(wn.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of f){const T=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);v.draw(d,g.TRIANGLES,wn.disabled,new rr({func:g.ALWAYS,mask:0},T,255,g.KEEP,g.KEEP,g.REPLACE),Ur.disabled,$n.disabled,rh(C.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,f=this.context.gl;return new rr({func:f.NOTEQUAL,mask:255},s,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(s){const f=this.context.gl;return new rr({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(s){const f=this.context.gl,d=s.sort((C,T)=>T.overscaledZ-C.overscaledZ),g=d[d.length-1].overscaledZ,v=d[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const C={};for(let T=0;T<v;T++)C[T+g]=new rr({func:f.GEQUAL,mask:255},T+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=v,[C,d]}return[{[g]:rr.disabled},d]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Ur([s.CONSTANT_COLOR,s.ONE],new u.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ur.unblended:Ur.alphaBlended}depthModeForSublayer(s,f,d){if(!this.opaquePassEnabledForLayer())return wn.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new wn(d||this.context.gl.LEQUAL,f,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,f){this.style=s,this.options=f,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(E.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,v={},C={},T={};for(const M in g){const R=g[M];R.used&&R.prepare(this.context),v[M]=R.getVisibleCoordinates(),C[M]=v[M].slice().reverse(),T[M]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<d.length;M++)if(this.style._layers[d[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of d){const R=this.style._layers[M];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const z=C[R.source];(R.type==="custom"||z.length)&&this.renderLayer(this,g[R.source],R,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?u.aO.black:u.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[d[this.currentLayer]],R=g[M.source],z=v[M.source];this._renderTileClippingMasks(M,z),this.renderLayer(this,R,M,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const M=this.style._layers[d[this.currentLayer]],R=g[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const z=(M.type==="symbol"?T:C)[M.source];this._renderTileClippingMasks(M,v[M.source]),this.renderLayer(this,R,M,z)}if(this.options.showTileBoundaries){const M=function(R,z){let F=null;const X=Object.values(R._layers).flatMap($=>$.source&&!$.isHidden(z)?[R.sourceCaches[$.source]]:[]),ie=X.filter($=>$.getSource().type==="vector"),re=X.filter($=>$.getSource().type!=="vector"),ue=$=>{(!F||F.getSource().maxzoom<$.getSource().maxzoom)&&(F=$)};return ie.forEach($=>ue($)),F||re.forEach($=>ue($)),F}(this.style,this.transform.zoom);M&&function(R,z,F){for(let X=0;X<F.length;X++)fp(R,z,F[X])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const R=M.transform.padding;Ir(M,M.transform.height-(R.top||0),3,xm),Ir(M,R.bottom||0,3,xh),qa(M,R.left||0,3,hp),qa(M,M.transform.width-(R.right||0),3,r_);const z=M.transform.centerPoint;(function(F,X,ie,re){$i(F,X-1,ie-10,2,20,re),$i(F,X-10,ie-1,20,2,re)})(M,z.x,M.transform.height-z.y,wm)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,d=this.transform.projMatrix;let g=this.terrainFacilitator.dirty;g||(g=s?!u.aY(f,d):!u.aZ(f,d)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(u.a_(f,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,C){const T=v.context,M=T.gl,R=Ur.unblended,z=new wn(M.LEQUAL,wn.ReadWrite,[0,1]),F=C.getTerrainMesh(),X=C.sourceCache.getRenderableTiles(),ie=v.useProgram("terrainDepth");T.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),T.clear({color:u.aO.transparent,depth:1});for(const re of X){const ue=C.getTerrainData(re.tileID),$={u_matrix:v.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(v.transform.zoom)};ie.draw(T,M.TRIANGLES,z,rr.disabled,R,$n.backCCW,$,ue,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,C){const T=v.context,M=T.gl,R=Ur.unblended,z=new wn(M.LEQUAL,wn.ReadWrite,[0,1]),F=C.getTerrainMesh(),X=C.getCoordsTexture(),ie=C.sourceCache.getRenderableTiles(),re=v.useProgram("terrainCoords");T.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),T.clear({color:u.aO.transparent,depth:1}),C.coordsIndex=[];for(const ue of ie){const $=C.getTerrainData(ue.tileID);T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,X.texture);const ve={u_matrix:v.transform.calculatePosMatrix(ue.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(v.transform.zoom)};re.draw(T,M.TRIANGLES,z,rr.disabled,R,$n.backCCW,ve,$,"terrain",F.vertexBuffer,F.indexBuffer,F.segments),C.coordsIndex.push(ue.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(s,f,d,g){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(g||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(v,C,T,M,R){if(v.renderPass!=="translucent")return;const z=rr.disabled,F=v.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(X,ie,re,ue,$,ve,Fe){const he=ie.transform,Ie=$==="map",Be=ve==="map";for(const Ge of X){const He=ue.getTile(Ge),et=He.getBucket(re);if(!et||!et.text||!et.text.segments.get().length)continue;const $e=u.ag(et.textSizeData,he.zoom),ut=Zt(He,1,ie.transform.zoom),ft=Kt(Ge.posMatrix,Be,Ie,ie.transform,ut),nn=re.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if($e){const pt=Math.pow(2,he.zoom-He.tileID.overscaledZ);mh(et,Ie,Be,Fe,he,ft,Ge.posMatrix,pt,$e,nn,ie.style.map.terrain?(Bt,rn)=>ie.style.map.terrain.getElevation(Ge,Bt,rn):null)}}}(M,v,T,C,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),R),T.paint.get("icon-opacity").constantOr(1)!==0&&yh(v,C,T,M,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),z,F),T.paint.get("text-opacity").constantOr(1)!==0&&yh(v,C,T,M,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),z,F),C.map.showCollisionBoxes&&(dh(v,C,T,M,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),!0),dh(v,C,T,M,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),!1))})(s,f,d,g,this.style.placement.variableOffsets);break;case"circle":(function(v,C,T,M){if(v.renderPass!=="translucent")return;const R=T.paint.get("circle-opacity"),z=T.paint.get("circle-stroke-width"),F=T.paint.get("circle-stroke-opacity"),X=!T.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(z.constantOr(1)===0||F.constantOr(1)===0))return;const ie=v.context,re=ie.gl,ue=v.depthModeForSublayer(0,wn.ReadOnly),$=rr.disabled,ve=v.colorModeForRenderPass(),Fe=[];for(let he=0;he<M.length;he++){const Ie=M[he],Be=C.getTile(Ie),Ge=Be.getBucket(T);if(!Ge)continue;const He=Ge.programConfigurations.get(T.id),et=v.useProgram("circle",He),$e=Ge.layoutVertexBuffer,ut=Ge.indexBuffer,ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ie),nn={programConfiguration:He,program:et,layoutVertexBuffer:$e,indexBuffer:ut,uniformValues:Wy(v,Ie,Be,T),terrainData:ft};if(X){const pt=Ge.segments.get();for(const Bt of pt)Fe.push({segments:new u.$([Bt]),sortKey:Bt.sortKey,state:nn})}else Fe.push({segments:Ge.segments,sortKey:0,state:nn})}X&&Fe.sort((he,Ie)=>he.sortKey-Ie.sortKey);for(const he of Fe){const{programConfiguration:Ie,program:Be,layoutVertexBuffer:Ge,indexBuffer:He,uniformValues:et,terrainData:$e}=he.state;Be.draw(ie,re.TRIANGLES,ue,$,ve,$n.disabled,et,$e,T.id,Ge,He,he.segments,T.paint,v.transform.zoom,Ie)}})(s,f,d,g);break;case"heatmap":(function(v,C,T,M){if(T.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const R=v.context,z=R.gl,F=rr.disabled,X=new Ur([z.ONE,z.ONE],u.aO.transparent,[!0,!0,!0,!0]);(function(ie,re,ue){const $=ie.gl;ie.activeTexture.set($.TEXTURE1),ie.viewport.set([0,0,re.width/4,re.height/4]);let ve=ue.heatmapFbo;if(ve)$.bindTexture($.TEXTURE_2D,ve.colorAttachment.get()),ie.bindFramebuffer.set(ve.framebuffer);else{const Fe=$.createTexture();$.bindTexture($.TEXTURE_2D,Fe),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ve=ue.heatmapFbo=ie.createFramebuffer(re.width/4,re.height/4,!1,!1),function(he,Ie,Be,Ge){var He,et;const $e=he.gl,ut=(He=he.HALF_FLOAT)!==null&&He!==void 0?He:$e.UNSIGNED_BYTE,ft=(et=he.RGBA16F)!==null&&et!==void 0?et:$e.RGBA;$e.texImage2D($e.TEXTURE_2D,0,ft,Ie.width/4,Ie.height/4,0,$e.RGBA,ut,null),Ge.colorAttachment.set(Be)}(ie,re,Fe,ve)}})(R,v,T),R.clear({color:u.aO.transparent});for(let ie=0;ie<M.length;ie++){const re=M[ie];if(C.hasRenderableParent(re))continue;const ue=C.getTile(re),$=ue.getBucket(T);if(!$)continue;const ve=$.programConfigurations.get(T.id),Fe=v.useProgram("heatmap",ve),{zoom:he}=v.transform;Fe.draw(R,z.TRIANGLES,wn.disabled,F,X,$n.disabled,sm(re.posMatrix,ue,he,T.paint.get("heatmap-intensity")),null,T.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,T.paint,v.transform.zoom,ve)}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(R,z){const F=R.context,X=F.gl,ie=z.heatmapFbo;if(!ie)return;F.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,ie.colorAttachment.get()),F.activeTexture.set(X.TEXTURE1);let re=z.colorRampTexture;re||(re=z.colorRampTexture=new Z(F,z.colorRamp,X.RGBA)),re.bind(X.LINEAR,X.CLAMP_TO_EDGE),R.useProgram("heatmapTexture").draw(F,X.TRIANGLES,wn.disabled,rr.disabled,R.colorModeForRenderPass(),$n.disabled,((ue,$,ve,Fe)=>{const he=u.F();u.aN(he,0,ue.width,ue.height,0,0,1);const Ie=ue.context.gl;return{u_matrix:he,u_world:[Ie.drawingBufferWidth,Ie.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}})(R,z),null,z.id,R.viewportBuffer,R.quadTriangleIndexBuffer,R.viewportSegments,z.paint,R.transform.zoom)}(v,T))})(s,f,d,g);break;case"line":(function(v,C,T,M){if(v.renderPass!=="translucent")return;const R=T.paint.get("line-opacity"),z=T.paint.get("line-width");if(R.constantOr(1)===0||z.constantOr(1)===0)return;const F=v.depthModeForSublayer(0,wn.ReadOnly),X=v.colorModeForRenderPass(),ie=T.paint.get("line-dasharray"),re=T.paint.get("line-pattern"),ue=re.constantOr(1),$=T.paint.get("line-gradient"),ve=T.getCrossfadeParameters(),Fe=ue?"linePattern":ie?"lineSDF":$?"lineGradient":"line",he=v.context,Ie=he.gl;let Be=!0;for(const Ge of M){const He=C.getTile(Ge);if(ue&&!He.patternsLoaded())continue;const et=He.getBucket(T);if(!et)continue;const $e=et.programConfigurations.get(T.id),ut=v.context.program.get(),ft=v.useProgram(Fe,$e),nn=Be||ft.program!==ut,pt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ge),Bt=re.constantOr(null);if(Bt&&He.imageAtlas){const jt=He.imageAtlas,an=jt.patternPositions[Bt.to.toString()],fn=jt.patternPositions[Bt.from.toString()];an&&fn&&$e.setConstantPatternPositions(an,fn)}const rn=pt?Ge:null,Sn=ue?Sl(v,He,T,ve,rn):ie?oh(v,He,T,ie,ve,rn):$?lm(v,He,T,et.lineClipsArray.length,rn):ih(v,He,T,rn);if(ue)he.activeTexture.set(Ie.TEXTURE0),He.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),$e.updatePaintBuffers(ve);else if(ie&&(nn||v.lineAtlas.dirty))he.activeTexture.set(Ie.TEXTURE0),v.lineAtlas.bind(he);else if($){const jt=et.gradients[T.id];let an=jt.texture;if(T.gradientVersion!==jt.version){let fn=256;if(T.stepInterpolant){const Tr=C.getSource().maxzoom,Gn=Ge.canonical.z===Tr?Math.ceil(1<<v.transform.maxZoom-Ge.canonical.z):1;fn=u.ac(u.aT(et.maxLineLength/u.W*1024*Gn),256,he.maxTextureSize)}jt.gradient=u.aU({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:fn,image:jt.gradient||void 0,clips:et.lineClipsArray}),jt.texture?jt.texture.update(jt.gradient):jt.texture=new Z(he,jt.gradient,Ie.RGBA),jt.version=T.gradientVersion,an=jt.texture}he.activeTexture.set(Ie.TEXTURE0),an.bind(T.stepInterpolant?Ie.NEAREST:Ie.LINEAR,Ie.CLAMP_TO_EDGE)}ft.draw(he,Ie.TRIANGLES,F,v.stencilModeForClipping(Ge),X,$n.disabled,Sn,pt,T.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,T.paint,v.transform.zoom,$e,et.layoutVertexBuffer2),Be=!1}})(s,f,d,g);break;case"fill":(function(v,C,T,M){const R=T.paint.get("fill-color"),z=T.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const F=v.colorModeForRenderPass(),X=T.paint.get("fill-pattern"),ie=v.opaquePassEnabledForLayer()&&!X.constantOr(1)&&R.constantOr(u.aO.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===ie){const re=v.depthModeForSublayer(1,v.renderPass==="opaque"?wn.ReadWrite:wn.ReadOnly);vm(v,C,T,M,re,F,!1)}if(v.renderPass==="translucent"&&T.paint.get("fill-antialias")){const re=v.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,wn.ReadOnly);vm(v,C,T,M,re,F,!0)}})(s,f,d,g);break;case"fill-extrusion":(function(v,C,T,M){const R=T.paint.get("fill-extrusion-opacity");if(R!==0&&v.renderPass==="translucent"){const z=new wn(v.context.gl.LEQUAL,wn.ReadWrite,v.depthRangeFor3D);if(R!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))vh(v,C,T,M,z,rr.disabled,Ur.disabled),vh(v,C,T,M,z,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const F=v.colorModeForRenderPass();vh(v,C,T,M,z,rr.disabled,F)}}})(s,f,d,g);break;case"hillshade":(function(v,C,T,M){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const R=v.context,z=v.depthModeForSublayer(0,wn.ReadOnly),F=v.colorModeForRenderPass(),[X,ie]=v.renderPass==="translucent"?v.stencilConfigForOverlap(M):[{},M];for(const re of ie){const ue=C.getTile(re);ue.needsHillshadePrepare!==void 0&&ue.needsHillshadePrepare&&v.renderPass==="offscreen"?cp(v,ue,T,z,rr.disabled,F):v.renderPass==="translucent"&&bh(v,re,ue,T,z,X[re.overscaledZ],F)}R.viewport.set([0,0,v.width,v.height])})(s,f,d,g);break;case"raster":(function(v,C,T,M){if(v.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!M.length)return;const R=v.context,z=R.gl,F=C.getSource(),X=v.useProgram("raster"),ie=v.colorModeForRenderPass(),[re,ue]=F instanceof er?[{},M]:v.stencilConfigForOverlap(M),$=ue[ue.length-1].overscaledZ,ve=!v.options.moving;for(const Fe of ue){const he=v.depthModeForSublayer(Fe.overscaledZ-$,T.paint.get("raster-opacity")===1?wn.ReadWrite:wn.ReadOnly,z.LESS),Ie=C.getTile(Fe);Ie.registerFadeDuration(T.paint.get("raster-fade-duration"));const Be=C.findLoadedParent(Fe,0),Ge=bm(Ie,Be,C,T,v.transform,v.style.map.terrain);let He,et;const $e=T.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;R.activeTexture.set(z.TEXTURE0),Ie.texture.bind($e,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(z.TEXTURE1),Be?(Be.texture.bind($e,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),He=Math.pow(2,Be.tileID.overscaledZ-Ie.tileID.overscaledZ),et=[Ie.tileID.canonical.x*He%1,Ie.tileID.canonical.y*He%1]):Ie.texture.bind($e,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const ut=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Fe),ft=ut?Fe:null,nn=ft?ft.posMatrix:v.transform.calculatePosMatrix(Fe.toUnwrapped(),ve),pt=sh(nn,et||[0,0],He||1,Ge,T);F instanceof er?X.draw(R,z.TRIANGLES,he,rr.disabled,ie,$n.disabled,pt,ut,T.id,F.boundsBuffer,v.quadTriangleIndexBuffer,F.boundsSegments):X.draw(R,z.TRIANGLES,he,re[Fe.overscaledZ],ie,$n.disabled,pt,ut,T.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(s,f,d,g);break;case"background":(function(v,C,T,M){const R=T.paint.get("background-color"),z=T.paint.get("background-opacity");if(z===0)return;const F=v.context,X=F.gl,ie=v.transform,re=ie.tileSize,ue=T.paint.get("background-pattern");if(v.isPatternMissing(ue))return;const $=!ue&&R.a===1&&z===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==$)return;const ve=rr.disabled,Fe=v.depthModeForSublayer(0,$==="opaque"?wn.ReadWrite:wn.ReadOnly),he=v.colorModeForRenderPass(),Ie=v.useProgram(ue?"backgroundPattern":"background"),Be=M||ie.coveringTiles({tileSize:re,terrain:v.style.map.terrain});ue&&(F.activeTexture.set(X.TEXTURE0),v.imageManager.bind(v.context));const Ge=T.getCrossfadeParameters();for(const He of Be){const et=M?He.posMatrix:v.transform.calculatePosMatrix(He.toUnwrapped()),$e=ue?Zy(et,z,v,ue,{tileID:He,tileSize:re},Ge):Hy(et,z,R),ut=v.style.map.terrain&&v.style.map.terrain.getTerrainData(He);Ie.draw(F,X.TRIANGLES,Fe,ve,he,$n.disabled,$e,ut,T.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(s,0,d,g);break;case"custom":(function(v,C,T){const M=v.context,R=T.implementation;if(v.renderPass==="offscreen"){const z=R.prerender;z&&(v.setCustomLayerDefaults(),M.setColorMode(v.colorModeForRenderPass()),z.call(R,M.gl,v.transform.customLayerMatrix()),M.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),M.setColorMode(v.colorModeForRenderPass()),M.setStencilMode(rr.disabled);const z=R.renderingMode==="3d"?new wn(v.context.gl.LEQUAL,wn.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,wn.ReadOnly);M.setDepthMode(z),R.render(M.gl,v.transform.customLayerMatrix()),M.setDirty(),v.setBaseState(),M.bindFramebuffer.set(null)}})(s,0,d)}}translatePosMatrix(s,f,d,g,v){if(!d[0]&&!d[1])return s;const C=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){const R=Math.sin(C),z=Math.cos(C);d=[d[0]*z-d[1]*R,d[0]*R+d[1]*z]}const T=[v?d[0]:Zt(f,d[0],this.transform.zoom),v?d[1]:Zt(f,d[1],this.transform.zoom),0],M=new Float32Array(16);return u.H(M,s,T),M}saveTileTexture(s){const f=this._tileTextures[s.size[0]];f?f.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const f=this._tileTextures[s];return f&&f.length>0?f.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const f=this.imageManager.getPattern(s.from.toString()),d=this.imageManager.getPattern(s.to.toString());return!f||!d}useProgram(s,f){this.cache=this.cache||{};const d=s+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new Ga(this.context,Ju[s],f,um[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Z(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:f}=this.context.gl;return this.width!==s||this.height!==f}}class ja{constructor(s,f){this.points=s,this.planes=f}static fromInvProjectionMatrix(s,f,d){const g=Math.pow(2,d),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const M=1/(T=u.af([],T,s))[3]/f*g;return u.a$(T,T,[M,M,1/T[3],M])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const M=function(X,ie){var re=ie[0],ue=ie[1],$=ie[2],ve=re*re+ue*ue+$*$;return ve>0&&(ve=1/Math.sqrt(ve)),X[0]=ie[0]*ve,X[1]=ie[1]*ve,X[2]=ie[2]*ve,X}([],function(X,ie,re){var ue=ie[0],$=ie[1],ve=ie[2],Fe=re[0],he=re[1],Ie=re[2];return X[0]=$*Ie-ve*he,X[1]=ve*Fe-ue*Ie,X[2]=ue*he-$*Fe,X}([],ce([],v[T[0]],v[T[1]]),ce([],v[T[2]],v[T[1]]))),R=-((z=M)[0]*(F=v[T[1]])[0]+z[1]*F[1]+z[2]*F[2]);var z,F;return M.concat(R)});return new ja(v,C)}}class Wa{constructor(s,f){this.min=s,this.max=f,this.center=function(d,g,v){return d[0]=.5*g[0],d[1]=.5*g[1],d[2]=.5*g[2],d}([],function(d,g,v){return d[0]=g[0]+v[0],d[1]=g[1]+v[1],d[2]=g[2]+v[2],d}([],this.min,this.max))}quadrant(s){const f=[s%2==0,s<2],d=_e(this.min),g=_e(this.max);for(let v=0;v<f.length;v++)d[v]=f[v]?this.min[v]:this.center[v],g[v]=f[v]?this.center[v]:this.max[v];return g[2]=this.max[2],new Wa(d,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let g=0;g<s.planes.length;g++){const v=s.planes[g];let C=0;for(let T=0;T<f.length;T++)u.b0(v,f[T])>=0&&C++;if(C===0)return 0;C!==f.length&&(d=!1)}if(d)return 2;for(let g=0;g<3;g++){let v=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let T=0;T<s.points.length;T++){const M=s.points[T][g]-this.min[g];v=Math.min(v,M),C=Math.max(C,M)}if(C<0||v>this.max[g]-this.min[g])return 0}return 1}}class cu{constructor(s=0,f=0,d=0,g=0){if(isNaN(s)||s<0||isNaN(f)||f<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=f,this.left=d,this.right=g}interpolate(s,f,d){return f.top!=null&&s.top!=null&&(this.top=u.z.number(s.top,f.top,d)),f.bottom!=null&&s.bottom!=null&&(this.bottom=u.z.number(s.bottom,f.bottom,d)),f.left!=null&&s.left!=null&&(this.left=u.z.number(s.left,f.left,d)),f.right!=null&&s.right!=null&&(this.right=u.z.number(s.right,f.right,d)),this}getCenter(s,f){const d=u.ac((this.left+s-this.right)/2,0,s),g=u.ac((this.top+f-this.bottom)/2,0,f);return new u.P(d,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new cu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const pp=85.051129;class Sh{constructor(s,f,d,g,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=s||0,this._maxZoom=f||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cu,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new Sh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const f=-u.b1(s,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var d=new u.A(4);return u.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,g,v){var C=g[0],T=g[1],M=g[2],R=g[3],z=Math.sin(v),F=Math.cos(v);d[0]=C*F+M*z,d[1]=T*F+R*z,d[2]=C*-z+M*F,d[3]=T*-z+R*F}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const f=u.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const f=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,f,d){this._unmodified=!1,this._edgeInsets.interpolate(s,f,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const f=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(s){const f=[new u.b2(0,s)];if(this._renderWorldCopies){const d=this.pointCoordinate(new u.P(0,0)),g=this.pointCoordinate(new u.P(this.width,0)),v=this.pointCoordinate(new u.P(this.width,this.height)),C=this.pointCoordinate(new u.P(0,this.height)),T=Math.floor(Math.min(d.x,g.x,v.x,C.x)),M=Math.floor(Math.max(d.x,g.x,v.x,C.x)),R=1;for(let z=T-R;z<=M+R;z++)z!==0&&f.push(new u.b2(z,s))}return f}coveringTiles(s){var f,d;let g=this.coveringZoomLevel(s);const v=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),T=u.Y.fromLngLat(this.center),M=Math.pow(2,g),R=[M*C.x,M*C.y,0],z=[M*T.x,M*T.y,0],F=ja.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let X=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(X=g);const ie=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,re=he=>({aabb:new Wa([he*M,0,0],[(he+1)*M,M,0]),zoom:0,x:0,y:0,wrap:he,fullyVisible:!1}),ue=[],$=[],ve=g,Fe=s.reparseOverscaled?v:g;if(this._renderWorldCopies)for(let he=1;he<=3;he++)ue.push(re(-he)),ue.push(re(he));for(ue.push(re(0));ue.length>0;){const he=ue.pop(),Ie=he.x,Be=he.y;let Ge=he.fullyVisible;if(!Ge){const ft=he.aabb.intersects(F);if(ft===0)continue;Ge=ft===2}const He=s.terrain?R:z,et=he.aabb.distanceX(He),$e=he.aabb.distanceY(He),ut=Math.max(Math.abs(et),Math.abs($e));if(he.zoom===ve||ut>ie+(1<<ve-he.zoom)-2&&he.zoom>=X){const ft=ve-he.zoom,nn=R[0]-.5-(Ie<<ft),pt=R[1]-.5-(Be<<ft);$.push({tileID:new u.Q(he.zoom===ve?Fe:he.zoom,he.wrap,he.zoom,Ie,Be),distanceSq:me([z[0]-.5-Ie,z[1]-.5-Be]),tileDistanceToCamera:Math.sqrt(nn*nn+pt*pt)})}else for(let ft=0;ft<4;ft++){const nn=(Ie<<1)+ft%2,pt=(Be<<1)+(ft>>1),Bt=he.zoom+1;let rn=he.aabb.quadrant(ft);if(s.terrain){const Sn=new u.Q(Bt,he.wrap,Bt,nn,pt),jt=s.terrain.getMinMaxElevation(Sn),an=(f=jt.minElevation)!==null&&f!==void 0?f:this.elevation,fn=(d=jt.maxElevation)!==null&&d!==void 0?d:this.elevation;rn=new Wa([rn.min[0],rn.min[1],an],[rn.max[0],rn.max[1],fn])}ue.push({aabb:rn,zoom:Bt,x:nn,y:pt,wrap:he.wrap,fullyVisible:Ge})}}return $.sort((he,Ie)=>he.distanceSq-Ie.distanceSq).map(he=>he.tileID)}resize(s,f){this.width=s,this.height=f,this.pixelsToGLUnits=[2/s,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const f=u.ac(s.lat,-85.051129,pp);return new u.P(u.N(s.lng)*this.worldSize,u.O(f)*this.worldSize)}unproject(s){return new u.Y(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const f=this.elevation,d=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,s),v=s.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-v))return;const C=d+f-v,T=Math.cos(this._pitch)*this.cameraToCenterDistance/C/u.b3(1,g.lat),M=this.scaleZoom(T/this.tileSize);this._elevation=v,this._center=g,this.zoom=M}setLocationAtPoint(s,f){const d=this.pointCoordinate(f),g=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(s),C=new u.Y(v.x-(d.x-g.x),v.y-(d.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,f){return f?this.coordinatePoint(this.locationCoordinate(s),f.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,f){return this.coordinateLocation(this.pointCoordinate(s,f))}locationCoordinate(s){return u.Y.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,f){if(f){const X=f.pointCoordinate(s);if(X!=null)return X}const d=[s.x,s.y,0,1],g=[s.x,s.y,1,1];u.af(d,d,this.pixelMatrixInverse),u.af(g,g,this.pixelMatrixInverse);const v=d[3],C=g[3],T=d[1]/v,M=g[1]/C,R=d[2]/v,z=g[2]/C,F=R===z?0:(0-R)/(z-R);return new u.Y(u.z.number(d[0]/v,g[0]/C,F)/this.worldSize,u.z.number(T,M,F)/this.worldSize)}coordinatePoint(s,f=0,d=this.pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,f,1];return u.af(g,g,d),new u.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Pe().extend(this.pointLocation(new u.P(0,s))).extend(this.pointLocation(new u.P(this.width,s))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Pe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,pp])}calculatePosMatrix(s,f=!1){const d=s.key,g=f?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];const v=s.canonical,C=this.worldSize/this.zoomScale(v.z),T=v.x+Math.pow(2,v.z)*s.wrap,M=u.an(new Float64Array(16));return u.H(M,M,[T*C,v.y*C,0]),u.J(M,M,[C/u.W,C/u.W,1]),u.K(M,f?this.alignedProjMatrix:this.projMatrix,M),g[d]=new Float32Array(M),g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,f){f=u.ac(+f,this.minZoom,this.maxZoom);const d={center:new u.M(s.lng,s.lat),zoom:f};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const he=179.9999999999;g=[-he,he]}const v=this.tileSize*this.zoomScale(d.zoom);let C=0,T=v,M=0,R=v,z=0,F=0;const{x:X,y:ie}=this.size;if(this.latRange){const he=this.latRange;C=u.O(he[1])*v,T=u.O(he[0])*v,T-C<ie&&(z=ie/(T-C))}g&&(M=u.b1(u.N(g[0])*v,0,v),R=u.b1(u.N(g[1])*v,0,v),R<M&&(R+=v),R-M<X&&(F=X/(R-M)));const{x:re,y:ue}=this.project.call({worldSize:v},s);let $,ve;const Fe=Math.max(F||0,z||0);if(Fe){const he=new u.P(F?(R+M)/2:re,z?(T+C)/2:ue);return d.center=this.unproject.call({worldSize:v},he).wrap(),d.zoom+=this.scaleZoom(Fe),d}if(this.latRange){const he=ie/2;ue-he<C&&(ve=C+he),ue+he>T&&(ve=T-he)}if(g){const he=(M+R)/2;let Ie=re;this._renderWorldCopies&&(Ie=u.b1(re,he-v/2,he+v/2));const Be=X/2;Ie-Be<M&&($=M+Be),Ie+Be>R&&($=R-Be)}if($!==void 0||ve!==void 0){const he=new u.P($??re,ve??ue);d.center=this.unproject.call({worldSize:v},he).wrap()}return d}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:f,zoom:d}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=d,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,f=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b3(1,this.center.lat)*this.worldSize;let g=u.an(new Float64Array(16));u.J(g,g,[this.width/2,-this.height/2,1]),u.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=u.an(new Float64Array(16)),u.J(g,g,[1,-1,1]),u.H(g,g,[-1,-1,0]),u.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),C=Math.min(this.elevation,this.minElevationForCurrentTile),T=v-C*this._pixelPerMeter/Math.cos(this._pitch),M=C<0?T:v,R=Math.PI/2+this._pitch,z=this._fov*(.5+s.y/this.height),F=Math.sin(z)*M/Math.sin(u.ac(Math.PI-R-z,.01,Math.PI-.01)),X=this.getHorizon(),ie=2*Math.atan(X/this.cameraToCenterDistance)*(.5+s.y/(2*X)),re=Math.sin(ie)*M/Math.sin(u.ac(Math.PI-R-ie,.01,Math.PI-.01)),ue=Math.min(F,re),$=1.01*(Math.cos(Math.PI/2-this._pitch)*ue+M),ve=this.height/50;g=new Float64Array(16),u.b4(g,this._fov,this.width/this.height,ve,$),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,u.J(g,g,[1,-1,1]),u.H(g,g,[0,0,-this.cameraToCenterDistance]),u.b5(g,g,this._pitch),u.ad(g,g,this.angle),u.H(g,g,[-f,-d,0]),this.mercatorMatrix=u.J([],g,[this.worldSize,this.worldSize,this.worldSize]),u.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.K(new Float64Array(16),this.labelPlaneMatrix,g),u.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=u.ar([],g),this.pixelMatrix3D=u.K(new Float64Array(16),this.labelPlaneMatrix,g);const Fe=this.width%2/2,he=this.height%2/2,Ie=Math.cos(this.angle),Be=Math.sin(this.angle),Ge=f-Math.round(f)+Ie*Fe+Be*he,He=d-Math.round(d)+Ie*he+Be*Fe,et=new Float64Array(g);if(u.H(et,et,[Ge>.5?Ge-1:Ge,He>.5?He-1:He,0]),this.alignedProjMatrix=et,g=u.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new u.P(0,0)),f=[s.x*this.worldSize,s.y*this.worldSize,0,1];return u.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,s))}getCameraQueryGeometry(s){const f=this.getCameraPoint();if(s.length===1)return[s[0],f];{let d=f.x,g=f.y,v=f.x,C=f.y;for(const T of s)d=Math.min(d,T.x),g=Math.min(g,T.y),v=Math.max(v,T.x),C=Math.max(C,T.y);return[new u.P(d,g),new u.P(v,g),new u.P(v,C),new u.P(d,C),new u.P(d,g)]}}lngLatToCameraDepth(s,f){const d=this.locationCoordinate(s),g=[d.x*this.worldSize,d.y*this.worldSize,f,1];return u.af(g,g,this.projMatrix),g[2]/g[3]}}function dp(_,s){let f,d=!1,g=null,v=null;const C=()=>{g=null,d&&(_.apply(v,f),g=setTimeout(C,s),d=!1)};return(...T)=>(d=!0,v=this,f=T,g||C(),g)}class mp{constructor(s){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let d;return f.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=dp(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const f=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),C=Math.round(f.lng*v)/v,T=Math.round(f.lat*v)/v,M=this._map.getBearing(),R=this._map.getPitch();let z="";if(z+=s?`/${C}/${T}/${d}`:`${d}/${T}/${C}`,(M||R)&&(z+="/"+Math.round(10*M)/10),R&&(z+=`/${Math.round(R)}`),this._hashName){const F=this._hashName;let X=!1;const ie=window.location.hash.slice(1).split("&").map(re=>{const ue=re.split("=")[0];return ue===F?(X=!0,`${ue}=${z}`):re}).filter(re=>re);return X||ie.push(`${F}=${z}`),`#${ie.join("&")}`}return`#${z}`}}const oc={linearity:.3,easing:u.b6(0,0,.3,1)},Tl=u.e({deceleration:2500,maxSpeed:1400},oc),Em=u.e({deceleration:20,maxSpeed:1400},oc),Im=u.e({deceleration:1e3,maxSpeed:360},oc),Cm=u.e({deceleration:1e3,maxSpeed:90},oc);class Tm{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:E.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,f=E.now();for(;s.length>0&&f-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)f.zoom+=v.zoomDelta||0,f.bearing+=v.bearingDelta||0,f.pitch+=v.pitchDelta||0,v.panDelta&&f.pan._add(v.panDelta),v.around&&(f.around=v.around),v.pinchAround&&(f.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(f.pan.mag()){const v=ac(f.pan.mag(),d,u.e({},Tl,s||{}));g.offset=f.pan.mult(v.amount/f.pan.mag()),g.center=this._map.transform.center,sc(g,v)}if(f.zoom){const v=ac(f.zoom,d,Em);g.zoom=this._map.transform.zoom+v.amount,sc(g,v)}if(f.bearing){const v=ac(f.bearing,d,Im);g.bearing=this._map.transform.bearing+u.ac(v.amount,-179,179),sc(g,v)}if(f.pitch){const v=ac(f.pitch,d,Cm);g.pitch=this._map.transform.pitch+v.amount,sc(g,v)}if(g.zoom||g.bearing){const v=f.pinchAround===void 0?f.around:f.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),u.e(g,{noMoveStart:!0})}}function sc(_,s){(!_.duration||_.duration<s.duration)&&(_.duration=s.duration,_.easing=s.easing)}function ac(_,s,f){const{maxSpeed:d,linearity:g,deceleration:v}=f,C=u.ac(_*g/(s/1e3),-d,d),T=Math.abs(C)/(v*g);return{easing:f.easing,duration:1e3*T,amount:C*(T/2)}}class mo extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,d,g={}){const v=P.mousePos(f.getCanvas(),d),C=f.unproject(v);super(s,u.e({point:v,lngLat:C,originalEvent:d},g)),this._defaultPrevented=!1,this.target=f}}class Bs extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,d){const g=s==="touchend"?d.changedTouches:d.touches,v=P.touchPos(f.getCanvasContainer(),g),C=v.map(M=>f.unproject(M)),T=v.reduce((M,R,z,F)=>M.add(R.div(F.length)),new u.P(0,0));super(s,{points:v,point:T,lngLats:C,lngLat:f.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class gp extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,d){super(s,{originalEvent:d}),this._defaultPrevented=!1}}class ms{constructor(s,f){this._map=s,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new gp(s.type,this._map,s))}mousedown(s,f){return this._mousedownPos=f,this._firePreventable(new mo(s.type,this._map,s))}mouseup(s){this._map.fire(new mo(s.type,this._map,s))}click(s,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new mo(s.type,this._map,s))}dblclick(s){return this._firePreventable(new mo(s.type,this._map,s))}mouseover(s){this._map.fire(new mo(s.type,this._map,s))}mouseout(s){this._map.fire(new mo(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Bs(s.type,this._map,s))}touchmove(s){this._map.fire(new Bs(s.type,this._map,s))}touchend(s){this._map.fire(new Bs(s.type,this._map,s))}touchcancel(s){this._map.fire(new Bs(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vs{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new mo(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new mo(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hu{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(u.P.convert(s),this._map.terrain)}}class gs{constructor(s,f){this._map=s,this._tr=new hu(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,f){this.isEnabled()&&s.shiftKey&&s.button===0&&(P.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(s,f){if(!this._active)return;const d=f;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=d,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(g.x,d.x),C=Math.max(g.x,d.x),T=Math.min(g.y,d.y),M=Math.max(g.y,d.y);P.setTransform(this._box,`translate(${v}px,${T}px)`),this._box.style.width=C-v+"px",this._box.style.height=M-T+"px"}mouseupWindow(s,f){if(!this._active||s.button!==0)return;const d=this._startPos,g=f;if(this.reset(),P.suppressClick(),d.x!==g.x||d.y!==g.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(d,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,f){return this._map.fire(new u.k(s,{originalEvent:f}))}}function Ll(_,s){if(_.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${s.length}`);const f={};for(let d=0;d<_.length;d++)f[_[d].identifier]=s[d];return f}class i_{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,f,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const v=new u.P(0,0);for(const C of g)v._add(C);return v.div(g.length)}(f),this.touches=Ll(d,f)))}touchmove(s,f,d){if(this.aborted||!this.centroid)return;const g=Ll(d,f);for(const v in this.touches){const C=g[v];(!C||C.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(s,f,d){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class yp{constructor(s){this.singleTap=new i_(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,f,d){this.singleTap.touchstart(s,f,d)}touchmove(s,f,d){this.singleTap.touchmove(s,f,d)}touchend(s,f,d){const g=this.singleTap.touchend(s,f,d);if(g){const v=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(v&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class o_{constructor(s){this._tr=new hu(s),this._zoomIn=new yp({numTouches:1,numTaps:2}),this._zoomOut=new yp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,f,d){this._zoomIn.touchstart(s,f,d),this._zoomOut.touchstart(s,f,d)}touchmove(s,f,d){this._zoomIn.touchmove(s,f,d),this._zoomOut.touchmove(s,f,d)}touchend(s,f,d){const g=this._zoomIn.touchend(s,f,d),v=this._zoomOut.touchend(s,f,d),C=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(g)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fu{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const f=this._moveFunction(...s);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(s,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,f){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=f.length?f[0]:f;return!this._moved&&g.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(d,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&P.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const lc={0:1,2:2};class Us{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const f=P.mouseButton(s);this._eventButton=f}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(f,d){const g=lc[d];return f.buttons===void 0||(f.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return P.mouseButton(s)===this._eventButton}}class St{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const Eh=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=function(s){s.preventDefault()}},pu=({enable:_,clickTolerance:s,bearingDegreesPerPixelMoved:f=.8})=>{const d=new Us({checkCorrectEvent:g=>P.mouseButton(g)===0&&g.ctrlKey||P.mouseButton(g)===2});return new fu({clickTolerance:s,move:(g,v)=>({bearingDelta:(v.x-g.x)*f}),moveStateManager:d,enable:_,assignEvents:Eh})},du=({enable:_,clickTolerance:s,pitchDegreesPerPixelMoved:f=-.5})=>{const d=new Us({checkCorrectEvent:g=>P.mouseButton(g)===0&&g.ctrlKey||P.mouseButton(g)===2});return new fu({clickTolerance:s,move:(g,v)=>({pitchDelta:(v.y-g.y)*f}),moveStateManager:d,enable:_,assignEvents:Eh})};class Lm{constructor(s,f){this._clickTolerance=s.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(s,f,d){return this._calculateTransform(s,f,d)}touchmove(s,f,d){if(this._active&&!(d.length<this.minTouchs()))return s.preventDefault(),this._calculateTransform(s,f,d)}touchend(s,f,d){this._calculateTransform(s,f,d),this._active&&d.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,f,d){d.length>0&&(this._active=!0);const g=Ll(d,f),v=new u.P(0,0),C=new u.P(0,0);let T=0;for(const R in g){const z=g[R],F=this._touches[R];F&&(v._add(z),C._add(z.sub(F)),T++,g[R]=z)}if(this._touches=g,T<this.minTouchs()||!C.mag())return;const M=C.div(T);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(T),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _t{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,f,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([f[0],f[1]]))}touchmove(s,f,d){if(!this._firstTwoTouches)return;s.preventDefault();const[g,v]=this._firstTwoTouches,C=mu(d,f,g),T=mu(d,f,v);if(!C||!T)return;const M=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],M,s)}touchend(s,f,d){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,C=mu(d,f,g),T=mu(d,f,v);C&&T||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function mu(_,s,f){for(let d=0;d<_.length;d++)if(_[d].identifier===f)return s[d]}function Pm(_,s){return Math.log(_/s)/Math.LN2}class Mm extends _t{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,f){const d=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Pm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pm(this._distance,d),pinchAround:f}}}function Ih(_,s){return 180*_.angleWith(s)/Math.PI}class _p extends _t{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,f,d){const g=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ih(this._vector,g),pinchAround:f}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const f=25/(Math.PI*this._minDiameter)*360,d=Ih(s,this._startVector);return Math.abs(d)<f}}function Ch(_){return Math.abs(_.y)>Math.abs(_.x)}class Am extends _t{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,f,d){super.touchstart(s,f,d),this._currentTouchCount=d.length}_start(s){this._lastPoints=s,Ch(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,f,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,v,d.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,f,d){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,v=f.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const C=s.y>0==f.y>0;return Ch(s)&&Ch(f)&&C}}const s_={panStep:100,bearingStep:15,pitchStep:10};class Ha{constructor(s){this._tr=new hu(s);const f=s_;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let f=0,d=0,g=0,v=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:s.shiftKey?d=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?d=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:T=>{const M=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:ur,zoom:f?Math.round(M.zoom)+f*(s.shiftKey?2:1):M.zoom,bearing:M.bearing+d*this._bearingStep,pitch:M.pitch+g*this._pitchStep,offset:[-v*this._panStep,-C*this._panStep],center:M.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ur(_){return _*(2-_)}const uc=4.000244140625;class Th{constructor(s,f){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=s,this._tr=new hu(s),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!s[this._map.cooperativeGestures._bypassKey])return;let f=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const d=E.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,f!==0&&f%uc==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),s.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=s,this._delta-=f,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=P.mousePos(this._map.getCanvas(),s),d=this._tr;this._around=f.y>d.transform.height/2-d.transform.getHorizon()?u.M.convert(this._aroundCenter?d.center:d.unproject(f)):u.M.convert(d.center),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>uc?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&M!==0&&(M=1/M);const R=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(R*M))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,d=this._startZoom,g=this._easing;let v,C=!1;if(this._type==="wheel"&&d&&g){const T=Math.min((E.now()-this._lastWheelEventTime)/200,1),M=g(T);v=u.z.number(d,f,M),T<1?this._frameId||(this._frameId=!0):C=!0}else v=f,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let f=u.b7;if(this._prevEase){const d=this._prevEase,g=(E.now()-d.start)/d.duration,v=d.easing(g+.01)-d.easing(g),C=.27/Math.sqrt(v*v+1e-4)*.01,T=Math.sqrt(.0729-C*C);f=u.b6(C,T,.25,1)}return this._prevEase={start:E.now(),duration:s,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class vp{constructor(s,f){this._clickZoom=s,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class km{constructor(s){this._tr=new hu(s),this.reset()}reset(){this._active=!1}dblclick(s,f){return s.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dm{constructor(){this._tap=new yp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,f,d){if(!this._swipePoint)if(this._tapTime){const g=f[0],v=s.timeStamp-this._tapTime<500,C=this._tapPoint.dist(g)<30;v&&C?d.length>0&&(this._swipePoint=g,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(s,f,d)}touchmove(s,f,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=f[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,f,d)}touchend(s,f,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const g=this._tap.touchend(s,f,d);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rm{constructor(s,f,d){this._el=s,this._mousePan=f,this._touchPan=d}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ys{constructor(s,f,d){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=f,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cc{constructor(s,f,d,g){this._el=s,this._touchZoom=f,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class kt{constructor(s,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",s);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=f,this._container.appendChild(g);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=d,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(s){this._onCooperativeGesture(s.touches.length===1)}wheel(s){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!s[this._bypassKey])}_onCooperativeGesture(s){this._enabled&&s&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ft=_=>_.zoom||_.drag||_.pitch||_.rotate;class Lh extends u.k{}function hc(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class bp{constructor(s,f){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,v)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=g.type==="renderFrame"?void 0:g,T={needsRenderFrame:!1},M={},R={},z=g.touches,F=z?this._getMapTouches(z):void 0,X=F?P.touchPos(this._map.getCanvas(),F):P.mousePos(this._map.getCanvas(),g);for(const{handlerName:ue,handler:$,allowed:ve}of this._handlers){if(!$.isEnabled())continue;let Fe;this._blockedByActive(R,ve,ue)?$.reset():$[v||g.type]&&(Fe=$[v||g.type](g,X,F),this.mergeHandlerResult(T,M,Fe,ue,C),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||$.isActive())&&(R[ue]=$)}const ie={};for(const ue in this._previousActiveHandlers)R[ue]||(ie[ue]=C);this._previousActiveHandlers=R,(Object.keys(ie).length||hc(T))&&(this._changes.push([T,M,ie]),this._triggerRenderFrame()),(Object.keys(R).length||hc(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:re}=T;re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],re(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tm(s),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,C]of this._listeners)P.addEventListener(g,v,g===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[s,f,d]of this._listeners)P.removeEventListener(s,f,s===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(s){const f=this._map,d=f.getCanvasContainer();this._add("mapEvent",new ms(f,s));const g=f.boxZoom=new gs(f,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const v=f.cooperativeGestures=new kt(f,s.cooperativeGestures);this._add("cooperativeGestures",v),s.cooperativeGestures&&v.enable();const C=new o_(f),T=new km(f);f.doubleClickZoom=new vp(T,C),this._add("tapZoom",C),this._add("clickZoom",T),s.interactive&&s.doubleClickZoom&&f.doubleClickZoom.enable();const M=new Dm;this._add("tapDragZoom",M);const R=f.touchPitch=new Am(f);this._add("touchPitch",R),s.interactive&&s.touchPitch&&f.touchPitch.enable(s.touchPitch);const z=pu(s),F=du(s);f.dragRotate=new ys(s,z,F),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]),s.interactive&&s.dragRotate&&f.dragRotate.enable();const X=(({enable:Fe,clickTolerance:he})=>{const Ie=new Us({checkCorrectEvent:Be=>P.mouseButton(Be)===0&&!Be.ctrlKey});return new fu({clickTolerance:he,move:(Be,Ge)=>({around:Ge,panDelta:Ge.sub(Be)}),activateOnStart:!0,moveStateManager:Ie,enable:Fe,assignEvents:Eh})})(s),ie=new Lm(s,f);f.dragPan=new Rm(d,X,ie),this._add("mousePan",X),this._add("touchPan",ie,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&f.dragPan.enable(s.dragPan);const re=new _p,ue=new Mm;f.touchZoomRotate=new cc(d,ue,re,M),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&f.touchZoomRotate.enable(s.touchZoomRotate);const $=f.scrollZoom=new Th(f,()=>this._triggerRenderFrame());this._add("scrollZoom",$,["mousePan"]),s.interactive&&s.scrollZoom&&f.scrollZoom.enable(s.scrollZoom);const ve=f.keyboard=new Ha(f);this._add("keyboard",ve),s.interactive&&s.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new Vs(f))}_add(s,f,d){this._handlers.push({handlerName:s,handler:f,allowed:d}),this._handlersById[s]=f}stop(s){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ft(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,f,d){for(const g in s)if(g!==d&&(!f||f.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const f=[];for(const d of s)this._el.contains(d.target)&&f.push(d);return f}mergeHandlerResult(s,f,d,g,v){if(!d)return;u.e(s,d);const C={handlerName:g,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(f.zoom=C),d.panDelta!==void 0&&(f.drag=C),d.pitchDelta!==void 0&&(f.pitch=C),d.bearingDelta!==void 0&&(f.rotate=C)}_applyChanges(){const s={},f={},d={};for(const[g,v,C]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new u.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),u.e(f,v),u.e(d,C);this._updateMapTransform(s,f,d),this._changes=[]}_updateMapTransform(s,f,d){const g=this._map,v=g._getTransformForUpdate(),C=g.terrain;if(!(hc(s)||C&&this._terrainMovement))return this._fireEvents(f,d,!0);let{panDelta:T,zoomDelta:M,bearingDelta:R,pitchDelta:z,around:F,pinchAround:X}=s;X!==void 0&&(F=X),g._stop(!0),F=F||g.transform.centerPoint;const ie=v.pointLocation(T?F.sub(T):F);R&&(v.bearing+=R),z&&(v.pitch+=z),M&&(v.zoom+=M),C?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(T)):v.setLocationAtPoint(ie,F):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(ie,F),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(g.terrain)})):v.setLocationAtPoint(ie,F),g._applyUpdatedTransform(v),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(f,d,!0)}_fireEvents(s,f,d){const g=Ft(this._eventsInProgress),v=Ft(s),C={};for(const z in s){const{originalEvent:F}=s[z];this._eventsInProgress[z]||(C[`${z}start`]=F),this._eventsInProgress[z]=s[z]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in C)this._fireEvent(z,C[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in s){const{originalEvent:F}=s[z];this._fireEvent(z,F)}const T={};let M;for(const z in this._eventsInProgress){const{handlerName:F,originalEvent:X}=this._eventsInProgress[z];this._handlersById[F].isActive()||(delete this._eventsInProgress[z],M=f[F]||X,T[`${z}end`]=M)}for(const z in T)this._fireEvent(z,T[z]);const R=Ft(this._eventsInProgress);if(d&&(g||v)&&!R){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;!z||!z.essential&&E.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:M})),F(this._map.getBearing())&&this._map.resetNorth()):(F(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(s,f){this._map.fire(new u.k(s,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Lh("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class go extends u.E{constructor(s,f){super(),this._renderFrameCallback=()=>{const d=Math.min((E.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.M(this.transform.center.lng,this.transform.center.lat)}setCenter(s,f){return this.jumpTo({center:s},f)}panBy(s,f,d){return s=u.P.convert(s).mult(-1),this.panTo(this.transform.center,u.e({offset:s},f),d)}panTo(s,f,d){return this.easeTo(u.e({center:s},f),d)}getZoom(){return this.transform.zoom}setZoom(s,f){return this.jumpTo({zoom:s},f),this}zoomTo(s,f,d){return this.easeTo(u.e({zoom:s},f),d)}zoomIn(s,f){return this.zoomTo(this.getZoom()+1,s,f),this}zoomOut(s,f){return this.zoomTo(this.getZoom()-1,s,f),this}getBearing(){return this.transform.bearing}setBearing(s,f){return this.jumpTo({bearing:s},f),this}getPadding(){return this.transform.padding}setPadding(s,f){return this.jumpTo({padding:s},f),this}rotateTo(s,f,d){return this.easeTo(u.e({bearing:s},f),d)}resetNorth(s,f){return this.rotateTo(0,u.e({duration:1e3},s),f),this}resetNorthPitch(s,f){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},s),f),this}snapToNorth(s,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,f):this}getPitch(){return this.transform.pitch}setPitch(s,f){return this.jumpTo({pitch:s},f),this}cameraForBounds(s,f){s=Pe.convert(s);const d=f&&f.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),d,f)}_cameraForBoxAndBearing(s,f,d,g){const v={top:0,bottom:0,right:0,left:0};if(typeof(g=u.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const ft=g.padding;g.padding={top:ft,bottom:ft,right:ft,left:ft}}g.padding=u.e(v,g.padding);const C=this.transform,T=C.padding,M=new Pe(s,f),R=C.project(M.getNorthWest()),z=C.project(M.getNorthEast()),F=C.project(M.getSouthEast()),X=C.project(M.getSouthWest()),ie=u.b8(-d),re=R.rotate(ie),ue=z.rotate(ie),$=F.rotate(ie),ve=X.rotate(ie),Fe=new u.P(Math.max(re.x,ue.x,ve.x,$.x),Math.max(re.y,ue.y,ve.y,$.y)),he=new u.P(Math.min(re.x,ue.x,ve.x,$.x),Math.min(re.y,ue.y,ve.y,$.y)),Ie=Fe.sub(he),Be=(C.width-(T.left+T.right+g.padding.left+g.padding.right))/Ie.x,Ge=(C.height-(T.top+T.bottom+g.padding.top+g.padding.bottom))/Ie.y;if(Ge<0||Be<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const He=Math.min(C.scaleZoom(C.scale*Math.min(Be,Ge)),g.maxZoom),et=u.P.convert(g.offset),$e=new u.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(u.b8(d)),ut=et.add($e).mult(C.scale/C.zoomScale(He));return{center:C.unproject(R.add(F).div(2).sub(ut)),zoom:He,bearing:d}}fitBounds(s,f,d){return this._fitInternal(this.cameraForBounds(s,f),f,d)}fitScreenCoordinates(s,f,d,g,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(s)),this.transform.pointLocation(u.P.convert(f)),d,g),g,v)}_fitInternal(s,f,d){return s?(delete(f=u.e(s,f)).padding,f.linear?this.easeTo(f,d):this.flyTo(f,d)):this}jumpTo(s,f){this.stop();const d=this._getTransformForUpdate();let g=!1,v=!1,C=!1;return"zoom"in s&&d.zoom!==+s.zoom&&(g=!0,d.zoom=+s.zoom),s.center!==void 0&&(d.center=u.M.convert(s.center)),"bearing"in s&&d.bearing!==+s.bearing&&(v=!0,d.bearing=+s.bearing),"pitch"in s&&d.pitch!==+s.pitch&&(C=!0,d.pitch=+s.pitch),s.padding==null||d.isPaddingEqual(s.padding)||(d.padding=s.padding),this._applyUpdatedTransform(d),this.fire(new u.k("movestart",f)).fire(new u.k("move",f)),g&&this.fire(new u.k("zoomstart",f)).fire(new u.k("zoom",f)).fire(new u.k("zoomend",f)),v&&this.fire(new u.k("rotatestart",f)).fire(new u.k("rotate",f)).fire(new u.k("rotateend",f)),C&&this.fire(new u.k("pitchstart",f)).fire(new u.k("pitch",f)).fire(new u.k("pitchend",f)),this.fire(new u.k("moveend",f))}calculateCameraOptionsFromTo(s,f,d,g=0){const v=u.Y.fromLngLat(s,f),C=u.Y.fromLngLat(d,g),T=C.x-v.x,M=C.y-v.y,R=C.z-v.z,z=Math.hypot(T,M,R);if(z===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(T,M),X=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),ie=180*Math.atan2(T,-M)/Math.PI;let re=180*Math.acos(F/z)/Math.PI;return re=R<0?90-re:90+re,{center:C.toLngLat(),zoom:X,pitch:re,bearing:ie}}easeTo(s,f){var d;this._stop(!1,s.easeId),((s=u.e({offset:[0,0],duration:500,easing:u.b7},s)).animate===!1||!s.essential&&E.prefersReducedMotion)&&(s.duration=0);const g=this._getTransformForUpdate(),v=this.getZoom(),C=this.getBearing(),T=this.getPitch(),M=this.getPadding(),R="bearing"in s?this._normalizeBearing(s.bearing,C):C,z="pitch"in s?+s.pitch:T,F="padding"in s?s.padding:g.padding,X=u.P.convert(s.offset);let ie=g.centerPoint.add(X);const re=g.pointLocation(ie),{center:ue,zoom:$}=g.getConstrained(u.M.convert(s.center||re),(d=s.zoom)!==null&&d!==void 0?d:v);this._normalizeCenter(ue);const ve=g.project(re),Fe=g.project(ue).sub(ve),he=g.zoomScale($-v);let Ie,Be;s.around&&(Ie=u.M.convert(s.around),Be=g.locationPoint(Ie));const Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||$!==v,this._rotating=this._rotating||C!==R,this._pitching=this._pitching||z!==T,this._padding=!g.isPaddingEqual(F),this._easeId=s.easeId,this._prepareEase(f,s.noMoveStart,Ge),this.terrain&&this._prepareElevation(ue),this._ease(He=>{if(this._zooming&&(g.zoom=u.z.number(v,$,He)),this._rotating&&(g.bearing=u.z.number(C,R,He)),this._pitching&&(g.pitch=u.z.number(T,z,He)),this._padding&&(g.interpolatePadding(M,F,He),ie=g.centerPoint.add(X)),this.terrain&&!s.freezeElevation&&this._updateElevation(He),Ie)g.setLocationAtPoint(Ie,Be);else{const et=g.zoomScale(g.zoom-v),$e=$>v?Math.min(2,he):Math.max(.5,he),ut=Math.pow($e,1-He),ft=g.unproject(ve.add(Fe.mult(He*ut)).mult(et));g.setLocationAtPoint(g.renderWorldCopies?ft.wrap():ft,ie)}this._applyUpdatedTransform(g),this._fireMoveEvents(f)},He=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,He)},s),this}_prepareEase(s,f,d={}){this._moving=!0,f||d.moving||this.fire(new u.k("movestart",s)),this._zooming&&!d.zooming&&this.fire(new u.k("zoomstart",s)),this._rotating&&!d.rotating&&this.fire(new u.k("rotatestart",s)),this._pitching&&!d.pitching&&this.fire(new u.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&f!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(d-(f-(d*s+this._elevationStart))/(1-s)),this._elevationTarget=f}this.transform.elevation=u.z.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const f=s.clone(),{center:d,zoom:g,pitch:v,bearing:C,elevation:T}=this.transformCameraUpdate(f);d&&(f.center=d),g!==void 0&&(f.zoom=g),v!==void 0&&(f.pitch=v),C!==void 0&&(f.bearing=C),T!==void 0&&(f.elevation=T),this.transform.apply(f)}_fireMoveEvents(s){this.fire(new u.k("move",s)),this._zooming&&this.fire(new u.k("zoom",s)),this._rotating&&this.fire(new u.k("rotate",s)),this._pitching&&this.fire(new u.k("pitch",s))}_afterEase(s,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const d=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new u.k("zoomend",s)),g&&this.fire(new u.k("rotateend",s)),v&&this.fire(new u.k("pitchend",s)),this.fire(new u.k("moveend",s))}flyTo(s,f){var d;if(!s.essential&&E.prefersReducedMotion){const Sn=u.L(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Sn,f)}this.stop(),s=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b7},s);const g=this._getTransformForUpdate(),v=this.getZoom(),C=this.getBearing(),T=this.getPitch(),M=this.getPadding(),R="bearing"in s?this._normalizeBearing(s.bearing,C):C,z="pitch"in s?+s.pitch:T,F="padding"in s?s.padding:g.padding,X=u.P.convert(s.offset);let ie=g.centerPoint.add(X);const re=g.pointLocation(ie),{center:ue,zoom:$}=g.getConstrained(u.M.convert(s.center||re),(d=s.zoom)!==null&&d!==void 0?d:v);this._normalizeCenter(ue);const ve=g.zoomScale($-v),Fe=g.project(re),he=g.project(ue).sub(Fe);let Ie=s.curve;const Be=Math.max(g.width,g.height),Ge=Be/ve,He=he.mag();if("minZoom"in s){const Sn=u.ac(Math.min(s.minZoom,v,$),g.minZoom,g.maxZoom),jt=Be/g.zoomScale(Sn-v);Ie=Math.sqrt(jt/He*2)}const et=Ie*Ie;function $e(Sn){const jt=(Ge*Ge-Be*Be+(Sn?-1:1)*et*et*He*He)/(2*(Sn?Ge:Be)*et*He);return Math.log(Math.sqrt(jt*jt+1)-jt)}function ut(Sn){return(Math.exp(Sn)-Math.exp(-Sn))/2}function ft(Sn){return(Math.exp(Sn)+Math.exp(-Sn))/2}const nn=$e(!1);let pt=function(Sn){return ft(nn)/ft(nn+Ie*Sn)},Bt=function(Sn){return Be*((ft(nn)*(ut(jt=nn+Ie*Sn)/ft(jt))-ut(nn))/et)/He;var jt},rn=($e(!0)-nn)/Ie;if(Math.abs(He)<1e-6||!isFinite(rn)){if(Math.abs(Be-Ge)<1e-6)return this.easeTo(s,f);const Sn=Ge<Be?-1:1;rn=Math.abs(Math.log(Ge/Be))/Ie,Bt=function(){return 0},pt=function(jt){return Math.exp(Sn*Ie*jt)}}return s.duration="duration"in s?+s.duration:1e3*rn/("screenSpeed"in s?+s.screenSpeed/Ie:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=C!==R,this._pitching=z!==T,this._padding=!g.isPaddingEqual(F),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(ue),this._ease(Sn=>{const jt=Sn*rn,an=1/pt(jt);g.zoom=Sn===1?$:v+g.scaleZoom(an),this._rotating&&(g.bearing=u.z.number(C,R,Sn)),this._pitching&&(g.pitch=u.z.number(T,z,Sn)),this._padding&&(g.interpolatePadding(M,F,Sn),ie=g.centerPoint.add(X)),this.terrain&&!s.freezeElevation&&this._updateElevation(Sn);const fn=Sn===1?ue:g.unproject(Fe.add(he.mult(Bt(jt))).mult(an));g.setLocationAtPoint(g.renderWorldCopies?fn.wrap():fn,ie),this._applyUpdatedTransform(g),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,f)}if(!s){const d=this.handlers;d&&d.stop(!1)}return this}_ease(s,f,d){d.animate===!1||d.duration===0?(s(1),f()):(this._easeStart=E.now(),this._easeOptions=d,this._onEaseFrame=s,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,f){s=u.b1(s,-180,180);const d=Math.abs(s-f);return Math.abs(s-360-f)<d&&(s-=360),Math.abs(s+360-f)<d&&(s+=360),s}_normalizeCenter(s){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const d=s.lng-f.center.lng;s.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(u.M.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const xp={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class _s{constructor(s=xp){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,f){const d=this._map._getUIString(`AttributionControl.${f}`);s.title=d,s.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const f=this._map.style.sourceCaches;for(const g in f){const v=f[g];if(v.used||v.usedForTerrain){const C=v.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,v)=>g.length-v.length),s=s.filter((g,v)=>{for(let C=v+1;C<s.length;C++)if(s[C].indexOf(g)>=0)return!1;return!0});const d=s.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,s.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Nm{constructor(s={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const d=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const f=P.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const f=++this._id;return this._queue.push({callback:s,id:f,cancelled:!1}),f}remove(s){const f=this._currentlyRunning,d=f?this._queue.concat(f):this._queue;for(const g of d)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const d of f)if(!d.cancelled&&(d.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Cr=u.X([{name:"a_pos3d",type:"Int16",components:3}]);class Gr extends u.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,f){this.sourceCache.update(s,f),this._renderableTilesKeys=[];const d={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))d[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),u.aN(g.posMatrix,0,u.W,0,u.W,0,1),this._tiles[g.key]=new Ko(g,this.tileSize));for(const g in this._tiles)d[g]||delete this._tiles[g]}freeRtt(s){for(const f in this._tiles){const d=this._tiles[f];(!s||d.tileID.equals(s)||d.tileID.isChildOf(s)||s.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const f={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(g.canonical.equals(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16),u.aN(v.posMatrix,0,u.W,0,u.W,0,1),f[d]=v}else if(g.canonical.isChildOf(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const C=g.canonical.z-s.canonical.z,T=g.canonical.x-(g.canonical.x>>C<<C),M=g.canonical.y-(g.canonical.y>>C<<C),R=u.W>>C;u.aN(v.posMatrix,0,R,0,R,0,1),u.H(v.posMatrix,v.posMatrix,[-T*R,-M*R,0]),f[d]=v}else if(s.canonical.isChildOf(g.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const C=s.canonical.z-g.canonical.z,T=s.canonical.x-(s.canonical.x>>C<<C),M=s.canonical.y-(s.canonical.y>>C<<C),R=u.W>>C;u.aN(v.posMatrix,0,u.W,0,u.W,0,1),u.H(v.posMatrix,v.posMatrix,[T*R,M*R,0]),u.J(v.posMatrix,v.posMatrix,[1/2**C,1/2**C,0]),f[d]=v}}return f}getSourceTile(s,f){const d=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>d.maxzoom&&(g=d.maxzoom),g<d.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&f)for(;g>=d.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(s.scaledTo(g--).key);return v}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=s)}}class Om{constructor(s,f,d){this.painter=s,this.sourceCache=new Gr(f),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,f,d,g=u.W){var v;if(!(f>=0&&f<g&&d>=0&&d<g))return 0;const C=this.getTerrainData(s),T=(v=C.tile)===null||v===void 0?void 0:v.dem;if(!T)return 0;const M=function(re,ue,$){var ve=ue[0],Fe=ue[1];return re[0]=$[0]*ve+$[4]*Fe+$[12],re[1]=$[1]*ve+$[5]*Fe+$[13],re}([],[f/g*u.W,d/g*u.W],C.u_terrain_matrix),R=[M[0]*T.dim,M[1]*T.dim],z=Math.floor(R[0]),F=Math.floor(R[1]),X=R[0]-z,ie=R[1]-F;return T.get(z,F)*(1-X)*(1-ie)+T.get(z+1,F)*X*(1-ie)+T.get(z,F+1)*(1-X)*ie+T.get(z+1,F+1)*X*ie}getElevationForLngLatZoom(s,f){const{tileID:d,mercatorX:g,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(s,f);return this.getElevation(d,g%u.W,v%u.W,u.W)}getElevation(s,f,d,g=u.W){return this.getDEMElevation(s,f,d,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,v=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Z(g,v,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Z(g,new u.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const f=this.sourceCache.getSourceTile(s,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const g=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new Z(g,f.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),f.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const d=f&&f+f.tileID.key+s.key;if(d&&!this._demMatrixCache[d]){const g=this.sourceCache.sourceCache._source.maxzoom;let v=s.canonical.z-f.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?v=s.canonical.z-g:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=s.canonical.x-(s.canonical.x>>v<<v),T=s.canonical.y-(s.canonical.y>>v<<v),M=u.b9(new Float64Array(16),[1/(u.W<<v),1/(u.W<<v),0]);u.H(M,M,[C*u.W,T*u.W,0]),this._demMatrixCache[s.key]={matrix:M,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(s){const f=this.painter,d=f.width/devicePixelRatio,g=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Z(f.context,{width:d,height:g,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Z(f.context,{width:d,height:g,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(d,g,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,d,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,C=0;v<this._coordsTextureSize;v++)for(let T=0;T<this._coordsTextureSize;T++,C+=4)f[C+0]=255&T,f[C+1]=255&v,f[C+2]=T>>8<<4|v>>8,f[C+3]=0;const d=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),g=new Z(s,d,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),d=this.painter.context,g=d.gl,v=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(v,T-C-1,1,1,g.RGBA,g.UNSIGNED_BYTE,f),d.bindFramebuffer.set(null);const M=f[0]+(f[2]>>4<<8),R=f[1]+((15&f[2])<<8),z=this.coordsIndex[255-f[3]],F=z&&this.sourceCache.getTileByID(z);if(!F)return null;const X=this._coordsTextureSize,ie=(1<<F.tileID.canonical.z)*X;return new u.Y((F.tileID.canonical.x*X+M)/ie+F.tileID.wrap,(F.tileID.canonical.y*X+R)/ie,this.getElevation(F.tileID,M,R,X))}depthAtPoint(s){const f=new Uint8Array(4),d=this.painter.context,g=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,f),d.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,f=new u.ba,d=new u.aX,g=this.meshSize,v=u.W/g,C=g*g;for(let F=0;F<=g;F++)for(let X=0;X<=g;X++)f.emplaceBack(X*v,F*v,0);for(let F=0;F<C;F+=g+1)for(let X=0;X<g;X++)d.emplaceBack(X+F,g+X+F+1,g+X+F+2),d.emplaceBack(X+F,g+X+F+2,X+F+1);const T=f.length,M=T+2*(g+1);for(const F of[0,1])for(let X=0;X<=g;X++)for(const ie of[0,1])f.emplaceBack(X*v,F*u.W,ie);for(let F=0;F<2*g;F+=2)d.emplaceBack(M+F,M+F+1,M+F+3),d.emplaceBack(M+F,M+F+3,M+F+2),d.emplaceBack(T+F,T+F+3,T+F+1),d.emplaceBack(T+F,T+F+2,T+F+3);const R=f.length,z=R+2*(g+1);for(const F of[0,1])for(let X=0;X<=g;X++)for(const ie of[0,1])f.emplaceBack(F*u.W,X*v,ie);for(let F=0;F<2*g;F+=2)d.emplaceBack(R+F,R+F+1,R+F+3),d.emplaceBack(R+F,R+F+3,R+F+2),d.emplaceBack(z+F,z+F+3,z+F+1),d.emplaceBack(z+F,z+F+2,z+F+3);return this._mesh={indexBuffer:s.createIndexBuffer(d),vertexBuffer:s.createVertexBuffer(f,Cr.members),segments:u.$.simpleSegment(0,0,f.length,d.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*u.bb/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,f){var d;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,f);return(d=this.getMinMaxElevation(g).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(s){const f=this.getTerrainData(s).tile,d={minElevation:null,maxElevation:null};return f&&f.dem&&(d.minElevation=f.dem.min*this.exaggeration,d.maxElevation=f.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(s,f){const d=u.Y.fromLngLat(s.wrap()),g=(1<<f)*u.W,v=d.x*g,C=d.y*g,T=Math.floor(v/u.W),M=Math.floor(C/u.W);return{tileID:new u.Q(f,0,f,T,M),mercatorX:v,mercatorY:C}}}class pc{constructor(s,f,d){this._context=s,this._size=f,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new Z(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(d.texture),{id:s,fbo:f,texture:d,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>s.id!==f),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const ya={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class wp{constructor(s,f){this.painter=s,this.terrain=f,this.pool=new pc(s.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(d=>!s._layers[d].isHidden(f)),this._coordsDescendingInv={};for(const d in s.sourceCaches){this._coordsDescendingInv[d]={};const g=s.sourceCaches[d].getVisibleCoordinates();for(const v of g){const C=this.terrain.sourceCache.getTerrainCoords(v);for(const T in C)this._coordsDescendingInv[d][T]||(this._coordsDescendingInv[d][T]=[]),this._coordsDescendingInv[d][T].push(C[T])}}this._coordsDescendingInvStr={};for(const d of s._order){const g=s._layers[d],v=g.source;if(ya[g.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const C in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][C]=this._coordsDescendingInv[v][C].map(T=>T.key).sort().join()}}for(const d of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[g][d.tileID.key];v&&v!==d.rttCoords[g]&&(d.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const f=s.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(ya[f]&&(this._prevType&&ya[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(ya[this._prevType]||ya[f]&&g){this._prevType=f;const v=this._stacks.length-1,C=this._stacks[v]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(wh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[v]){const R=this.pool.getObjectForId(T.rtt[v].id);if(R.stamp===T.rtt[v].stamp){this.pool.useObject(R);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),T.rtt[v]={id:M.id,stamp:M.stamp},d.context.bindFramebuffer.set(M.fbo.framebuffer),d.context.clear({color:u.aO.transparent,stencil:0}),d.currentStencilSource=void 0;for(let R=0;R<C.length;R++){const z=d.style._layers[C[R]],F=z.source?this._coordsDescendingInv[z.source][T.tileID.key]:[T.tileID];d.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),d._renderTileClippingMasks(z,F),d.renderLayer(d,d.style.sourceCaches[z.source],z,F),z.source&&(T.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][T.tileID.key])}}return wh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ya[f]}return!1}}const Sp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ep=m,dc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:xp,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ph=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},Ip={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cp{constructor(s,f,d=!1){this.mousedown=C=>{this.startMouse(u.e({},C,{ctrlKey:!0,preventDefault:()=>C.preventDefault()}),P.mousePos(this.element,C)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.moveMouse(C,P.mousePos(this.element,C))},this.mouseup=C=>{this.mouseRotate.dragEnd(C),this.mousePitch&&this.mousePitch.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,C.targetTouches)[0],this.startTouch(C,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,C.targetTouches)[0],this.moveTouch(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),v=s.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=pu({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:T,bearingDegreesPerPixelMoved:M=.8})=>{const R=new St;return new fu({clickTolerance:T,move:(z,F)=>({bearingDelta:(F.x-z.x)*M}),moveStateManager:R,enable:C,assignEvents:Ph})})({clickTolerance:g,enable:!0}),this.map=s,d&&(this.mousePitch=du({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:T,pitchDegreesPerPixelMoved:M=-.5})=>{const R=new St;return new fu({clickTolerance:T,move:(z,F)=>({pitchDelta:(F.y-z.y)*M}),moveStateManager:R,enable:C,assignEvents:Ph})})({clickTolerance:v,enable:!0})),P.addEventListener(f,"mousedown",this.mousedown),P.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(f,"touchcancel",this.reset)}startMouse(s,f){this.mouseRotate.dragStart(s,f),this.mousePitch&&this.mousePitch.dragStart(s,f),P.disableDrag()}startTouch(s,f){this.touchRotate.dragStart(s,f),this.touchPitch&&this.touchPitch.dragStart(s,f),P.disableDrag()}moveMouse(s,f){const d=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,f)||{};if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(s,f)||{};v&&d.setPitch(d.getPitch()+v)}}moveTouch(s,f){const d=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,f)||{};if(g&&d.setBearing(d.getBearing()+g),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(s,f)||{};v&&d.setPitch(d.getPitch()+v)}}off(){const s=this.element;P.removeEventListener(s,"mousedown",this.mousedown),P.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let _a;function Mh(_,s,f){const d=new u.M(_.lng,_.lat);if(_=new u.M(_.lng,_.lat),s){const g=new u.M(_.lng-360,_.lat),v=new u.M(_.lng+360,_.lat),C=f.locationPoint(_).distSqr(s);f.locationPoint(g).distSqr(s)<C?_=g:f.locationPoint(v).distSqr(s)<C&&(_=v)}for(;Math.abs(_.lng-f.center.lng)>180;){const g=f.locationPoint(_);if(g.x>=0&&g.y>=0&&g.x<=f.width&&g.y<=f.height)break;_.lng>f.center.lng?_.lng-=360:_.lng+=360}return _.lng!==d.lng&&f.locationPoint(_).y>f.height/2-f.getHorizon()?_:d}const mc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ah(_,s,f){const d=_.classList;for(const g in mc)d.remove(`maplibregl-${f}-anchor-${g}`);d.add(`maplibregl-${f}-anchor-${s}`)}class gc extends u.E{constructor(s){if(super(),this._onKeyPress=f=>{const d=f.code,g=f.charCode||f.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=f=>{const d=f.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()},this._update=f=>{var d;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Mh(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${mc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${v}`),E.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=u.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const f=P.createNS("http://www.w3.org/2000/svg","svg"),d=41,g=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${d}px`),f.setAttributeNS(null,"width",`${g}px`),f.setAttributeNS(null,"viewBox",`0 0 ${g} ${d}`);const v=P.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const C=P.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const T=P.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of M){const Fe=P.createNS("http://www.w3.org/2000/svg","ellipse");Fe.setAttributeNS(null,"opacity","0.04"),Fe.setAttributeNS(null,"cx","10.5"),Fe.setAttributeNS(null,"cy","5.80029008"),Fe.setAttributeNS(null,"rx",ve.rx),Fe.setAttributeNS(null,"ry",ve.ry),T.appendChild(Fe)}const R=P.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const z=P.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(z);const F=P.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const X=P.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(X);const ie=P.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ie.setAttributeNS(null,"fill","#FFFFFF");const re=P.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ue=P.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#000000"),ue.setAttributeNS(null,"opacity","0.25"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962");const $=P.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),re.appendChild(ue),re.appendChild($),C.appendChild(T),C.appendChild(R),C.appendChild(F),C.appendChild(ie),C.appendChild(re),f.appendChild(C),f.setAttributeNS(null,"height",d*this._scale+"px"),f.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(f),this._offset=u.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Ah(this._element,this._anchor,"marker"),s&&s.className)for(const f of s.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=u.M.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var f,d;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,v=g.terrain.depthAtPoint(this._pos),C=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,C)-v<.006)return void(this._element.style.opacity=this._opacity);const T=-this._offset.y/g.transform._pixelPerMeter,M=Math.sin(g.getPitch()*Math.PI/180)*T,R=g.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),z=g.transform.lngLatToCameraDepth(this._lngLat,C+M)-R>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=u.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,f){return s===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const kh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let gu=0,Pl=!1;const Dh={maxWidth:100,unit:"metric"};function Rh(_,s,f){const d=f&&f.maxWidth||100,g=_._container.clientHeight/2,v=_.unproject([0,g]),C=_.unproject([d,g]),T=v.distanceTo(C);if(f&&f.unit==="imperial"){const M=3.2808*T;M>5280?Ml(s,d,M/5280,_._getUIString("ScaleControl.Miles")):Ml(s,d,M,_._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Ml(s,d,T/1852,_._getUIString("ScaleControl.NauticalMiles")):T>=1e3?Ml(s,d,T/1e3,_._getUIString("ScaleControl.Kilometers")):Ml(s,d,T,_._getUIString("ScaleControl.Meters"))}function Ml(_,s,f,d){const g=function(v){const C=Math.pow(10,`${Math.floor(v)}`.length-1);let T=v/C;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(M){const R=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*R)/R}(T),C*T}(f);_.style.width=s*(g/f)+"px",_.innerHTML=`${g}&nbsp;${d}`}const Tp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Lp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nh(_){if(_){if(typeof _=="number"){const s=Math.round(Math.abs(_)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,_),"top-left":new u.P(s,s),"top-right":new u.P(-s,s),bottom:new u.P(0,-_),"bottom-left":new u.P(s,-s),"bottom-right":new u.P(-s,-s),left:new u.P(_,0),right:new u.P(-_,0)}}if(_ instanceof u.P||Array.isArray(_)){const s=u.P.convert(_);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:u.P.convert(_.center||[0,0]),top:u.P.convert(_.top||[0,0]),"top-left":u.P.convert(_["top-left"]||[0,0]),"top-right":u.P.convert(_["top-right"]||[0,0]),bottom:u.P.convert(_.bottom||[0,0]),"bottom-left":u.P.convert(_["bottom-left"]||[0,0]),"bottom-right":u.P.convert(_["bottom-right"]||[0,0]),left:u.P.convert(_.left||[0,0]),right:u.P.convert(_.right||[0,0])}}return Nh(new u.P(0,0))}const zm=m;c.AJAXError=u.be,c.Evented=u.E,c.LngLat=u.M,c.MercatorCoordinate=u.Y,c.Point=u.P,c.addProtocol=u.bf,c.config=u.a,c.removeProtocol=u.bg,c.AttributionControl=_s,c.BoxZoomHandler=gs,c.CanvasSource=ps,c.CooperativeGesturesHandler=kt,c.DoubleClickZoomHandler=vp,c.DragPanHandler=Rm,c.DragRotateHandler=ys,c.EdgeInsets=cu,c.FullscreenControl=class extends u.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var s;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=f==null?void 0:f.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Dr,c.GeolocateControl=class extends u.E{constructor(_){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const f=new u.M(s.coords.longitude,s.coords.latitude),d=s.coords.accuracy,g=this._map.getBearing(),v=u.e({bearing:g},this.options.fitBoundsOptions),C=Pe.fromLngLat(f,d);this._map.fitBounds(C,v,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const f=new u.M(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Pl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gc({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")))})}},this.options=u.e({},kh,_)}onAdd(_){return this._map=_,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return u._(this,arguments,void 0,function*(s=!1){if(_a!==void 0&&!s)return _a;if(window.navigator.permissions===void 0)return _a=!!window.navigator.geolocation,_a;try{_a=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{_a=!!window.navigator.geolocation}return _a})}().then(s=>this._setupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,gu=0,Pl=!1}_isOutOfMapMaxBounds(_){const s=this._map.getMaxBounds(),f=_.coords;return s&&(f.longitude<s.getWest()||f.longitude>s.getEast()||f.latitude<s.getSouth()||f.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),s=_.getSouthEast(),f=_.getNorthEast(),d=s.distanceTo(f),g=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gu--,Pl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),gu++,gu>1?(_={maximumAge:6e5,timeout:0},Pl=!0):(_=this.options.positionOptions,Pl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=mp,c.ImageSource=er,c.KeyboardHandler=Ha,c.LngLatBounds=Pe,c.LogoControl=Nm,c.Map=class extends go{constructor(_){if(u.bc.mark(u.bd.create),(_=u.e({},dc,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Sh(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),{bearingSnap:_.bearingSnap}),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new fc,this._controls=[],this._mapId=u.a3(),this._locale=u.e({},Sp,_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new Y(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const f=dp(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{s?f(d):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bp(this,_),this._hash=_.hash&&new mp(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,u.e({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new _s(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Nm,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new u.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new u.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new u.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(_,s){if(s===void 0&&(s=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=_.onAdd(this);this._controls.push(_);const d=this._controlPositions[s];return s.indexOf("bottom")!==-1?d.insertBefore(f,d.firstChild):d.appendChild(f),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(_);return s>-1&&this._controls.splice(s,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,s,f,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,s,f,d)}resize(_){var s;const f=this._containerDimensions(),d=f[0],g=f[1],v=this._getClampedPixelRatio(d,g);if(this._resizeCanvas(d,g,v),this.painter.resize(d,g,v),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const M=this._getClampedPixelRatio(d,g);this._resizeCanvas(d,g,M),this.painter.resize(d,g,M)}this.transform.resize(d,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(d,g);const C=!this._moving;return C&&(this.stop(),this.fire(new u.k("movestart",_)).fire(new u.k("move",_))),this.fire(new u.k("resize",_)),C&&this.fire(new u.k("moveend",_)),this}_getClampedPixelRatio(_,s){const{0:f,1:d}=this._maxCanvasSize,g=this.getPixelRatio(),v=_*g,C=s*g;return Math.min(v>f?f/v:1,C>d?d/C:1)*g}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Pe.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(u.M.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(u.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,s,f){if(_==="mouseenter"||_==="mouseover"){let d=!1;return{layer:s,listener:f,delegates:{mousemove:v=>{const C=this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[];C.length?d||(d=!0,f.call(this,new mo(_,this,v.originalEvent,{features:C}))):d=!1},mouseout:()=>{d=!1}}}}if(_==="mouseleave"||_==="mouseout"){let d=!1;return{layer:s,listener:f,delegates:{mousemove:C=>{(this.getLayer(s)?this.queryRenderedFeatures(C.point,{layers:[s]}):[]).length?d=!0:d&&(d=!1,f.call(this,new mo(_,this,C.originalEvent)))},mouseout:C=>{d&&(d=!1,f.call(this,new mo(_,this,C.originalEvent)))}}}}{const d=g=>{const v=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];v.length&&(g.features=v,f.call(this,g),delete g.features)};return{layer:s,listener:f,delegates:{[_]:d}}}}on(_,s,f){if(f===void 0)return super.on(_,s);const d=this._createDelegatedListener(_,s,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(_,s,f){if(f===void 0)return super.once(_,s);const d=this._createDelegatedListener(_,s,f);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(_,s,f){return f===void 0?super.off(_,s):(this._delegatedListeners&&this._delegatedListeners[_]&&(d=>{const g=this._delegatedListeners[_];for(let v=0;v<g.length;v++){const C=g[v];if(C.layer===s&&C.listener===f){for(const T in C.delegates)this.off(T,C.delegates[T]);return g.splice(v,1),this}}})(),this)}queryRenderedFeatures(_,s){if(!this.style)return[];let f;const d=_ instanceof u.P||Array.isArray(_),g=d?_:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(d?{}:_)||{},g instanceof u.P||typeof g[0]=="number")f=[u.P.convert(g)];else{const v=u.P.convert(g[0]),C=u.P.convert(g[1]);f=[v,new u.P(C.x,v.y),C,new u.P(v.x,C.y),v]}return this.style.queryRenderedFeatures(f,s,this.transform)}querySourceFeatures(_,s){return this.style.querySourceFeatures(_,s)}setStyle(_,s){return(s=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(_,s))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const s=this._locale[_];if(s==null)throw new Error(`Missing UI string '${_}'`);return s}_updateStyle(_,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,s));const f=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new ko(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,s,f):this.style.loadJSON(_,s,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ko(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,s){if(typeof _=="string"){const f=this._requestManager.transformRequest(_,"Style");u.h(f,new AbortController).then(d=>{this._updateDiff(d.data,s)}).catch(d=>{d&&this.fire(new u.j(d))})}else typeof _=="object"&&this._updateDiff(_,s)}_updateDiff(_,s){try{this.style.setState(_,s)&&this._update(!0)}catch(f){u.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(_,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(_,s){return this._lazyInitEmptyStyle(),this.style.addSource(_,s),this._update(!0)}isSourceLoaded(_){const s=this.style&&this.style.sourceCaches[_];if(s!==void 0)return s.loaded();this.fire(new u.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const s=this.style.sourceCaches[_.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&s.reload();for(const f in this.style._layers){const d=this.style._layers[f];d.type==="hillshade"&&d.source===_.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Om(this.painter,s,_),this.painter.renderToTexture=new wp(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==_.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:_})),this}getTerrain(){var _,s;return(s=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const s in _){const f=_[s]._tiles;for(const d in f){const g=f[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,s,f={}){const{pixelRatio:d=1,sdf:g=!1,stretchX:v,stretchY:C,content:T}=f;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||u.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:R,data:z}=s,F=s;return this.style.addImage(_,{data:new u.R({width:M,height:R},new Uint8Array(z)),pixelRatio:d,stretchX:v,stretchY:C,content:T,sdf:g,version:0,userImage:F}),F.onAdd&&F.onAdd(this,_),this}}{const{width:M,height:R,data:z}=E.getImageData(s);this.style.addImage(_,{data:new u.R({width:M,height:R},z),pixelRatio:d,stretchX:v,stretchY:C,content:T,sdf:g,version:0})}}updateImage(_,s){const f=this.style.getImage(_);if(!f)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=s instanceof HTMLImageElement||u.b(s)?E.getImageData(s):s,{width:g,height:v,data:C}=d;if(g===void 0||v===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==f.data.width||v!==f.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(s instanceof HTMLImageElement||u.b(s));return f.data.replace(C,T),this.style.updateImage(_,f),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return W.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,s){return this._lazyInitEmptyStyle(),this.style.addLayer(_,s),this._update(!0)}moveLayer(_,s){return this.style.moveLayer(_,s),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,s,f){return this.style.setLayerZoomRange(_,s,f),this._update(!0)}setFilter(_,s,f={}){return this.style.setFilter(_,s,f),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,s,f,d={}){return this.style.setPaintProperty(_,s,f,d),this._update(!0)}getPaintProperty(_,s){return this.style.getPaintProperty(_,s)}setLayoutProperty(_,s,f,d={}){return this.style.setLayoutProperty(_,s,f,d),this._update(!0)}getLayoutProperty(_,s){return this.style.getLayoutProperty(_,s)}setGlyphs(_,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,s,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,s,f,d=>{d||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,s,f=>{f||this._update(!0)}),this}setLight(_,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(_,s){return this.style.setFeatureState(_,s),this._update()}removeFeatureState(_,s){return this.style.removeFeatureState(_,s),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,s=0;return this._container&&(_=this._container.clientWidth||400,s=this._container.clientHeight||300),[_,s]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const s=this._canvasContainer=P.create("div","maplibregl-canvas-container",_);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),d=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],d);const g=this._controlContainer=P.create("div","maplibregl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{v[C]=P.create("div",`maplibregl-ctrl-${C} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,s,f){this._canvas.width=Math.floor(f*_),this._canvas.height=Math.floor(f*s),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{s={requestedAttributes:_},d&&(s.statusMessage=d.statusMessage,s.type=d.type)},{once:!0});const f=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!f){const d="Failed to initialize WebGL";throw s?(s.message=d,new Error(JSON.stringify(s))):new Error(d)}this.painter=new Sm(f,this.transform),D.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,v=E.now();this.style.zoomHistory.update(g,v);const C=new u.a8(g,{now:v,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=C.crossFadingFactor();T===1&&T===this._crossFadingFactor||(f=!0,this._crossFadingFactor=T),this.style.update(C)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bc.mark(u.bd.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,u.bc.mark(u.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bc.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(_=>{u.bc.frame(_),this._frameRequest=null,this._render(_)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return Ep}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=mo,c.MapTouchEvent=Bs,c.MapWheelEvent=gp,c.Marker=gc,c.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const s=this._map.getZoom(),f=s===this._map.getMaxZoom(),d=s===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,f)=>{const d=this._map._getUIString(`NavigationControl.${f}`);s.title=d,s.setAttribute("aria-label",d)},this.options=u.e({},Ip,_),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,s){const f=P.create("button",_,this._container);return f.type="button",f.addEventListener("click",s),f}},c.Popup=class extends u.E{constructor(_){super(),this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Mh(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!s)return;const d=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const v=Nh(this.options.offset);if(!g){const T=this._container.offsetWidth,M=this._container.offsetHeight;let R;R=d.y+v.bottom.y<M?["top"]:d.y>this._map.transform.height-M?["bottom"]:[],d.x<T/2?R.push("left"):d.x>this._map.transform.width-T/2&&R.push("right"),g=R.length===0?"bottom":R.join("-")}let C=d.add(v[g]);this.options.subpixelPositioning||(C=C.round()),P.setTransform(this._container,`${mc[g]} translate(${C.x}px,${C.y}px)`),Ah(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(Tp),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=u.M.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const s=document.createDocumentFragment(),f=document.createElement("body");let d;for(f.innerHTML=_;d=f.firstChild,d;)s.appendChild(d);return this.setDOMContent(s)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){this._container&&this._container.classList.add(_)}removeClassName(_){this._container&&this._container.classList.remove(_)}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Lp);_&&_.focus()}},c.RasterDEMTileSource=Yt,c.RasterTileSource=Oe,c.ScaleControl=class{constructor(_){this._onMove=()=>{Rh(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Rh(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Dh),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Th,c.Style=ko,c.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=Am,c.TwoFingersTouchRotateHandler=_p,c.TwoFingersTouchZoomHandler=Mm,c.TwoFingersTouchZoomRotateHandler=cc,c.VectorTileSource=Dn,c.VideoSource=Mo,c.addSourceType=(_,s)=>u._(void 0,void 0,void 0,function*(){if(Va(_))throw new Error(`A source type called "${_}" already exists.`);((f,d)=>{Os[f]=d})(_,s)}),c.clearPrewarmedResources=function(){const _=yn;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(At),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return rt().getRTLTextPluginStatus()},c.getVersion=function(){return zm},c.getWorkerCount=function(){return hn.workerCount},c.getWorkerUrl=function(){return u.a.WORKER_URL},c.importScriptInWorkers=function(_){return kr().broadcast("IS",_)},c.prewarm=function(){kn().acquire(At)},c.setMaxParallelImageRequests=function(_){u.a.MAX_PARALLEL_IMAGE_REQUESTS=_},c.setRTLTextPlugin=function(_,s){return rt().setRTLTextPlugin(_,s)},c.setWorkerCount=function(_){hn.workerCount=_},c.setWorkerUrl=function(_){u.a.WORKER_URL=_}});var a=n;return a})})(wI);var tD=wI.exports;const Es=Iv(tD);var nD=Object.defineProperty,rD=(t,e,n)=>e in t?nD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ow=(t,e,n)=>(rD(t,typeof e!="symbol"?e+"":e,n),n);function wd(){}function EI(t){return t()}function zw(){return Object.create(null)}function Sy(t){t.forEach(EI)}function II(t){return typeof t=="function"}function iD(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function oD(t){return Object.keys(t).length===0}function sD(t,e){t.appendChild(e)}function aD(t,e,n){t.insertBefore(e,n||null)}function CI(t){t.parentNode&&t.parentNode.removeChild(t)}function Fw(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Eu(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function lD(t){return Array.from(t.childNodes)}function hg(t,e,n){t.classList.toggle(e,!!n)}let Zv;function yd(t){Zv=t}const rf=[],Bw=[];let cf=[];const Vw=[],uD=Promise.resolve();let J0=!1;function cD(){J0||(J0=!0,uD.then(TI))}function Q0(t){cf.push(t)}const _0=new Set;let Qh=0;function TI(){if(Qh!==0)return;const t=Zv;do{try{for(;Qh<rf.length;){const e=rf[Qh];Qh++,yd(e),hD(e.$$)}}catch(e){throw rf.length=0,Qh=0,e}for(yd(null),rf.length=0,Qh=0;Bw.length;)Bw.pop()();for(let e=0;e<cf.length;e+=1){const n=cf[e];_0.has(n)||(_0.add(n),n())}cf.length=0}while(rf.length);for(;Vw.length;)Vw.pop()();J0=!1,_0.clear(),yd(t)}function hD(t){if(t.fragment!==null){t.update(),Sy(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Q0)}}function fD(t){const e=[],n=[];cf.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),cf=e}const pD=new Set;function dD(t,e){t&&t.i&&(pD.delete(t),t.i(e))}function mD(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Q0(()=>{const a=t.$$.on_mount.map(EI).filter(II);t.$$.on_destroy?t.$$.on_destroy.push(...a):Sy(a),t.$$.on_mount=[]}),i.forEach(Q0)}function gD(t,e){const n=t.$$;n.fragment!==null&&(fD(n.after_update),Sy(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function yD(t,e){t.$$.dirty[0]===-1&&(rf.push(t),cD(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function _D(t,e,n,r,i,a,c=null,u=[-1]){const m=Zv;yd(t);const w=t.$$={fragment:null,ctx:[],props:a,update:wd,not_equal:i,bound:zw(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(m?m.$$.context:[])),callbacks:zw(),dirty:u,skip_bound:!1,root:e.target||m.$$.root};c&&c(w.root);let S=!1;if(w.ctx=n?n(t,e.props||{},(E,P,...D)=>{const k=D.length?D[0]:P;return w.ctx&&i(w.ctx[E],w.ctx[E]=k)&&(!w.skip_bound&&w.bound[E]&&w.bound[E](k),S&&yD(t,E)),P}):[],w.update(),S=!0,Sy(w.before_update),w.fragment=r?r(w.ctx):!1,e.target){if(e.hydrate){const E=lD(e.target);w.fragment&&w.fragment.l(E),E.forEach(CI)}else w.fragment&&w.fragment.c();e.intro&&dD(t.$$.fragment),mD(t,e.target,e.anchor),TI()}yd(m)}class vD{constructor(){Ow(this,"$$"),Ow(this,"$$set")}$destroy(){gD(this,1),this.$destroy=wd}$on(e,n){if(!II(n))return wd;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!oD(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const bD="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(bD);function xD(t){let e,n,r;return{c(){e=Fw("svg"),n=Fw("path"),Eu(n,"stroke-width","4"),Eu(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Eu(n,"class","svelte-gzo3ar"),Eu(e,"width",r=t[0]==="list"?20:void 0),Eu(e,"viewBox","0 0 70 85"),Eu(e,"fill","none"),Eu(e,"class","svelte-gzo3ar"),hg(e,"in-map",t[0]!=="list"),hg(e,"list-icon",t[0]==="list")},m(i,a){aD(i,e,a),sD(e,n)},p(i,[a]){a&1&&r!==(r=i[0]==="list"?20:void 0)&&Eu(e,"width",r),a&1&&hg(e,"in-map",i[0]!=="list"),a&1&&hg(e,"list-icon",i[0]==="list")},i:wd,o:wd,d(i){i&&CI(e)}}}function wD(t,e,n){let{displayIn:r}=e;return t.$$set=i=>{"displayIn"in i&&n(0,r=i.displayIn)},[r]}class SD extends vD{constructor(e){super(),_D(this,e,wD,xD,iD,{displayIn:0})}}const ED=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],ID={decimalLatitude:40.123,decimalLongitude:-74.123},CD=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],TD=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function LD(){const t=[];return ED.forEach(e=>{e.decimalLatitude?t.push(e):t.push({...e,...ID})}),[...t,...CD,...TD]}const PD=LD();PD.map(t=>t.verbatimCoordinates);/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function MD(t,e){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(w){return function(S){return m([w,S])}}function m(w){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(a=w[0]&2?i.return:w[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,w[1])).done)return a;switch(i=0,a&&(w=[w[0]&2,a.value]),w[0]){case 0:case 1:a=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!a||w[1]>a[0]&&w[1]<a[3])){n.label=w[1];break}if(w[0]===6&&n.label<a[1]){n.label=a[1],a=w;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(w);break}a[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(S){w=[6,S],i=0}finally{r=a=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}var Du=function(){function t(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return t}();function AD(t,e){return t>e?1:t<e?-1:0}function Lu(t,e,n){for(var r=new Du(null,null),i=r,a=r;;){var c=n(t,e.key);if(c<0){if(e.left===null)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}a.left=e,a=e,e=e.left}else if(c>0){if(e.right===null)break;if(n(t,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,a.left=e.right,e.left=r.right,e.right=r.left,e}function v0(t,e,n,r){var i=new Du(t,e);if(n===null)return i.left=i.right=null,i;n=Lu(t,n,r);var a=r(t,n.key);return a<0?(i.left=n.left,i.right=n,n.left=null):a>=0&&(i.right=n.right,i.left=n,n.right=null),i}function Uw(t,e,n){var r=null,i=null;if(e){e=Lu(t,e,n);var a=n(e.key,t);a===0?(r=e.left,i=e.right):a<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function kD(t,e,n){return e===null?t:(t===null||(e=Lu(t.key,e,n),e.left=t),e)}function $0(t,e,n,r,i){if(t){r(""+e+(n?"└── ":"├── ")+i(t)+`
`);var a=e+(n?"    ":"│   ");t.left&&$0(t.left,a,!1,r,i),t.right&&$0(t.right,a,!0,r,i)}}var Xv=function(){function t(e){e===void 0&&(e=AD),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,n){return this._size++,this._root=v0(e,n,this._root,this._comparator)},t.prototype.add=function(e,n){var r=new Du(e,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,a=Lu(e,this._root,i),c=i(e,a.key);return c===0?this._root=a:(c<0?(r.left=a.left,r.right=a,a.left=null):c>0&&(r.right=a.right,r.left=a,a.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,n,r){var i;if(n===null)return null;n=Lu(e,n,r);var a=r(e,n.key);return a===0?(n.left===null?i=n.right:(i=Lu(e,n.left,r),i.right=n.right),this._size--,i):n},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Lu(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return n;i<0?n=n.left:n=n.right}return null},t.prototype.find=function(e){return this._root&&(this._root=Lu(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return!0;i<0?n=n.left:n=n.right}return!1},t.prototype.forEach=function(e,n){for(var r=this._root,i=[],a=!1;!a;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(n,r),r=r.right):a=!0;return this},t.prototype.range=function(e,n,r,i){for(var a=[],c=this._comparator,u=this._root,m;a.length!==0||u;)if(u)a.push(u),u=u.left;else{if(u=a.pop(),m=c(u.key,n),m>0)break;if(c(u.key,e)>=0&&r.call(i,u))return this;u=u.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(n){var r=n.key;return e.push(r)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(n){var r=n.data;return e.push(r)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var n=this._root,r=!1,i=0,a=[];!r;)if(n)a.push(n),n=n.left;else if(a.length>0){if(n=a.pop(),i===e)return n;i++,n=n.right}else r=!0;return null},t.prototype.next=function(e){var n=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;n;){var a=i(e.key,n.key);if(a===0)break;a<0?(r=n,n=n.left):n=n.right}return r},t.prototype.prev=function(e){var n=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;n;){var a=i(e.key,n.key);if(a===0)break;a<0?n=n.left:(r=n,n=n.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return RD(this._root)},t.prototype.load=function(e,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var i=e.length,a=this._comparator;if(r&&nv(e,n,0,i-1,a),this._root===null)this._root=ev(e,n,0,i),this._size=i;else{var c=ND(this.toList(),DD(e,n),a);i=this._size+i,this._root=tv({head:c},0,i)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var n=[];return $0(this._root,"",!0,function(r){return n.push(r)},e),n.join("")},t.prototype.update=function(e,n,r){var i=this._comparator,a=Uw(e,this._root,i),c=a.left,u=a.right;i(e,n)<0?u=v0(n,r,u,i):c=v0(n,r,c,i),this._root=kD(c,u,i)},t.prototype.split=function(e){return Uw(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e,n,r;return MD(this,function(i){switch(i.label){case 0:e=this._root,n=[],r=!1,i.label=1;case 1:return r?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:r=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},t}();function ev(t,e,n,r){var i=r-n;if(i>0){var a=n+Math.floor(i/2),c=t[a],u=e[a],m=new Du(c,u);return m.left=ev(t,e,n,a),m.right=ev(t,e,a+1,r),m}return null}function DD(t,e){for(var n=new Du(null,null),r=n,i=0;i<t.length;i++)r=r.next=new Du(t[i],e[i]);return r.next=null,n.next}function RD(t){for(var e=t,n=[],r=!1,i=new Du(null,null),a=i;!r;)e?(n.push(e),e=e.left):n.length>0?(e=a=a.next=n.pop(),e=e.right):r=!0;return a.next=null,i.next}function tv(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),a=tv(t,e,i),c=t.head;return c.left=a,t.head=t.head.next,c.right=tv(t,i+1,n),c}return null}function ND(t,e,n){for(var r=new Du(null,null),i=r,a=t,c=e;a!==null&&c!==null;)n(a.key,c.key)<0?(i.next=a,a=a.next):(i.next=c,c=c.next),i=i.next;return a!==null?i.next=a:c!==null&&(i.next=c),r.next}function nv(t,e,n,r,i){if(!(n>=r)){for(var a=t[n+r>>1],c=n-1,u=r+1;;){do c++;while(i(t[c],a)<0);do u--;while(i(t[u],a)>0);if(c>=u)break;var m=t[c];t[c]=t[u],t[u]=m,m=e[c],e[c]=e[u],e[u]=m}nv(t,e,n,u,i),nv(t,e,u+1,r,i)}}function pa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gw(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jo(t,e,n){return e&&Gw(t.prototype,e),n&&Gw(t,n),t}var ed=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},rv=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x,i=t.ll.y<e.ll.y?e.ll.y:t.ll.y,a=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:a}}},Mu=Number.EPSILON;Mu===void 0&&(Mu=Math.pow(2,-52));var OD=Mu*Mu,iv=function(t,e){if(-Mu<t&&t<Mu&&-Mu<e&&e<Mu)return 0;var n=t-e;return n*n<OD*t*e?0:t<e?-1:1},zD=function(){function t(){pa(this,t),this.reset()}return jo(t,[{key:"reset",value:function(){this.xRounder=new qw,this.yRounder=new qw}},{key:"round",value:function(e,n){return{x:this.xRounder.round(e),y:this.yRounder.round(n)}}}]),t}(),qw=function(){function t(){pa(this,t),this.tree=new Xv,this.round(0)}return jo(t,[{key:"round",value:function(e){var n=this.tree.add(e),r=this.tree.prev(n);if(r!==null&&iv(n.key,r.key)===0)return this.tree.remove(e),r.key;var i=this.tree.next(n);return i!==null&&iv(n.key,i.key)===0?(this.tree.remove(e),i.key):e}}]),t}(),Sd=new zD,_d=function(t,e){return t.x*e.y-t.y*e.x},LI=function(t,e){return t.x*e.x+t.y*e.y},jw=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},a=_d(r,i);return iv(a,0)},ty=function(t){return Math.sqrt(LI(t,t))},FD=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return _d(i,r)/ty(i)/ty(r)},BD=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return LI(i,r)/ty(i)/ty(r)},Ww=function(t,e,n){return e.y===0?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},Hw=function(t,e,n){return e.x===0?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},VD=function(t,e,n,r){if(e.x===0)return Hw(n,r,t.x);if(r.x===0)return Hw(t,e,n.x);if(e.y===0)return Ww(n,r,t.y);if(r.y===0)return Ww(t,e,n.y);var i=_d(e,r);if(i==0)return null;var a={x:n.x-t.x,y:n.y-t.y},c=_d(a,e)/i,u=_d(a,r)/i,m=t.x+u*e.x,w=n.x+c*r.x,S=t.y+u*e.y,E=n.y+c*r.y,P=(m+w)/2,D=(S+E)/2;return{x:P,y:D}},nl=function(){jo(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return r!==0?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:ny.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,n){return e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0}}]);function t(e,n){pa(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return jo(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var n=e.point.events,r=0,i=n.length;r<i;r++){var a=n[r];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,n=0;n<e;n++){var r=this.point.events[n];if(r.segment.consumedBy===void 0)for(var i=n+1;i<e;i++){var a=this.point.events[i];a.consumedBy===void 0&&r.otherSE.point.events===a.otherSE.point.events&&r.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],n=0,r=this.point.events.length;n<r;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}},{key:"getLeftmostComparator",value:function(e){var n=this,r=new Map,i=function(a){var c=a.otherSE;r.set(a,{sine:FD(n.point,e.point,c.point),cosine:BD(n.point,e.point,c.point)})};return function(a,c){r.has(a)||i(a),r.has(c)||i(c);var u=r.get(a),m=u.sine,w=u.cosine,S=r.get(c),E=S.sine,P=S.cosine;return m>=0&&E>=0?w<P?1:w>P?-1:0:m<0&&E<0?w<P?-1:w>P?1:0:E<m?-1:E>m?1:0}}}]),t}(),UD=0,ny=function(){jo(t,null,[{key:"compare",value:function(e,n){var r=e.leftSE.point.x,i=n.leftSE.point.x,a=e.rightSE.point.x,c=n.rightSE.point.x;if(c<r)return 1;if(a<i)return-1;var u=e.leftSE.point.y,m=n.leftSE.point.y,w=e.rightSE.point.y,S=n.rightSE.point.y;if(r<i){if(m<u&&m<w)return 1;if(m>u&&m>w)return-1;var E=e.comparePoint(n.leftSE.point);if(E<0)return 1;if(E>0)return-1;var P=n.comparePoint(e.rightSE.point);return P!==0?P:-1}if(r>i){if(u<m&&u<S)return-1;if(u>m&&u>S)return 1;var D=n.comparePoint(e.leftSE.point);if(D!==0)return D;var k=e.comparePoint(n.rightSE.point);return k<0?1:k>0?-1:1}if(u<m)return-1;if(u>m)return 1;if(a<c){var V=n.comparePoint(e.rightSE.point);if(V!==0)return V}if(a>c){var j=e.comparePoint(n.rightSE.point);if(j<0)return 1;if(j>0)return-1}if(a!==c){var te=w-u,U=a-r,W=S-m,Y=c-i;if(te>U&&W<Y)return 1;if(te<U&&W>Y)return-1}return a>c?1:a<c||w<S?-1:w>S?1:e.id<n.id?-1:e.id>n.id?1:0}}]);function t(e,n,r,i){pa(this,t),this.id=++UD,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return jo(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<n?e:n},ur:{x:this.rightSE.point.x,y:e>n?e:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var n=this.leftSE.point,r=this.rightSE.point,i=this.vector();if(n.x===r.x)return e.x===n.x?0:e.x<n.x?1:-1;var a=(e.y-n.y)/i.y,c=n.x+a*i.x;if(e.x===c)return 0;var u=(e.x-n.x)/i.x,m=n.y+u*i.y;return e.y===m?0:e.y<m?-1:1}},{key:"getIntersection",value:function(e){var n=this.bbox(),r=e.bbox(),i=rv(n,r);if(i===null)return null;var a=this.leftSE.point,c=this.rightSE.point,u=e.leftSE.point,m=e.rightSE.point,w=ed(n,u)&&this.comparePoint(u)===0,S=ed(r,a)&&e.comparePoint(a)===0,E=ed(n,m)&&this.comparePoint(m)===0,P=ed(r,c)&&e.comparePoint(c)===0;if(S&&w)return P&&!E?c:!P&&E?m:null;if(S)return E&&a.x===m.x&&a.y===m.y?null:a;if(w)return P&&c.x===u.x&&c.y===u.y?null:u;if(P&&E)return null;if(P)return c;if(E)return m;var D=VD(a,this.vector(),u,e.vector());return D===null||!ed(i,D)?null:Sd.round(D.x,D.y)}},{key:"split",value:function(e){var n=[],r=e.events!==void 0,i=new nl(e,!0),a=new nl(e,!1),c=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(i);var u=new t(i,c,this.rings.slice(),this.windings.slice());return nl.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),nl.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(i!==0){if(i>0){var a=n;n=r,r=a}if(n.prev===r){var c=n;n=r,r=c}for(var u=0,m=r.rings.length;u<m;u++){var w=r.rings[u],S=r.windings[u],E=n.rings.indexOf(w);E===-1?(n.rings.push(w),n.windings.push(S)):n.windings[E]+=S}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys,a=0,c=this.rings.length;a<c;a++){var u=this.rings[a],m=this.windings[a],w=n.indexOf(u);w===-1?(n.push(u),r.push(m)):r[w]+=m}for(var S=[],E=[],P=0,D=n.length;P<D;P++)if(r[P]!==0){var k=n[P],V=k.poly;if(E.indexOf(V)===-1)if(k.isExterior)S.push(V);else{E.indexOf(V)===-1&&E.push(V);var j=S.indexOf(k.poly);j!==-1&&S.splice(j,1)}}for(var te=0,U=S.length;te<U;te++){var W=S[te].multiPoly;i.indexOf(W)===-1&&i.push(W)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ia.type){case"union":{var r=e.length===0,i=n.length===0;this._isInResult=r!==i;break}case"intersection":{var a,c;e.length<n.length?(a=e.length,c=n.length):(a=n.length,c=e.length),this._isInResult=c===Ia.numMultiPolys&&a<c;break}case"xor":{var u=Math.abs(e.length-n.length);this._isInResult=u%2===1;break}case"difference":{var m=function(w){return w.length===1&&w[0].isSubject};this._isInResult=m(e)!==m(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ia.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,a,c,u=nl.comparePoints(e,n);if(u<0)i=e,a=n,c=1;else if(u>0)i=n,a=e,c=-1;else throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));var m=new nl(i,!0),w=new nl(a,!1);return new t(m,w,[r],[c])}}]),t}(),Zw=function(){function t(e,n,r){if(pa(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Sd.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var a=i,c=1,u=e.length;c<u;c++){if(typeof e[c][0]!="number"||typeof e[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var m=Sd.round(e[c][0],e[c][1]);m.x===a.x&&m.y===a.y||(this.segments.push(ny.fromRing(a,m,this)),m.x<this.bbox.ll.x&&(this.bbox.ll.x=m.x),m.y<this.bbox.ll.y&&(this.bbox.ll.y=m.y),m.x>this.bbox.ur.x&&(this.bbox.ur.x=m.x),m.y>this.bbox.ur.y&&(this.bbox.ur.y=m.y),a=m)}(i.x!==a.x||i.y!==a.y)&&this.segments.push(ny.fromRing(a,i,this))}return jo(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,r=this.segments.length;n<r;n++){var i=this.segments[n];e.push(i.leftSE),e.push(i.rightSE)}return e}}]),t}(),GD=function(){function t(e,n){if(pa(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Zw(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var a=new Zw(e[r],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=n}return jo(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),n=0,r=this.interiorRings.length;n<r;n++)for(var i=this.interiorRings[n].getSweepEvents(),a=0,c=i.length;a<c;a++)e.push(i[a]);return e}}]),t}(),Xw=function(){function t(e,n){if(pa(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var a=new GD(e[r],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=n}return jo(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,r=this.polys.length;n<r;n++)for(var i=this.polys[n].getSweepEvents(),a=0,c=i.length;a<c;a++)e.push(i[a]);return e}}]),t}(),qD=function(){jo(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var a=e[r];if(!(!a.isInResult()||a.ringOut)){for(var c=null,u=a.leftSE,m=a.rightSE,w=[u],S=u.point,E=[];c=u,u=m,w.push(u),u.point!==S;)for(;;){var P=u.getAvailableLinkedEvents();if(P.length===0){var D=w[0].point,k=w[w.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(D.x,",")+" ".concat(D.y,"]. Last matching segment found ends at")+" [".concat(k.x,", ").concat(k.y,"]."))}if(P.length===1){m=P[0].otherSE;break}for(var V=null,j=0,te=E.length;j<te;j++)if(E[j].point===u.point){V=j;break}if(V!==null){var U=E.splice(V)[0],W=w.splice(U.index);W.unshift(W[0].otherSE),n.push(new t(W.reverse()));continue}E.push({index:w.length,point:u.point});var Y=u.getLeftmostComparator(c);m=P.sort(Y)[0].otherSE;break}n.push(new t(w))}}return n}}]);function t(e){pa(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return jo(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,n=[e],r=1,i=this.events.length-1;r<i;r++){var a=this.events[r].point,c=this.events[r+1].point;jw(a,e,c)!==0&&(n.push(a),e=a)}if(n.length===1)return null;var u=n[0],m=n[1];jw(u,e,m)===0&&n.shift(),n.push(n[0]);for(var w=this.isExteriorRing()?1:-1,S=this.isExteriorRing()?0:n.length-1,E=this.isExteriorRing()?n.length:-1,P=[],D=S;D!=E;D+=w)P.push([n[D].x,n[D].y]);return P}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],n=1,r=this.events.length;n<r;n++){var i=this.events[n];nl.compare(e,i)>0&&(e=i)}for(var a=e.segment.prevInResult(),c=a?a.prevInResult():null;;){if(!a)return null;if(!c)return a.ringOut;if(c.ringOut!==a.ringOut)return c.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=c.prevInResult(),c=a?a.prevInResult():null}}}]),t}(),Yw=function(){function t(e){pa(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return jo(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(var n=0,r=this.interiorRings.length;n<r;n++){var i=this.interiorRings[n].getGeom();i!==null&&e.push(i)}return e}}]),t}(),jD=function(){function t(e){pa(this,t),this.rings=e,this.polys=this._composePolys(e)}return jo(t,[{key:"getGeom",value:function(){for(var e=[],n=0,r=this.polys.length;n<r;n++){var i=this.polys[n].getGeom();i!==null&&e.push(i)}return e}},{key:"_composePolys",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var a=e[r];if(!a.poly)if(a.isExteriorRing())n.push(new Yw(a));else{var c=a.enclosingRing();c.poly||n.push(new Yw(c)),c.poly.addInterior(a)}}return n}}]),t}(),WD=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ny.compare;pa(this,t),this.queue=e,this.tree=new Xv(n),this.segments=[]}return jo(t,[{key:"process",value:function(e){var n=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(n),r;var i=e.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=i,c=i,u=void 0,m=void 0;u===void 0;)a=this.tree.prev(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);for(;m===void 0;)c=this.tree.next(c),c===null?m=null:c.key.consumedBy===void 0&&(m=c.key);if(e.isLeft){var w=null;if(u){var S=u.getIntersection(n);if(S!==null&&(n.isAnEndpoint(S)||(w=S),!u.isAnEndpoint(S)))for(var E=this._splitSafely(u,S),P=0,D=E.length;P<D;P++)r.push(E[P])}var k=null;if(m){var V=m.getIntersection(n);if(V!==null&&(n.isAnEndpoint(V)||(k=V),!m.isAnEndpoint(V)))for(var j=this._splitSafely(m,V),te=0,U=j.length;te<U;te++)r.push(j[te])}if(w!==null||k!==null){var W=null;if(w===null)W=k;else if(k===null)W=w;else{var Y=nl.comparePoints(w,k);W=Y<=0?w:k}this.queue.remove(n.rightSE),r.push(n.rightSE);for(var oe=n.split(W),_e=0,se=oe.length;_e<se;_e++)r.push(oe[_e])}r.length>0?(this.tree.remove(n),r.push(e)):(this.segments.push(n),n.prev=u)}else{if(u&&m){var ce=u.getIntersection(m);if(ce!==null){if(!u.isAnEndpoint(ce))for(var me=this._splitSafely(u,ce),Ce=0,Z=me.length;Ce<Z;Ce++)r.push(me[Ce]);if(!m.isAnEndpoint(ce))for(var fe=this._splitSafely(m,ce),Ke=0,Se=fe.length;Ke<Se;Ke++)r.push(fe[Ke])}}this.tree.remove(n)}return r}},{key:"_splitSafely",value:function(e,n){this.tree.remove(e);var r=e.rightSE;this.queue.remove(r);var i=e.split(n);return i.push(r),e.consumedBy===void 0&&this.tree.insert(e),i}}]),t}(),Kw=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,HD=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ZD=function(){function t(){pa(this,t)}return jo(t,[{key:"run",value:function(e,n,r){Ia.type=e,Sd.reset();for(var i=[new Xw(n,!0)],a=0,c=r.length;a<c;a++)i.push(new Xw(r[a],!1));if(Ia.numMultiPolys=i.length,Ia.type==="difference")for(var u=i[0],m=1;m<i.length;)rv(i[m].bbox,u.bbox)!==null?m++:i.splice(m,1);if(Ia.type==="intersection"){for(var w=0,S=i.length;w<S;w++)for(var E=i[w],P=w+1,D=i.length;P<D;P++)if(rv(E.bbox,i[P].bbox)===null)return[]}for(var k=new Xv(nl.compare),V=0,j=i.length;V<j;V++)for(var te=i[V].getSweepEvents(),U=0,W=te.length;U<W;U++)if(k.insert(te[U]),k.size>Kw)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Y=new WD(k),oe=k.size,_e=k.pop();_e;){var se=_e.key;if(k.size===oe){var ce=se.segment;throw new Error("Unable to pop() ".concat(se.isLeft?"left":"right"," SweepEvent ")+"[".concat(se.point.x,", ").concat(se.point.y,"] from segment #").concat(ce.id," ")+"[".concat(ce.leftSE.point.x,", ").concat(ce.leftSE.point.y,"] -> ")+"[".concat(ce.rightSE.point.x,", ").concat(ce.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(k.size>Kw)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Y.segments.length>HD)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var me=Y.process(se),Ce=0,Z=me.length;Ce<Z;Ce++){var fe=me[Ce];fe.consumedBy===void 0&&k.insert(fe)}oe=k.size,_e=k.pop()}Sd.reset();var Ke=qD.factory(Y.segments),Se=new jD(Ke);return Se.getGeom()}}]),t}(),Ia=new ZD,XD=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ia.run("union",t,n)},YD=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ia.run("intersection",t,n)},KD=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ia.run("xor",t,n)},JD=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ia.run("difference",t,n)},PI={union:XD,intersection:YD,xor:KD,difference:JD},Vo=63710088e-1,MI={centimeters:Vo*100,centimetres:Vo*100,degrees:Vo/111325,feet:Vo*3.28084,inches:Vo*39.37,kilometers:Vo/1e3,kilometres:Vo/1e3,meters:Vo,metres:Vo,miles:Vo/1609.344,millimeters:Vo*1e3,millimetres:Vo*1e3,nauticalmiles:Vo/1852,radians:1,yards:Vo*1.0936};function Ey(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function QD(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Jw(t[0])||!Jw(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return Ey(r,e,n)}function AI(t,e,n){n===void 0&&(n={});for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<a[a.length-1].length;c++)if(a[a.length-1][c]!==a[0][c])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:t};return Ey(u,e,n)}function ov(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function kI(t,e,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:t};return Ey(r,e,n)}function $D(t,e){e===void 0&&(e="kilometers");var n=MI[e];if(!n)throw new Error(e+" units is invalid");return t*n}function eR(t,e){e===void 0&&(e="kilometers");var n=MI[e];if(!n)throw new Error(e+" units is invalid");return t/n}function Jw(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function ry(t){return t.type==="Feature"?t.geometry:t}function tR(t,e,n){n===void 0&&(n={});var r=ry(t),i=ry(e),a=PI.union(r.coordinates,i.coordinates);return a.length===0?null:a.length===1?AI(a[0],n.properties):kI(a,n.properties)}function DI(t,e,n){if(t!==null)for(var r,i,a,c,u,m,w,S=0,E=0,P,D=t.type,k=D==="FeatureCollection",V=D==="Feature",j=k?t.features.length:1,te=0;te<j;te++){w=k?t.features[te].geometry:V?t.geometry:t,P=w?w.type==="GeometryCollection":!1,u=P?w.geometries.length:1;for(var U=0;U<u;U++){var W=0,Y=0;if(c=P?w.geometries[U]:w,c!==null){m=c.coordinates;var oe=c.type;switch(S=n&&(oe==="Polygon"||oe==="MultiPolygon")?1:0,oe){case null:break;case"Point":if(e(m,E,te,W,Y)===!1)return!1;E++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<m.length;r++){if(e(m[r],E,te,W,Y)===!1)return!1;E++,oe==="MultiPoint"&&W++}oe==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<m.length;r++){for(i=0;i<m[r].length-S;i++){if(e(m[r][i],E,te,W,Y)===!1)return!1;E++}oe==="MultiLineString"&&W++,oe==="Polygon"&&Y++}oe==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<m.length;r++){for(Y=0,i=0;i<m[r].length;i++){for(a=0;a<m[r][i].length-S;a++){if(e(m[r][i][a],E,te,W,Y)===!1)return!1;E++}Y++}W++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(DI(c.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qw(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function RI(t,e){var n,r,i,a,c,u,m,w,S,E,P=0,D=t.type==="FeatureCollection",k=t.type==="Feature",V=D?t.features.length:1;for(n=0;n<V;n++){for(u=D?t.features[n].geometry:k?t.geometry:t,w=D?t.features[n].properties:k?t.properties:{},S=D?t.features[n].bbox:k?t.bbox:void 0,E=D?t.features[n].id:k?t.id:void 0,m=u?u.type==="GeometryCollection":!1,c=m?u.geometries.length:1,i=0;i<c;i++){if(a=m?u.geometries[i]:u,a===null){if(e(null,P,w,S,E)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,P,w,S,E)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(e(a.geometries[r],P,w,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}function sv(t){var e=[1/0,1/0,-1/0,-1/0];return DI(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}sv.default=sv;function nR(t,e){e===void 0&&(e={});var n=sv(t),r=(n[0]+n[2])/2,i=(n[1]+n[3])/2;return QD([r,i],e.properties,e)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Lc=function(){};Lc.prototype.interfaces_=function(){return[]};Lc.prototype.getClass=function(){return Lc};Lc.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var ar=function(t){function e(n){t.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Xt=function(){},NI={MAX_VALUE:{configurable:!0}};Xt.isNaN=function(t){return Number.isNaN(t)};Xt.doubleToLongBits=function(t){return t};Xt.longBitsToDouble=function(t){return t};Xt.isInfinite=function(t){return!Number.isFinite(t)};NI.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Xt,NI);var hs=function(){},Iy=function(){},gf=function(){};function fs(){}var Re=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Wc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Re.prototype.setOrdinate=function(t,e){switch(t){case Re.X:this.x=e;break;case Re.Y:this.y=e;break;case Re.Z:this.z=e;break;default:throw new ar("Invalid ordinate index: "+t)}};Re.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return!(!Lc.equalsWithTolerance(this.x,e.x,n)||!Lc.equalsWithTolerance(this.y,e.y,n))}};Re.prototype.getOrdinate=function(t){switch(t){case Re.X:return this.x;case Re.Y:return this.y;case Re.Z:return this.z}throw new ar("Invalid ordinate index: "+t)};Re.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||Xt.isNaN(this.z))&&Xt.isNaN(t.z)};Re.prototype.equals=function(t){return t instanceof Re?this.equals2D(t):!1};Re.prototype.equalInZ=function(t,e){return Lc.equalsWithTolerance(this.z,t.z,e)};Re.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0};Re.prototype.clone=function(){};Re.prototype.copy=function(){return new Re(this)};Re.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Re.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)};Re.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)};Re.prototype.hashCode=function(){var t=17;return t=37*t+Re.hashCode(this.x),t=37*t+Re.hashCode(this.y),t};Re.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};Re.prototype.interfaces_=function(){return[hs,Iy,fs]};Re.prototype.getClass=function(){return Re};Re.hashCode=function(){if(arguments.length===1){var t=arguments[0],e=Xt.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}};Wc.DimensionalComparator.get=function(){return ql};Wc.serialVersionUID.get=function(){return 6683108902428367e3};Wc.NULL_ORDINATE.get=function(){return Xt.NaN};Wc.X.get=function(){return 0};Wc.Y.get=function(){return 1};Wc.Z.get=function(){return 2};Object.defineProperties(Re,Wc);var ql=function(t){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new ar("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};ql.prototype.compare=function(t,e){var n=t,r=e,i=ql.compare(n.x,r.x);if(i!==0)return i;var a=ql.compare(n.y,r.y);if(a!==0)return a;if(this._dimensionsToTest<=2)return 0;var c=ql.compare(n.z,r.z);return c};ql.prototype.interfaces_=function(){return[gf]};ql.prototype.getClass=function(){return ql};ql.compare=function(t,e){return t<e?-1:t>e?1:Xt.isNaN(t)?Xt.isNaN(e)?0:-1:Xt.isNaN(e)?1:0};var yf=function(){};yf.prototype.create=function(){};yf.prototype.interfaces_=function(){return[]};yf.prototype.getClass=function(){return yf};var ze=function(){},jd={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};ze.prototype.interfaces_=function(){return[]};ze.prototype.getClass=function(){return ze};ze.toLocationSymbol=function(t){switch(t){case ze.EXTERIOR:return"e";case ze.BOUNDARY:return"b";case ze.INTERIOR:return"i";case ze.NONE:return"-"}throw new ar("Unknown location value: "+t)};jd.INTERIOR.get=function(){return 0};jd.BOUNDARY.get=function(){return 1};jd.EXTERIOR.get=function(){return 2};jd.NONE.get=function(){return-1};Object.defineProperties(ze,jd);var Ut=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Wo=function(){},OI={LOG_10:{configurable:!0}};Wo.prototype.interfaces_=function(){return[]};Wo.prototype.getClass=function(){return Wo};Wo.log10=function(t){var e=Math.log(t);return Xt.isInfinite(e)||Xt.isNaN(e)?e:e/Wo.LOG_10};Wo.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i};Wo.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],a=arguments[2];return r<i?i:r>a?a:r}};Wo.wrap=function(t,e){return t<0?e- -t%e:t%e};Wo.max=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}else if(arguments.length===4){var i=arguments[0],a=arguments[1],c=arguments[2],u=arguments[3],m=i;return a>m&&(m=a),c>m&&(m=c),u>m&&(m=u),m}};Wo.average=function(t,e){return(t+e)/2};OI.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Wo,OI);var da=function(t){this.str=t};da.prototype.append=function(t){this.str+=t};da.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)};da.prototype.toString=function(t){return this.str};var ta=function(t){this.value=t};ta.prototype.intValue=function(){return this.value};ta.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};ta.isNaN=function(t){return Number.isNaN(t)};var Ed=function(){};Ed.isWhitespace=function(t){return t<=32&&t>=0||t===127};Ed.toUpperCase=function(t){return t.toUpperCase()};var je=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];t.call(this,t.parse(r))}}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.init(i,a)}},Rs={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};je.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};je.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=je.magnitude(n._hi),i=je.TEN.pow(r);n=n.divide(i),n.gt(je.TEN)?(n=n.divide(je.TEN),r+=1):n.lt(je.ONE)&&(n=n.multiply(je.TEN),r-=1);for(var a=r+1,c=new da,u=je.MAX_PRINT_DIGITS-1,m=0;m<=u;m++){t&&m===a&&c.append(".");var w=Math.trunc(n._hi);if(w<0)break;var S=!1,E=0;w>9?(S=!0,E="9"):E="0"+w,c.append(E),n=n.subtract(je.valueOf(w)).multiply(je.TEN),S&&n.selfAdd(je.TEN);var P=!0,D=je.magnitude(n._hi);if(D<0&&Math.abs(D)>=u-m&&(P=!1),!P)break}return e[0]=r,c.toString()};je.prototype.sqr=function(){return this.multiply(this)};je.prototype.doubleValue=function(){return this._hi+this._lo};je.prototype.subtract=function(){if(arguments[0]instanceof je){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.add(-e)}};je.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};je.prototype.isZero=function(){return this._hi===0&&this._lo===0};je.prototype.selfSubtract=function(){if(arguments[0]instanceof je){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}};je.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};je.prototype.min=function(t){return this.le(t)?this:t};je.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof je){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfDivide(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,a=null,c=null,u=null,m=null,w=null,S=null,E=null;return m=this._hi/n,w=je.SPLIT*m,i=w-m,E=je.SPLIT*n,i=w-i,a=m-i,c=E-n,S=m*n,c=E-c,u=n-c,E=i*c-S+i*u+a*c+a*u,w=(this._hi-S-E+this._lo-m*r)/n,E=m+w,this._hi=E,this._lo=m-E+w,this}};je.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};je.prototype.divide=function(){if(arguments[0]instanceof je){var t=arguments[0],e=null,n=null,r=null,i=null,a=null,c=null,u=null,m=null;a=this._hi/t._hi,c=je.SPLIT*a,e=c-a,m=je.SPLIT*t._hi,e=c-e,n=a-e,r=m-t._hi,u=a*t._hi,r=m-r,i=t._hi-r,m=e*r-u+e*i+n*r+n*i,c=(this._hi-u-m+this._lo-a*t._lo)/t._hi,m=a+c;var w=m,S=a-m+c;return new je(w,S)}else if(typeof arguments[0]=="number"){var E=arguments[0];return Xt.isNaN(E)?je.createNaN():je.copy(this).selfDivide(E,0)}};je.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};je.prototype.pow=function(t){if(t===0)return je.valueOf(1);var e=new je(this),n=je.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2===1&&n.selfMultiply(e),r/=2,r>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n};je.prototype.ceil=function(){if(this.isNaN())return je.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new je(t,e)};je.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0};je.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};je.prototype.setValue=function(){if(arguments[0]instanceof je){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.init(e),this}};je.prototype.max=function(t){return this.ge(t)?this:t};je.prototype.sqrt=function(){if(this.isZero())return je.valueOf(0);if(this.isNegative())return je.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=je.valueOf(e),r=this.subtract(n.sqr()),i=r._hi*(t*.5);return n.add(i)};je.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof je){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0],n=null,r=null,i=null,a=null,c=null,u=null;return i=this._hi+e,c=i-this._hi,a=i-c,a=e-c+(this._hi-a),u=a+this._lo,n=i+u,r=u+(i-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(arguments.length===2){var m=arguments[0],w=arguments[1],S=null,E=null,P=null,D=null,k=null,V=null,j=null,te=null;k=this._hi+m,P=this._lo+w,j=k-this._hi,te=P-this._lo,V=k-j,D=P-te,V=m-j+(this._hi-V),D=w-te+(this._lo-D),j=V+P,S=k+j,E=j+(k-S),j=D+E;var U=S+j,W=j+(S-U);return this._hi=U,this._lo=W,this}};je.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof je){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfMultiply(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,a=null,c=null,u=null,m=null,w=null;m=je.SPLIT*this._hi,i=m-this._hi,w=je.SPLIT*n,i=m-i,a=this._hi-i,c=w-n,m=this._hi*n,c=w-c,u=n-c,w=i*c-m+i*u+a*c+a*u+(this._hi*r+this._lo*n);var S=m+w;i=m-S;var E=w+i;return this._hi=S,this._lo=E,this}};je.prototype.selfSqr=function(){return this.selfMultiply(this)};je.prototype.floor=function(){if(this.isNaN())return je.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new je(t,e)};je.prototype.negate=function(){return this.isNaN()?this:new je(-this._hi,-this._lo)};je.prototype.clone=function(){};je.prototype.multiply=function(){if(arguments[0]instanceof je){var t=arguments[0];return t.isNaN()?je.createNaN():je.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return Xt.isNaN(e)?je.createNaN():je.copy(this).selfMultiply(e,0)}};je.prototype.isNaN=function(){return Xt.isNaN(this._hi)};je.prototype.intValue=function(){return Math.trunc(this._hi)};je.prototype.toString=function(){var t=je.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};je.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if(n.charAt(0)===".")i="0"+n;else if(r<0)i="0."+je.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var a=r-n.length,c=je.stringOfChar("0",a);i=n+c+".0"}return this.isNegative()?"-"+i:i};je.prototype.reciprocal=function(){var t=null,e=null,n=null,r=null,i=null,a=null,c=null,u=null;i=1/this._hi,a=je.SPLIT*i,t=a-i,u=je.SPLIT*this._hi,t=a-t,e=i-t,n=u-this._hi,c=i*this._hi,n=u-n,r=this._hi-n,u=t*n-c+t*r+e*n+e*r,a=(1-c-u-i*this._lo)/this._hi;var m=i+a,w=i-m+a;return new je(m,w)};je.prototype.toSciNotation=function(){if(this.isZero())return je.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=je.SCI_NOT_EXPONENT_CHAR+e[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var a=n.charAt(0)+"."+i;return this.isNegative()?"-"+a+r:a+r};je.prototype.abs=function(){return this.isNaN()?je.NaN:this.isNegative()?this.negate():new je(this)};je.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};je.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};je.prototype.add=function(){if(arguments[0]instanceof je){var t=arguments[0];return je.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return je.copy(this).selfAdd(e)}};je.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof je){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}};je.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};je.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};je.prototype.trunc=function(){return this.isNaN()?je.NaN:this.isPositive()?this.floor():this.ceil()};je.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};je.prototype.interfaces_=function(){return[fs,hs,Iy]};je.prototype.getClass=function(){return je};je.sqr=function(t){return je.valueOf(t).selfMultiply(t)};je.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return je.parse(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return new je(e)}};je.sqrt=function(t){return je.valueOf(t).sqrt()};je.parse=function(t){for(var e=0,n=t.length;Ed.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);(i==="-"||i==="+")&&(e++,i==="-"&&(r=!0))}for(var a=new je,c=0,u=0,m=0;!(e>=n);){var w=t.charAt(e);if(e++,Ed.isDigit(w)){var S=w-"0";a.selfMultiply(je.TEN),a.selfAdd(S),c++;continue}if(w==="."){u=c;continue}if(w==="e"||w==="E"){var E=t.substring(e);try{m=ta.parseInt(E)}catch(j){throw j instanceof Error?new Error("Invalid exponent "+E+" in string "+t):j}finally{}break}throw new Error("Unexpected character '"+w+"' at position "+e+" in string "+t)}var P=a,D=c-u-m;if(D===0)P=a;else if(D>0){var k=je.TEN.pow(D);P=a.divide(k)}else if(D<0){var V=je.TEN.pow(-D);P=a.multiply(V)}return r?P.negate():P};je.createNaN=function(){return new je(Xt.NaN,Xt.NaN)};je.copy=function(t){return new je(t)};je.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n)),i=Math.pow(10,r);return i*10<=e&&(r+=1),r};je.stringOfChar=function(t,e){for(var n=new da,r=0;r<e;r++)n.append(t);return n.toString()};Rs.PI.get=function(){return new je(3.141592653589793,12246467991473532e-32)};Rs.TWO_PI.get=function(){return new je(6.283185307179586,24492935982947064e-32)};Rs.PI_2.get=function(){return new je(1.5707963267948966,6123233995736766e-32)};Rs.E.get=function(){return new je(2.718281828459045,14456468917292502e-32)};Rs.NaN.get=function(){return new je(Xt.NaN,Xt.NaN)};Rs.EPS.get=function(){return 123259516440783e-46};Rs.SPLIT.get=function(){return 134217729};Rs.MAX_PRINT_DIGITS.get=function(){return 32};Rs.TEN.get=function(){return je.valueOf(10)};Rs.ONE.get=function(){return je.valueOf(1)};Rs.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Rs.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(je,Rs);var oo=function(){},zI={DP_SAFE_EPSILON:{configurable:!0}};oo.prototype.interfaces_=function(){return[]};oo.prototype.getClass=function(){return oo};oo.orientationIndex=function(t,e,n){var r=oo.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=je.valueOf(e.x).selfAdd(-t.x),a=je.valueOf(e.y).selfAdd(-t.y),c=je.valueOf(n.x).selfAdd(-e.x),u=je.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(u).selfSubtract(a.selfMultiply(c)).signum()};oo.signOfDet2x2=function(t,e,n,r){var i=t.multiply(r).selfSubtract(e.multiply(n));return i.signum()};oo.intersection=function(t,e,n,r){var i=je.valueOf(r.y).selfSubtract(n.y).selfMultiply(je.valueOf(e.x).selfSubtract(t.x)),a=je.valueOf(r.x).selfSubtract(n.x).selfMultiply(je.valueOf(e.y).selfSubtract(t.y)),c=i.subtract(a),u=je.valueOf(r.x).selfSubtract(n.x).selfMultiply(je.valueOf(t.y).selfSubtract(n.y)),m=je.valueOf(r.y).selfSubtract(n.y).selfMultiply(je.valueOf(t.x).selfSubtract(n.x)),w=u.subtract(m),S=w.selfDivide(c).doubleValue(),E=je.valueOf(t.x).selfAdd(je.valueOf(e.x).selfSubtract(t.x).selfMultiply(S)).doubleValue(),P=je.valueOf(e.x).selfSubtract(t.x).selfMultiply(je.valueOf(t.y).selfSubtract(n.y)),D=je.valueOf(e.y).selfSubtract(t.y).selfMultiply(je.valueOf(t.x).selfSubtract(n.x)),k=P.subtract(D),V=k.selfDivide(c).doubleValue(),j=je.valueOf(n.y).selfAdd(je.valueOf(r.y).selfSubtract(n.y).selfMultiply(V)).doubleValue();return new Re(E,j)};oo.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),a=(t.y-n.y)*(e.x-n.x),c=i-a;if(i>0){if(a<=0)return oo.signum(c);r=i+a}else if(i<0){if(a>=0)return oo.signum(c);r=-i-a}else return oo.signum(c);var u=oo.DP_SAFE_EPSILON*r;return c>=u||-c>=u?oo.signum(c):2};oo.signum=function(t){return t>0?1:t<0?-1:0};zI.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(oo,zI);var En=function(){},Wd={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Wd.X.get=function(){return 0};Wd.Y.get=function(){return 1};Wd.Z.get=function(){return 2};Wd.M.get=function(){return 3};En.prototype.setOrdinate=function(t,e,n){};En.prototype.size=function(){};En.prototype.getOrdinate=function(t,e){};En.prototype.getCoordinate=function(){};En.prototype.getCoordinateCopy=function(t){};En.prototype.getDimension=function(){};En.prototype.getX=function(t){};En.prototype.clone=function(){};En.prototype.expandEnvelope=function(t){};En.prototype.copy=function(){};En.prototype.getY=function(t){};En.prototype.toCoordinateArray=function(){};En.prototype.interfaces_=function(){return[Iy]};En.prototype.getClass=function(){return En};Object.defineProperties(En,Wd);var FI=function(){},Gf=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(FI),Ii=function(){};Ii.arraycopy=function(t,e,n,r,i){for(var a=0,c=e;c<e+i;c++)n[r+a]=t[c],a++};Ii.getProperty=function(t){return{"line.separator":`
`}[t]};var Is=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],a=arguments[1];this.x=i.y*a.w-a.y*i.w,this.y=a.x*i.w-i.x*a.w,this.w=i.x*a.y-a.x*i.y}else if(arguments[0]instanceof Re&&arguments[1]instanceof Re){var c=arguments[0],u=arguments[1];this.x=c.y-u.y,this.y=u.x-c.x,this.w=c.x*u.y-u.x*c.y}}else if(arguments.length===3){var m=arguments[0],w=arguments[1],S=arguments[2];this.x=m,this.y=w,this.w=S}else if(arguments.length===4){var E=arguments[0],P=arguments[1],D=arguments[2],k=arguments[3],V=E.y-P.y,j=P.x-E.x,te=E.x*P.y-P.x*E.y,U=D.y-k.y,W=k.x-D.x,Y=D.x*k.y-k.x*D.y;this.x=j*Y-W*te,this.y=U*te-V*Y,this.w=V*W-U*j}};Is.prototype.getY=function(){var t=this.y/this.w;if(Xt.isNaN(t)||Xt.isInfinite(t))throw new Gf;return t};Is.prototype.getX=function(){var t=this.x/this.w;if(Xt.isNaN(t)||Xt.isInfinite(t))throw new Gf;return t};Is.prototype.getCoordinate=function(){var t=new Re;return t.x=this.getX(),t.y=this.getY(),t};Is.prototype.interfaces_=function(){return[]};Is.prototype.getClass=function(){return Is};Is.intersection=function(t,e,n,r){var i=t.y-e.y,a=e.x-t.x,c=t.x*e.y-e.x*t.y,u=n.y-r.y,m=r.x-n.x,w=n.x*r.y-r.x*n.y,S=a*w-m*c,E=u*c-i*w,P=i*m-u*a,D=S/P,k=E/P;if(Xt.isNaN(D)||Xt.isInfinite(D)||Xt.isNaN(k)||Xt.isInfinite(k))throw new Gf;return new Re(D,k)};var Rt=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Re){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var a=arguments[0],c=arguments[1],u=arguments[2],m=arguments[3];this.init(a,c,u,m)}},BI={serialVersionUID:{configurable:!0}};Rt.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Rt.prototype.equals=function(t){if(!(t instanceof Rt))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()};Rt.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Rt;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new Rt(e,r,n,i)};Rt.prototype.isNull=function(){return this._maxx<this._minx};Rt.prototype.getMaxX=function(){return this._maxx};Rt.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Re){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof Rt){var e=arguments[0];return this.isNull()||e.isNull()?!1:e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}};Rt.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Rt){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof Re){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}};Rt.prototype.getMinY=function(){return this._miny};Rt.prototype.getMinX=function(){return this._minx};Rt.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Re){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Rt){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};Rt.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e};Rt.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Rt.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0};Rt.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)};Rt.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Rt.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Rt.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Rt.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e};Rt.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Rt.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Rt){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof Re){var e=arguments[0];return this.covers(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}};Rt.prototype.centre=function(){return this.isNull()?null:new Re((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Rt.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Re){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Rt){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],c=arguments[2],u=arguments[3];i<a?(this._minx=i,this._maxx=a):(this._minx=a,this._maxx=i),c<u?(this._miny=c,this._maxy=u):(this._miny=u,this._maxy=c)}};Rt.prototype.getMaxY=function(){return this._maxy};Rt.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),e===0?n:n===0?e:Math.sqrt(e*e+n*n)};Rt.prototype.hashCode=function(){var t=17;return t=37*t+Re.hashCode(this._minx),t=37*t+Re.hashCode(this._maxx),t=37*t+Re.hashCode(this._miny),t=37*t+Re.hashCode(this._maxy),t};Rt.prototype.interfaces_=function(){return[hs,fs]};Rt.prototype.getClass=function(){return Rt};Rt.intersects=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){var r=arguments[0],i=arguments[1],a=arguments[2],c=arguments[3],u=Math.min(a.x,c.x),m=Math.max(a.x,c.x),w=Math.min(r.x,i.x),S=Math.max(r.x,i.x);return!(w>m||S<u||(u=Math.min(a.y,c.y),m=Math.max(a.y,c.y),w=Math.min(r.y,i.y),S=Math.max(r.y,i.y),w>m)||S<u)}};BI.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Rt,BI);var Hs={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Cy=function(t){this.geometryFactory=t||new mn};Cy.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=Hs.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(i=Hs.emptyTypeStr.exec(t),i[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],sf[n]&&(e=sf[n].apply(this,[r]))),e===void 0)throw new Error("Could not parse WKT "+t);return e};Cy.prototype.write=function(t){return this.extractGeometry(t)};Cy.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!el[e])return null;var n=e.toUpperCase(),r;return t.isEmpty()?r=n+" EMPTY":r=n+"("+el[e].apply(this,[t])+")",r};var el={coordinate:function(t){return t.x+" "+t.y},point:function(t){return el.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+el.point.apply(e,[t._geometries[r]])+")");return n.join(",")},linestring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(el.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},linearring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(el.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},multilinestring:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+el.linestring.apply(e,[t._geometries[r]])+")");return n.join(",")},polygon:function(t){var e=this,n=[];n.push("("+el.linestring.apply(this,[t._shell])+")");for(var r=0,i=t._holes.length;r<i;++r)n.push("("+el.linestring.apply(e,[t._holes[r]])+")");return n.join(",")},multipolygon:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+el.polygon.apply(e,[t._geometries[r]])+")");return n.join(",")},geometrycollection:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push(e.extractGeometry(t._geometries[r]));return n.join(",")}},sf={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var e=t.trim().split(Hs.spaces);return this.geometryFactory.createPoint(new Re(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var n,r=t.trim().split(","),i=[],a=0,c=r.length;a<c;++a)n=r[a].replace(Hs.trimParens,"$1"),i.push(sf.point.apply(e,[n]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var e=t.trim().split(","),n=[],r,i=0,a=e.length;i<a;++i)r=e[i].trim().split(Hs.spaces),n.push(new Re(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var e=t.trim().split(","),n=[],r,i=0,a=e.length;i<a;++i)r=e[i].trim().split(Hs.spaces),n.push(new Re(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var n,r=t.trim().split(Hs.parenComma),i=[],a=0,c=r.length;a<c;++a)n=r[a].replace(Hs.trimParens,"$1"),i.push(sf.linestring.apply(e,[n]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var n,r,i,a=t.trim().split(Hs.parenComma),c,u=[],m=0,w=a.length;m<w;++m)n=a[m].replace(Hs.trimParens,"$1"),r=sf.linestring.apply(e,[n]),i=e.geometryFactory.createLinearRing(r._points),m===0?c=i:u.push(i);return this.geometryFactory.createPolygon(c,u)},multipolygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var n,r=t.trim().split(Hs.doubleParenComma),i=[],a=0,c=r.length;a<c;++a)n=r[a].replace(Hs.trimParens,"$1"),i.push(sf.polygon.apply(e,[n]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){var e=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=t.trim().split("|"),r=[],i=0,a=n.length;i<a;++i)r.push(e.read(n[i]));return this.geometryFactory.createGeometryCollection(r)}},Ts=function(t){this.parser=new Cy(t)};Ts.prototype.write=function(t){return this.parser.write(t)};Ts.toLineString=function(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var hl=function(t){function e(n){t.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),iy=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var n=arguments[0];t.call(this,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(hl),on=function(){};on.prototype.interfaces_=function(){return[]};on.prototype.getClass=function(){return on};on.shouldNeverReachHere=function(){if(arguments.length===0)on.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new iy("Should never reach here"+(t!==null?": "+t:""))}};on.isTrue=function(){var t,e;if(arguments.length===1)t=arguments[0],on.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],e=arguments[1],!t))throw e===null?new iy:new iy(e)};on.equals=function(){var t,e,n;if(arguments.length===2)t=arguments[0],e=arguments[1],on.equals(t,e,null);else if(arguments.length===3&&(t=arguments[0],e=arguments[1],n=arguments[2],!e.equals(t)))throw new iy("Expected "+t+" but encountered "+e+(n!==null?": "+n:""))};var fr=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Re,this._intPt[1]=new Re,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Hc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};fr.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]};fr.prototype.getTopologySummary=function(){var t=new da;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};fr.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)};fr.prototype.getIntersectionNum=function(){return this._result};fr.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};fr.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};fr.prototype.setPrecisionModel=function(t){this._precisionModel=t};fr.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var e=arguments[0],n=0;n<this._result;n++)if(!(t._intPt[n].equals2D(t._inputLines[e][0])||t._intPt[n].equals2D(t._inputLines[e][1])))return!0;return!1}};fr.prototype.getIntersection=function(t){return this._intPt[t]};fr.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};fr.prototype.hasIntersection=function(){return this._result!==fr.NO_INTERSECTION};fr.prototype.getEdgeDistance=function(t,e){var n=fr.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1]);return n};fr.prototype.isCollinear=function(){return this._result===fr.COLLINEAR_INTERSECTION};fr.prototype.toString=function(){return Ts.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Ts.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};fr.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]};fr.prototype.isIntersection=function(t){for(var e=this,n=0;n<this._result;n++)if(e._intPt[n].equals2D(t))return!0;return!1};fr.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]};fr.prototype.interfaces_=function(){return[]};fr.prototype.getClass=function(){return fr};fr.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),a=-1;if(t.equals(e))a=0;else if(t.equals(n))r>i?a=r:a=i;else{var c=Math.abs(t.x-e.x),u=Math.abs(t.y-e.y);r>i?a=c:a=u,a===0&&!t.equals(e)&&(a=Math.max(c,u))}return on.isTrue(!(a===0&&!t.equals(e)),"Bad distance calculation"),a};fr.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=Math.sqrt(r*r+i*i);return on.isTrue(!(a===0&&!t.equals(e)),"Invalid distance calculation"),a};Hc.DONT_INTERSECT.get=function(){return 0};Hc.DO_INTERSECT.get=function(){return 1};Hc.COLLINEAR.get=function(){return 2};Hc.NO_INTERSECTION.get=function(){return 0};Hc.POINT_INTERSECTION.get=function(){return 1};Hc.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(fr,Hc);var Zu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(n){var r=new Rt(this._inputLines[0][0],this._inputLines[0][1]),i=new Rt(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(n)&&i.contains(n)},e.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];if(this._isProper=!1,Rt.intersects(r,i,n)&&xt.orientationIndex(r,i,n)===0&&xt.orientationIndex(i,r,n)===0)return this._isProper=!0,(n.equals(r)||n.equals(i))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(n,r,i,a,c){c.x=this.smallestInAbsValue(n.x,r.x,i.x,a.x),c.y=this.smallestInAbsValue(n.y,r.y,i.y,a.y),n.x-=c.x,n.y-=c.y,r.x-=c.x,r.y-=c.y,i.x-=c.x,i.y-=c.y,a.x-=c.x,a.y-=c.y},e.prototype.safeHCoordinateIntersection=function(n,r,i,a){var c=null;try{c=Is.intersection(n,r,i,a)}catch(u){if(u instanceof Gf)c=e.nearestEndpoint(n,r,i,a);else throw u}finally{}return c},e.prototype.intersection=function(n,r,i,a){var c=this.intersectionWithNormalization(n,r,i,a);return this.isInSegmentEnvelopes(c)||(c=new Re(e.nearestEndpoint(n,r,i,a))),this._precisionModel!==null&&this._precisionModel.makePrecise(c),c},e.prototype.smallestInAbsValue=function(n,r,i,a){var c=n,u=Math.abs(c);return Math.abs(r)<u&&(c=r,u=Math.abs(r)),Math.abs(i)<u&&(c=i,u=Math.abs(i)),Math.abs(a)<u&&(c=a),c},e.prototype.checkDD=function(n,r,i,a,c){var u=oo.intersection(n,r,i,a),m=this.isInSegmentEnvelopes(u);Ii.out.println("DD in env = "+m+"  --------------------- "+u),c.distance(u)>1e-4&&Ii.out.println("Distance = "+c.distance(u))},e.prototype.intersectionWithNormalization=function(n,r,i,a){var c=new Re(n),u=new Re(r),m=new Re(i),w=new Re(a),S=new Re;this.normalizeToEnvCentre(c,u,m,w,S);var E=this.safeHCoordinateIntersection(c,u,m,w);return E.x+=S.x,E.y+=S.y,E},e.prototype.computeCollinearIntersection=function(n,r,i,a){var c=Rt.intersects(n,r,i),u=Rt.intersects(n,r,a),m=Rt.intersects(i,a,n),w=Rt.intersects(i,a,r);return c&&u?(this._intPt[0]=i,this._intPt[1]=a,t.COLLINEAR_INTERSECTION):m&&w?(this._intPt[0]=n,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):c&&m?(this._intPt[0]=i,this._intPt[1]=n,i.equals(n)&&!u&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):c&&w?(this._intPt[0]=i,this._intPt[1]=r,i.equals(r)&&!u&&!m?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&m?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!c&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&w?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!c&&!m?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(n,r,i,a,c){var u=n.x<r.x?n.x:r.x,m=n.y<r.y?n.y:r.y,w=n.x>r.x?n.x:r.x,S=n.y>r.y?n.y:r.y,E=i.x<a.x?i.x:a.x,P=i.y<a.y?i.y:a.y,D=i.x>a.x?i.x:a.x,k=i.y>a.y?i.y:a.y,V=u>E?u:E,j=w<D?w:D,te=m>P?m:P,U=S<k?S:k,W=(V+j)/2,Y=(te+U)/2;c.x=W,c.y=Y,n.x-=c.x,n.y-=c.y,r.x-=c.x,r.y-=c.y,i.x-=c.x,i.y-=c.y,a.x-=c.x,a.y-=c.y},e.prototype.computeIntersect=function(n,r,i,a){if(this._isProper=!1,!Rt.intersects(n,r,i,a))return t.NO_INTERSECTION;var c=xt.orientationIndex(n,r,i),u=xt.orientationIndex(n,r,a);if(c>0&&u>0||c<0&&u<0)return t.NO_INTERSECTION;var m=xt.orientationIndex(i,a,n),w=xt.orientationIndex(i,a,r);if(m>0&&w>0||m<0&&w<0)return t.NO_INTERSECTION;var S=c===0&&u===0&&m===0&&w===0;return S?this.computeCollinearIntersection(n,r,i,a):(c===0||u===0||m===0||w===0?(this._isProper=!1,n.equals2D(i)||n.equals2D(a)?this._intPt[0]=n:r.equals2D(i)||r.equals2D(a)?this._intPt[0]=r:c===0?this._intPt[0]=new Re(i):u===0?this._intPt[0]=new Re(a):m===0?this._intPt[0]=new Re(n):w===0&&(this._intPt[0]=new Re(r))):(this._isProper=!0,this._intPt[0]=this.intersection(n,r,i,a)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(n,r,i,a){var c=n,u=xt.distancePointLine(n,i,a),m=xt.distancePointLine(r,i,a);return m<u&&(u=m,c=r),m=xt.distancePointLine(i,n,r),m<u&&(u=m,c=i),m=xt.distancePointLine(a,n,r),m<u&&(u=m,c=a),c},e}(fr),Pc=function(){};Pc.prototype.interfaces_=function(){return[]};Pc.prototype.getClass=function(){return Pc};Pc.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,a=n.x-e.x,c=n.y-e.y;return Pc.signOfDet2x2(r,i,a,c)};Pc.signOfDet2x2=function(t,e,n,r){var i=null,a=null,c=null;if(i=1,t===0||r===0)return e===0||n===0?0:e>0?n>0?-i:i:n>0?i:-i;if(e===0||n===0)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,a=t,t=n,n=a,a=e,e=r,r=a):e<=-r?(i=-i,n=-n,r=-r):(a=t,t=-n,n=a,a=e,e=-r,r=a):r>0?-e<=r?(i=-i,t=-t,e=-e):(a=-t,t=n,n=a,a=-e,e=r,r=a):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,a=-t,t=-n,n=a,a=-e,e=-r,r=a),t>0)if(n>0){if(!(t<=n))return i}else return i;else{if(n>0)return-i;if(t>=n)i=-i,t=-t,n=-n;else return-i}for(;;){if(c=Math.floor(n/t),n=n-c*t,r=r-c*e,r<0)return-i;if(r>e)return i;if(t>n+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(r===0)return n===0?0:-i;if(n===0||(c=Math.floor(t/n),t=t-c*n,e=e-c*r,e<0))return i;if(e>r)return-i;if(n>t+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(e===0)return t===0?0:i;if(t===0)return-i}};var $s=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};$s.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,a=t.y-this._p.y,c=e.x-this._p.x,u=e.y-this._p.y,m=Pc.signOfDet2x2(i,a,c,u);if(m===0)return this._isPointOnSegment=!0,null;u<a&&(m=-m),m>0&&this._crossingCount++}};$s.prototype.isPointInPolygon=function(){return this.getLocation()!==ze.EXTERIOR};$s.prototype.getLocation=function(){return this._isPointOnSegment?ze.BOUNDARY:this._crossingCount%2===1?ze.INTERIOR:ze.EXTERIOR};$s.prototype.isOnSegment=function(){return this._isPointOnSegment};$s.prototype.interfaces_=function(){return[]};$s.prototype.getClass=function(){return $s};$s.locatePointInRing=function(){if(arguments[0]instanceof Re&&Ut(arguments[1],En)){for(var t=arguments[0],e=arguments[1],n=new $s(t),r=new Re,i=new Re,a=1;a<e.size();a++)if(e.getCoordinate(a,r),e.getCoordinate(a-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Re&&arguments[1]instanceof Array){for(var c=arguments[0],u=arguments[1],m=new $s(c),w=1;w<u.length;w++){var S=u[w],E=u[w-1];if(m.countSegment(S,E),m.isOnSegment())return m.getLocation()}return m.getLocation()}};var xt=function(){},Zc={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};xt.prototype.interfaces_=function(){return[]};xt.prototype.getClass=function(){return xt};xt.orientationIndex=function(t,e,n){return oo.orientationIndex(t,e,n)};xt.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,a=t[r+1].y,c=t[r-1].y;e+=i*(c-a)}return e/2}else if(Ut(arguments[0],En)){var u=arguments[0],m=u.size();if(m<3)return 0;var w=new Re,S=new Re,E=new Re;u.getCoordinate(0,S),u.getCoordinate(1,E);var P=S.x;E.x-=P;for(var D=0,k=1;k<m-1;k++)w.y=S.y,S.x=E.x,S.y=E.y,u.getCoordinate(k+1,E),E.x-=P,D+=S.x*(w.y-E.y);return D/2}};xt.distanceLineLine=function(t,e,n,r){if(t.equals(e))return xt.distancePointLine(t,n,r);if(n.equals(r))return xt.distancePointLine(r,t,e);var i=!1;if(!Rt.intersects(t,e,n,r))i=!0;else{var a=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(a===0)i=!0;else{var c=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),u=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),m=u/a,w=c/a;(w<0||w>1||m<0||m>1)&&(i=!0)}}return i?Wo.min(xt.distancePointLine(t,n,r),xt.distancePointLine(e,n,r),xt.distancePointLine(n,t,e),xt.distancePointLine(r,t,e)):0};xt.isPointInRing=function(t,e){return xt.locatePointInRing(t,e)!==ze.EXTERIOR};xt.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new Re;t.getCoordinate(0,r);for(var i=r.x,a=r.y,c=1;c<e;c++){t.getCoordinate(c,r);var u=r.x,m=r.y,w=u-i,S=m-a;n+=Math.sqrt(w*w+S*S),i=u,a=m}return n};xt.isCCW=function(t){var e=t.length-1;if(e<3)throw new ar("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var a=t[i];a.y>n.y&&(n=a,r=i)}var c=r;do c=c-1,c<0&&(c=e);while(t[c].equals2D(n)&&c!==r);var u=r;do u=(u+1)%e;while(t[u].equals2D(n)&&u!==r);var m=t[c],w=t[u];if(m.equals2D(n)||w.equals2D(n)||m.equals2D(w))return!1;var S=xt.computeOrientation(m,n,w),E=!1;return S===0?E=m.x>w.x:E=S>0,E};xt.locatePointInRing=function(t,e){return $s.locatePointInRing(t,e)};xt.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)};xt.computeOrientation=function(t,e,n){return xt.orientationIndex(t,e,n)};xt.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(e.length===0)throw new ar("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=xt.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}else if(arguments.length===3){var a=arguments[0],c=arguments[1],u=arguments[2];if(c.x===u.x&&c.y===u.y)return a.distance(c);var m=(u.x-c.x)*(u.x-c.x)+(u.y-c.y)*(u.y-c.y),w=((a.x-c.x)*(u.x-c.x)+(a.y-c.y)*(u.y-c.y))/m;if(w<=0)return a.distance(c);if(w>=1)return a.distance(u);var S=((c.y-a.y)*(u.x-c.x)-(c.x-a.x)*(u.y-c.y))/m;return Math.abs(S)*Math.sqrt(m)}};xt.isOnLine=function(t,e){for(var n=new Zu,r=1;r<e.length;r++){var i=e[r-1],a=e[r];if(n.computeIntersection(t,i,a),n.hasIntersection())return!0}return!1};Zc.CLOCKWISE.get=function(){return-1};Zc.RIGHT.get=function(){return xt.CLOCKWISE};Zc.COUNTERCLOCKWISE.get=function(){return 1};Zc.LEFT.get=function(){return xt.COUNTERCLOCKWISE};Zc.COLLINEAR.get=function(){return 0};Zc.STRAIGHT.get=function(){return xt.COLLINEAR};Object.defineProperties(xt,Zc);var fl=function(){};fl.prototype.filter=function(t){};fl.prototype.interfaces_=function(){return[]};fl.prototype.getClass=function(){return fl};var Vt=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},Ba={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Vt.prototype.isGeometryCollection=function(){return this.getSortIndex()===Vt.SORTINDEX_GEOMETRYCOLLECTION};Vt.prototype.getFactory=function(){return this._factory};Vt.prototype.getGeometryN=function(t){return this};Vt.prototype.getArea=function(){return 0};Vt.prototype.isRectangle=function(){return!1};Vt.prototype.equals=function(){if(arguments[0]instanceof Vt){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof Vt))return!1;var n=e;return this.equalsExact(n)}};Vt.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};Vt.prototype.geometryChanged=function(){this.apply(Vt.geometryChangedFilter)};Vt.prototype.geometryChangedAction=function(){this._envelope=null};Vt.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};Vt.prototype.getLength=function(){return 0};Vt.prototype.getNumGeometries=function(){return 1};Vt.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}};Vt.prototype.getUserData=function(){return this._userData};Vt.prototype.getSRID=function(){return this._SRID};Vt.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Vt.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Vt.SORTINDEX_GEOMETRYCOLLECTION)throw new ar("This method does not support GeometryCollection arguments")};Vt.prototype.equal=function(t,e,n){return n===0?t.equals(e):t.distance(e)<=n};Vt.prototype.norm=function(){var t=this.copy();return t.normalize(),t};Vt.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Vt.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Rt(this._envelope)};Vt.prototype.setSRID=function(t){this._SRID=t};Vt.prototype.setUserData=function(t){this._userData=t};Vt.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),a=r.next(),c=i.compareTo(a);if(c!==0)return c}return n.hasNext()?1:r.hasNext()?-1:0};Vt.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Vt.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Vt.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Vt.SORTINDEX_MULTIPOINT||this.getSortIndex()===Vt.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Vt.SORTINDEX_MULTIPOLYGON};Vt.prototype.interfaces_=function(){return[Iy,hs,fs]};Vt.prototype.getClass=function(){return Vt};Vt.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1};Vt.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(t[e]===null)return!0;return!1};Ba.serialVersionUID.get=function(){return 8763622679187377e3};Ba.SORTINDEX_POINT.get=function(){return 0};Ba.SORTINDEX_MULTIPOINT.get=function(){return 1};Ba.SORTINDEX_LINESTRING.get=function(){return 2};Ba.SORTINDEX_LINEARRING.get=function(){return 3};Ba.SORTINDEX_MULTILINESTRING.get=function(){return 4};Ba.SORTINDEX_POLYGON.get=function(){return 5};Ba.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Ba.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Ba.geometryChangedFilter.get=function(){return Yv};Object.defineProperties(Vt,Ba);var Yv=function(){};Yv.interfaces_=function(){return[fl]};Yv.filter=function(t){t.geometryChangedAction()};var Ma=function(){};Ma.prototype.filter=function(t){};Ma.prototype.interfaces_=function(){return[]};Ma.prototype.getClass=function(){return Ma};var ls=function(){},vl={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ls.prototype.isInBoundary=function(t){};ls.prototype.interfaces_=function(){return[]};ls.prototype.getClass=function(){return ls};vl.Mod2BoundaryNodeRule.get=function(){return _f};vl.EndPointBoundaryNodeRule.get=function(){return vf};vl.MultiValentEndPointBoundaryNodeRule.get=function(){return bf};vl.MonoValentEndPointBoundaryNodeRule.get=function(){return xf};vl.MOD2_BOUNDARY_RULE.get=function(){return new _f};vl.ENDPOINT_BOUNDARY_RULE.get=function(){return new vf};vl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new bf};vl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new xf};vl.OGC_SFS_BOUNDARY_RULE.get=function(){return ls.MOD2_BOUNDARY_RULE};Object.defineProperties(ls,vl);var _f=function(){};_f.prototype.isInBoundary=function(t){return t%2===1};_f.prototype.interfaces_=function(){return[ls]};_f.prototype.getClass=function(){return _f};var vf=function(){};vf.prototype.isInBoundary=function(t){return t>0};vf.prototype.interfaces_=function(){return[ls]};vf.prototype.getClass=function(){return vf};var bf=function(){};bf.prototype.isInBoundary=function(t){return t>1};bf.prototype.interfaces_=function(){return[ls]};bf.prototype.getClass=function(){return bf};var xf=function(){};xf.prototype.isInBoundary=function(t){return t===1};xf.prototype.interfaces_=function(){return[ls]};xf.prototype.getClass=function(){return xf};var jr=function(){};jr.prototype.add=function(){};jr.prototype.addAll=function(){};jr.prototype.isEmpty=function(){};jr.prototype.iterator=function(){};jr.prototype.size=function(){};jr.prototype.toArray=function(){};jr.prototype.remove=function(){};function Kv(t){this.message=t||""}Kv.prototype=new Error;Kv.prototype.name="IndexOutOfBoundsException";var qf=function(){};qf.prototype.hasNext=function(){};qf.prototype.next=function(){};qf.prototype.remove=function(){};var Cs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(jr);function jf(t){this.message=t||""}jf.prototype=new Error;jf.prototype.name="NoSuchElementException";var mt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof jr&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,jr]},e.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.set=function(n,r){var i=this.array_[n];return this.array_[n]=r,i},e.prototype.iterator=function(){return new rR(this)},e.prototype.get=function(n){if(n<0||n>=this.size())throw new Kv;return this.array_[n]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var n=this,r=[],i=0,a=this.array_.length;i<a;i++)r.push(n.array_[i]);return r},e.prototype.remove=function(n){for(var r=this,i=!1,a=0,c=this.array_.length;a<c;a++)if(r.array_[a]===n){r.array_.splice(a,1),i=!0;break}return i},e}(Cs),rR=function(t){function e(n){t.call(this),this.arrayList_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new jf;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(qf),Hd=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.ensureCapacity(i.length),this.add(i,a)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(r){return this.get(r)},e.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var i=arguments[0],a=arguments[1],c=!1,u=i.iterator();u.hasNext();)r.add(u.next(),a),c=!0;return c}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var r=this,i=t.prototype.clone.call(this),a=0;a<this.size();a++)i.add(a,r.get(a).copy());return i},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var r=this;if(arguments.length===1){var i=arguments[0];t.prototype.add.call(this,i)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],c=arguments[1];return this.add(a,c,!0),!0}else if(arguments[0]instanceof Re&&typeof arguments[1]=="boolean"){var u=arguments[0],m=arguments[1];if(!m&&this.size()>=1){var w=this.get(this.size()-1);if(w.equals2D(u))return null}t.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var S=arguments[0],E=arguments[1];return this.add(S,E),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var P=arguments[0],D=arguments[1],k=arguments[2];if(k)for(var V=0;V<P.length;V++)r.add(P[V],D);else for(var j=P.length-1;j>=0;j--)r.add(P[j],D);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Re){var te=arguments[0],U=arguments[1],W=arguments[2];if(!W){var Y=this.size();if(Y>0){if(te>0){var oe=this.get(te-1);if(oe.equals2D(U))return null}if(te<Y){var _e=this.get(te);if(_e.equals2D(U))return null}}}t.prototype.add.call(this,te,U)}}else if(arguments.length===4){var se=arguments[0],ce=arguments[1],me=arguments[2],Ce=arguments[3],Z=1;me>Ce&&(Z=-1);for(var fe=me;fe!==Ce;fe+=Z)r.add(se[fe],ce);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new Re(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(mt),gn=function(){},Ty={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Ty.ForwardComparator.get=function(){return Id};Ty.BidirectionalComparator.get=function(){return wf};Ty.coordArrayType.get=function(){return new Array(0).fill(null)};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};gn.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};gn.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(gn.indexOf(r,e)<0)return r}return null};gn.scroll=function(t,e){var n=gn.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);Ii.arraycopy(t,n,r,0,t.length-n),Ii.arraycopy(t,0,r,t.length-n,n),Ii.arraycopy(r,0,t,0,t.length)};gn.equals=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];if(r===i)return!0;if(r===null||i===null||r.length!==i.length)return!1;for(var c=0;c<r.length;c++)if(a.compare(r[c],i[c])!==0)return!1;return!0}};gn.intersection=function(t,e){for(var n=new Hd,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()};gn.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1};gn.removeRepeatedPoints=function(t){if(!gn.hasRepeatedPoints(t))return t;var e=new Hd(t,!1);return e.toCoordinateArray()};gn.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}};gn.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)t[n]!==null&&e++;var r=new Array(e).fill(null);if(e===0)return r;for(var i=0,a=0;a<t.length;a++)t[a]!==null&&(r[i++]=t[a]);return r};gn.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new Re(t[n]);return e}else if(arguments.length===5)for(var r=arguments[0],i=arguments[1],a=arguments[2],c=arguments[3],u=arguments[4],m=0;m<u;m++)a[c+m]=new Re(r[i+m])};gn.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(r.compareTo(i)!==0)return!1}return!0};gn.envelope=function(t){for(var e=new Rt,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e};gn.toCoordinateArray=function(t){return t.toArray(gn.coordArrayType)};gn.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]};gn.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1};gn.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(r!==0)return r}return 1};gn.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(r!==0)return r;n++}return n<e.length?-1:n<t.length?1:0};gn.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(e===null||e.compareTo(t[n])>0)&&(e=t[n]);return e};gn.extract=function(t,e,n){e=Wo.clamp(e,0,t.length),n=Wo.clamp(n,-1,t.length);var r=n-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(r===0)return i;for(var a=0,c=e;c<=n;c++)i[a++]=t[c];return i};Object.defineProperties(gn,Ty);var Id=function(){};Id.prototype.compare=function(t,e){var n=t,r=e;return gn.compare(n,r)};Id.prototype.interfaces_=function(){return[gf]};Id.prototype.getClass=function(){return Id};var wf=function(){};wf.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;var i=gn.compare(n,r),a=gn.isEqualReversed(n,r);return a?0:i};wf.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;for(var i=gn.increasingDirection(n),a=gn.increasingDirection(r),c=i>0?0:n.length-1,u=a>0?0:n.length-1,m=0;m<n.length;m++){var w=n[c].compareTo(r[u]);if(w!==0)return w;c+=i,u+=a}return 0};wf.prototype.interfaces_=function(){return[gf]};wf.prototype.getClass=function(){return wf};var Xc=function(){};Xc.prototype.get=function(){};Xc.prototype.put=function(){};Xc.prototype.size=function(){};Xc.prototype.values=function(){};Xc.prototype.entrySet=function(){};var iR=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Xc);function Zd(t){this.message=t||""}Zd.prototype=new Error;Zd.prototype.name="OperationNotSupported";function Ly(){}Ly.prototype=new jr;Ly.prototype.contains=function(){};var Jv=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof jr&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(n){for(var r=this,i=0,a=this.array_.length;i<a;i++){var c=r.array_[i];if(c===n)return!0}return!1},e.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.remove=function(n){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var n=this,r=[],i=0,a=this.array_.length;i<a;i++)r.push(n.array_[i]);return r},e.prototype.iterator=function(){return new oR(this)},e}(Ly),oR=function(t){function e(n){t.call(this),this.hashSet_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new jf;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new Zd},e}(qf),rl=0,Iu=1;function $w(t){return t===null?rl:t.color}function Kn(t){return t===null?null:t.parent}function Qa(t,e){t!==null&&(t.color=e)}function b0(t){return t===null?null:t.left}function e2(t){return t===null?null:t.right}function ki(){this.root_=null,this.size_=0}ki.prototype=new iR;ki.prototype.get=function(t){for(var e=this.root_;e!==null;){var n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null};ki.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:rl,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,i;do if(r=n,i=t.compareTo(n.key),i<0)n=n.left;else if(i>0)n=n.right;else{var a=n.value;return n.value=e,a}while(n!==null);var c={key:t,left:null,right:null,value:e,parent:r,color:rl,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?r.left=c:r.right=c,this.fixAfterInsertion(c),this.size_++,null};ki.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=Iu;t!=null&&t!==this.root_&&t.parent.color===Iu;)if(Kn(t)===b0(Kn(Kn(t)))){var n=e2(Kn(Kn(t)));$w(n)===Iu?(Qa(Kn(t),rl),Qa(n,rl),Qa(Kn(Kn(t)),Iu),t=Kn(Kn(t))):(t===e2(Kn(t))&&(t=Kn(t),e.rotateLeft(t)),Qa(Kn(t),rl),Qa(Kn(Kn(t)),Iu),e.rotateRight(Kn(Kn(t))))}else{var r=b0(Kn(Kn(t)));$w(r)===Iu?(Qa(Kn(t),rl),Qa(r,rl),Qa(Kn(Kn(t)),Iu),t=Kn(Kn(t))):(t===b0(Kn(t))&&(t=Kn(t),e.rotateRight(t)),Qa(Kn(t),rl),Qa(Kn(Kn(t)),Iu),e.rotateLeft(Kn(Kn(t))))}this.root_.color=rl};ki.prototype.values=function(){var t=new mt,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=ki.successor(e))!==null;)t.add(e.value);return t};ki.prototype.entrySet=function(){var t=new Jv,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=ki.successor(e))!==null;)t.add(e);return t};ki.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};ki.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};ki.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};ki.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var n=t.parent,r=t;n!==null&&r===n.right;)r=n,n=n.parent;return n}};ki.prototype.size=function(){return this.size_};var Cd=function(){};Cd.prototype.interfaces_=function(){return[]};Cd.prototype.getClass=function(){return Cd};function VI(){}VI.prototype=new Ly;function na(){this.array_=[],arguments[0]instanceof jr&&this.addAll(arguments[0])}na.prototype=new VI;na.prototype.contains=function(t){for(var e=this,n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===0)return!0}return!1};na.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===1)return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0};na.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0};na.prototype.remove=function(t){throw new Zd};na.prototype.size=function(){return this.array_.length};na.prototype.isEmpty=function(){return this.array_.length===0};na.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};na.prototype.iterator=function(){return new Py(this)};var Py=function(t){this.treeSet_=t,this.position_=0};Py.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new jf;return this.treeSet_.array_[this.position_++]};Py.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Py.prototype.remove=function(){throw new Zd};var Au=function(){};Au.sort=function(){var t=arguments[0],e,n,r,i;if(arguments.length===1)i=function(c,u){return c.compareTo(u)},t.sort(i);else if(arguments.length===2)r=arguments[1],i=function(c,u){return r.compare(c,u)},t.sort(i);else if(arguments.length===3){n=t.slice(arguments[1],arguments[2]),n.sort();var a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));for(t.splice(0,t.length),e=0;e<a.length;e++)t.push(a[e])}else if(arguments.length===4)for(n=t.slice(arguments[1],arguments[2]),r=arguments[3],i=function(c,u){return r.compare(c,u)},n.sort(i),a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length)),t.splice(0,t.length),e=0;e<a.length;e++)t.push(a[e])};Au.asList=function(t){for(var e=new mt,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var Ln=function(){},Ns={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Ns.P.get=function(){return 0};Ns.L.get=function(){return 1};Ns.A.get=function(){return 2};Ns.FALSE.get=function(){return-1};Ns.TRUE.get=function(){return-2};Ns.DONTCARE.get=function(){return-3};Ns.SYM_FALSE.get=function(){return"F"};Ns.SYM_TRUE.get=function(){return"T"};Ns.SYM_DONTCARE.get=function(){return"*"};Ns.SYM_P.get=function(){return"0"};Ns.SYM_L.get=function(){return"1"};Ns.SYM_A.get=function(){return"2"};Ln.prototype.interfaces_=function(){return[]};Ln.prototype.getClass=function(){return Ln};Ln.toDimensionSymbol=function(t){switch(t){case Ln.FALSE:return Ln.SYM_FALSE;case Ln.TRUE:return Ln.SYM_TRUE;case Ln.DONTCARE:return Ln.SYM_DONTCARE;case Ln.P:return Ln.SYM_P;case Ln.L:return Ln.SYM_L;case Ln.A:return Ln.SYM_A}throw new ar("Unknown dimension value: "+t)};Ln.toDimensionValue=function(t){switch(Ed.toUpperCase(t)){case Ln.SYM_FALSE:return Ln.FALSE;case Ln.SYM_TRUE:return Ln.TRUE;case Ln.SYM_DONTCARE:return Ln.DONTCARE;case Ln.SYM_P:return Ln.P;case Ln.SYM_L:return Ln.L;case Ln.SYM_A:return Ln.A}throw new ar("Unknown dimension symbol: "+t)};Object.defineProperties(Ln,Ns);var ra=function(){};ra.prototype.filter=function(t){};ra.prototype.interfaces_=function(){return[]};ra.prototype.getClass=function(){return ra};var Ls=function(){};Ls.prototype.filter=function(t,e){};Ls.prototype.isDone=function(){};Ls.prototype.isGeometryChanged=function(){};Ls.prototype.interfaces_=function(){return[]};Ls.prototype.getClass=function(){return Ls};var Hi=function(t){function e(r,i){if(t.call(this,i),this._geometries=r||[],t.hasNullElements(this._geometries))throw new ar("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var r=this,i=new Rt,a=0;a<this._geometries.length;a++)i.expandToInclude(r._geometries[a].getEnvelopeInternal());return i},e.prototype.getGeometryN=function(r){return this._geometries[r]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var r=this,i=new Array(this.getNumPoints()).fill(null),a=-1,c=0;c<this._geometries.length;c++)for(var u=r._geometries[c].getCoordinates(),m=0;m<u.length;m++)a++,i[a]=u[m];return i},e.prototype.getArea=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getArea();return i},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._geometries.length!==c._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!r._geometries[u].equalsExact(c._geometries[u],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<this._geometries.length;i++)r._geometries[i].normalize();Au.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var r=this,i=Ln.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,r._geometries[a].getBoundaryDimension());return i},e.prototype.getDimension=function(){for(var r=this,i=Ln.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,r._geometries[a].getDimension());return i},e.prototype.getLength=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getNumPoints();return i},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),c=0;c<this._geometries.length;c++)a[c]=r._geometries[c].reverse();return this.getFactory().createGeometryCollection(a)},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],a=new na(Au.asList(this._geometries)),c=new na(Au.asList(i._geometries));return this.compare(a,c)}else if(arguments.length===2){for(var u=arguments[0],m=arguments[1],w=u,S=this.getNumGeometries(),E=w.getNumGeometries(),P=0;P<S&&P<E;){var D=r.getGeometryN(P),k=w.getGeometryN(P),V=D.compareToSameClass(k,m);if(V!==0)return V;P++}return P<S?1:P<E?-1:0}},e.prototype.apply=function(){var r=this;if(Ut(arguments[0],Ma))for(var i=arguments[0],a=0;a<this._geometries.length;a++)r._geometries[a].apply(i);else if(Ut(arguments[0],Ls)){var c=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(r._geometries[u].apply(c),!c.isDone());u++);c.isGeometryChanged()&&this.geometryChanged()}else if(Ut(arguments[0],ra)){var m=arguments[0];m.filter(this);for(var w=0;w<this._geometries.length;w++)r._geometries[w].apply(m)}else if(Ut(arguments[0],fl)){var S=arguments[0];S.filter(this);for(var E=0;E<this._geometries.length;E++)r._geometries[E].apply(S)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),on.shouldNeverReachHere(),null},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._geometries=new Array(this._geometries.length).fill(null);for(var a=0;a<this._geometries.length;a++)i._geometries[a]=r._geometries[a].clone();return i},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.isEmpty=function(){for(var r=this,i=0;i<this._geometries.length;i++)if(!r._geometries[i].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,n),e}(Vt),Ru=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Vt.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Ln.FALSE:0},e.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!r._geometries[i].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),c=0;c<this._geometries.length;c++)a[i-1-c]=r._geometries[c].reverse();return this.getFactory().createMultiLineString(a)},e.prototype.getBoundary=function(){return new is(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[Cd]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,n),e}(Hi),is=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],e=ls.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};is.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)};is.prototype.getBoundary=function(){return this._geom instanceof br?this.boundaryLineString(this._geom):this._geom instanceof Ru?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};is.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var e=this._bnRule.isInBoundary(2);return e?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};is.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};is.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new mt;this._endpointMap=new ki;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);i.getNumPoints()!==0&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var a=this._endpointMap.entrySet().iterator();a.hasNext();){var c=a.next(),u=c.getValue(),m=u.count;e._bnRule.isInBoundary(m)&&n.add(c.getKey())}return gn.toCoordinateArray(n)};is.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);e===null&&(e=new oy,this._endpointMap.put(t,e)),e.count++};is.prototype.interfaces_=function(){return[]};is.prototype.getClass=function(){return is};is.getBoundary=function(){if(arguments.length===1){var t=arguments[0],e=new is(t);return e.getBoundary()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new is(n,r);return i.getBoundary()}};var oy=function(){this.count=null};oy.prototype.interfaces_=function(){return[]};oy.prototype.getClass=function(){return oy};function sR(){}function aR(){}var lR=function(){};function uR(){}function cR(){}function hR(){}var os=function(){},Qv={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};os.prototype.interfaces_=function(){return[]};os.prototype.getClass=function(){return os};os.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)};os.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],e=new uR,n=new sR;return t.printStackTrace(n),e.toString()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],a="";new aR(os.getStackTrace(r));for(var c=new hR,u=0;u<i;u++)try{a+=c.readLine()+os.NEWLINE}catch(m){if(m instanceof cR)on.shouldNeverReachHere();else throw m}finally{}return a}};os.split=function(t,e){for(var n=e.length,r=new mt,i=""+t,a=i.indexOf(e);a>=0;){var c=i.substring(0,a);r.add(c),i=i.substring(a+n),a=i.indexOf(e)}i.length>0&&r.add(i);for(var u=new Array(r.size()).fill(null),m=0;m<u.length;m++)u[m]=r.get(m);return u};os.toString=function(){if(arguments.length===1){var t=arguments[0];return os.SIMPLE_ORDINATE_FORMAT.format(t)}};os.spaces=function(t){return os.chars(" ",t)};Qv.NEWLINE.get=function(){return Ii.getProperty("line.separator")};Qv.SIMPLE_ORDINATE_FORMAT.get=function(){return new lR};Object.defineProperties(os,Qv);var Mr=function(){};Mr.prototype.interfaces_=function(){return[]};Mr.prototype.getClass=function(){return Mr};Mr.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),a=0;a<i;a++)n.setOrdinate(r,a,t.getOrdinate(e,a))};Mr.isRing=function(t){var e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,En.X)===t.getOrdinate(e-1,En.X)&&t.getOrdinate(0,En.Y)===t.getOrdinate(e-1,En.Y)};Mr.isEqual=function(t,e){var n=t.size(),r=e.size();if(n!==r)return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),a=0;a<n;a++)for(var c=0;c<i;c++){var u=t.getOrdinate(a,c),m=e.getOrdinate(a,c);if(t.getOrdinate(a,c)!==e.getOrdinate(a,c)&&!(Xt.isNaN(u)&&Xt.isNaN(m)))return!1}return!0};Mr.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(Mr.copy(e,0,r,0,i),i>0)for(var a=i;a<n;a++)Mr.copy(e,i-1,r,a,1);return r};Mr.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)Mr.swap(t,r,e-r)};Mr.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}};Mr.copy=function(t,e,n,r,i){for(var a=0;a<i;a++)Mr.copyCoord(t,e+a,n,r+a)};Mr.toString=function(){if(arguments.length===1){var t=arguments[0],e=t.size();if(e===0)return"()";var n=t.getDimension(),r=new da;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var a=0;a<n;a++)a>0&&r.append(","),r.append(os.toString(t.getOrdinate(i,a)))}return r.append(")"),r.toString()}};Mr.ensureValidRing=function(t,e){var n=e.size();if(n===0)return e;if(n<=3)return Mr.createClosedRing(t,e,4);var r=e.getOrdinate(0,En.X)===e.getOrdinate(n-1,En.X)&&e.getOrdinate(0,En.Y)===e.getOrdinate(n-1,En.Y);return r?e:Mr.createClosedRing(t,e,n+1)};Mr.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();Mr.copy(e,0,r,0,i);for(var a=i;a<n;a++)Mr.copy(e,0,r,a,1);return r};var br=function(t){function e(r,i){t.call(this,i),this._points=null,this.init(r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Rt:this._points.expandEnvelope(new Rt)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._points.size()!==c._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!r.equal(r._points.getCoordinate(u),c._points.getCoordinate(u),a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<Math.trunc(this._points.size()/2);i++){var a=r._points.size()-1-i;if(!r._points.getCoordinate(i).equals(r._points.getCoordinate(a)))return r._points.getCoordinate(i).compareTo(r._points.getCoordinate(a))>0&&Mr.reverse(r._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Ln.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return xt.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var r=this._points.copy();Mr.reverse(r);var i=this.getFactory().createLineString(r);return i},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var i=arguments[0],a=i,c=0,u=0;c<this._points.size()&&u<a._points.size();){var m=r._points.getCoordinate(c).compareTo(a._points.getCoordinate(u));if(m!==0)return m;c++,u++}return c<this._points.size()?1:u<a._points.size()?-1:0}else if(arguments.length===2){var w=arguments[0],S=arguments[1],E=w;return S.compare(this._points,E._points)}},e.prototype.apply=function(){var r=this;if(Ut(arguments[0],Ma))for(var i=arguments[0],a=0;a<this._points.size();a++)i.filter(r._points.getCoordinate(a));else if(Ut(arguments[0],Ls)){var c=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(c.filter(r._points,u),!c.isDone());u++);c.isGeometryChanged()&&this.geometryChanged()}else if(Ut(arguments[0],ra)){var m=arguments[0];m.filter(this)}else if(Ut(arguments[0],fl)){var w=arguments[0];w.filter(this)}},e.prototype.getBoundary=function(){return new is(this).getBoundary()},e.prototype.isEquivalentClass=function(r){return r instanceof e},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._points=this._points.clone(),r},e.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new ar("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},e.prototype.isCoordinate=function(r){for(var i=this,a=0;a<this._points.size();a++)if(i._points.getCoordinate(a).equals(r))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},e.prototype.interfaces_=function(){return[Cd]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(Vt),Td=function(){};Td.prototype.interfaces_=function(){return[]};Td.prototype.getClass=function(){return Td};var Co=function(t){function e(r,i){t.call(this,i),this._coordinates=r||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Rt;var r=new Rt;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Ln.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],i=r;return this.getCoordinate().compareTo(i.getCoordinate())}else if(arguments.length===2){var a=arguments[0],c=arguments[1],u=a;return c.compare(this._coordinates,u._coordinates)}},e.prototype.apply=function(){if(Ut(arguments[0],Ma)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(Ut(arguments[0],Ls)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this._coordinates,0),i.isGeometryChanged()&&this.geometryChanged()}else if(Ut(arguments[0],ra)){var a=arguments[0];a.filter(this)}else if(Ut(arguments[0],fl)){var c=arguments[0];c.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),on.isTrue(r.size()<=1),this._coordinates=r},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Td]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,n),e}(Vt),Xl=function(){};Xl.prototype.interfaces_=function(){return[]};Xl.prototype.getClass=function(){return Xl};var Xr=function(t){function e(r,i,a){if(t.call(this,a),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),i===null&&(i=[]),t.hasNullElements(i))throw new ar("holes must not contain null elements");if(r.isEmpty()&&t.hasNonEmptyElements(i))throw new ar("shell is empty but holes are not");this._shell=r,this._holes=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var i=new Array(this.getNumPoints()).fill(null),a=-1,c=this._shell.getCoordinates(),u=0;u<c.length;u++)a++,i[a]=c[u];for(var m=0;m<this._holes.length;m++)for(var w=r._holes[m].getCoordinates(),S=0;S<w.length;S++)a++,i[a]=w[S];return i},e.prototype.getArea=function(){var r=this,i=0;i+=Math.abs(xt.signedArea(this._shell.getCoordinateSequence()));for(var a=0;a<this._holes.length;a++)i-=Math.abs(xt.signedArea(r._holes[a].getCoordinateSequence()));return i},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),i=this.getEnvelopeInternal(),a=0;a<5;a++){var c=r.getX(a);if(!(c===i.getMinX()||c===i.getMaxX()))return!1;var u=r.getY(a);if(!(u===i.getMinY()||u===i.getMaxY()))return!1}for(var m=r.getX(0),w=r.getY(0),S=1;S<=4;S++){var E=r.getX(S),P=r.getY(S),D=E!==m,k=P!==w;if(D===k)return!1;m=E,w=P}return!0},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i,u=this._shell,m=c._shell;if(!u.equalsExact(m,a)||this._holes.length!==c._holes.length)return!1;for(var w=0;w<this._holes.length;w++)if(!r._holes[w].equalsExact(c._holes[w],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var i=0;i<this._holes.length;i++)r.normalize(r._holes[i],!1);Au.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];if(a.isEmpty())return null;var u=new Array(a.getCoordinates().length-1).fill(null);Ii.arraycopy(a.getCoordinates(),0,u,0,u.length);var m=gn.minCoordinate(a.getCoordinates());gn.scroll(u,m),Ii.arraycopy(u,0,a.getCoordinates(),0,u.length),a.getCoordinates()[u.length]=u[0],xt.isCCW(a.getCoordinates())===c&&gn.reverse(a.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var r=this,i=0;i+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)i+=r._holes[a].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)i+=r._holes[a].getNumPoints();return i},e.prototype.reverse=function(){var r=this,i=this.copy();i._shell=this._shell.copy().reverse(),i._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)i._holes[a]=r._holes[a].copy().reverse();return i},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],a=this._shell,c=i._shell;return a.compareToSameClass(c)}else if(arguments.length===2){var u=arguments[0],m=arguments[1],w=u,S=this._shell,E=w._shell,P=S.compareToSameClass(E,m);if(P!==0)return P;for(var D=this.getNumInteriorRing(),k=w.getNumInteriorRing(),V=0;V<D&&V<k;){var j=r.getInteriorRingN(V),te=w.getInteriorRingN(V),U=j.compareToSameClass(te,m);if(U!==0)return U;V++}return V<D?1:V<k?-1:0}},e.prototype.apply=function(r){var i=this;if(Ut(r,Ma)){this._shell.apply(r);for(var a=0;a<this._holes.length;a++)i._holes[a].apply(r)}else if(Ut(r,Ls)){if(this._shell.apply(r),!r.isDone())for(var c=0;c<this._holes.length&&(i._holes[c].apply(r),!r.isDone());c++);r.isGeometryChanged()&&this.geometryChanged()}else if(Ut(r,ra))r.filter(this);else if(Ut(r,fl)){r.filter(this),this._shell.apply(r);for(var u=0;u<this._holes.length;u++)i._holes[u].apply(r)}},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var i=new Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var a=0;a<this._holes.length;a++)i[a+1]=r._holes[a];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._shell=this._shell.clone(),i._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)i._holes[a]=r._holes[a].clone();return i},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var r=this,i=this._shell.copy(),a=new Array(this._holes.length).fill(null),c=0;c<a.length;c++)a[c]=r._holes[c].copy();return new e(i,a,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(r){return this._holes[r]},e.prototype.interfaces_=function(){return[Xl]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(Vt),Sf=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Vt.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Ln.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[Td]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,n),e}(Hi),Aa=function(t){function e(r,i){r instanceof Re&&i instanceof mn&&(r=i.getCoordinateSequenceFactory().create(r)),t.call(this,r,i),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Vt.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Ln.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var r=this._points.copy();Mr.reverse(r);var i=this.getFactory().createLinearRing(r);return i},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new ar("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new ar("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(br),Ta=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Vt.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),c=0;c<this._geometries.length;c++)a[c]=r._geometries[c].reverse();return this.getFactory().createMultiPolygon(a)},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new mt,a=0;a<this._geometries.length;a++)for(var c=r._geometries[a],u=c.getBoundary(),m=0;m<u.getNumGeometries();m++)i.add(u.getGeometryN(m));var w=new Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(w))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[Xl]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Hi),us=function(t){this._factory=t||null,this._isUserDataCopied=!1},My={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};us.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};us.prototype.edit=function(t,e){if(t===null)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n};us.prototype.editInternal=function(t,e){return this._factory===null&&(this._factory=t.getFactory()),t instanceof Hi?this.editGeometryCollection(t,e):t instanceof Xr?this.editPolygon(t,e):t instanceof Co?e.edit(t,this._factory):t instanceof br?e.edit(t,this._factory):(on.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};us.prototype.editGeometryCollection=function(t,e){for(var n=this,r=e.edit(t,this._factory),i=new mt,a=0;a<r.getNumGeometries();a++){var c=n.edit(r.getGeometryN(a),e);c===null||c.isEmpty()||i.add(c)}return r.getClass()===Sf?this._factory.createMultiPoint(i.toArray([])):r.getClass()===Ru?this._factory.createMultiLineString(i.toArray([])):r.getClass()===Ta?this._factory.createMultiPolygon(i.toArray([])):this._factory.createGeometryCollection(i.toArray([]))};us.prototype.editPolygon=function(t,e){var n=this,r=e.edit(t,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var i=this.edit(r.getExteriorRing(),e);if(i===null||i.isEmpty())return this._factory.createPolygon();for(var a=new mt,c=0;c<r.getNumInteriorRing();c++){var u=n.edit(r.getInteriorRingN(c),e);u===null||u.isEmpty()||a.add(u)}return this._factory.createPolygon(i,a.toArray([]))};us.prototype.interfaces_=function(){return[]};us.prototype.getClass=function(){return us};us.GeometryEditorOperation=function(){};My.NoOpGeometryOperation.get=function(){return Ld};My.CoordinateOperation.get=function(){return Pd};My.CoordinateSequenceOperation.get=function(){return Md};Object.defineProperties(us,My);var Ld=function(){};Ld.prototype.edit=function(t,e){return t};Ld.prototype.interfaces_=function(){return[us.GeometryEditorOperation]};Ld.prototype.getClass=function(){return Ld};var Pd=function(){};Pd.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return n===null?t:t instanceof Aa?e.createLinearRing(n):t instanceof br?e.createLineString(n):t instanceof Co?n.length>0?e.createPoint(n[0]):e.createPoint():t};Pd.prototype.interfaces_=function(){return[us.GeometryEditorOperation]};Pd.prototype.getClass=function(){return Pd};var Md=function(){};Md.prototype.edit=function(t,e){return t instanceof Aa?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof br?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Co?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t};Md.prototype.interfaces_=function(){return[us.GeometryEditorOperation]};Md.prototype.getClass=function(){return Md};var Lr=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new Re}else if(Ut(arguments[0],En)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=r.getCoordinateCopy(i)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],c=arguments[1];this._coordinates=a,this._dimension=c,a===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],m=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=m;for(var w=0;w<u;w++)t._coordinates[w]=new Re}}},UI={serialVersionUID:{configurable:!0}};Lr.prototype.setOrdinate=function(t,e,n){switch(e){case En.X:this._coordinates[t].x=n;break;case En.Y:this._coordinates[t].y=n;break;case En.Z:this._coordinates[t].z=n;break;default:throw new ar("invalid ordinateIndex")}};Lr.prototype.size=function(){return this._coordinates.length};Lr.prototype.getOrdinate=function(t,e){switch(e){case En.X:return this._coordinates[t].x;case En.Y:return this._coordinates[t].y;case En.Z:return this._coordinates[t].z}return Xt.NaN};Lr.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}};Lr.prototype.getCoordinateCopy=function(t){return new Re(this._coordinates[t])};Lr.prototype.getDimension=function(){return this._dimension};Lr.prototype.getX=function(t){return this._coordinates[t].x};Lr.prototype.clone=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].clone();return new Lr(e,this._dimension)};Lr.prototype.expandEnvelope=function(t){for(var e=this,n=0;n<this._coordinates.length;n++)t.expandToInclude(e._coordinates[n]);return t};Lr.prototype.copy=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].copy();return new Lr(e,this._dimension)};Lr.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var e=new da(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)e.append(", "),e.append(t._coordinates[n]);return e.append(")"),e.toString()}else return"()"};Lr.prototype.getY=function(t){return this._coordinates[t].y};Lr.prototype.toCoordinateArray=function(){return this._coordinates};Lr.prototype.interfaces_=function(){return[En,fs]};Lr.prototype.getClass=function(){return Lr};UI.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Lr,UI);var ka=function(){},$v={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ka.prototype.readResolve=function(){return ka.instance()};ka.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Lr(t)}else if(Ut(arguments[0],En)){var e=arguments[0];return new Lr(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new Lr(n):new Lr(n,r)}};ka.prototype.interfaces_=function(){return[yf,fs]};ka.prototype.getClass=function(){return ka};ka.instance=function(){return ka.instanceObject};$v.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};$v.instanceObject.get=function(){return new ka};Object.defineProperties(ka,$v);var GI=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(n){return this.map_.get(n)||null},e.prototype.put=function(n,r){return this.map_.set(n,r),r},e.prototype.values=function(){for(var n=new mt,r=this.map_.values(),i=r.next();!i.done;)n.add(i.value),i=r.next();return n},e.prototype.entrySet=function(){var n=new Jv;return this.map_.entries().forEach(function(r){return n.add(r)}),n},e.prototype.size=function(){return this.map_.size()},e}(Xc),Mn=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof ia){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},e1={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Mn.prototype.equals=function(t){if(!(t instanceof Mn))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale};Mn.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new ta(n).compareTo(new ta(r))};Mn.prototype.getScale=function(){return this._scale};Mn.prototype.isFloating=function(){return this._modelType===Mn.FLOATING||this._modelType===Mn.FLOATING_SINGLE};Mn.prototype.getType=function(){return this._modelType};Mn.prototype.toString=function(){var t="UNKNOWN";return this._modelType===Mn.FLOATING?t="Floating":this._modelType===Mn.FLOATING_SINGLE?t="Floating-Single":this._modelType===Mn.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};Mn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(Xt.isNaN(t))return t;if(this._modelType===Mn.FLOATING_SINGLE){var e=t;return e}return this._modelType===Mn.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof Re){var n=arguments[0];if(this._modelType===Mn.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};Mn.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===Mn.FLOATING?t=16:this._modelType===Mn.FLOATING_SINGLE?t=6:this._modelType===Mn.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};Mn.prototype.setScale=function(t){this._scale=Math.abs(t)};Mn.prototype.interfaces_=function(){return[fs,hs]};Mn.prototype.getClass=function(){return Mn};Mn.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e};e1.serialVersionUID.get=function(){return 7777263578777804e3};e1.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Mn,e1);var ia=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},t1={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};ia.prototype.readResolve=function(){return ia.nameToTypeMap.get(this._name)};ia.prototype.toString=function(){return this._name};ia.prototype.interfaces_=function(){return[fs]};ia.prototype.getClass=function(){return ia};t1.serialVersionUID.get=function(){return-552860263173159e4};t1.nameToTypeMap.get=function(){return new GI};Object.defineProperties(ia,t1);Mn.Type=ia;Mn.FIXED=new ia("FIXED");Mn.FLOATING=new ia("FLOATING");Mn.FLOATING_SINGLE=new ia("FLOATING SINGLE");var mn=function t(){this._precisionModel=new Mn,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?Ut(arguments[0],yf)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Mn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},qI={serialVersionUID:{configurable:!0}};mn.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new Re(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new Re(t.getMinX(),t.getMinY()),new Re(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new Re(t.getMinX(),t.getMinY()),new Re(t.getMinX(),t.getMaxY()),new Re(t.getMaxX(),t.getMaxY()),new Re(t.getMaxX(),t.getMinY()),new Re(t.getMinX(),t.getMinY())]),null)};mn.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new br(this.getCoordinateSequenceFactory().create(t),this);if(Ut(t,En))return new br(t,this)}else return new br(this.getCoordinateSequenceFactory().create([]),this)};mn.prototype.createMultiLineString=function(){if(arguments.length===0)return new Ru(null,this);if(arguments.length===1){var t=arguments[0];return new Ru(t,this)}};mn.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var a=i.next(),c=a.getClass();e===null&&(e=c),c!==e&&(n=!0),a.isGeometryCollectionOrDerived()&&(r=!0)}if(e===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(mn.toGeometryArray(t));var u=t.iterator().next(),m=t.size()>1;if(m){if(u instanceof Xr)return this.createMultiPolygon(mn.toPolygonArray(t));if(u instanceof br)return this.createMultiLineString(mn.toLineStringArray(t));if(u instanceof Co)return this.createMultiPoint(mn.toPointArray(t));on.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};mn.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};mn.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Re){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(Ut(arguments[0],En)){var e=arguments[0];return new Co(e,this)}}};mn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};mn.prototype.createPolygon=function(){if(arguments.length===0)return new Xr(null,null,this);if(arguments.length===1){if(Ut(arguments[0],En)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Aa){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return new Xr(r,i,this)}};mn.prototype.getSRID=function(){return this._SRID};mn.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Hi(null,this);if(arguments.length===1){var t=arguments[0];return new Hi(t,this)}};mn.prototype.createGeometry=function(t){var e=new us(this);return e.edit(t,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};mn.prototype.getPrecisionModel=function(){return this._precisionModel};mn.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(Ut(arguments[0],En)){var e=arguments[0];return new Aa(e,this)}}};mn.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Ta(null,this);if(arguments.length===1){var t=arguments[0];return new Ta(t,this)}};mn.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new Sf(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Sf(e,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(Ut(arguments[0],En)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(r.size()).fill(null),a=0;a<r.size();a++){var c=t.getCoordinateSequenceFactory().create(1,r.getDimension());Mr.copy(r,a,c,0,1),i[a]=t.createPoint(c)}return this.createMultiPoint(i)}}};mn.prototype.interfaces_=function(){return[fs]};mn.prototype.getClass=function(){return mn};mn.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.toGeometryArray=function(t){if(t===null)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.getDefaultCoordinateSequenceFactory=function(){return ka.instance()};mn.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};mn.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)};qI.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(mn,qI);var fR=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ay=function(t){this.geometryFactory=t||new mn};Ay.prototype.read=function(t){var e;typeof t=="string"?e=JSON.parse(t):e=t;var n=e.type;if(!Xs[n])throw new Error("Unknown GeoJSON type: "+e.type);return fR.indexOf(n)!==-1?Xs[n].apply(this,[e.coordinates]):n==="GeometryCollection"?Xs[n].apply(this,[e.geometries]):Xs[n].apply(this,[e])};Ay.prototype.write=function(t){var e=t.getGeometryType();if(!tl[e])throw new Error("Geometry is not supported");return tl[e].apply(this,[t])};var Xs={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!Xs[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=Xs.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var r=0;r<t.features.length;++r)n.features.push(e.read(t.features[r]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new Re(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Re(t[0],t[1]),new Re(t[2],t[1]),new Re(t[2],t[3]),new Re(t[0],t[3]),new Re(t[0],t[1])])},Point:function(t){var e=new Re(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(Xs.Point.apply(e,[t[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=Xs.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(Xs.LineString.apply(e,[t[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=Xs.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(n),i=[],a=1;a<t.length;++a){var c=t[a],u=Xs.coordinates.apply(e,[c]),m=e.geometryFactory.createLinearRing(u);i.push(m)}return this.geometryFactory.createPolygon(r,i)},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(Xs.Polygon.apply(e,[i]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(e.read(i))}return this.geometryFactory.createGeometryCollection(n)}},tl={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=tl.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=tl.Point.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],r=t.getCoordinates(),i=0;i<r.length;++i){var a=r[i];n.push(tl.coordinate.apply(e,[a]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=tl.LineString.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],r=tl.LineString.apply(this,[t._shell]);n.push(r.coordinates);for(var i=0;i<t._holes.length;++i){var a=t._holes[i],c=tl.LineString.apply(e,[a]);n.push(c.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=tl.Polygon.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=i.getGeometryType();n.push(tl[a].apply(e,[i]))}return{type:"GeometryCollection",geometries:n}}},n1=function(t){this.geometryFactory=t||new mn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Ay(this.geometryFactory)};n1.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===Mn.FIXED&&this.reducePrecision(e),e};n1.prototype.reducePrecision=function(t){var e=this,n,r;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(n=0,r=t.points.length;n<r;n++)e.precisionModel.makePrecise(t.points[n]);else if(t.geometries)for(n=0,r=t.geometries.length;n<r;n++)e.reducePrecision(t.geometries[n])};var jI=function(){this.parser=new Ay(this.geometryFactory)};jI.prototype.write=function(t){return this.parser.write(t)};var st=function(){},ky={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};st.prototype.interfaces_=function(){return[]};st.prototype.getClass=function(){return st};st.opposite=function(t){return t===st.LEFT?st.RIGHT:t===st.RIGHT?st.LEFT:t};ky.ON.get=function(){return 0};ky.LEFT.get=function(){return 1};ky.RIGHT.get=function(){return 2};Object.defineProperties(st,ky);function Dy(t){this.message=t||""}Dy.prototype=new Error;Dy.prototype.name="EmptyStackException";function ma(){this.array_=[]}ma.prototype=new Cs;ma.prototype.add=function(t){return this.array_.push(t),!0};ma.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};ma.prototype.push=function(t){return this.array_.push(t),t};ma.prototype.pop=function(t){if(this.array_.length===0)throw new Dy;return this.array_.pop()};ma.prototype.peek=function(){if(this.array_.length===0)throw new Dy;return this.array_[this.array_.length-1]};ma.prototype.empty=function(){return this.array_.length===0};ma.prototype.isEmpty=function(){return this.empty()};ma.prototype.search=function(t){return this.array_.indexOf(t)};ma.prototype.size=function(){return this.array_.length};ma.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};var oa=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};oa.prototype.getCoordinate=function(){return this._minCoord};oa.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n};oa.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();on.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=xt.computeOrientation(this._minCoord,n,e),i=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===xt.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===xt.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)};oa.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge(),r=n.getCoordinates();if(e<0||e+1>=r.length||r[e].y===r[e+1].y)return-1;var i=st.LEFT;return r[e].y<r[e+1].y&&(i=st.RIGHT),i};oa.prototype.getEdge=function(){return this._orientedDe};oa.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(e._minCoord===null||n[r].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=r,e._minCoord=n[r])};oa.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),e=t.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};oa.prototype.findEdge=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();r.isForward()&&e.checkForRightmostCoordinate(r)}on.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var i=this.getRightmostSide(this._minDe,this._minIndex);i===st.LEFT&&(this._orientedDe=this._minDe.getSym())};oa.prototype.interfaces_=function(){return[]};oa.prototype.getClass=function(){return oa};var pl=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new Re(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(n,r){return r?n:n+" [ "+r+" ]"},e}(hl),Ry=function(){this.array_=[]};Ry.prototype.addLast=function(t){this.array_.push(t)};Ry.prototype.removeFirst=function(){return this.array_.shift()};Ry.prototype.isEmpty=function(){return this.array_.length===0};var Zi=function(){this._finder=null,this._dirEdgeList=new mt,this._nodes=new mt,this._rightMostCoord=null,this._env=null,this._finder=new oa};Zi.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.setVisited(!1)}};Zi.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Zi.prototype.computeNodeDepth=function(t){for(var e=this,n=null,r=t.getEdges().iterator();r.hasNext();){var i=r.next();if(i.isVisited()||i.getSym().isVisited()){n=i;break}}if(n===null)throw new pl("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(n);for(var a=t.getEdges().iterator();a.hasNext();){var c=a.next();c.setVisited(!0),e.copySymDepths(c)}};Zi.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(st.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)};Zi.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Zi.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(st.RIGHT)>=1&&e.getDepth(st.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}};Zi.prototype.computeDepths=function(t){var e=this,n=new Jv,r=new Ry,i=t.getNode();for(r.addLast(i),n.add(i),t.setVisited(!0);!r.isEmpty();){var a=r.removeFirst();n.add(a),e.computeNodeDepth(a);for(var c=a.getEdges().iterator();c.hasNext();){var u=c.next(),m=u.getSym();if(!m.isVisited()){var w=m.getNode();n.contains(w)||(r.addLast(w),n.add(w))}}}};Zi.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0};Zi.prototype.getEnvelope=function(){if(this._env===null){for(var t=new Rt,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),r=n.getEdge().getCoordinates(),i=0;i<r.length-1;i++)t.expandToInclude(r[i]);this._env=t}return this._env};Zi.prototype.addReachable=function(t){var e=this,n=new ma;for(n.add(t);!n.empty();){var r=n.pop();e.add(r,n)}};Zi.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(st.LEFT,t.getDepth(st.RIGHT)),e.setDepth(st.RIGHT,t.getDepth(st.LEFT))};Zi.prototype.add=function(t,e){var n=this;t.setVisited(!0),this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var i=r.next();n._dirEdgeList.add(i);var a=i.getSym(),c=a.getNode();c.isVisited()||e.push(c)}};Zi.prototype.getNodes=function(){return this._nodes};Zi.prototype.getDirectedEdges=function(){return this._dirEdgeList};Zi.prototype.interfaces_=function(){return[hs]};Zi.prototype.getClass=function(){return Zi};var Jn=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[st.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var a=0;a<this.location.length;a++)e.location[a]=i.location[a]}}else if(arguments.length===3){var c=arguments[0],u=arguments[1],m=arguments[2];this.init(3),this.location[st.ON]=c,this.location[st.LEFT]=u,this.location[st.RIGHT]=m}};Jn.prototype.setAllLocations=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]=t};Jn.prototype.isNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==ze.NONE)return!1;return!0};Jn.prototype.setAllLocationsIfNull=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]===ze.NONE&&(e.location[n]=t)};Jn.prototype.isLine=function(){return this.location.length===1};Jn.prototype.merge=function(t){var e=this;if(t.location.length>this.location.length){var n=new Array(3).fill(null);n[st.ON]=this.location[st.ON],n[st.LEFT]=ze.NONE,n[st.RIGHT]=ze.NONE,this.location=n}for(var r=0;r<this.location.length;r++)e.location[r]===ze.NONE&&r<t.location.length&&(e.location[r]=t.location[r])};Jn.prototype.getLocations=function(){return this.location};Jn.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[st.LEFT];this.location[st.LEFT]=this.location[st.RIGHT],this.location[st.RIGHT]=t};Jn.prototype.toString=function(){var t=new da;return this.location.length>1&&t.append(ze.toLocationSymbol(this.location[st.LEFT])),t.append(ze.toLocationSymbol(this.location[st.ON])),this.location.length>1&&t.append(ze.toLocationSymbol(this.location[st.RIGHT])),t.toString()};Jn.prototype.setLocations=function(t,e,n){this.location[st.ON]=t,this.location[st.LEFT]=e,this.location[st.RIGHT]=n};Jn.prototype.get=function(t){return t<this.location.length?this.location[t]:ze.NONE};Jn.prototype.isArea=function(){return this.location.length>1};Jn.prototype.isAnyNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]===ze.NONE)return!0;return!1};Jn.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(st.ON,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.location[e]=n}};Jn.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(ze.NONE)};Jn.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]};Jn.prototype.allPositionsEqual=function(t){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==t)return!1;return!0};Jn.prototype.interfaces_=function(){return[]};Jn.prototype.getClass=function(){return Jn};var Fn=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Jn(e),this.elt[1]=new Jn(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Jn(n.elt[0]),this.elt[1]=new Jn(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.elt[0]=new Jn(ze.NONE),this.elt[1]=new Jn(ze.NONE),this.elt[r].setLocation(i)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],u=arguments[2];this.elt[0]=new Jn(a,c,u),this.elt[1]=new Jn(a,c,u)}else if(arguments.length===4){var m=arguments[0],w=arguments[1],S=arguments[2],E=arguments[3];this.elt[0]=new Jn(ze.NONE,ze.NONE,ze.NONE),this.elt[1]=new Jn(ze.NONE,ze.NONE,ze.NONE),this.elt[m].setLocations(w,S,E)}};Fn.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};Fn.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)};Fn.prototype.isNull=function(t){return this.elt[t].isNull()};Fn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}};Fn.prototype.isLine=function(t){return this.elt[t].isLine()};Fn.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)e.elt[n]===null&&t.elt[n]!==null?e.elt[n]=new Jn(t.elt[n]):e.elt[n].merge(t.elt[n])};Fn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Fn.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(st.ON)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}};Fn.prototype.toString=function(){var t=new da;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};Fn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};Fn.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};Fn.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(st.ON,e)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}};Fn.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)};Fn.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)};Fn.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Jn(this.elt[t].location[0]))};Fn.prototype.interfaces_=function(){return[]};Fn.prototype.getClass=function(){return Fn};Fn.toLineLabel=function(t){for(var e=new Fn(ze.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Br=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new mt,this._pts=new mt,this._label=new Fn(ze.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new mt,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Br.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)e[n]=t._pts.get(n);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=xt.isCCW(this._ring.getCoordinates())};Br.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};Br.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,r=!0;do{if(n===null)throw new pl("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new pl("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var i=n.getLabel();on.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(n.getEdge(),n.isForward(),r),r=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)};Br.prototype.getLinearRing=function(){return this._ring};Br.prototype.getCoordinate=function(t){return this._pts.get(t)};Br.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode(),r=n.getEdges().getOutgoingDegree(t);r>t._maxNodeDegree&&(t._maxNodeDegree=r),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2};Br.prototype.addPoints=function(t,e,n){var r=this,i=t.getCoordinates();if(e){var a=1;n&&(a=0);for(var c=a;c<i.length;c++)r._pts.add(i[c])}else{var u=i.length-2;n&&(u=i.length-1);for(var m=u;m>=0;m--)r._pts.add(i[m])}};Br.prototype.isHole=function(){return this._isHole};Br.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};Br.prototype.containsPoint=function(t){var e=this.getLinearRing(),n=e.getEnvelopeInternal();if(!n.contains(t)||!xt.isPointInRing(t,e.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var i=r.next();if(i.containsPoint(t))return!1}return!0};Br.prototype.addHole=function(t){this._holes.add(t)};Br.prototype.isShell=function(){return this._shell===null};Br.prototype.getLabel=function(){return this._label};Br.prototype.getEdges=function(){return this._edges};Br.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};Br.prototype.getShell=function(){return this._shell};Br.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=e.getLocation(n,st.RIGHT);if(r===ze.NONE)return null;if(this._label.getLocation(n)===ze.NONE)return this._label.setLocation(n,r),null}};Br.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};Br.prototype.toPolygon=function(t){for(var e=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=e._holes.get(r).getLinearRing();var i=t.createPolygon(this.getLinearRing(),n);return i};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};var pR=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(n,r){n.setMinEdgeRing(r)},e.prototype.getNext=function(n){return n.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Br),dR=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var n=this,r=new mt,i=this._startDe;do{if(i.getMinEdgeRing()===null){var a=new pR(i,n._geometryFactory);r.add(a)}i=i.getNext()}while(i!==this._startDe);return r},e.prototype.setEdgeRing=function(n,r){n.setEdgeRing(r)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,r=this._startDe;do{var i=r.getNode();i.getEdges().linkMinimalDirectedEdges(n),r=r.getNext()}while(r!==this._startDe)},e.prototype.getNext=function(n){return n.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Br),Ho=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._label=t}};Ho.prototype.setVisited=function(t){this._isVisited=t};Ho.prototype.setInResult=function(t){this._isInResult=t};Ho.prototype.isCovered=function(){return this._isCovered};Ho.prototype.isCoveredSet=function(){return this._isCoveredSet};Ho.prototype.setLabel=function(t){this._label=t};Ho.prototype.getLabel=function(){return this._label};Ho.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};Ho.prototype.updateIM=function(t){on.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};Ho.prototype.isInResult=function(){return this._isInResult};Ho.prototype.isVisited=function(){return this._isVisited};Ho.prototype.interfaces_=function(){return[]};Ho.prototype.getClass=function(){return Ho};var Ny=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new Fn(0,ze.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var r=n.next();if(r.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(n){},e.prototype.computeMergedLocation=function(n,r){var i=ze.NONE;if(i=this._label.getLocation(r),!n.isNull(r)){var a=n.getLocation(r);i!==ze.BOUNDARY&&(i=a)}return i},e.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];this._label===null?this._label=new Fn(n,r):this._label.setLocation(n,r)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof e){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof Fn)for(var i=arguments[0],a=0;a<2;a++){var c=n.computeMergedLocation(i,a),u=n._label.getLocation(a);u===ze.NONE&&n._label.setLocation(a,c)}},e.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},e.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var r=ze.NONE;this._label!==null&&(r=this._label.getLocation(n));var i=null;switch(r){case ze.BOUNDARY:i=ze.INTERIOR;break;case ze.INTERIOR:i=ze.BOUNDARY;break;default:i=ze.BOUNDARY;break}this._label.setLocation(n,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ho),sa=function(){this.nodeMap=new ki,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};sa.prototype.find=function(t){return this.nodeMap.get(t)};sa.prototype.addNode=function(){if(arguments[0]instanceof Re){var t=arguments[0],e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof Ny){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return r===null?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}};sa.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};sa.prototype.iterator=function(){return this.nodeMap.values().iterator()};sa.prototype.values=function(){return this.nodeMap.values()};sa.prototype.getBoundaryNodes=function(t){for(var e=new mt,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===ze.BOUNDARY&&e.add(r)}return e};sa.prototype.add=function(t){var e=t.getCoordinate(),n=this.addNode(e);n.add(t)};sa.prototype.interfaces_=function(){return[]};sa.prototype.getClass=function(){return sa};var Bn=function(){},Xd={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Bn.prototype.interfaces_=function(){return[]};Bn.prototype.getClass=function(){return Bn};Bn.isNorthern=function(t){return t===Bn.NE||t===Bn.NW};Bn.isOpposite=function(t,e){if(t===e)return!1;var n=(t-e+4)%4;return n===2};Bn.commonHalfPlane=function(t,e){if(t===e)return t;var n=(t-e+4)%4;if(n===2)return-1;var r=t<e?t:e,i=t>e?t:e;return r===0&&i===3?3:r};Bn.isInHalfPlane=function(t,e){return e===Bn.SE?t===Bn.SE||t===Bn.SW:t===e||t===e+1};Bn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new ar("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Bn.NE:Bn.SE:e>=0?Bn.NW:Bn.SW}else if(arguments[0]instanceof Re&&arguments[1]instanceof Re){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new ar("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Bn.NE:Bn.SE:r.y>=n.y?Bn.NW:Bn.SW}};Xd.NE.get=function(){return 0};Xd.NW.get=function(){return 1};Xd.SW.get=function(){return 2};Xd.SE.get=function(){return 3};Object.defineProperties(Bn,Xd);var Di=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=null;this._edge=e,this.init(n,r),this._label=i}else if(arguments.length===4){var a=arguments[0],c=arguments[1],u=arguments[2],m=arguments[3];this._edge=a,this.init(c,u),this._label=m}};Di.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:xt.computeOrientation(t._p0,t._p1,this._p1)};Di.prototype.getDy=function(){return this._dy};Di.prototype.getCoordinate=function(){return this._p0};Di.prototype.setNode=function(t){this._node=t};Di.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)};Di.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)};Di.prototype.getDirectedCoordinate=function(){return this._p1};Di.prototype.getDx=function(){return this._dx};Di.prototype.getLabel=function(){return this._label};Di.prototype.getEdge=function(){return this._edge};Di.prototype.getQuadrant=function(){return this._quadrant};Di.prototype.getNode=function(){return this._node};Di.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf("."),r=e.substring(n+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};Di.prototype.computeLabel=function(t){};Di.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Bn.quadrant(this._dx,this._dy),on.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Di.prototype.interfaces_=function(){return[hs]};Di.prototype.getClass=function(){return Di};var av=function(t){function e(){var n=arguments[0],r=arguments[1];if(t.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var i=n.getNumPoints()-1;this.init(n.getCoordinate(i),n.getCoordinate(i-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(n){return this._depth[n]},e.prototype.setVisited=function(n){this._isVisited=n},e.prototype.computeDirectedLabel=function(){this._label=new Fn(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(n,r){if(this._depth[n]!==-999&&this._depth[n]!==r)throw new pl("assigned depths do not match",this.getCoordinate());this._depth[n]=r},e.prototype.isInteriorAreaEdge=function(){for(var n=this,r=!0,i=0;i<2;i++)n._label.isArea(i)&&n._label.getLocation(i,st.LEFT)===ze.INTERIOR&&n._label.getLocation(i,st.RIGHT)===ze.INTERIOR||(r=!1);return r},e.prototype.setNextMin=function(n){this._nextMin=n},e.prototype.print=function(n){t.prototype.print.call(this,n),n.print(" "+this._depth[st.LEFT]+"/"+this._depth[st.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},e.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},e.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,ze.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,ze.EXTERIOR);return n&&r&&i},e.prototype.setEdgeRing=function(n){this._edgeRing=n},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},e.prototype.setInResult=function(n){this._isInResult=n},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},e.prototype.setSym=function(n){this._sym=n},e.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},e.prototype.setEdgeDepths=function(n,r){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var a=1;n===st.LEFT&&(a=-1);var c=st.opposite(n),u=i*a,m=r+u;this.setDepth(n,r),this.setDepth(c,m)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(n){this._next=n},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(n,r){return n===ze.EXTERIOR&&r===ze.INTERIOR?1:n===ze.INTERIOR&&r===ze.EXTERIOR?-1:0},e}(Di),Ef=function(){};Ef.prototype.createNode=function(t){return new Ny(t,null)};Ef.prototype.interfaces_=function(){return[]};Ef.prototype.getClass=function(){return Ef};var pr=function(){if(this._edges=new mt,this._nodes=null,this._edgeEndList=new mt,arguments.length===0)this._nodes=new sa(new Ef);else if(arguments.length===1){var t=arguments[0];this._nodes=new sa(t)}};pr.prototype.printEdges=function(t){var e=this;t.println("Edges:");for(var n=0;n<this._edges.size();n++){t.println("edge "+n+":");var r=e._edges.get(n);r.print(t),r.eiList.print(t)}};pr.prototype.find=function(t){return this._nodes.find(t)};pr.prototype.addNode=function(){if(arguments[0]instanceof Ny){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof Re){var e=arguments[0];return this._nodes.addNode(e)}};pr.prototype.getNodeIterator=function(){return this._nodes.iterator()};pr.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkResultDirectedEdges()}};pr.prototype.debugPrintln=function(t){Ii.out.println(t)};pr.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(n===null)return!1;var r=n.getLabel();return r!==null&&r.getLocation(t)===ze.BOUNDARY};pr.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkAllDirectedEdges()}};pr.prototype.matchInSameDirection=function(t,e,n,r){return t.equals(n)?xt.computeOrientation(t,e,r)===xt.COLLINEAR&&Bn.quadrant(t,e)===Bn.quadrant(n,r):!1};pr.prototype.getEdgeEnds=function(){return this._edgeEndList};pr.prototype.debugPrint=function(t){Ii.out.print(t)};pr.prototype.getEdgeIterator=function(){return this._edges.iterator()};pr.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),a=i.getCoordinates();if(n.matchInSameDirection(t,e,a[0],a[1])||n.matchInSameDirection(t,e,a[a.length-1],a[a.length-2]))return i}return null};pr.prototype.insertEdge=function(t){this._edges.add(t)};pr.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null};pr.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e._edges.add(r);var i=new av(r,!0),a=new av(r,!1);i.setSym(a),a.setSym(i),e.add(i),e.add(a)}};pr.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};pr.prototype.getNodes=function(){return this._nodes.values()};pr.prototype.findEdge=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),a=i.getCoordinates();if(t.equals(a[0])&&e.equals(a[1]))return i}return null};pr.prototype.interfaces_=function(){return[]};pr.prototype.getClass=function(){return pr};pr.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.getEdges().linkResultDirectedEdges()}};var To=function(){this._geometryFactory=null,this._shellList=new mt;var t=arguments[0];this._geometryFactory=t};To.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}};To.prototype.computePolygons=function(t){for(var e=this,n=new mt,r=t.iterator();r.hasNext();){var i=r.next(),a=i.toPolygon(e._geometryFactory);n.add(a)}return n};To.prototype.placeFreeHoles=function(t,e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();if(i.getShell()===null){var a=n.findEdgeRingContaining(i,t);if(a===null)throw new pl("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(a)}}};To.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=this,i=new mt,a=t.iterator();a.hasNext();){var c=a.next();if(c.getMaxNodeDegree()>2){c.linkDirectedEdgesForMinimalEdgeRings();var u=c.buildMinimalRings(),m=r.findShell(u);m!==null?(r.placePolygonHoles(m,u),e.add(m)):n.addAll(u)}else i.add(c)}return i};To.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){var n=e.next();if(n.containsPoint(t))return!0}return!1};To.prototype.buildMaximalEdgeRings=function(t){for(var e=this,n=new mt,r=t.iterator();r.hasNext();){var i=r.next();if(i.isInResult()&&i.getLabel().isArea()&&i.getEdgeRing()===null){var a=new dR(i,e._geometryFactory);n.add(a),a.setInResult()}}return n};To.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}};To.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};To.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),a=null,c=null,u=e.iterator();u.hasNext();){var m=u.next(),w=m.getLinearRing(),S=w.getEnvelopeInternal();a!==null&&(c=a.getLinearRing().getEnvelopeInternal());var E=!1;S.contains(r)&&xt.isPointInRing(i,w.getCoordinates())&&(E=!0),E&&(a===null||c.contains(S))&&(a=m)}return a};To.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return on.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n};To.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var e=arguments[0],n=arguments[1];pr.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new mt,a=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(a,this._shellList,i),this.placeFreeHoles(this._shellList,i)}};To.prototype.interfaces_=function(){return[]};To.prototype.getClass=function(){return To};var If=function(){};If.prototype.getBounds=function(){};If.prototype.interfaces_=function(){return[]};If.prototype.getClass=function(){return If};var Ps=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Ps.prototype.getItem=function(){return this._item};Ps.prototype.getBounds=function(){return this._bounds};Ps.prototype.interfaces_=function(){return[If,fs]};Ps.prototype.getClass=function(){return Ps};var dl=function(){this._size=null,this._items=null,this._size=0,this._items=new mt,this._items.add(null)};dl.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};dl.prototype.size=function(){return this._size};dl.prototype.reorder=function(t){for(var e=this,n=null,r=this._items.get(t);t*2<=this._size&&(n=t*2,n!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(r)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,r)};dl.prototype.clear=function(){this._size=0,this._items.clear()};dl.prototype.isEmpty=function(){return this._size===0};dl.prototype.add=function(t){var e=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)e._items.set(n,e._items.get(Math.trunc(n/2)));this._items.set(n,t)};dl.prototype.interfaces_=function(){return[]};dl.prototype.getClass=function(){return dl};var Yl=function(){};Yl.prototype.visitItem=function(t){};Yl.prototype.interfaces_=function(){return[]};Yl.prototype.getClass=function(){return Yl};var Mc=function(){};Mc.prototype.insert=function(t,e){};Mc.prototype.remove=function(t,e){};Mc.prototype.query=function(){};Mc.prototype.interfaces_=function(){return[]};Mc.prototype.getClass=function(){return Mc};var Zr=function(){if(this._childBoundables=new mt,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._level=t}},WI={serialVersionUID:{configurable:!0}};Zr.prototype.getLevel=function(){return this._level};Zr.prototype.size=function(){return this._childBoundables.size()};Zr.prototype.getChildBoundables=function(){return this._childBoundables};Zr.prototype.addChildBoundable=function(t){on.isTrue(this._bounds===null),this._childBoundables.add(t)};Zr.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Zr.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Zr.prototype.interfaces_=function(){return[If,fs]};Zr.prototype.getClass=function(){return Zr};WI.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Zr,WI);var Ms=function(){};Ms.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}};Ms.min=function(t){return Ms.sort(t),t.get(0)};Ms.sort=function(t,e){var n=t.toArray();e?Au.sort(n,e):Au.sort(n);for(var r=t.iterator(),i=0,a=n.length;i<a;i++)r.next(),r.set(n[i])};Ms.singletonList=function(t){var e=new mt;return e.add(t),e};var Or=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};Or.prototype.expandToQueue=function(t,e){var n=Or.isComposite(this._boundable1),r=Or.isComposite(this._boundable2);if(n&&r)return Or.area(this._boundable1)>Or.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new ar("neither boundable is composite")};Or.prototype.isLeaves=function(){return!(Or.isComposite(this._boundable1)||Or.isComposite(this._boundable2))};Or.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0};Or.prototype.expand=function(t,e,n,r){for(var i=this,a=t.getChildBoundables(),c=a.iterator();c.hasNext();){var u=c.next(),m=new Or(u,e,i._itemDistance);m.getDistance()<r&&n.add(m)}};Or.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};Or.prototype.getDistance=function(){return this._distance};Or.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Or.prototype.interfaces_=function(){return[hs]};Or.prototype.getClass=function(){return Or};Or.area=function(t){return t.getBounds().getArea()};Or.isComposite=function(t){return t instanceof Zr};var yi=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new mt,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var n=arguments[0];on.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},Oy={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};yi.prototype.getNodeCapacity=function(){return this._nodeCapacity};yi.prototype.lastNode=function(t){return t.get(t.size()-1)};yi.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Zr?n+=t.size(i):i instanceof Ps&&(n+=1)}return n}};yi.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Ps&&i.getItem()===e&&(n=i)}return n!==null?(t.getChildBoundables().remove(n),!0):!1};yi.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new mt:e}else if(arguments.length===1){for(var n=arguments[0],r=new mt,i=n.getChildBoundables().iterator();i.hasNext();){var a=i.next();if(a instanceof Zr){var c=t.itemsTree(a);c!==null&&r.add(c)}else a instanceof Ps?r.add(a.getItem()):on.shouldNeverReachHere()}return r.size()<=0?null:r}};yi.prototype.insert=function(t,e){on.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ps(t,e))};yi.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var e=arguments[0],n=new mt;return this.boundablesAtLevel(e,this._root,n),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];if(on.isTrue(r>-2),i.getLevel()===r)return a.add(i),null;for(var c=i.getChildBoundables().iterator();c.hasNext();){var u=c.next();u instanceof Zr?t.boundablesAtLevel(r,u,a):(on.isTrue(u instanceof Ps),r===-1&&a.add(u))}return null}};yi.prototype.query=function(){var t=this;if(arguments.length===1){var e=arguments[0];this.build();var n=new mt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n}else if(arguments.length===2){var r=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i)}else if(arguments.length===3){if(Ut(arguments[2],Yl)&&arguments[0]instanceof Object&&arguments[1]instanceof Zr)for(var a=arguments[0],c=arguments[1],u=arguments[2],m=c.getChildBoundables(),w=0;w<m.size();w++){var S=m.get(w);t.getIntersectsOp().intersects(S.getBounds(),a)&&(S instanceof Zr?t.query(a,S,u):S instanceof Ps?u.visitItem(S.getItem()):on.shouldNeverReachHere())}else if(Ut(arguments[2],Cs)&&arguments[0]instanceof Object&&arguments[1]instanceof Zr)for(var E=arguments[0],P=arguments[1],D=arguments[2],k=P.getChildBoundables(),V=0;V<k.size();V++){var j=k.get(V);t.getIntersectsOp().intersects(j.getBounds(),E)&&(j instanceof Zr?t.query(E,j,D):j instanceof Ps?D.add(j.getItem()):on.shouldNeverReachHere())}}};yi.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};yi.prototype.getRoot=function(){return this.build(),this._root};yi.prototype.remove=function(){var t=this;if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),e)?this.remove(e,this._root,n):!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],c=this.removeItem(i,a);if(c)return!0;for(var u=null,m=i.getChildBoundables().iterator();m.hasNext();){var w=m.next();if(t.getIntersectsOp().intersects(w.getBounds(),r)&&w instanceof Zr&&(c=t.remove(r,w,a),c)){u=w;break}}return u!==null&&u.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(u),c}};yi.prototype.createHigherLevels=function(t,e){on.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return n.size()===1?n.get(0):this.createHigherLevels(n,e+1)};yi.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof Zr){var a=t.depth(i);a>n&&(n=a)}}return n+1}};yi.prototype.createParentBoundables=function(t,e){var n=this;on.isTrue(!t.isEmpty());var r=new mt;r.add(this.createNode(e));var i=new mt(t);Ms.sort(i,this.getComparator());for(var a=i.iterator();a.hasNext();){var c=a.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(e)),n.lastNode(r).addChildBoundable(c)}return r};yi.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};yi.prototype.interfaces_=function(){return[fs]};yi.prototype.getClass=function(){return yi};yi.compareDoubles=function(t,e){return t>e?1:t<e?-1:0};Oy.IntersectsOp.get=function(){return mR};Oy.serialVersionUID.get=function(){return-3886435814360241e3};Oy.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(yi,Oy);var mR=function(){},Cf=function(){};Cf.prototype.distance=function(t,e){};Cf.prototype.interfaces_=function(){return[]};Cf.prototype.getClass=function(){return Cf};var HI=function(t){function e(r){r=r||e.DEFAULT_NODE_CAPACITY,t.call(this,r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(r,i){var a=this;on.isTrue(r.length>0);for(var c=new mt,u=0;u<r.length;u++)c.addAll(a.createParentBoundablesFromVerticalSlice(r[u],i));return c},e.prototype.createNode=function(r){return new t2(r)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];if(r.isNull())return null;t.prototype.insert.call(this,r,i)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(r,i){for(var a=Math.trunc(Math.ceil(r.size()/i)),c=new Array(i).fill(null),u=r.iterator(),m=0;m<i;m++){c[m]=new mt;for(var w=0;u.hasNext()&&w<a;){var S=u.next();c[m].add(S),w++}}return c},e.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return t.prototype.query.call(this,r)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];t.prototype.query.call(this,i,a)}else if(arguments.length===3){if(Ut(arguments[2],Yl)&&arguments[0]instanceof Object&&arguments[1]instanceof Zr){var c=arguments[0],u=arguments[1],m=arguments[2];t.prototype.query.call(this,c,u,m)}else if(Ut(arguments[2],Cs)&&arguments[0]instanceof Object&&arguments[1]instanceof Zr){var w=arguments[0],S=arguments[1],E=arguments[2];t.prototype.query.call(this,w,S,E)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(r,i){return t.prototype.createParentBoundables.call(this,r,i)},e.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return t.prototype.remove.call(this,r,i)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(r,i){on.isTrue(!r.isEmpty());var a=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),c=new mt(r);Ms.sort(c,e.xComparator);var u=this.verticalSlices(c,Math.trunc(Math.ceil(Math.sqrt(a))));return this.createParentBoundablesFromVerticalSlices(u,i)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(Ut(arguments[0],Cf)){var r=arguments[0],i=new Or(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(i)}else if(arguments[0]instanceof Or){var a=arguments[0];return this.nearestNeighbour(a,Xt.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&Ut(arguments[1],Cf)){var c=arguments[0],u=arguments[1],m=new Or(this.getRoot(),c.getRoot(),u);return this.nearestNeighbour(m)}else if(arguments[0]instanceof Or&&typeof arguments[1]=="number"){var w=arguments[0],S=arguments[1],E=S,P=null,D=new dl;for(D.add(w);!D.isEmpty()&&E>0;){var k=D.poll(),V=k.getDistance();if(V>=E)break;k.isLeaves()?(E=V,P=k):k.expandToQueue(D,E)}return[P.getBoundable(0).getItem(),P.getBoundable(1).getItem()]}}else if(arguments.length===3){var j=arguments[0],te=arguments[1],U=arguments[2],W=new Ps(j,te),Y=new Or(this.getRoot(),W,U);return this.nearestNeighbour(Y)[0]}},e.prototype.interfaces_=function(){return[Mc,fs]},e.prototype.getClass=function(){return e},e.centreX=function(r){return e.avg(r.getMinX(),r.getMaxX())},e.avg=function(r,i){return(r+i)/2},e.centreY=function(r){return e.avg(r.getMinY(),r.getMaxY())},n.STRtreeNode.get=function(){return t2},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[gf]},compare:function(r,i){return t.compareDoubles(e.centreX(r.getBounds()),e.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[gf]},compare:function(r,i){return t.compareDoubles(e.centreY(r.getBounds()),e.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(r,i){return r.intersects(i)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(yi),t2=function(t){function e(){var n=arguments[0];t.call(this,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var n=null,r=this.getChildBoundables().iterator();r.hasNext();){var i=r.next();n===null?n=new Rt(i.getBounds()):n.expandToInclude(i.getBounds())}return n},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zr),io=function(){};io.prototype.interfaces_=function(){return[]};io.prototype.getClass=function(){return io};io.relativeSign=function(t,e){return t<e?-1:t>e?1:0};io.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=io.relativeSign(e.x,n.x),i=io.relativeSign(e.y,n.y);switch(t){case 0:return io.compareValue(r,i);case 1:return io.compareValue(i,r);case 2:return io.compareValue(i,-r);case 3:return io.compareValue(-r,i);case 4:return io.compareValue(-r,-i);case 5:return io.compareValue(-i,-r);case 6:return io.compareValue(-i,r);case 7:return io.compareValue(r,-i)}return on.shouldNeverReachHere("invalid octant value"),0};io.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var Kl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new Re(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};Kl.prototype.getCoordinate=function(){return this.coord};Kl.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};Kl.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:io.compare(this._segmentOctant,this.coord,e.coord)};Kl.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};Kl.prototype.isInterior=function(){return this._isInterior};Kl.prototype.interfaces_=function(){return[hs]};Kl.prototype.getClass=function(){return Kl};var Xi=function(){this._nodeMap=new ki,this._edge=null;var t=arguments[0];this._edge=t};Xi.prototype.getSplitCoordinates=function(){var t=this,e=new Hd;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();t.addEdgeCoordinates(r,i,e),r=i}return e.toCoordinateArray()};Xi.prototype.addCollapsedNodes=function(){var t=this,e=new mt;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var r=n.next().intValue();t.add(t._edge.getCoordinate(r),r)}};Xi.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Xi.prototype.findCollapsesFromExistingVertices=function(t){for(var e=this,n=0;n<this._edge.size()-2;n++){var r=e._edge.getCoordinate(n),i=e._edge.getCoordinate(n+2);r.equals2D(i)&&t.add(new ta(n+1))}};Xi.prototype.addEdgeCoordinates=function(t,e,n){var r=this,i=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(i);n.add(new Re(t.coord),!1);for(var c=t.segmentIndex+1;c<=e.segmentIndex;c++)n.add(r._edge.getCoordinate(c));a&&n.add(new Re(e.coord))};Xi.prototype.iterator=function(){return this._nodeMap.values().iterator()};Xi.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),a=e.createSplitEdge(r,i);t.add(a),r=i}};Xi.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,r===1?(n[0]=t.segmentIndex+1,!0):!1};Xi.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=this,n=new Array(1).fill(null),r=this.iterator(),i=r.next();r.hasNext();){var a=r.next(),c=e.findCollapseIndex(i,a,n);c&&t.add(new ta(n[0])),i=a}};Xi.prototype.getEdge=function(){return this._edge};Xi.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};Xi.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(i);a||r--;var c=new Array(r).fill(null),u=0;c[u++]=new Re(t.coord);for(var m=t.segmentIndex+1;m<=e.segmentIndex;m++)c[u++]=n._edge.getCoordinate(m);return a&&(c[u]=new Re(e.coord)),new Ar(c,this._edge.getData())};Xi.prototype.add=function(t,e){var n=new Kl(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return r!==null?(on.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)};Xi.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0),r=n.getCoordinate(0);if(!r.equals2D(e[0]))throw new hl("bad split edge start point at "+r);var i=t.get(t.size()-1),a=i.getCoordinates(),c=a[a.length-1];if(!c.equals2D(e[e.length-1]))throw new hl("bad split edge end point at "+c)};Xi.prototype.interfaces_=function(){return[]};Xi.prototype.getClass=function(){return Xi};var Ac=function(){};Ac.prototype.interfaces_=function(){return[]};Ac.prototype.getClass=function(){return Ac};Ac.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new ar("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}else if(arguments[0]instanceof Re&&arguments[1]instanceof Re){var i=arguments[0],a=arguments[1],c=a.x-i.x,u=a.y-i.y;if(c===0&&u===0)throw new ar("Cannot compute the octant for two identical points "+i);return Ac.octant(c,u)}};var Da=function(){};Da.prototype.getCoordinates=function(){};Da.prototype.size=function(){};Da.prototype.getCoordinate=function(t){};Da.prototype.isClosed=function(){};Da.prototype.setData=function(t){};Da.prototype.getData=function(){};Da.prototype.interfaces_=function(){return[]};Da.prototype.getClass=function(){return Da};var Ad=function(){};Ad.prototype.addIntersection=function(t,e){};Ad.prototype.interfaces_=function(){return[Da]};Ad.prototype.getClass=function(){return Ad};var Ar=function(){this._nodeList=new Xi(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Ar.prototype.getCoordinates=function(){return this._pts};Ar.prototype.size=function(){return this._pts.length};Ar.prototype.getCoordinate=function(t){return this._pts[t]};Ar.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Ar.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};Ar.prototype.setData=function(t){this._data=t};Ar.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:Ac.octant(t,e)};Ar.prototype.getData=function(){return this._data};Ar.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[3],a=new Re(n.getIntersection(i));this.addIntersection(a,r)}};Ar.prototype.toString=function(){return Ts.toLineString(new Lr(this._pts))};Ar.prototype.getNodeList=function(){return this._nodeList};Ar.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}var a=this._nodeList.add(t,n);return a};Ar.prototype.addIntersections=function(t,e,n){for(var r=this,i=0;i<t.getIntersectionNum();i++)r.addIntersection(t,e,n,i)};Ar.prototype.interfaces_=function(){return[Ad]};Ar.prototype.getClass=function(){return Ar};Ar.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],e=new mt;return Ar.getNodedSubstrings(t,e),e}else if(arguments.length===2)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var a=i.next();a.getNodeList().addSplitEdges(r)}};var Nt=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Re,this.p1=new Re;else if(arguments.length===1){var t=arguments[0];this.p0=new Re(t.p0),this.p1=new Re(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new Re(e,n),this.p1=new Re(r,i)}},ZI={serialVersionUID:{configurable:!0}};Nt.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Nt.prototype.orientationIndex=function(){if(arguments[0]instanceof Nt){var t=arguments[0],e=xt.orientationIndex(this.p0,this.p1,t.p0),n=xt.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}else if(arguments[0]instanceof Re){var r=arguments[0];return xt.orientationIndex(this.p0,this.p1,r)}};Nt.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};Nt.prototype.isVertical=function(){return this.p0.x===this.p1.x};Nt.prototype.equals=function(t){if(!(t instanceof Nt))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)};Nt.prototype.intersection=function(t){var e=new Zu;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null};Nt.prototype.project=function(){if(arguments[0]instanceof Re){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new Re(t);var e=this.projectionFactor(t),n=new Re;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof Nt){var r=arguments[0],i=this.projectionFactor(r.p0),a=this.projectionFactor(r.p1);if(i>=1&&a>=1||i<=0&&a<=0)return null;var c=this.project(r.p0);i<0&&(c=this.p0),i>1&&(c=this.p1);var u=this.project(r.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new Nt(c,u)}};Nt.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Nt.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Nt.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};Nt.prototype.distancePerpendicular=function(t){return xt.distancePointLinePerpendicular(t,this.p0,this.p1)};Nt.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Nt.prototype.midPoint=function(){return Nt.midPoint(this.p0,this.p1)};Nt.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;if(r<=0)return Xt.NaN;var i=((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r;return i};Nt.prototype.closestPoints=function(t){var e=this.intersection(t);if(e!==null)return[e,e];var n=new Array(2).fill(null),r=Xt.MAX_VALUE,i=null,a=this.closestPoint(t.p0);r=a.distance(t.p0),n[0]=a,n[1]=t.p0;var c=this.closestPoint(t.p1);i=c.distance(t.p1),i<r&&(r=i,n[0]=c,n[1]=t.p1);var u=t.closestPoint(this.p0);i=u.distance(this.p0),i<r&&(r=i,n[0]=this.p0,n[1]=u);var m=t.closestPoint(this.p1);return i=m.distance(this.p1),i<r&&(r=i,n[0]=this.p1,n[1]=m),n};Nt.prototype.closestPoint=function(t){var e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);var n=this.p0.distance(t),r=this.p1.distance(t);return n<r?this.p0:this.p1};Nt.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Nt.prototype.getLength=function(){return this.p0.distance(this.p1)};Nt.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return n!==0?n:this.p1.compareTo(e.p1)};Nt.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};Nt.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};Nt.prototype.lineIntersection=function(t){try{var e=Is.intersection(this.p0,this.p1,t.p0,t.p1);return e}catch(n){if(!(n instanceof Gf))throw n}finally{}return null};Nt.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Nt.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,c=Math.sqrt(i*i+a*a),u=0,m=0;if(e!==0){if(c<=0)throw new Error("Cannot compute offset from zero-length line segment");u=e*i/c,m=e*a/c}var w=n-m,S=r+u,E=new Re(w,S);return E};Nt.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}};Nt.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||Xt.isNaN(e))&&(e=1),e};Nt.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Nt.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Nt.prototype.distance=function(){if(arguments[0]instanceof Nt){var t=arguments[0];return xt.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof Re){var e=arguments[0];return xt.distancePointLine(e,this.p0,this.p1)}};Nt.prototype.pointAlong=function(t){var e=new Re;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e};Nt.prototype.hashCode=function(){var t=Xt.doubleToLongBits(this.p0.x);t^=Xt.doubleToLongBits(this.p0.y)*31;var e=Math.trunc(t)^Math.trunc(t>>32),n=Xt.doubleToLongBits(this.p1.x);n^=Xt.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(n)^Math.trunc(n>>32);return e^r};Nt.prototype.interfaces_=function(){return[hs,fs]};Nt.prototype.getClass=function(){return Nt};Nt.midPoint=function(t,e){return new Re((t.x+e.x)/2,(t.y+e.y)/2)};ZI.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Nt,ZI);var kd=function(){this.tempEnv1=new Rt,this.tempEnv2=new Rt,this._overlapSeg1=new Nt,this._overlapSeg2=new Nt};kd.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};kd.prototype.interfaces_=function(){return[]};kd.prototype.getClass=function(){return kd};var Lo=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};Lo.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]};Lo.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],a=this._pts[n];if(r.tempEnv1.init(i,a),n-e===1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var c=Math.trunc((e+n)/2);e<c&&this.computeSelect(t,e,c,r),c<n&&this.computeSelect(t,c,n,r)};Lo.prototype.getCoordinates=function(){for(var t=this,e=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)e[n++]=t._pts[r];return e};Lo.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)};Lo.prototype.setId=function(t){this._id=t};Lo.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)};Lo.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Rt(t,e)}return this._env};Lo.prototype.getEndIndex=function(){return this._end};Lo.prototype.getStartIndex=function(){return this._start};Lo.prototype.getContext=function(){return this._context};Lo.prototype.getId=function(){return this._id};Lo.prototype.computeOverlapsInternal=function(t,e,n,r,i,a){var c=this._pts[t],u=this._pts[e],m=n._pts[r],w=n._pts[i];if(e-t===1&&i-r===1)return a.overlap(this,t,n,r),null;if(a.tempEnv1.init(c,u),a.tempEnv2.init(m,w),!a.tempEnv1.intersects(a.tempEnv2))return null;var S=Math.trunc((t+e)/2),E=Math.trunc((r+i)/2);t<S&&(r<E&&this.computeOverlapsInternal(t,S,n,r,E,a),E<i&&this.computeOverlapsInternal(t,S,n,E,i,a)),S<e&&(r<E&&this.computeOverlapsInternal(S,e,n,r,E,a),E<i&&this.computeOverlapsInternal(S,e,n,E,i,a))};Lo.prototype.interfaces_=function(){return[]};Lo.prototype.getClass=function(){return Lo};var ea=function(){};ea.prototype.interfaces_=function(){return[]};ea.prototype.getClass=function(){return ea};ea.getChainStartIndices=function(t){var e=0,n=new mt;n.add(new ta(e));do{var r=ea.findChainEnd(t,e);n.add(new ta(r)),e=r}while(e<t.length-1);var i=ea.toIntArray(n);return i};ea.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=Bn.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])){var a=Bn.quadrant(t[i-1],t[i]);if(a!==r)break}i++}return i-1};ea.getChains=function(){if(arguments.length===1){var t=arguments[0];return ea.getChains(t,null)}else if(arguments.length===2){for(var e=arguments[0],n=arguments[1],r=new mt,i=ea.getChainStartIndices(e),a=0;a<i.length-1;a++){var c=new Lo(e,i[a],i[a+1],n);r.add(c)}return r}};ea.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Nu=function(){};Nu.prototype.computeNodes=function(t){};Nu.prototype.getNodedSubstrings=function(){};Nu.prototype.interfaces_=function(){return[]};Nu.prototype.getClass=function(){return Nu};var Dd=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}};Dd.prototype.setSegmentIntersector=function(t){this._segInt=t};Dd.prototype.interfaces_=function(){return[Nu]};Dd.prototype.getClass=function(){return Dd};var r1=function(t){function e(r){r?t.call(this,r):t.call(this),this._monoChains=new mt,this._index=new HI,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return Ar.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(r){for(var i=this,a=ea.getChains(r.getCoordinates(),r),c=a.iterator();c.hasNext();){var u=c.next();u.setId(i._idCounter++),i._index.insert(u.getEnvelope(),u),i._monoChains.add(u)}},e.prototype.computeNodes=function(r){var i=this;this._nodedSegStrings=r;for(var a=r.iterator();a.hasNext();)i.add(a.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var r=this,i=new n2(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var c=a.next(),u=r._index.query(c.getEnvelope()),m=u.iterator();m.hasNext();){var w=m.next();if(w.getId()>c.getId()&&(c.computeOverlaps(w,i),r._nOverlaps++),r._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return n2},Object.defineProperties(e,n),e}(Dd),n2=function(t){function e(){t.call(this),this._si=null;var n=arguments[0];this._si=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],a=arguments[3],c=n.getContext(),u=i.getContext();this._si.processIntersections(c,r,u,a)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(kd),Pn=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],c=arguments[2],u=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(a),this.setJoinStyle(c),this.setMitreLimit(u)}}},bl={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Pn.prototype.getEndCapStyle=function(){return this._endCapStyle};Pn.prototype.isSingleSided=function(){return this._isSingleSided};Pn.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=Pn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Pn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Pn.JOIN_ROUND&&(this._quadrantSegments=Pn.DEFAULT_QUADRANT_SEGMENTS)};Pn.prototype.getJoinStyle=function(){return this._joinStyle};Pn.prototype.setJoinStyle=function(t){this._joinStyle=t};Pn.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};Pn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Pn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Pn.prototype.setEndCapStyle=function(t){this._endCapStyle=t};Pn.prototype.getMitreLimit=function(){return this._mitreLimit};Pn.prototype.setMitreLimit=function(t){this._mitreLimit=t};Pn.prototype.setSingleSided=function(t){this._isSingleSided=t};Pn.prototype.interfaces_=function(){return[]};Pn.prototype.getClass=function(){return Pn};Pn.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)};bl.CAP_ROUND.get=function(){return 1};bl.CAP_FLAT.get=function(){return 2};bl.CAP_SQUARE.get=function(){return 3};bl.JOIN_ROUND.get=function(){return 1};bl.JOIN_MITRE.get=function(){return 2};bl.JOIN_BEVEL.get=function(){return 3};bl.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};bl.DEFAULT_MITRE_LIMIT.get=function(){return 5};bl.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Pn,bl);var xr=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=xt.COUNTERCLOCKWISE,this._inputLine=t||null},Yd={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};xr.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],a=this._inputLine[e],c=this._inputLine[n];return!this.isConcave(i,a,c)||!this.isShallow(i,a,c,r)?!1:this.isShallowSampled(i,a,t,n,r)};xr.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var a=!1;t.isDeletable(e,n,r,t._distanceTol)&&(t._isDeleted[n]=xr.DELETE,a=!0,i=!0),a?e=r:e=n,n=t.findNextNonDeletedIndex(e),r=t.findNextNonDeletedIndex(n)}return i};xr.prototype.isShallowConcavity=function(t,e,n,r){var i=xt.computeOrientation(t,e,n),a=i===this._angleOrientation;if(!a)return!1;var c=xt.distancePointLine(e,t,n);return c<r};xr.prototype.isShallowSampled=function(t,e,n,r,i){var a=this,c=Math.trunc((r-n)/xr.NUM_PTS_TO_CHECK);c<=0&&(c=1);for(var u=n;u<r;u+=c)if(!a.isShallow(t,e,a._inputLine[u],i))return!1;return!0};xr.prototype.isConcave=function(t,e,n){var r=xt.computeOrientation(t,e,n),i=r===this._angleOrientation;return i};xr.prototype.simplify=function(t){var e=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=xt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=e.deleteShallowConcavities();while(n);return this.collapseLine()};xr.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===xr.DELETE;)e++;return e};xr.prototype.isShallow=function(t,e,n,r){var i=xt.distancePointLine(e,t,n);return i<r};xr.prototype.collapseLine=function(){for(var t=this,e=new Hd,n=0;n<this._inputLine.length;n++)t._isDeleted[n]!==xr.DELETE&&e.add(t._inputLine[n]);return e.toCoordinateArray()};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};xr.simplify=function(t,e){var n=new xr(t);return n.simplify(e)};Yd.INIT.get=function(){return 0};Yd.DELETE.get=function(){return 1};Yd.KEEP.get=function(){return 1};Yd.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(xr,Yd);var Zo=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new mt},XI={COORDINATE_ARRAY_TYPE:{configurable:!0}};Zo.prototype.getCoordinates=function(){var t=this._ptList.toArray(Zo.COORDINATE_ARRAY_TYPE);return t};Zo.prototype.setPrecisionModel=function(t){this._precisionModel=t};Zo.prototype.addPt=function(t){var e=new Re(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)};Zo.prototype.revere=function(){};Zo.prototype.addPts=function(t,e){var n=this;if(e)for(var r=0;r<t.length;r++)n.addPt(t[r]);else for(var i=t.length-1;i>=0;i--)n.addPt(t[i])};Zo.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1),n=t.distance(e);return n<this._minimimVertexDistance};Zo.prototype.toString=function(){var t=new mn,e=t.createLineString(this.getCoordinates());return e.toString()};Zo.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new Re(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)};Zo.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};Zo.prototype.interfaces_=function(){return[]};Zo.prototype.getClass=function(){return Zo};XI.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Zo,XI);var bn=function(){},Yc={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};bn.prototype.interfaces_=function(){return[]};bn.prototype.getClass=function(){return bn};bn.toDegrees=function(t){return t*180/Math.PI};bn.normalize=function(t){for(;t>Math.PI;)t-=bn.PI_TIMES_2;for(;t<=-Math.PI;)t+=bn.PI_TIMES_2;return t};bn.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}};bn.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=n.x-e.x,c=n.y-e.y,u=r*a+i*c;return u>0};bn.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=n.x-e.x,c=n.y-e.y,u=r*a+i*c;return u<0};bn.interiorAngle=function(t,e,n){var r=bn.angle(e,t),i=bn.angle(e,n);return Math.abs(i-r)};bn.normalizePositive=function(t){if(t<0){for(;t<0;)t+=bn.PI_TIMES_2;t>=bn.PI_TIMES_2&&(t=0)}else{for(;t>=bn.PI_TIMES_2;)t-=bn.PI_TIMES_2;t<0&&(t=0)}return t};bn.angleBetween=function(t,e,n){var r=bn.angle(e,t),i=bn.angle(e,n);return bn.diff(r,i)};bn.diff=function(t,e){var n=null;return t<e?n=e-t:n=t-e,n>Math.PI&&(n=2*Math.PI-n),n};bn.toRadians=function(t){return t*Math.PI/180};bn.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?bn.COUNTERCLOCKWISE:n<0?bn.CLOCKWISE:bn.NONE};bn.angleBetweenOriented=function(t,e,n){var r=bn.angle(e,t),i=bn.angle(e,n),a=i-r;return a<=-Math.PI?a+bn.PI_TIMES_2:a>Math.PI?a-bn.PI_TIMES_2:a};Yc.PI_TIMES_2.get=function(){return 2*Math.PI};Yc.PI_OVER_2.get=function(){return Math.PI/2};Yc.PI_OVER_4.get=function(){return Math.PI/4};Yc.COUNTERCLOCKWISE.get=function(){return xt.COUNTERCLOCKWISE};Yc.CLOCKWISE.get=function(){return xt.CLOCKWISE};Yc.NONE.get=function(){return xt.COLLINEAR};Object.defineProperties(bn,Yc);var tr=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Nt,this._seg1=new Nt,this._offset0=new Nt,this._offset1=new Nt,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new Zu,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Pn.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},Kd={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};tr.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=xt.computeOrientation(this._s0,this._s1,this._s2),r=n===xt.CLOCKWISE&&this._side===st.LEFT||n===xt.COUNTERCLOCKWISE&&this._side===st.RIGHT;n===0?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)};tr.prototype.addLineEndCap=function(t,e){var n=new Nt(t,e),r=new Nt;this.computeOffsetSegment(n,st.LEFT,this._distance,r);var i=new Nt;this.computeOffsetSegment(n,st.RIGHT,this._distance,i);var a=e.x-t.x,c=e.y-t.y,u=Math.atan2(c,a);switch(this._bufParams.getEndCapStyle()){case Pn.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,u+Math.PI/2,u-Math.PI/2,xt.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Pn.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case Pn.CAP_SQUARE:var m=new Re;m.x=Math.abs(this._distance)*Math.cos(u),m.y=Math.abs(this._distance)*Math.sin(u);var w=new Re(r.p1.x+m.x,r.p1.y+m.y),S=new Re(i.p1.x+m.x,i.p1.y+m.y);this._segList.addPt(w),this._segList.addPt(S);break}};tr.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};tr.prototype.addMitreJoin=function(t,e,n,r){var i=!0,a=null;try{a=Is.intersection(e.p0,e.p1,n.p0,n.p1);var c=r<=0?1:a.distance(t)/Math.abs(r);c>this._bufParams.getMitreLimit()&&(i=!1)}catch(u){if(u instanceof Gf)a=new Re(0,0),i=!1;else throw u}finally{}i?this._segList.addPt(a):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())};tr.prototype.addFilletCorner=function(t,e,n,r,i){var a=e.x-t.x,c=e.y-t.y,u=Math.atan2(c,a),m=n.x-t.x,w=n.y-t.y,S=Math.atan2(w,m);r===xt.CLOCKWISE?u<=S&&(u+=2*Math.PI):u>=S&&(u-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,u,S,r,i),this._segList.addPt(n)};tr.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*tr.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Pn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Pn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};tr.prototype.createSquare=function(t){this._segList.addPt(new Re(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new Re(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new Re(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new Re(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};tr.prototype.addSegments=function(t,e){this._segList.addPts(t,e)};tr.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};tr.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};tr.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};tr.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,a=bn.angle(i,this._seg0.p0),c=bn.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1),u=c/2,m=bn.normalize(a+u),w=bn.normalize(m+Math.PI),S=r*n,E=S*Math.abs(Math.sin(u)),P=n-E,D=i.x+S*Math.cos(w),k=i.y+S*Math.sin(w),V=new Re(D,k),j=new Nt(i,V),te=j.pointAlongOffset(1,P),U=j.pointAlongOffset(1,-P);this._side===st.LEFT?(this._segList.addPt(te),this._segList.addPt(U)):(this._segList.addPt(U),this._segList.addPt(te))};tr.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===st.LEFT?1:-1,a=t.p1.x-t.p0.x,c=t.p1.y-t.p0.y,u=Math.sqrt(a*a+c*c),m=i*n*a/u,w=i*n*c/u;r.p0.x=t.p0.x-w,r.p0.y=t.p0.y+m,r.p1.x=t.p1.x-w,r.p1.y=t.p1.y+m};tr.prototype.addFilletArc=function(t,e,n,r,i){var a=this,c=r===xt.CLOCKWISE?-1:1,u=Math.abs(e-n),m=Math.trunc(u/this._filletAngleQuantum+.5);if(m<1)return null;for(var w=0,S=u/m,E=w,P=new Re;E<u;){var D=e+c*E;P.x=t.x+i*Math.cos(D),P.y=t.y+i*Math.sin(D),a._segList.addPt(P),E+=S}};tr.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*tr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Re((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new Re((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};tr.prototype.createCircle=function(t){var e=new Re(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};tr.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)};tr.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Zo,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*tr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};tr.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var e=this._li.getIntersectionNum();e>=2&&(this._bufParams.getJoinStyle()===Pn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Pn.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,xt.CLOCKWISE,this._distance))};tr.prototype.closeRing=function(){this._segList.closeRing()};tr.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};tr.prototype.interfaces_=function(){return[]};tr.prototype.getClass=function(){return tr};Kd.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};Kd.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};Kd.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};Kd.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(tr,Kd);var lo=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};lo.prototype.getOffsetCurve=function(t,e){if(this._distance=e,e===0)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var a=i.getCoordinates();return n&&gn.reverse(a),a};lo.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=xr.simplify(t,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],st.LEFT),n.addFirstSegment();for(var c=a-2;c>=0;c--)n.addNextSegment(i[c],!0)}else{n.addSegments(t,!1);var u=xr.simplify(t,r),m=u.length-1;n.initSideSegments(u[0],u[1],st.LEFT),n.addFirstSegment();for(var w=2;w<=m;w++)n.addNextSegment(u[w],!0)}n.addLastSegment(),n.closeRing()};lo.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===st.RIGHT&&(r=-r);var i=xr.simplify(t,r),a=i.length-1;n.initSideSegments(i[a-1],i[0],e);for(var c=1;c<=a;c++){var u=c!==1;n.addNextSegment(i[c],u)}n.closeRing()};lo.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=xr.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],st.LEFT);for(var a=2;a<=i;a++)e.addNextSegment(r[a],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var c=xr.simplify(t,-n),u=c.length-1;e.initSideSegments(c[u],c[u-1],st.LEFT);for(var m=u-2;m>=0;m--)e.addNextSegment(c[m],!0);e.addLastSegment(),e.addLineEndCap(c[1],c[0]),e.closeRing()};lo.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Pn.CAP_ROUND:e.createCircle(t);break;case Pn.CAP_SQUARE:e.createSquare(t);break}};lo.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided()||e===0)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);var a=r.getCoordinates();return a};lo.prototype.getBufferParameters=function(){return this._bufParams};lo.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};lo.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(n===0)return lo.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()};lo.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=xr.simplify(t,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],st.LEFT),n.addFirstSegment();for(var c=a-2;c>=0;c--)n.addNextSegment(i[c],!0)}else{var u=xr.simplify(t,r),m=u.length-1;n.initSideSegments(u[0],u[1],st.LEFT),n.addFirstSegment();for(var w=2;w<=m;w++)n.addNextSegment(u[w],!0)}n.addLastSegment()};lo.prototype.getSegGen=function(t){return new tr(this._precisionModel,this._bufParams,t)};lo.prototype.interfaces_=function(){return[]};lo.prototype.getClass=function(){return lo};lo.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new Re(t[n]);return e};var kc=function(){this._subgraphs=null,this._seg=new Nt,this._cga=new xt;var t=arguments[0];this._subgraphs=t},YI={DepthSegment:{configurable:!0}};kc.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=new mt,r=this._subgraphs.iterator();r.hasNext();){var i=r.next(),a=i.getEnvelope();e.y<a.getMinY()||e.y>a.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(Ut(arguments[2],Cs)&&arguments[0]instanceof Re&&arguments[1]instanceof av)for(var c=arguments[0],u=arguments[1],m=arguments[2],w=u.getEdge().getCoordinates(),S=0;S<w.length-1;S++){t._seg.p0=w[S],t._seg.p1=w[S+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var E=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(E<c.x)&&!t._seg.isHorizontal()&&!(c.y<t._seg.p0.y||c.y>t._seg.p1.y)&&xt.computeOrientation(t._seg.p0,t._seg.p1,c)!==xt.RIGHT){var P=u.getDepth(st.LEFT);t._seg.p0.equals(w[S])||(P=u.getDepth(st.RIGHT));var D=new Ou(t._seg,P);m.add(D)}}else if(Ut(arguments[2],Cs)&&arguments[0]instanceof Re&&Ut(arguments[1],Cs))for(var k=arguments[0],V=arguments[1],j=arguments[2],te=V.iterator();te.hasNext();){var U=te.next();U.isForward()&&t.findStabbedSegments(k,U,j)}}};kc.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);if(e.size()===0)return 0;var n=Ms.min(e);return n._leftDepth};kc.prototype.interfaces_=function(){return[]};kc.prototype.getClass=function(){return kc};YI.DepthSegment.get=function(){return Ou};Object.defineProperties(kc,YI);var Ou=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new Nt(t),this._leftDepth=e};Ou.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return n!==0||(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(e._upwardSeg)};Ou.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return n!==0?n:t.p1.compareTo(e.p1)};Ou.prototype.toString=function(){return this._upwardSeg.toString()};Ou.prototype.interfaces_=function(){return[hs]};Ou.prototype.getClass=function(){return Ou};var An=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};An.prototype.area=function(){return An.area(this.p0,this.p1,this.p2)};An.prototype.signedArea=function(){return An.signedArea(this.p0,this.p1,this.p2)};An.prototype.interpolateZ=function(t){if(t===null)throw new ar("Supplied point is null.");return An.interpolateZ(t,this.p0,this.p1,this.p2)};An.prototype.longestSideLength=function(){return An.longestSideLength(this.p0,this.p1,this.p2)};An.prototype.isAcute=function(){return An.isAcute(this.p0,this.p1,this.p2)};An.prototype.circumcentre=function(){return An.circumcentre(this.p0,this.p1,this.p2)};An.prototype.area3D=function(){return An.area3D(this.p0,this.p1,this.p2)};An.prototype.centroid=function(){return An.centroid(this.p0,this.p1,this.p2)};An.prototype.inCentre=function(){return An.inCentre(this.p0,this.p1,this.p2)};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};An.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)};An.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2};An.det=function(t,e,n,r){return t*r-e*n};An.interpolateZ=function(t,e,n,r){var i=e.x,a=e.y,c=n.x-i,u=r.x-i,m=n.y-a,w=r.y-a,S=c*w-u*m,E=t.x-i,P=t.y-a,D=(w*E-u*P)/S,k=(-m*E+c*P)/S,V=e.z+D*(n.z-e.z)+k*(r.z-e.z);return V};An.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),a=n.distance(t),c=r;return i>c&&(c=i),a>c&&(c=a),c};An.isAcute=function(t,e,n){return!(!bn.isAcute(t,e,n)||!bn.isAcute(e,n,t)||!bn.isAcute(n,t,e))};An.circumcentre=function(t,e,n){var r=n.x,i=n.y,a=t.x-r,c=t.y-i,u=e.x-r,m=e.y-i,w=2*An.det(a,c,u,m),S=An.det(c,a*a+c*c,m,u*u+m*m),E=An.det(a,a*a+c*c,u,u*u+m*m),P=r-S/w,D=i+E/w;return new Re(P,D)};An.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new Is(t.x+n/2,t.y+r/2,1),a=new Is(t.x-r+n/2,t.y+n+r/2,1);return new Is(i,a)};An.angleBisector=function(t,e,n){var r=e.distance(t),i=e.distance(n),a=r/(r+i),c=n.x-t.x,u=n.y-t.y,m=new Re(t.x+a*c,t.y+a*u);return m};An.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,a=e.z-t.z,c=n.x-t.x,u=n.y-t.y,m=n.z-t.z,w=i*m-a*u,S=a*c-r*m,E=r*u-i*c,P=w*w+S*S+E*E,D=Math.sqrt(P)/2;return D};An.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new Re(r,i)};An.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),a=t.distance(e),c=r+i+a,u=(r*t.x+i*e.x+a*n.x)/c,m=(r*t.y+i*e.y+a*n.y)/c;return new Re(u,m)};var cs=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new mt;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};cs.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,ze.EXTERIOR,ze.INTERIOR)};cs.prototype.addPolygon=function(t){var e=this,n=this._distance,r=st.LEFT;this._distance<0&&(n=-this._distance,r=st.RIGHT);var i=t.getExteriorRing(),a=gn.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance)||this._distance<=0&&a.length<3)return null;this.addPolygonRing(a,n,r,ze.EXTERIOR,ze.INTERIOR);for(var c=0;c<t.getNumInteriorRing();c++){var u=t.getInteriorRingN(c),m=gn.removeRepeatedPoints(u.getCoordinates());e._distance>0&&e.isErodedCompletely(u,-e._distance)||e.addPolygonRing(m,n,st.opposite(r),ze.INTERIOR,ze.EXTERIOR)}};cs.prototype.isTriangleErodedCompletely=function(t,e){var n=new An(t[0],t[1],t[2]),r=n.inCentre(),i=xt.distancePointLine(r,n.p0,n.p1);return i<Math.abs(e)};cs.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=gn.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,ze.EXTERIOR,ze.INTERIOR)};cs.prototype.addCurve=function(t,e,n){if(t===null||t.length<2)return null;var r=new Ar(t,new Fn(0,ze.BOUNDARY,e,n));this._curveList.add(r)};cs.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};cs.prototype.addPolygonRing=function(t,e,n,r,i){if(e===0&&t.length<Aa.MINIMUM_VALID_SIZE)return null;var a=r,c=i;t.length>=Aa.MINIMUM_VALID_SIZE&&xt.isCCW(t)&&(a=i,c=r,n=st.opposite(n));var u=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(u,a,c)};cs.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Xr?this.addPolygon(t):t instanceof br?this.addLineString(t):t instanceof Co?this.addPoint(t):t instanceof Sf?this.addCollection(t):t instanceof Ru?this.addCollection(t):t instanceof Ta?this.addCollection(t):t instanceof Hi&&this.addCollection(t)};cs.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(n.length===4)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i};cs.prototype.addCollection=function(t){for(var e=this,n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);e.add(r)}};cs.prototype.interfaces_=function(){return[]};cs.prototype.getClass=function(){return cs};var Tf=function(){};Tf.prototype.locate=function(t){};Tf.prototype.interfaces_=function(){return[]};Tf.prototype.getClass=function(){return Tf};var La=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};La.prototype.next=function(){if(this._atStart)return this._atStart=!1,La.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new jf;var t=this._parent.getGeometryN(this._index++);return t instanceof Hi?(this._subcollectionIterator=new La(t),this._subcollectionIterator.next()):t};La.prototype.remove=function(){throw new Error(this.getClass().getName())};La.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};La.prototype.interfaces_=function(){return[qf]};La.prototype.getClass=function(){return La};La.isAtomic=function(t){return!(t instanceof Hi)};var qo=function(){this._geom=null;var t=arguments[0];this._geom=t};qo.prototype.locate=function(t){return qo.locate(t,this._geom)};qo.prototype.interfaces_=function(){return[Tf]};qo.prototype.getClass=function(){return qo};qo.isPointInRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?xt.isPointInRing(t,e.getCoordinates()):!1};qo.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!qo.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(qo.isPointInRing(t,i))return!1}return!0};qo.containsPoint=function(t,e){if(e instanceof Xr)return qo.containsPointInPolygon(t,e);if(e instanceof Hi)for(var n=new La(e);n.hasNext();){var r=n.next();if(r!==e&&qo.containsPoint(t,r))return!0}return!1};qo.locate=function(t,e){return e.isEmpty()?ze.EXTERIOR:qo.containsPoint(t,e)?ze.INTERIOR:ze.EXTERIOR};var Ri=function(){this._edgeMap=new ki,this._edgeList=null,this._ptInAreaLocation=[ze.NONE,ze.NONE]};Ri.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return e===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};Ri.prototype.propagateSideLabels=function(t){for(var e=ze.NONE,n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea(t)&&i.getLocation(t,st.LEFT)!==ze.NONE&&(e=i.getLocation(t,st.LEFT))}if(e===ze.NONE)return null;for(var a=e,c=this.iterator();c.hasNext();){var u=c.next(),m=u.getLabel();if(m.getLocation(t,st.ON)===ze.NONE&&m.setLocation(t,st.ON,a),m.isArea(t)){var w=m.getLocation(t,st.LEFT),S=m.getLocation(t,st.RIGHT);if(S!==ze.NONE){if(S!==a)throw new pl("side location conflict",u.getCoordinate());w===ze.NONE&&on.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),a=w}else on.isTrue(m.getLocation(t,st.LEFT)===ze.NONE,"found single null side"),m.setLocation(t,st.RIGHT,a),m.setLocation(t,st.LEFT,a)}}};Ri.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var e=t.next();return e.getCoordinate()};Ri.prototype.print=function(t){Ii.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Ri.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Ri.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel(),i=r.getLocation(t,st.LEFT);on.isTrue(i!==ze.NONE,"Found unlabelled area edge");for(var a=i,c=this.iterator();c.hasNext();){var u=c.next(),m=u.getLabel();on.isTrue(m.isArea(t),"Found non-area edge");var w=m.getLocation(t,st.LEFT),S=m.getLocation(t,st.RIGHT);if(w===S||S!==a)return!1;a=w}return!0};Ri.prototype.findIndex=function(t){var e=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var r=e._edgeList.get(n);if(r===t)return n}return-1};Ri.prototype.iterator=function(){return this.getEdges().iterator()};Ri.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new mt(this._edgeMap.values())),this._edgeList};Ri.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===ze.NONE&&(this._ptInAreaLocation[t]=qo.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]};Ri.prototype.toString=function(){var t=new da;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append(`
`)}return t.toString()};Ri.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.computeLabel(t)}};Ri.prototype.computeLabelling=function(t){var e=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var i=r.next(),a=i.getLabel(),c=0;c<2;c++)a.isLine(c)&&a.getLocation(c)===ze.BOUNDARY&&(n[c]=!0);for(var u=this.iterator();u.hasNext();)for(var m=u.next(),w=m.getLabel(),S=0;S<2;S++)if(w.isAnyNull(S)){var E=ze.NONE;if(n[S])E=ze.EXTERIOR;else{var P=m.getCoordinate();E=e.getLocation(S,P,t)}w.setAllLocationsIfNull(S,E)}};Ri.prototype.getDegree=function(){return this._edgeMap.size()};Ri.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null};Ri.prototype.interfaces_=function(){return[]};Ri.prototype.getClass=function(){return Ri};var gR=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var r=null,i=null,a=this._SCANNING_FOR_INCOMING,c=0;c<this._resultAreaEdgeList.size();c++){var u=n._resultAreaEdgeList.get(c),m=u.getSym();if(u.getLabel().isArea())switch(r===null&&u.isInResult()&&(r=u),a){case n._SCANNING_FOR_INCOMING:if(!m.isInResult())continue;i=m,a=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!u.isInResult())continue;i.setNext(u),a=n._SCANNING_FOR_INCOMING;break}}if(a===this._LINKING_TO_OUTGOING){if(r===null)throw new pl("no outgoing dirEdge found",this.getCoordinate());on.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),i.setNext(r)}},e.prototype.insert=function(n){var r=n;this.insertEdgeEnd(r,r)},e.prototype.getRightmostEdge=function(){var n=this.getEdges(),r=n.size();if(r<1)return null;var i=n.get(0);if(r===1)return i;var a=n.get(r-1),c=i.getQuadrant(),u=a.getQuadrant();return Bn.isNorthern(c)&&Bn.isNorthern(u)?i:!Bn.isNorthern(c)&&!Bn.isNorthern(u)?a:i.getDy()!==0?i:a.getDy()!==0?a:(on.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(n){Ii.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var i=r.next();n.print("out "),i.print(n),n.println(),n.print("in "),i.getSym().print(n),n.println()}},e.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new mt;for(var r=this.iterator();r.hasNext();){var i=r.next();(i.isInResult()||i.getSym().isInResult())&&n._resultAreaEdgeList.add(i)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(n){for(var r=this.iterator();r.hasNext();){var i=r.next(),a=i.getLabel();a.setAllLocationsIfNull(0,n.getLocation(0)),a.setAllLocationsIfNull(1,n.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var r=null,i=null,a=this._edgeList.size()-1;a>=0;a--){var c=n._edgeList.get(a),u=c.getSym();i===null&&(i=u),r!==null&&u.setNext(r),r=c}i.setNext(r)},e.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var r=arguments[0],i=this.findIndex(r),a=r.getDepth(st.LEFT),c=r.getDepth(st.RIGHT),u=this.computeDepths(i+1,this._edgeList.size(),a),m=this.computeDepths(0,i,u);if(m!==c)throw new pl("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var w=arguments[0],S=arguments[1],E=arguments[2],P=E,D=w;D<S;D++){var k=n._edgeList.get(D);k.setEdgeDepths(st.RIGHT,P),P=k.getDepth(st.LEFT)}return P}},e.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.merge(r.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(n){for(var r=this,i=null,a=null,c=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var m=r._resultAreaEdgeList.get(u),w=m.getSym();switch(i===null&&m.getEdgeRing()===n&&(i=m),c){case r._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==n)continue;a=w,c=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(m.getEdgeRing()!==n)continue;a.setNextMin(m),c=r._SCANNING_FOR_INCOMING;break}}c===this._LINKING_TO_OUTGOING&&(on.isTrue(i!==null,"found null for first outgoing dirEdge"),on.isTrue(i.getEdgeRing()===n,"unable to link last incoming dirEdge"),a.setNextMin(i))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,r=this.iterator();r.hasNext();){var i=r.next();i.isInResult()&&n++}return n}else if(arguments.length===1){for(var a=arguments[0],c=0,u=this.iterator();u.hasNext();){var m=u.next();m.getEdgeRing()===a&&c++}return c}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var n=ze.NONE,r=this.iterator();r.hasNext();){var i=r.next(),a=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){n=ze.INTERIOR;break}if(a.isInResult()){n=ze.EXTERIOR;break}}}if(n===ze.NONE)return null;for(var c=n,u=this.iterator();u.hasNext();){var m=u.next(),w=m.getSym();m.isLineEdge()?m.getEdge().setCovered(c===ze.INTERIOR):(m.isInResult()&&(c=ze.EXTERIOR),w.isInResult()&&(c=ze.INTERIOR))}},e.prototype.computeLabelling=function(n){var r=this;t.prototype.computeLabelling.call(this,n),this._label=new Fn(ze.NONE);for(var i=this.iterator();i.hasNext();)for(var a=i.next(),c=a.getEdge(),u=c.getLabel(),m=0;m<2;m++){var w=u.getLocation(m);(w===ze.INTERIOR||w===ze.BOUNDARY)&&r._label.setLocation(m,ze.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ri),KI=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(n){return new Ny(n,new gR)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ef),Jl=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Jl.prototype.compareTo=function(t){var e=t,n=Jl.compareOriented(this._pts,this._orientation,e._pts,e._orientation);return n};Jl.prototype.interfaces_=function(){return[hs]};Jl.prototype.getClass=function(){return Jl};Jl.orientation=function(t){return gn.increasingDirection(t)===1};Jl.compareOriented=function(t,e,n,r){for(var i=e?1:-1,a=r?1:-1,c=e?t.length:-1,u=r?n.length:-1,m=e?0:t.length-1,w=r?0:n.length-1;;){var S=t[m].compareTo(n[w]);if(S!==0)return S;m+=i,w+=a;var E=m===c,P=w===u;if(E&&!P)return-1;if(!E&&P)return 1;if(E&&P)return 0}};var As=function(){this._edges=new mt,this._ocaMap=new ki};As.prototype.print=function(t){var e=this;t.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=e._edges.get(n);n>0&&t.print(","),t.print("(");for(var i=r.getCoordinates(),a=0;a<i.length;a++)a>0&&t.print(","),t.print(i[a].x+" "+i[a].y);t.println(")")}t.print(")  ")};As.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next())};As.prototype.findEdgeIndex=function(t){for(var e=this,n=0;n<this._edges.size();n++)if(e._edges.get(n).equals(t))return n;return-1};As.prototype.iterator=function(){return this._edges.iterator()};As.prototype.getEdges=function(){return this._edges};As.prototype.get=function(t){return this._edges.get(t)};As.prototype.findEqualEdge=function(t){var e=new Jl(t.getCoordinates()),n=this._ocaMap.get(e);return n};As.prototype.add=function(t){this._edges.add(t);var e=new Jl(t.getCoordinates());this._ocaMap.put(e,t)};As.prototype.interfaces_=function(){return[]};As.prototype.getClass=function(){return As};var zu=function(){};zu.prototype.processIntersections=function(t,e,n,r){};zu.prototype.isDone=function(){};zu.prototype.interfaces_=function(){return[]};zu.prototype.getClass=function(){return zu};var Xo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Xo.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if(Xo.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};Xo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Xo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Xo.prototype.getLineIntersector=function(){return this._li};Xo.prototype.hasProperIntersection=function(){return this._hasProper};Xo.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],a=t.getCoordinates()[e+1],c=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(i,a,c,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Xo.prototype.hasIntersection=function(){return this._hasIntersection};Xo.prototype.isDone=function(){return!1};Xo.prototype.hasInteriorIntersection=function(){return this._hasInterior};Xo.prototype.interfaces_=function(){return[zu]};Xo.prototype.getClass=function(){return Xo};Xo.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var aa=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new Re(t),this.segmentIndex=e,this.dist=n};aa.prototype.getSegmentIndex=function(){return this.segmentIndex};aa.prototype.getCoordinate=function(){return this.coord};aa.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};aa.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)};aa.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};aa.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};aa.prototype.getDistance=function(){return this.dist};aa.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0};aa.prototype.interfaces_=function(){return[hs]};aa.prototype.getClass=function(){return aa};var Ra=function(){this._nodeMap=new ki,this.edge=null;var t=arguments[0];this.edge=t};Ra.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Ra.prototype.iterator=function(){return this._nodeMap.values().iterator()};Ra.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),a=e.createSplitEdge(r,i);t.add(a),r=i}};Ra.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};Ra.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],a=e.dist>0||!e.coord.equals2D(i);a||r--;var c=new Array(r).fill(null),u=0;c[u++]=new Re(t.coord);for(var m=t.segmentIndex+1;m<=e.segmentIndex;m++)c[u++]=n.edge.pts[m];return a&&(c[u]=e.coord),new sy(c,new Fn(this.edge._label))};Ra.prototype.add=function(t,e,n){var r=new aa(t,e,n),i=this._nodeMap.get(r);return i!==null?i:(this._nodeMap.put(r,r),r)};Ra.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();if(n.coord.equals(t))return!0}return!1};Ra.prototype.interfaces_=function(){return[]};Ra.prototype.getClass=function(){return Ra};var Fu=function(){};Fu.prototype.getChainStartIndices=function(t){var e=this,n=0,r=new mt;r.add(new ta(n));do{var i=e.findChainEnd(t,n);r.add(new ta(i)),n=i}while(n<t.length-1);var a=Fu.toIntArray(r);return a};Fu.prototype.findChainEnd=function(t,e){for(var n=Bn.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){var i=Bn.quadrant(t[r-1],t[r]);if(i!==n)break;r++}return r-1};Fu.prototype.interfaces_=function(){return[]};Fu.prototype.getClass=function(){return Fu};Fu.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var ml=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Rt,this.env2=new Rt;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Fu;this.startIndex=e.getChainStartIndices(this.pts)};ml.prototype.getCoordinates=function(){return this.pts};ml.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n};ml.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n};ml.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(arguments.length===6){var i=arguments[0],a=arguments[1],c=arguments[2],u=arguments[3],m=arguments[4],w=arguments[5],S=this.pts[i],E=this.pts[a],P=c.pts[u],D=c.pts[m];if(a-i===1&&m-u===1)return w.addIntersections(this.e,i,c.e,u),null;if(this.env1.init(S,E),this.env2.init(P,D),!this.env1.intersects(this.env2))return null;var k=Math.trunc((i+a)/2),V=Math.trunc((u+m)/2);i<k&&(u<V&&this.computeIntersectsForChain(i,k,c,u,V,w),V<m&&this.computeIntersectsForChain(i,k,c,V,m,w)),k<a&&(u<V&&this.computeIntersectsForChain(k,a,c,u,V,w),V<m&&this.computeIntersectsForChain(k,a,c,V,m,w))}};ml.prototype.getStartIndexes=function(){return this.startIndex};ml.prototype.computeIntersects=function(t,e){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var i=0;i<t.startIndex.length-1;i++)n.computeIntersectsForChain(r,t,i,e)};ml.prototype.interfaces_=function(){return[]};ml.prototype.getClass=function(){return ml};var Ei=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)e._depth[n][r]=t.NULL_VALUE},JI={NULL_VALUE:{configurable:!0}};Ei.prototype.getDepth=function(t,e){return this._depth[t][e]};Ei.prototype.setDepth=function(t,e,n){this._depth[t][e]=n};Ei.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==Ei.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===Ei.NULL_VALUE}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return this._depth[i][a]===Ei.NULL_VALUE}};Ei.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var i=0;t._depth[e][r]>n&&(i=1),t._depth[e][r]=i}}};Ei.prototype.getDelta=function(t){return this._depth[t][st.RIGHT]-this._depth[t][st.LEFT]};Ei.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?ze.EXTERIOR:ze.INTERIOR};Ei.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Ei.prototype.add=function(){var t=this;if(arguments.length===1)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=e.getLocation(n,r);(i===ze.EXTERIOR||i===ze.INTERIOR)&&(t.isNull(n,r)?t._depth[n][r]=Ei.depthAtLocation(i):t._depth[n][r]+=Ei.depthAtLocation(i))}else if(arguments.length===3){var a=arguments[0],c=arguments[1],u=arguments[2];u===ze.INTERIOR&&this._depth[a][c]++}};Ei.prototype.interfaces_=function(){return[]};Ei.prototype.getClass=function(){return Ei};Ei.depthAtLocation=function(t){return t===ze.EXTERIOR?0:t===ze.INTERIOR?1:Ei.NULL_VALUE};JI.NULL_VALUE.get=function(){return-1};Object.defineProperties(Ei,JI);var sy=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Ra(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ei,this._depthDelta=0,arguments.length===1){var n=arguments[0];e.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var r=new e(n,Fn.toLineLabel(this._label));return r},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(n){this._isIsolated=n},e.prototype.setName=function(n){this._name=n},e.prototype.equals=function(n){var r=this;if(!(n instanceof e))return!1;var i=n;if(this.pts.length!==i.pts.length)return!1;for(var a=!0,c=!0,u=this.pts.length,m=0;m<this.pts.length;m++)if(r.pts[m].equals2D(i.pts[m])||(a=!1),r.pts[m].equals2D(i.pts[--u])||(c=!1),!a&&!c)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},e.prototype.print=function(n){var r=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&n.print(","),n.print(r.pts[i].x+" "+r.pts[i].y);n.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(n){e.updateIM(this._label,n)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(n){var r=this;n.print("edge "+this._name+": ");for(var i=this.pts.length-1;i>=0;i--)n.print(r.pts[i]+" ");n.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new ml(this)),this._mce},e.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new Rt;for(var r=0;r<this.pts.length;r++)n._env.expandToInclude(n.pts[r])}return this._env},e.prototype.addIntersection=function(n,r,i,a){var c=new Re(n.getIntersection(a)),u=r,m=n.getEdgeDistance(i,a),w=u+1;if(w<this.pts.length){var S=this.pts[w];c.equals2D(S)&&(u=w,m=0)}this.eiList.add(c,u,m)},e.prototype.toString=function(){var n=this,r=new da;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&r.append(","),r.append(n.pts[i].x+" "+n.pts[i].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},e.prototype.isPointwiseEqual=function(n){var r=this;if(this.pts.length!==n.pts.length)return!1;for(var i=0;i<this.pts.length;i++)if(!r.pts[i].equals2D(n.pts[i]))return!1;return!0},e.prototype.setDepthDelta=function(n){this._depthDelta=n},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(n,r,i){for(var a=this,c=0;c<n.getIntersectionNum();c++)a.addIntersection(n,r,i,c)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setAtLeastIfValid(n.getLocation(0,st.ON),n.getLocation(1,st.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,st.LEFT),n.getLocation(1,st.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,st.RIGHT),n.getLocation(1,st.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(Ho),Wi=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new As,this._bufParams=t||null};Wi.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};Wi.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(e!==null){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new Fn(t.getLabel()),r.flip()),n.merge(r);var i=Wi.depthDelta(r),a=e.getDepthDelta(),c=a+i;e.setDepthDelta(c)}else this._edgeList.add(t),t.setDepthDelta(Wi.depthDelta(t.getLabel()))};Wi.prototype.buildSubgraphs=function(t,e){for(var n=new mt,r=t.iterator();r.hasNext();){var i=r.next(),a=i.getRightmostCoordinate(),c=new kc(n),u=c.getDepth(a);i.computeDepth(u),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}};Wi.prototype.createSubgraphs=function(t){for(var e=new mt,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Zi;i.create(r),e.add(i)}}return Ms.sort(e,Ms.reverseOrder()),e};Wi.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};Wi.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var e=new r1,n=new Zu;return n.setPrecisionModel(t),e.setSegmentIntersector(new Xo(n)),e};Wi.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;n===null&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new lo(n,this._bufParams),i=new cs(t,e,r),a=i.getCurves();if(a.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(a,n),this._graph=new pr(new KI),this._graph.addEdges(this._edgeList.getEdges());var c=this.createSubgraphs(this._graph),u=new To(this._geomFact);this.buildSubgraphs(c,u);var m=u.getPolygons();if(m.size()<=0)return this.createEmptyResultGeometry();var w=this._geomFact.buildGeometry(m);return w};Wi.prototype.computeNodedEdges=function(t,e){var n=this,r=this.getNoder(e);r.computeNodes(t);for(var i=r.getNodedSubstrings(),a=i.iterator();a.hasNext();){var c=a.next(),u=c.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var m=c.getData(),w=new sy(c.getCoordinates(),new Fn(m));n.insertUniqueEdge(w)}}};Wi.prototype.setNoder=function(t){this._workingNoder=t};Wi.prototype.interfaces_=function(){return[]};Wi.prototype.getClass=function(){return Wi};Wi.depthDelta=function(t){var e=t.getLocation(0,st.LEFT),n=t.getLocation(0,st.RIGHT);return e===ze.INTERIOR&&n===ze.EXTERIOR?1:e===ze.EXTERIOR&&n===ze.INTERIOR?-1:0};Wi.convertSegStrings=function(t){for(var e=new mn,n=new mt;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var Ql=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],a=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};Ql.prototype.rescale=function(){var t=this;if(Ut(arguments[0],jr))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],a=0;a<i.length;a++)i[a].x=i[a].x/t._scaleFactor+t._offsetX,i[a].y=i[a].y/t._scaleFactor+t._offsetY;i.length===2&&i[0].equals2D(i[1])&&Ii.out.println(i)}};Ql.prototype.scale=function(){var t=this;if(Ut(arguments[0],jr)){for(var e=arguments[0],n=new mt,r=e.iterator();r.hasNext();){var i=r.next();n.add(new Ar(t.scale(i.getCoordinates()),i.getData()))}return n}else if(arguments[0]instanceof Array){for(var a=arguments[0],c=new Array(a.length).fill(null),u=0;u<a.length;u++)c[u]=new Re(Math.round((a[u].x-t._offsetX)*t._scaleFactor),Math.round((a[u].y-t._offsetY)*t._scaleFactor),a[u].z);var m=gn.removeRepeatedPoints(c);return m}};Ql.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Ql.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};Ql.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)};Ql.prototype.interfaces_=function(){return[Nu]};Ql.prototype.getClass=function(){return Ql};var la=function(){this._li=new Zu,this._segStrings=null;var t=arguments[0];this._segStrings=t},QI={fact:{configurable:!0}};la.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();t.checkEndPtVertexIntersections(r[0],t._segStrings),t.checkEndPtVertexIntersections(r[r.length-1],t._segStrings)}else if(arguments.length===2){for(var i=arguments[0],a=arguments[1],c=a.iterator();c.hasNext();)for(var u=c.next(),m=u.getCoordinates(),w=1;w<m.length-1;w++)if(m[w].equals(i))throw new hl("found endpt/interior pt intersection at index "+w+" :pt "+i)}};la.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var i=r.next();t.checkInteriorIntersections(n,i)}else if(arguments.length===2)for(var a=arguments[0],c=arguments[1],u=a.getCoordinates(),m=c.getCoordinates(),w=0;w<u.length-1;w++)for(var S=0;S<m.length-1;S++)t.checkInteriorIntersections(a,w,c,S);else if(arguments.length===4){var E=arguments[0],P=arguments[1],D=arguments[2],k=arguments[3];if(E===D&&P===k)return null;var V=E.getCoordinates()[P],j=E.getCoordinates()[P+1],te=D.getCoordinates()[k],U=D.getCoordinates()[k+1];if(this._li.computeIntersection(V,j,te,U),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,V,j)||this.hasInteriorIntersection(this._li,te,U)))throw new hl("found non-noded intersection at "+V+"-"+j+" and "+te+"-"+U)}};la.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};la.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],i=r.getCoordinates(),a=0;a<i.length-2;a++)t.checkCollapse(i[a],i[a+1],i[a+2])};la.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!(i.equals(e)||i.equals(n)))return!0}return!1};la.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new hl("found non-noded collapse at "+la.fact.createLineString([t,e,n]))};la.prototype.interfaces_=function(){return[]};la.prototype.getClass=function(){return la};QI.fact.get=function(){return new mn};Object.defineProperties(la,QI);var uo=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new ar("Scale factor must be non-zero");e!==1&&(this._pt=new Re(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new Re,this._p1Scaled=new Re),this.initCorners(this._pt)},$I={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};uo.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),a=Math.max(t.y,e.y),c=this._maxx<n||this._minx>r||this._maxy<i||this._miny>a;if(c)return!1;var u=this.intersectsToleranceSquare(t,e);return on.isTrue(!(c&&u),"Found bad envelope test"),u};uo.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new Re(this._maxx,this._maxy),this._corner[1]=new Re(this._minx,this._maxy),this._corner[2]=new Re(this._minx,this._miny),this._corner[3]=new Re(this._maxx,this._miny)};uo.prototype.intersects=function(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};uo.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};uo.prototype.getCoordinate=function(){return this._originalPt};uo.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)};uo.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=uo.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Rt(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};uo.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))};uo.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||n&&r||t.equals(this._pt)||e.equals(this._pt))};uo.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return this.intersects(n,r)?(t.addIntersection(this.getCoordinate(),e),!0):!1};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};$I.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(uo,$I);var Rd=function(){this.tempEnv1=new Rt,this.selectedSegment=new Nt};Rd.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}};Rd.prototype.interfaces_=function(){return[]};Rd.prototype.getClass=function(){return Rd};var Lf=function(){this._index=null;var t=arguments[0];this._index=t},eC={HotPixelSnapAction:{configurable:!0}};Lf.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),a=new tC(e,n,r);return this._index.query(i,{interfaces_:function(){return[Yl]},visitItem:function(c){var u=c;u.select(i,a)}}),a.isNodeAdded()}};Lf.prototype.interfaces_=function(){return[]};Lf.prototype.getClass=function(){return Lf};eC.HotPixelSnapAction.get=function(){return tC};Object.defineProperties(Lf,eC);var tC=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],i=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1],i=n.getContext();if(this._parentEdge!==null&&i===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,r)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Rd),Dc=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new mt};Dc.prototype.processIntersections=function(t,e,n,r){var i=this;if(t===n&&e===r)return null;var a=t.getCoordinates()[e],c=t.getCoordinates()[e+1],u=n.getCoordinates()[r],m=n.getCoordinates()[r+1];if(this._li.computeIntersection(a,c,u,m),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)i._interiorIntersections.add(i._li.getIntersection(w));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}};Dc.prototype.isDone=function(){return!1};Dc.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Dc.prototype.interfaces_=function(){return[zu]};Dc.prototype.getClass=function(){return Dc};var Na=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Zu,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};Na.prototype.checkCorrectness=function(t){var e=Ar.getNodedSubstrings(t),n=new la(e);try{n.checkValid()}catch(r){if(r instanceof FI)r.printStackTrace();else throw r}finally{}};Na.prototype.getNodedSubstrings=function(){return Ar.getNodedSubstrings(this._nodedSegStrings)};Na.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)};Na.prototype.findInteriorIntersections=function(t,e){var n=new Dc(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()};Na.prototype.computeVertexSnaps=function(){var t=this;if(Ut(arguments[0],jr))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.computeVertexSnaps(r)}else if(arguments[0]instanceof Ar)for(var i=arguments[0],a=i.getCoordinates(),c=0;c<a.length;c++){var u=new uo(a[c],t._scaleFactor,t._li),m=t._pointSnapper.snap(u,i,c);m&&i.addIntersection(a[c],c)}};Na.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new r1,this._pointSnapper=new Lf(this._noder.getIndex()),this.snapRound(t,this._li)};Na.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=new uo(r,e._scaleFactor,e._li);e._pointSnapper.snap(i)}};Na.prototype.interfaces_=function(){return[Nu]};Na.prototype.getClass=function(){return Na};var wi=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Pn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},Wf={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};wi.prototype.bufferFixedPrecision=function(t){var e=new Ql(new Na(new Mn(1)),t.getScale()),n=new Wi(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)};wi.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var e=wi.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(a){if(a instanceof pl)t._saveException=a;else throw a}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],r=wi.precisionScaleFactor(this._argGeom,this._distance,n),i=new Mn(r);this.bufferFixedPrecision(i)}};wi.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===Mn.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};wi.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};wi.prototype.bufferOriginalPrecision=function(){try{var t=new Wi(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(e){if(e instanceof hl)this._saveException=e;else throw e}finally{}};wi.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};wi.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};wi.bufferOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new wi(t),r=n.getResultGeometry(e);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Vt&&typeof arguments[1]=="number"){var i=arguments[0],a=arguments[1],c=arguments[2],u=new wi(i);u.setQuadrantSegments(c);var m=u.getResultGeometry(a);return m}else if(arguments[2]instanceof Pn&&arguments[0]instanceof Vt&&typeof arguments[1]=="number"){var w=arguments[0],S=arguments[1],E=arguments[2],P=new wi(w,E),D=P.getResultGeometry(S);return D}}else if(arguments.length===4){var k=arguments[0],V=arguments[1],j=arguments[2],te=arguments[3],U=new wi(k);U.setQuadrantSegments(j),U.setEndCapStyle(te);var W=U.getResultGeometry(V);return W}};wi.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=Wo.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),a=e>0?e:0,c=i+2*a,u=Math.trunc(Math.log(c)/Math.log(10)+1),m=n-u,w=Math.pow(10,m);return w};Wf.CAP_ROUND.get=function(){return Pn.CAP_ROUND};Wf.CAP_BUTT.get=function(){return Pn.CAP_FLAT};Wf.CAP_FLAT.get=function(){return Pn.CAP_FLAT};Wf.CAP_SQUARE.get=function(){return Pn.CAP_SQUARE};Wf.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(wi,Wf);var Gi=function(){this._pt=[new Re,new Re],this._distance=Xt.NaN,this._isNull=!0};Gi.prototype.getCoordinates=function(){return this._pt};Gi.prototype.getCoordinate=function(t){return this._pt[t]};Gi.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};Gi.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};Gi.prototype.getDistance=function(){return this._distance};Gi.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};Gi.prototype.interfaces_=function(){return[]};Gi.prototype.getClass=function(){return Gi};var Ea=function(){};Ea.prototype.interfaces_=function(){return[]};Ea.prototype.getClass=function(){return Ea};Ea.computeDistance=function(){if(arguments[2]instanceof Gi&&arguments[0]instanceof br&&arguments[1]instanceof Re)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new Nt,a=0;a<r.length-1;a++){i.setCoordinates(r[a],r[a+1]);var c=i.closestPoint(e);n.setMinimum(c,e)}else if(arguments[2]instanceof Gi&&arguments[0]instanceof Xr&&arguments[1]instanceof Re){var u=arguments[0],m=arguments[1],w=arguments[2];Ea.computeDistance(u.getExteriorRing(),m,w);for(var S=0;S<u.getNumInteriorRing();S++)Ea.computeDistance(u.getInteriorRingN(S),m,w)}else if(arguments[2]instanceof Gi&&arguments[0]instanceof Vt&&arguments[1]instanceof Re){var E=arguments[0],P=arguments[1],D=arguments[2];if(E instanceof br)Ea.computeDistance(E,P,D);else if(E instanceof Xr)Ea.computeDistance(E,P,D);else if(E instanceof Hi)for(var k=E,V=0;V<k.getNumGeometries();V++){var j=k.getGeometryN(V);Ea.computeDistance(j,P,D)}else D.setMinimum(E.getCoordinate(),P)}else if(arguments[2]instanceof Gi&&arguments[0]instanceof Nt&&arguments[1]instanceof Re){var te=arguments[0],U=arguments[1],W=arguments[2],Y=te.closestPoint(U);W.setMinimum(Y,U)}};var Bu=function(t){this._maxPtDist=new Gi,this._inputGeom=t||null},i1={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Bu.prototype.computeMaxMidpointDistance=function(t){var e=new $l(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};Bu.prototype.computeMaxVertexDistance=function(t){var e=new Rc(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};Bu.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};Bu.prototype.getDistancePoints=function(){return this._maxPtDist};Bu.prototype.interfaces_=function(){return[]};Bu.prototype.getClass=function(){return Bu};i1.MaxPointDistanceFilter.get=function(){return Rc};i1.MaxMidpointDistanceFilter.get=function(){return $l};Object.defineProperties(Bu,i1);var Rc=function(t){this._maxPtDist=new Gi,this._minPtDist=new Gi,this._geom=t||null};Rc.prototype.filter=function(t){this._minPtDist.initialize(),Ea.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Rc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Rc.prototype.interfaces_=function(){return[Ma]};Rc.prototype.getClass=function(){return Rc};var $l=function(t){this._maxPtDist=new Gi,this._minPtDist=new Gi,this._geom=t||null};$l.prototype.filter=function(t,e){if(e===0)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new Re((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),Ea.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};$l.prototype.isDone=function(){return!1};$l.prototype.isGeometryChanged=function(){return!1};$l.prototype.getMaxPointDistance=function(){return this._maxPtDist};$l.prototype.interfaces_=function(){return[Ls]};$l.prototype.getClass=function(){return $l};var ll=function(t){this._comps=t||null};ll.prototype.filter=function(t){t instanceof Xr&&this._comps.add(t)};ll.prototype.interfaces_=function(){return[ra]};ll.prototype.getClass=function(){return ll};ll.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return ll.getPolygons(t,new mt)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof Xr?n.add(e):e instanceof Hi&&e.apply(new ll(n)),n}};var xi=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};xi.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof Aa){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof br&&this._lines.add(t)};xi.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};xi.prototype.interfaces_=function(){return[fl]};xi.prototype.getClass=function(){return xi};xi.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(xi.getLines(t))}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(xi.getLines(e,n))}};xi.getLines=function(){if(arguments.length===1){var t=arguments[0];return xi.getLines(t,!1)}else if(arguments.length===2){if(Ut(arguments[0],jr)&&Ut(arguments[1],jr)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();xi.getLines(i,n)}return n}else if(arguments[0]instanceof Vt&&typeof arguments[1]=="boolean"){var a=arguments[0],c=arguments[1],u=new mt;return a.apply(new xi(u,c)),u}else if(arguments[0]instanceof Vt&&Ut(arguments[1],jr)){var m=arguments[0],w=arguments[1];return m instanceof br?w.add(m):m.apply(new xi(w)),w}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&Ut(arguments[0],jr)&&Ut(arguments[1],jr)){for(var S=arguments[0],E=arguments[1],P=arguments[2],D=S.iterator();D.hasNext();){var k=D.next();xi.getLines(k,E,P)}return E}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Vt&&Ut(arguments[1],jr)){var V=arguments[0],j=arguments[1],te=arguments[2];return V.apply(new xi(j,te)),j}}};var ks=function(){if(this._boundaryRule=ls.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t===null)throw new ar("Rule must be non-null");this._boundaryRule=t}};ks.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof Re&&arguments[1]instanceof Xr){var e=arguments[0],n=arguments[1];if(n.isEmpty())return ze.EXTERIOR;var r=n.getExteriorRing(),i=this.locateInPolygonRing(e,r);if(i===ze.EXTERIOR)return ze.EXTERIOR;if(i===ze.BOUNDARY)return ze.BOUNDARY;for(var a=0;a<n.getNumInteriorRing();a++){var c=n.getInteriorRingN(a),u=t.locateInPolygonRing(e,c);if(u===ze.INTERIOR)return ze.EXTERIOR;if(u===ze.BOUNDARY)return ze.BOUNDARY}return ze.INTERIOR}else if(arguments[0]instanceof Re&&arguments[1]instanceof br){var m=arguments[0],w=arguments[1];if(!w.getEnvelopeInternal().intersects(m))return ze.EXTERIOR;var S=w.getCoordinates();return!w.isClosed()&&(m.equals(S[0])||m.equals(S[S.length-1]))?ze.BOUNDARY:xt.isOnLine(m,S)?ze.INTERIOR:ze.EXTERIOR}else if(arguments[0]instanceof Re&&arguments[1]instanceof Co){var E=arguments[0],P=arguments[1],D=P.getCoordinate();return D.equals2D(E)?ze.INTERIOR:ze.EXTERIOR}};ks.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?xt.locatePointInRing(t,e.getCoordinates()):ze.EXTERIOR};ks.prototype.intersects=function(t,e){return this.locate(t,e)!==ze.EXTERIOR};ks.prototype.updateLocationInfo=function(t){t===ze.INTERIOR&&(this._isIn=!0),t===ze.BOUNDARY&&this._numBoundaries++};ks.prototype.computeLocation=function(t,e){var n=this;if(e instanceof Co&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof br)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Xr)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Ru)for(var r=e,i=0;i<r.getNumGeometries();i++){var a=r.getGeometryN(i);n.updateLocationInfo(n.locateInternal(t,a))}else if(e instanceof Ta)for(var c=e,u=0;u<c.getNumGeometries();u++){var m=c.getGeometryN(u);n.updateLocationInfo(n.locateInternal(t,m))}else if(e instanceof Hi)for(var w=new La(e);w.hasNext();){var S=w.next();S!==e&&n.computeLocation(t,S)}};ks.prototype.locate=function(t,e){return e.isEmpty()?ze.EXTERIOR:e instanceof br?this.locateInternal(t,e):e instanceof Xr?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?ze.BOUNDARY:this._numBoundaries>0||this._isIn?ze.INTERIOR:ze.EXTERIOR)};ks.prototype.interfaces_=function(){return[]};ks.prototype.getClass=function(){return ks};var qi=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._component=r,this._segIndex=i,this._pt=a}},nC={INSIDE_AREA:{configurable:!0}};qi.prototype.isInsideArea=function(){return this._segIndex===qi.INSIDE_AREA};qi.prototype.getCoordinate=function(){return this._pt};qi.prototype.getGeometryComponent=function(){return this._component};qi.prototype.getSegmentIndex=function(){return this._segIndex};qi.prototype.interfaces_=function(){return[]};qi.prototype.getClass=function(){return qi};nC.INSIDE_AREA.get=function(){return-1};Object.defineProperties(qi,nC);var Wl=function(t){this._pts=t||null};Wl.prototype.filter=function(t){t instanceof Co&&this._pts.add(t)};Wl.prototype.interfaces_=function(){return[ra]};Wl.prototype.getClass=function(){return Wl};Wl.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof Co?Ms.singletonList(t):Wl.getPoints(t,new mt)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof Co?n.add(e):e instanceof Hi&&e.apply(new Wl(n)),n}};var Nc=function(){this._locations=null;var t=arguments[0];this._locations=t};Nc.prototype.filter=function(t){(t instanceof Co||t instanceof br||t instanceof Xr)&&this._locations.add(new qi(t,0,t.getCoordinate()))};Nc.prototype.interfaces_=function(){return[ra]};Nc.prototype.getClass=function(){return Nc};Nc.getLocations=function(t){var e=new mt;return t.apply(new Nc(e)),e};var Ci=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new ks,this._minDistanceLocation=null,this._minDistance=Xt.MAX_VALUE,arguments.length===2){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Ci.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=1-n,a=ll.getPolygons(this._geom[n]);if(a.size()>0){var c=Nc.getLocations(this._geom[i]);if(this.computeContainmentDistance(c,a,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&Ut(arguments[0],Cs)&&Ut(arguments[1],Cs)){for(var u=arguments[0],m=arguments[1],w=arguments[2],S=0;S<u.size();S++)for(var E=u.get(S),P=0;P<m.size();P++)if(t.computeContainmentDistance(E,m.get(P),w),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof qi&&arguments[1]instanceof Xr){var D=arguments[0],k=arguments[1],V=arguments[2],j=D.getCoordinate();if(ze.EXTERIOR!==this._ptLocator.locate(j,k))return this._minDistance=0,V[0]=D,V[1]=new qi(k,j),null}}};Ci.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),c=0;c<e.size();c++){var u=e.get(c);if(r.computeMinDistance(a,u,n),r._minDistance<=r._terminateDistance)return null}};Ci.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=xi.getLines(this._geom[0]),n=xi.getLines(this._geom[1]),r=Wl.getPoints(this._geom[0]),i=Wl.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),this.updateMinDistance(t,!1)};Ci.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Ci.prototype.updateMinDistance=function(t,e){if(t[0]===null)return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};Ci.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};Ci.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof br&&arguments[1]instanceof Co){var e=arguments[0],n=arguments[1],r=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),a=n.getCoordinate(),c=0;c<i.length-1;c++){var u=xt.distancePointLine(a,i[c],i[c+1]);if(u<t._minDistance){t._minDistance=u;var m=new Nt(i[c],i[c+1]),w=m.closestPoint(a);r[0]=new qi(e,c,w),r[1]=new qi(n,0,a)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof br&&arguments[1]instanceof br){var S=arguments[0],E=arguments[1],P=arguments[2];if(S.getEnvelopeInternal().distance(E.getEnvelopeInternal())>this._minDistance)return null;for(var D=S.getCoordinates(),k=E.getCoordinates(),V=0;V<D.length-1;V++)for(var j=0;j<k.length-1;j++){var te=xt.distanceLineLine(D[V],D[V+1],k[j],k[j+1]);if(te<t._minDistance){t._minDistance=te;var U=new Nt(D[V],D[V+1]),W=new Nt(k[j],k[j+1]),Y=U.closestPoints(W);P[0]=new qi(S,V,Y[0]),P[1]=new qi(E,j,Y[1])}if(t._minDistance<=t._terminateDistance)return null}}}};Ci.prototype.computeMinDistancePoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),c=0;c<e.size();c++){var u=e.get(c),m=a.getCoordinate().distance(u.getCoordinate());if(m<r._minDistance&&(r._minDistance=m,n[0]=new qi(a,0,a.getCoordinate()),n[1]=new qi(u,0,u.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};Ci.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new ar("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Ci.prototype.computeMinDistanceLines=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),c=0;c<e.size();c++){var u=e.get(c);if(r.computeMinDistance(a,u,n),r._minDistance<=r._terminateDistance)return null}};Ci.prototype.interfaces_=function(){return[]};Ci.prototype.getClass=function(){return Ci};Ci.distance=function(t,e){var n=new Ci(t,e);return n.distance()};Ci.isWithinDistance=function(t,e,n){var r=new Ci(t,e,n);return r.distance()<=n};Ci.nearestPoints=function(t,e){var n=new Ci(t,e);return n.nearestPoints()};var Ai=function(){this._pt=[new Re,new Re],this._distance=Xt.NaN,this._isNull=!0};Ai.prototype.getCoordinates=function(){return this._pt};Ai.prototype.getCoordinate=function(t){return this._pt[t]};Ai.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};Ai.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};Ai.prototype.toString=function(){return Ts.toLineString(this._pt[0],this._pt[1])};Ai.prototype.getDistance=function(){return this._distance};Ai.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};Ai.prototype.interfaces_=function(){return[]};Ai.prototype.getClass=function(){return Ai};var Ks=function(){};Ks.prototype.interfaces_=function(){return[]};Ks.prototype.getClass=function(){return Ks};Ks.computeDistance=function(){if(arguments[2]instanceof Ai&&arguments[0]instanceof br&&arguments[1]instanceof Re)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new Nt,i=t.getCoordinates(),a=0;a<i.length-1;a++){r.setCoordinates(i[a],i[a+1]);var c=r.closestPoint(e);n.setMinimum(c,e)}else if(arguments[2]instanceof Ai&&arguments[0]instanceof Xr&&arguments[1]instanceof Re){var u=arguments[0],m=arguments[1],w=arguments[2];Ks.computeDistance(u.getExteriorRing(),m,w);for(var S=0;S<u.getNumInteriorRing();S++)Ks.computeDistance(u.getInteriorRingN(S),m,w)}else if(arguments[2]instanceof Ai&&arguments[0]instanceof Vt&&arguments[1]instanceof Re){var E=arguments[0],P=arguments[1],D=arguments[2];if(E instanceof br)Ks.computeDistance(E,P,D);else if(E instanceof Xr)Ks.computeDistance(E,P,D);else if(E instanceof Hi)for(var k=E,V=0;V<k.getNumGeometries();V++){var j=k.getGeometryN(V);Ks.computeDistance(j,P,D)}else D.setMinimum(E.getCoordinate(),P)}else if(arguments[2]instanceof Ai&&arguments[0]instanceof Nt&&arguments[1]instanceof Re){var te=arguments[0],U=arguments[1],W=arguments[2],Y=te.closestPoint(U);W.setMinimum(Y,U)}};var ss=function(){this._g0=null,this._g1=null,this._ptDist=new Ai,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},o1={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};ss.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};ss.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new ar("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};ss.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)};ss.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};ss.prototype.computeOrientedDistance=function(t,e,n){var r=new Oc(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new eu(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}};ss.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};ss.prototype.interfaces_=function(){return[]};ss.prototype.getClass=function(){return ss};ss.distance=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new ss(t,e);return n.distance()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],c=new ss(r,i);return c.setDensifyFraction(a),c.distance()}};o1.MaxPointDistanceFilter.get=function(){return Oc};o1.MaxDensifiedByFractionDistanceFilter.get=function(){return eu};Object.defineProperties(ss,o1);var Oc=function(){this._maxPtDist=new Ai,this._minPtDist=new Ai,this._euclideanDist=new Ks,this._geom=null;var t=arguments[0];this._geom=t};Oc.prototype.filter=function(t){this._minPtDist.initialize(),Ks.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Oc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Oc.prototype.interfaces_=function(){return[Ma]};Oc.prototype.getClass=function(){return Oc};var eu=function(){this._maxPtDist=new Ai,this._minPtDist=new Ai,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};eu.prototype.filter=function(t,e){var n=this;if(e===0)return null;for(var r=t.getCoordinate(e-1),i=t.getCoordinate(e),a=(i.x-r.x)/this._numSubSegs,c=(i.y-r.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var m=r.x+u*a,w=r.y+u*c,S=new Re(m,w);n._minPtDist.initialize(),Ks.computeDistance(n._geom,S,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};eu.prototype.isDone=function(){return!1};eu.prototype.isGeometryChanged=function(){return!1};eu.prototype.getMaxPointDistance=function(){return this._maxPtDist};eu.prototype.interfaces_=function(){return[Ls]};eu.prototype.getClass=function(){return eu};var So=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},s1={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};So.prototype.checkMaximumDistance=function(t,e,n){var r=new ss(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Ts.toLineString(i[0],i[1])+")"}};So.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=So.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),So.VERBOSE&&Ii.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};So.prototype.checkNegativeValid=function(){if(!(this._input instanceof Xr||this._input instanceof Ta||this._input instanceof Hi))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};So.prototype.getErrorIndicator=function(){return this._errorIndicator};So.prototype.checkMinimumDistance=function(t,e,n){var r=new Ci(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Ts.toLineString(i[0],i[1])+" )"}};So.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};So.prototype.getErrorLocation=function(){return this._errorLocation};So.prototype.getPolygonLines=function(t){for(var e=new mt,n=new xi(e),r=ll.getPolygons(t),i=r.iterator();i.hasNext();){var a=i.next();a.apply(n)}return t.getFactory().buildGeometry(e)};So.prototype.getErrorMessage=function(){return this._errMsg};So.prototype.interfaces_=function(){return[]};So.prototype.getClass=function(){return So};s1.VERBOSE.get=function(){return!1};s1.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(So,s1);var Ti=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},a1={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Ti.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Ti.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Ti.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var e=new Rt(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new Rt(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Ti.prototype.checkDistance=function(){var t=new So(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};Ti.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Ti.prototype.checkPolygonal=function(){this._result instanceof Xr||this._result instanceof Ta||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Ti.prototype.getErrorIndicator=function(){return this._errorIndicator};Ti.prototype.getErrorLocation=function(){return this._errorLocation};Ti.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Ti.prototype.report=function(t){if(!Ti.VERBOSE)return null;Ii.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};Ti.prototype.getErrorMessage=function(){return this._errorMsg};Ti.prototype.interfaces_=function(){return[]};Ti.prototype.getClass=function(){return Ti};Ti.isValidMsg=function(t,e,n){var r=new Ti(t,e,n);return r.isValid()?null:r.getErrorMessage()};Ti.isValid=function(t,e,n){var r=new Ti(t,e,n);return!!r.isValid()};a1.VERBOSE.get=function(){return!1};a1.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Ti,a1);var ua=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};ua.prototype.getCoordinates=function(){return this._pts};ua.prototype.size=function(){return this._pts.length};ua.prototype.getCoordinate=function(t){return this._pts[t]};ua.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};ua.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:Ac.octant(this.getCoordinate(t),this.getCoordinate(t+1))};ua.prototype.setData=function(t){this._data=t};ua.prototype.getData=function(){return this._data};ua.prototype.toString=function(){return Ts.toLineString(new Lr(this._pts))};ua.prototype.interfaces_=function(){return[Da]};ua.prototype.getClass=function(){return ua};var _i=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new mt,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};_i.prototype.getInteriorIntersection=function(){return this._interiorIntersection};_i.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};_i.prototype.getIntersectionSegments=function(){return this._intSegments};_i.prototype.count=function(){return this._intersectionCount};_i.prototype.getIntersections=function(){return this._intersections};_i.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};_i.prototype.setKeepIntersections=function(t){this._keepIntersections=t};_i.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection()||t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly){var i=this.isEndSegment(t,e)||this.isEndSegment(n,r);if(!i)return null}var a=t.getCoordinates()[e],c=t.getCoordinates()[e+1],u=n.getCoordinates()[r],m=n.getCoordinates()[r+1];this._li.computeIntersection(a,c,u,m),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=c,this._intSegments[2]=u,this._intSegments[3]=m,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};_i.prototype.isEndSegment=function(t,e){return e===0||e>=t.size()-2};_i.prototype.hasIntersection=function(){return this._interiorIntersection!==null};_i.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};_i.prototype.interfaces_=function(){return[zu]};_i.prototype.getClass=function(){return _i};_i.createAllIntersectionsFinder=function(t){var e=new _i(t);return e.setFindAllIntersections(!0),e};_i.createAnyIntersectionFinder=function(t){return new _i(t)};_i.createIntersectionCounter=function(t){var e=new _i(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Ds=function(){this._li=new Zu,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};Ds.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Ds.prototype.getIntersections=function(){return this._segInt.getIntersections()};Ds.prototype.isValid=function(){return this.execute(),this._isValid};Ds.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};Ds.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new _i(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new r1;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Ds.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new pl(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Ds.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Ts.toLineString(t[0],t[1])+" and "+Ts.toLineString(t[2],t[3])};Ds.prototype.interfaces_=function(){return[]};Ds.prototype.getClass=function(){return Ds};Ds.computeIntersections=function(t){var e=new Ds(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Vu=function t(){this._nv=null;var e=arguments[0];this._nv=new Ds(t.toSegmentStrings(e))};Vu.prototype.checkValid=function(){this._nv.checkValid()};Vu.prototype.interfaces_=function(){return[]};Vu.prototype.getClass=function(){return Vu};Vu.toSegmentStrings=function(t){for(var e=new mt,n=t.iterator();n.hasNext();){var r=n.next();e.add(new ua(r.getCoordinates(),r))}return e};Vu.checkValid=function(t){var e=new Vu(t);e.checkValid()};var zc=function(t){this._mapOp=t};zc.prototype.map=function(t){for(var e=this,n=new mt,r=0;r<t.getNumGeometries();r++){var i=e._mapOp.map(t.getGeometryN(r));i.isEmpty()||n.add(i)}return t.getFactory().createGeometryCollection(mn.toGeometryArray(n))};zc.prototype.interfaces_=function(){return[]};zc.prototype.getClass=function(){return zc};zc.map=function(t,e){var n=new zc(e);return n.map(t)};var ca=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new mt,this._resultLineList=new mt;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};ca.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();e.collectLineEdge(r,t,e._lineEdgesList),e.collectBoundaryTouchEdge(r,t,e._lineEdgesList)}};ca.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)};ca.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};ca.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&!t.isVisited()&&en.isResultOfOp(r,e)&&!i.isCovered()&&(n.add(i),t.setVisitedEdge(!0))};ca.prototype.findCoveredLineEdges=function(){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();n.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var i=r.next(),a=i.getEdge();if(i.isLineEdge()&&!a.isCoveredSet()){var c=t._op.isCoveredByA(i.getCoordinate());a.setCovered(c)}}};ca.prototype.labelIsolatedLines=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();r.isIsolated()&&(i.isNull(0)?e.labelIsolatedLine(r,0):e.labelIsolatedLine(r,1))}};ca.prototype.buildLines=function(t){for(var e=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),i=e._geometryFactory.createLineString(r.getCoordinates());e._resultLineList.add(i),r.setInResult(!0)}};ca.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;on.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),en.isResultOfOp(r,e)&&e===en.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))};ca.prototype.interfaces_=function(){return[]};ca.prototype.getClass=function(){return ca};var Fc=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new mt;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Fc.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}};Fc.prototype.extractNonCoveredResultNodes=function(t){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||t===en.INTERSECTION)){var i=r.getLabel();en.isResultOfOp(i,t)&&e.filterCoveredNodeToPoint(r)}}};Fc.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};Fc.prototype.interfaces_=function(){return[]};Fc.prototype.getClass=function(){return Fc};var co=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};co.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};co.prototype.transformPolygon=function(t,e){var n=this,r=!0,i=this.transformLinearRing(t.getExteriorRing(),t);(i===null||!(i instanceof Aa)||i.isEmpty())&&(r=!1);for(var a=new mt,c=0;c<t.getNumInteriorRing();c++){var u=n.transformLinearRing(t.getInteriorRingN(c),t);u===null||u.isEmpty()||(u instanceof Aa||(r=!1),a.add(u))}if(r)return this._factory.createPolygon(i,a.toArray([]));var m=new mt;return i!==null&&m.add(i),m.addAll(a),this._factory.buildGeometry(m)};co.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};co.prototype.getInputGeometry=function(){return this._inputGeom};co.prototype.transformMultiLineString=function(t,e){for(var n=this,r=new mt,i=0;i<t.getNumGeometries();i++){var a=n.transformLineString(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};co.prototype.transformCoordinates=function(t,e){return this.copy(t)};co.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};co.prototype.transformMultiPoint=function(t,e){for(var n=this,r=new mt,i=0;i<t.getNumGeometries();i++){var a=n.transformPoint(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};co.prototype.transformMultiPolygon=function(t,e){for(var n=this,r=new mt,i=0;i<t.getNumGeometries();i++){var a=n.transformPolygon(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};co.prototype.copy=function(t){return t.copy()};co.prototype.transformGeometryCollection=function(t,e){for(var n=this,r=new mt,i=0;i<t.getNumGeometries();i++){var a=n.transform(t.getGeometryN(i));a!==null&&(n._pruneEmptyGeometry&&a.isEmpty()||r.add(a))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(mn.toGeometryArray(r)):this._factory.buildGeometry(r)};co.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Co)return this.transformPoint(t,null);if(t instanceof Sf)return this.transformMultiPoint(t,null);if(t instanceof Aa)return this.transformLinearRing(t,null);if(t instanceof br)return this.transformLineString(t,null);if(t instanceof Ru)return this.transformMultiLineString(t,null);if(t instanceof Xr)return this.transformPolygon(t,null);if(t instanceof Ta)return this.transformMultiPolygon(t,null);if(t instanceof Hi)return this.transformGeometryCollection(t,null);throw new ar("Unknown Geometry subtype: "+t.getClass().getName())};co.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(n===null)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};co.prototype.interfaces_=function(){return[]};co.prototype.getClass=function(){return co};var Oa=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Nt,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof br&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};Oa.prototype.snapVertices=function(t,e){for(var n=this,r=this._isClosed?t.size()-1:t.size(),i=0;i<r;i++){var a=t.get(i),c=n.findSnapForVertex(a,e);c!==null&&(t.set(i,new Re(c)),i===0&&n._isClosed&&t.set(t.size()-1,new Re(c)))}};Oa.prototype.findSnapForVertex=function(t,e){for(var n=this,r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<n._snapTolerance)return e[r]}return null};Oa.prototype.snapTo=function(t){var e=new Hd(this._srcPts);this.snapVertices(e,t),this.snapSegments(e,t);var n=e.toCoordinateArray();return n};Oa.prototype.snapSegments=function(t,e){var n=this;if(e.length===0)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var i=0;i<r;i++){var a=e[i],c=n.findSegmentIndexToSnap(a,t);c>=0&&t.add(c+1,new Re(a),!1)}};Oa.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,r=Xt.MAX_VALUE,i=-1,a=0;a<e.size()-1;a++){if(n._seg.p0=e.get(a),n._seg.p1=e.get(a+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var c=n._seg.distance(t);c<n._snapTolerance&&c<r&&(r=c,i=a)}return i};Oa.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};Oa.prototype.interfaces_=function(){return[]};Oa.prototype.getClass=function(){return Oa};Oa.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var Pr=function(t){this._srcGeom=t||null},rC={SNAP_PRECISION_FACTOR:{configurable:!0}};Pr.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t),r=new iC(e,n);return r.transform(this._srcGeom)};Pr.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new iC(t,n,!0),i=r.transform(this._srcGeom),a=i;return e&&Ut(a,Xl)&&(a=i.buffer(0)),a};Pr.prototype.computeSnapTolerance=function(t){var e=this.computeMinimumSegmentLength(t),n=e/10;return n};Pr.prototype.extractTargetCoordinates=function(t){for(var e=new na,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))};Pr.prototype.computeMinimumSegmentLength=function(t){for(var e=Xt.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e};Pr.prototype.interfaces_=function(){return[]};Pr.prototype.getClass=function(){return Pr};Pr.snap=function(t,e,n){var r=new Array(2).fill(null),i=new Pr(t);r[0]=i.snapTo(e,n);var a=new Pr(e);return r[1]=a.snapTo(r[0],n),r};Pr.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],e=Pr.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===Mn.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return Math.min(Pr.computeOverlaySnapTolerance(i),Pr.computeOverlaySnapTolerance(a))}};Pr.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal(),n=Math.min(e.getHeight(),e.getWidth()),r=n*Pr.SNAP_PRECISION_FACTOR;return r};Pr.snapToSelf=function(t,e,n){var r=new Pr(t);return r.snapToSelf(e,n)};rC.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Pr,rC);var iC=function(t){function e(n,r,i){t.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=i!==void 0?i:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(n,r){var i=new Oa(n,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(r)},e.prototype.transformCoordinates=function(n,r){var i=n.toCoordinateArray(),a=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(a)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(co),Ui=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Ui.prototype.getCommon=function(){return Xt.longBitsToDouble(this._commonBits)};Ui.prototype.add=function(t){var e=Xt.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=Ui.signExpBits(this._commonBits),this._isFirst=!1,null;var n=Ui.signExpBits(e);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Ui.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=Ui.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Ui.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],e=Xt.longBitsToDouble(t),n=Xt.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,i=r.substring(r.length-64),a=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]";return a}};Ui.prototype.interfaces_=function(){return[]};Ui.prototype.getClass=function(){return Ui};Ui.getBit=function(t,e){var n=1<<e;return t&n?1:0};Ui.signExpBits=function(t){return t>>52};Ui.zeroLowerBits=function(t,e){var n=(1<<e)-1,r=~n,i=t&r;return i};Ui.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(Ui.getBit(t,r)!==Ui.getBit(e,r))return n;n++}return 52};var tu=function(){this._commonCoord=null,this._ccFilter=new Bc},l1={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};tu.prototype.addCommonBits=function(t){var e=new nu(this._commonCoord);t.apply(e),t.geometryChanged()};tu.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var e=new Re(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new nu(e);return t.apply(n),t.geometryChanged(),t};tu.prototype.getCommonCoordinate=function(){return this._commonCoord};tu.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};tu.prototype.interfaces_=function(){return[]};tu.prototype.getClass=function(){return tu};l1.CommonCoordinateFilter.get=function(){return Bc};l1.Translater.get=function(){return nu};Object.defineProperties(tu,l1);var Bc=function(){this._commonBitsX=new Ui,this._commonBitsY=new Ui};Bc.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};Bc.prototype.getCommonCoordinate=function(){return new Re(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Bc.prototype.interfaces_=function(){return[Ma]};Bc.prototype.getClass=function(){return Bc};var nu=function(){this.trans=null;var t=arguments[0];this.trans=t};nu.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)};nu.prototype.isDone=function(){return!1};nu.prototype.isGeometryChanged=function(){return!0};nu.prototype.interfaces_=function(){return[Ls]};nu.prototype.getClass=function(){return nu};var vi=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};vi.prototype.selfSnap=function(t){var e=new Pr(t),n=e.snapTo(t,this._snapTolerance);return n};vi.prototype.removeCommonBits=function(t){this._cbr=new tu,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e};vi.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};vi.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=en.overlayOp(e[0],e[1],t);return this.prepareResult(n)};vi.prototype.checkValid=function(t){t.isValid()||Ii.out.println("Snapped geometry is invalid")};vi.prototype.computeSnapTolerance=function(){this._snapTolerance=Pr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};vi.prototype.snap=function(t){var e=this.removeCommonBits(t),n=Pr.snap(e[0],e[1],this._snapTolerance);return n};vi.prototype.interfaces_=function(){return[]};vi.prototype.getClass=function(){return vi};vi.overlayOp=function(t,e,n){var r=new vi(t,e);return r.getResultGeometry(n)};vi.union=function(t,e){return vi.overlayOp(t,e,en.UNION)};vi.intersection=function(t,e){return vi.overlayOp(t,e,en.INTERSECTION)};vi.symDifference=function(t,e){return vi.overlayOp(t,e,en.SYMDIFFERENCE)};vi.difference=function(t,e){return vi.overlayOp(t,e,en.DIFFERENCE)};var Yi=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};Yi.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=en.overlayOp(this._geom[0],this._geom[1],t);var i=!0;i&&(n=!0)}catch(a){if(a instanceof hl)r=a;else throw a}finally{}if(!n)try{e=vi.overlayOp(this._geom[0],this._geom[1],t)}catch(a){throw a instanceof hl?r:a}finally{}return e};Yi.prototype.interfaces_=function(){return[]};Yi.prototype.getClass=function(){return Yi};Yi.overlayOp=function(t,e,n){var r=new Yi(t,e);return r.getResultGeometry(n)};Yi.union=function(t,e){return Yi.overlayOp(t,e,en.UNION)};Yi.intersection=function(t,e){return Yi.overlayOp(t,e,en.INTERSECTION)};Yi.symDifference=function(t,e){return Yi.overlayOp(t,e,en.SYMDIFFERENCE)};Yi.difference=function(t,e){return Yi.overlayOp(t,e,en.DIFFERENCE)};var Nd=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};Nd.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)};Nd.prototype.interfaces_=function(){return[]};Nd.prototype.getClass=function(){return Nd};var Po=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=a}},u1={INSERT:{configurable:!0},DELETE:{configurable:!0}};Po.prototype.isDelete=function(){return this._eventType===Po.DELETE};Po.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};Po.prototype.getObject=function(){return this._obj};Po.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0};Po.prototype.getInsertEvent=function(){return this._insertEvent};Po.prototype.isInsert=function(){return this._eventType===Po.INSERT};Po.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};Po.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Po.prototype.interfaces_=function(){return[hs]};Po.prototype.getClass=function(){return Po};u1.INSERT.get=function(){return 1};u1.DELETE.get=function(){return 2};Object.defineProperties(Po,u1);var ay=function(){};ay.prototype.interfaces_=function(){return[]};ay.prototype.getClass=function(){return ay};var Li=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};Li.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if(Li.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};Li.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Li.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};Li.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Li.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next(),i=r.getCoordinate();if(t.isIntersection(i))return!0}return!1};Li.prototype.hasProperIntersection=function(){return this._hasProper};Li.prototype.hasIntersection=function(){return this._hasIntersection};Li.prototype.isDone=function(){return this._isDone};Li.prototype.isBoundaryPoint=function(t,e){return e===null?!1:!!(this.isBoundaryPointInternal(t,e[0])||this.isBoundaryPointInternal(t,e[1]))};Li.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e};Li.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],a=t.getCoordinates()[e+1],c=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(i,a,c,u),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Li.prototype.interfaces_=function(){return[]};Li.prototype.getClass=function(){return Li};Li.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var yR=function(t){function e(){t.call(this),this.events=new mt,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var n=this;Ms.sort(this.events);for(var r=0;r<this.events.size();r++){var i=n.events.get(r);i.isDelete()&&i.getInsertEvent().setDeleteEventIndex(r)}},e.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var i=0;i<this.events.size();i++){var a=n.events.get(i);if(a.isInsert()&&n.processOverlaps(i,a.getDeleteEventIndex(),a,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Li&&Ut(arguments[0],Cs)&&Ut(arguments[1],Cs)){var c=arguments[0],u=arguments[1],m=arguments[2];this.addEdges(c,c),this.addEdges(u,u),this.computeIntersections(m)}else if(typeof arguments[2]=="boolean"&&Ut(arguments[0],Cs)&&arguments[1]instanceof Li){var w=arguments[0],S=arguments[1],E=arguments[2];E?this.addEdges(w,null):this.addEdges(w),this.computeIntersections(S)}}},e.prototype.addEdge=function(n,r){for(var i=this,a=n.getMonotoneChainEdge(),c=a.getStartIndexes(),u=0;u<c.length-1;u++){var m=new Nd(a,u),w=new Po(r,a.getMinX(u),m);i.events.add(w),i.events.add(new Po(a.getMaxX(u),w))}},e.prototype.processOverlaps=function(n,r,i,a){for(var c=this,u=i.getObject(),m=n;m<r;m++){var w=c.events.get(m);if(w.isInsert()){var S=w.getObject();i.isSameLabel(w)||(u.computeIntersections(S,a),c.nOverlaps++)}}},e.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var r=arguments[0],i=r.iterator();i.hasNext();){var a=i.next();n.addEdge(a,a)}else if(arguments.length===2)for(var c=arguments[0],u=arguments[1],m=c.iterator();m.hasNext();){var w=m.next();n.addEdge(w,u)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ay),za=function(){this._min=Xt.POSITIVE_INFINITY,this._max=Xt.NEGATIVE_INFINITY},oC={NodeComparator:{configurable:!0}};za.prototype.getMin=function(){return this._min};za.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)};za.prototype.getMax=function(){return this._max};za.prototype.toString=function(){return Ts.toLineString(new Re(this._min,0),new Re(this._max,0))};za.prototype.interfaces_=function(){return[]};za.prototype.getClass=function(){return za};oC.NodeComparator.get=function(){return Od};Object.defineProperties(za,oC);var Od=function(){};Od.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,a=(r._min+r._max)/2;return i<a?-1:i>a?1:0};Od.prototype.interfaces_=function(){return[gf]};Od.prototype.getClass=function(){return Od};var _R=function(t){function e(){t.call(this),this._item=null;var n=arguments[0],r=arguments[1],i=arguments[2];this._min=n,this._max=r,this._item=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(za),vR=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(n,r){this._min=Math.min(n._min,r._min),this._max=Math.max(n._max,r._max)},e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;this._node1!==null&&this._node1.query(n,r,i),this._node2!==null&&this._node2.query(n,r,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(za),Fa=function(){this._leaves=new mt,this._root=null,this._level=0};Fa.prototype.buildTree=function(){var t=this;Ms.sort(this._leaves,new za.NodeComparator);for(var e=this._leaves,n=null,r=new mt;;){if(t.buildLevel(e,r),r.size()===1)return r.get(0);n=e,e=r,r=n}};Fa.prototype.insert=function(t,e,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new _R(t,e,n))};Fa.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)};Fa.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Fa.prototype.printNode=function(t){Ii.out.println(Ts.toLineString(new Re(t._min,this._level),new Re(t._max,this._level)))};Fa.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Fa.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n),i=n+1<t.size()?t.get(n):null;if(i===null)e.add(r);else{var a=new vR(t.get(n),t.get(n+1));e.add(a)}}};Fa.prototype.interfaces_=function(){return[]};Fa.prototype.getClass=function(){return Fa};var Pf=function(){this._items=new mt};Pf.prototype.visitItem=function(t){this._items.add(t)};Pf.prototype.getItems=function(){return this._items};Pf.prototype.interfaces_=function(){return[Yl]};Pf.prototype.getClass=function(){return Pf};var Mf=function(){this._index=null;var t=arguments[0];if(!Ut(t,Xl))throw new ar("Argument must be Polygonal");this._index=new Uu(t)},c1={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Mf.prototype.locate=function(t){var e=new $s(t),n=new Af(e);return this._index.query(t.y,t.y,n),e.getLocation()};Mf.prototype.interfaces_=function(){return[Tf]};Mf.prototype.getClass=function(){return Mf};c1.SegmentVisitor.get=function(){return Af};c1.IntervalIndexedGeometry.get=function(){return Uu};Object.defineProperties(Mf,c1);var Af=function(){this._counter=null;var t=arguments[0];this._counter=t};Af.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))};Af.prototype.interfaces_=function(){return[Yl]};Af.prototype.getClass=function(){return Af};var Uu=function(){this._index=new Fa;var t=arguments[0];this.init(t)};Uu.prototype.init=function(t){for(var e=this,n=xi.getLines(t),r=n.iterator();r.hasNext();){var i=r.next(),a=i.getCoordinates();e.addLine(a)}};Uu.prototype.addLine=function(t){for(var e=this,n=1;n<t.length;n++){var r=new Nt(t[n-1],t[n]),i=Math.min(r.p0.y,r.p1.y),a=Math.max(r.p0.y,r.p1.y);e._index.insert(i,a,r)}};Uu.prototype.query=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new Pf;return this._index.query(t,e,n),n.getItems()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._index.query(r,i,a)}};Uu.prototype.interfaces_=function(){return[]};Uu.prototype.getClass=function(){return Uu};var td=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new GI,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new ks,arguments.length===2){var n=arguments[0],r=arguments[1],i=ls.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=i,r!==null&&this.add(r)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],u=arguments[2];this._argIndex=a,this._parentGeom=c,this._boundaryNodeRule=u,c!==null&&this.add(c)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(n,r){var i=this._nodes.addNode(r),a=i.getLabel(),c=1,u=ze.NONE;u=a.getLocation(n,st.ON),u===ze.BOUNDARY&&c++;var m=e.determineBoundary(this._boundaryNodeRule,c);a.setLocation(n,m)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.computeSelfNodes(n,r,!1)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],c=arguments[2],u=new Li(i,!0,!1);u.setIsDoneIfProperInt(c);var m=this.createEdgeSetIntersector(),w=this._parentGeom instanceof Aa||this._parentGeom instanceof Xr||this._parentGeom instanceof Ta,S=a||!w;return m.computeIntersections(this._edges,u,S),this.addSelfIntersectionNodes(this._argIndex),u}},e.prototype.computeSplitEdges=function(n){for(var r=this._edges.iterator();r.hasNext();){var i=r.next();i.eiList.addSplitEdges(n)}},e.prototype.computeEdgeIntersections=function(n,r,i){var a=new Li(r,i,!0);a.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var c=this.createEdgeSetIntersector();return c.computeIntersections(this._edges,n._edges,a),a},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Co){var n=arguments[0],r=n.getCoordinate();this.insertPoint(this._argIndex,r,ze.INTERIOR)}else if(arguments[0]instanceof Re){var i=arguments[0];this.insertPoint(this._argIndex,i,ze.INTERIOR)}},e.prototype.addPolygon=function(n){var r=this;this.addPolygonRing(n.getExteriorRing(),ze.EXTERIOR,ze.INTERIOR);for(var i=0;i<n.getNumInteriorRing();i++){var a=n.getInteriorRingN(i);r.addPolygonRing(a,ze.INTERIOR,ze.EXTERIOR)}},e.prototype.addEdge=function(n){this.insertEdge(n);var r=n.getCoordinates();this.insertPoint(this._argIndex,r[0],ze.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],ze.BOUNDARY)},e.prototype.addLineString=function(n){var r=gn.removeRepeatedPoints(n.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=new sy(r,new Fn(this._argIndex,ze.INTERIOR));this._lineEdgeMap.put(n,i),this.insertEdge(i),on.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),r=new Array(n.size()).fill(null),i=0,a=n.iterator();a.hasNext();){var c=a.next();r[i++]=c.getCoordinate().copy()}return r},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(n,r,i){if(this.isBoundaryNode(n,r))return null;i===ze.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,r):this.insertPoint(n,r,i)},e.prototype.addPolygonRing=function(n,r,i){if(n.isEmpty())return null;var a=gn.removeRepeatedPoints(n.getCoordinates());if(a.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var c=r,u=i;xt.isCCW(a)&&(c=i,u=r);var m=new sy(a,new Fn(this._argIndex,ze.BOUNDARY,c,u));this._lineEdgeMap.put(n,m),this.insertEdge(m),this.insertPoint(this._argIndex,a[0],ze.BOUNDARY)},e.prototype.insertPoint=function(n,r,i){var a=this._nodes.addNode(r),c=a.getLabel();c===null?a._label=new Fn(n,i):c.setLocation(n,i)},e.prototype.createEdgeSetIntersector=function(){return new yR},e.prototype.addSelfIntersectionNodes=function(n){for(var r=this,i=this._edges.iterator();i.hasNext();)for(var a=i.next(),c=a.getLabel().getLocation(n),u=a.eiList.iterator();u.hasNext();){var m=u.next();r.addSelfIntersectionNode(n,m.coord,c)}},e.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Ta&&(this._useBoundaryDeterminationRule=!1),n instanceof Xr)this.addPolygon(n);else if(n instanceof br)this.addLineString(n);else if(n instanceof Co)this.addPoint(n);else if(n instanceof Sf)this.addCollection(n);else if(n instanceof Ru)this.addCollection(n);else if(n instanceof Ta)this.addCollection(n);else if(n instanceof Hi)this.addCollection(n);else throw new Error(n.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(n){for(var r=this,i=0;i<n.getNumGeometries();i++){var a=n.getGeometryN(i);r.add(a)}},e.prototype.locate=function(n){return Ut(this._parentGeom,Xl)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Mf(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(n,r){return n.isInBoundary(r)?ze.BOUNDARY:ze.INTERIOR},e}(pr),kf=function(){if(this._li=new Zu,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new td(0,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=ls.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new td(0,e,r),this._arg[1]=new td(1,n,r)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],c=arguments[2];i.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new td(0,i,c),this._arg[1]=new td(1,a,c)}};kf.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};kf.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};kf.prototype.interfaces_=function(){return[]};kf.prototype.getClass=function(){return kf};var ku=function(){};ku.prototype.interfaces_=function(){return[]};ku.prototype.getClass=function(){return ku};ku.map=function(){if(arguments[0]instanceof Vt&&Ut(arguments[1],ku.MapOp)){for(var t=arguments[0],e=arguments[1],n=new mt,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));i!==null&&n.add(i)}return t.getFactory().buildGeometry(n)}else if(Ut(arguments[0],jr)&&Ut(arguments[1],ku.MapOp)){for(var a=arguments[0],c=arguments[1],u=new mt,m=a.iterator();m.hasNext();){var w=m.next(),S=c.map(w);S!==null&&u.add(S)}return u}};ku.MapOp=function(){};var en=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r),this._ptLocator=new ks,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new As,this._resultPolyList=new mt,this._resultLineList=new mt,this._resultPointList=new mt,this._graph=new pr(new KI),this._geomFact=n.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(n){var r=this._edgeList.findEqualEdge(n);if(r!==null){var i=r.getLabel(),a=n.getLabel();r.isPointwiseEqual(n)||(a=new Fn(n.getLabel()),a.flip());var c=r.getDepth();c.isNull()&&c.add(i),c.add(a),i.merge(a)}else this._edgeList.add(n)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getSym();r.isInResult()&&i.isInResult()&&(r.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},e.prototype.computeGeometry=function(n,r,i,a){var c=new mt;return c.addAll(n),c.addAll(r),c.addAll(i),c.isEmpty()?e.createEmptyResult(a,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(c)},e.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(n,r){for(var i=this,a=r.iterator();a.hasNext();){var c=a.next(),u=i._ptLocator.locate(n,c);if(u!==ze.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var n=new mt,r=this._edgeList.iterator();r.hasNext();){var i=r.next();i.isCollapsed()&&(r.remove(),n.add(i.getCollapsedEdge()))}this._edgeList.addAll(n)},e.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next(),i=r.getEdges().getLabel();r.getLabel().merge(i)}},e.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},e.prototype.insertUniqueEdges=function(n){for(var r=this,i=n.iterator();i.hasNext();){var a=i.next();r.insertUniqueEdge(a)}},e.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new mt;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Vu.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var i=new To(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var a=new ca(this,this._geomFact,this._ptLocator);this._resultLineList=a.build(n);var c=new Fc(this,this._geomFact,this._ptLocator);this._resultPointList=c.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},e.prototype.labelIncompleteNode=function(n,r){var i=this._ptLocator.locate(n.getCoordinate(),this._arg[r].getGeometry());n.getLabel().setLocation(r,i)},e.prototype.copyPoints=function(n){for(var r=this,i=this._arg[n].getNodeIterator();i.hasNext();){var a=i.next(),c=r._graph.addNode(a.getCoordinate());c.setLabel(n,a.getLabel().getLocation(n))}},e.prototype.findResultAreaEdges=function(n){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var i=r.next(),a=i.getLabel();a.isArea()&&!i.isInteriorAreaEdge()&&e.isResultOfOp(a.getLocation(0,st.RIGHT),a.getLocation(1,st.RIGHT),n)&&i.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var r=n.next(),i=r.getLabel(),a=r.getDepth();if(!a.isNull()){a.normalize();for(var c=0;c<2;c++)!i.isNull(c)&&i.isArea()&&!a.isNull(c)&&(a.getDelta(c)===0?i.toLine(c):(on.isTrue(!a.isNull(c,st.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(c,st.LEFT,a.getLocation(c,st.LEFT)),on.isTrue(!a.isNull(c,st.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(c,st.RIGHT,a.getLocation(c,st.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next();i.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next(),a=i.getLabel();i.isIsolated()&&(a.isNull(0)?n.labelIncompleteNode(i,0):n.labelIncompleteNode(i,1)),i.getEdges().updateLabelling(a)}},e.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(kf);en.overlayOp=function(t,e,n){var r=new en(t,e),i=r.getResultGeometry(n);return i};en.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return en.createEmptyResult(en.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return zc.map(t,{interfaces_:function(){return[ku.MapOp]},map:function(r){return r.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Yi.overlayOp(t,e,en.INTERSECTION)};en.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return en.createEmptyResult(en.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Yi.overlayOp(t,e,en.SYMDIFFERENCE)};en.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),a=-1;switch(t){case en.INTERSECTION:a=Math.min(r,i);break;case en.UNION:a=Math.max(r,i);break;case en.DIFFERENCE:a=r;break;case en.SYMDIFFERENCE:a=Math.max(r,i);break}return a};en.createEmptyResult=function(t,e,n,r){var i=null;switch(en.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon();break}return i};en.difference=function(t,e){return t.isEmpty()?en.createEmptyResult(en.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Yi.overlayOp(t,e,en.DIFFERENCE))};en.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return en.isResultOfOp(n,r,e)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],c=arguments[2];switch(i===ze.BOUNDARY&&(i=ze.INTERIOR),a===ze.BOUNDARY&&(a=ze.INTERIOR),c){case en.INTERSECTION:return i===ze.INTERIOR&&a===ze.INTERIOR;case en.UNION:return i===ze.INTERIOR||a===ze.INTERIOR;case en.DIFFERENCE:return i===ze.INTERIOR&&a!==ze.INTERIOR;case en.SYMDIFFERENCE:return i===ze.INTERIOR&&a!==ze.INTERIOR||i!==ze.INTERIOR&&a===ze.INTERIOR}return!1}};en.INTERSECTION=1;en.UNION=2;en.DIFFERENCE=3;en.SYMDIFFERENCE=4;var Hl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new ks,this._seg=new Nt;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Hl.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=e._linework.getGeometryN(n),i=r.getCoordinateSequence(),a=0;a<i.size()-1;a++){i.getCoordinate(a,e._seg.p0),i.getCoordinate(a+1,e._seg.p1);var c=e._seg.distance(t);if(c<=e._boundaryDistanceTolerance)return!0}return!1};Hl.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?ze.BOUNDARY:this._ptLocator.locate(t,this._g)};Hl.prototype.extractLinework=function(t){var e=new Df;t.apply(e);var n=e.getLinework(),r=mn.toLineStringArray(n);return t.getFactory().createMultiLineString(r)};Hl.prototype.interfaces_=function(){return[]};Hl.prototype.getClass=function(){return Hl};var Df=function(){this._linework=null,this._linework=new mt};Df.prototype.getLinework=function(){return this._linework};Df.prototype.filter=function(t){var e=this;if(t instanceof Xr){var n=t;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)e._linework.add(n.getInteriorRingN(r))}};Df.prototype.interfaces_=function(){return[ra]};Df.prototype.getClass=function(){return Df};var Gu=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Gu.prototype.extractPoints=function(t,e,n){for(var r=this,i=t.getCoordinates(),a=0;a<i.length-1;a++)r.computeOffsetPoints(i[a],i[a+1],e,n)};Gu.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e};Gu.prototype.getPoints=function(t){for(var e=this,n=new mt,r=xi.getLines(this._g),i=r.iterator();i.hasNext();){var a=i.next();e.extractPoints(a,t,n)}return n};Gu.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,a=e.y-t.y,c=Math.sqrt(i*i+a*a),u=n*i/c,m=n*a/c,w=(e.x+t.x)/2,S=(e.y+t.y)/2;if(this._doLeft){var E=new Re(w-m,S+u);r.add(E)}if(this._doRight){var P=new Re(w+m,S-u);r.add(P)}};Gu.prototype.interfaces_=function(){return[]};Gu.prototype.getClass=function(){return Gu};var Yo=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new mt;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new Hl(this._geom[0],this._boundaryDistanceTolerance),new Hl(this._geom[1],this._boundaryDistanceTolerance),new Hl(this._geom[2],this._boundaryDistanceTolerance)]},sC={TOLERANCE:{configurable:!0}};Yo.prototype.reportResult=function(t,e,n){Ii.out.println("Overlay result invalid - A:"+ze.toLocationSymbol(e[0])+" B:"+ze.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+ze.toLocationSymbol(e[2]))};Yo.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e};Yo.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var r=t._testCoords.get(n);if(!t.checkValid(e,r))return t._invalidLocation=r,!1}return!0}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),Yo.hasLocation(this._location,ze.BOUNDARY)?!0:this.isValidResult(i,this._location)}};Yo.prototype.addTestPts=function(t){var e=new Gu(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))};Yo.prototype.isValidResult=function(t,e){var n=en.isResultOfOp(e[0],e[1],t),r=e[2]===ze.INTERIOR,i=!(n^r);return i||this.reportResult(t,e,n),i};Yo.prototype.getInvalidLocation=function(){return this._invalidLocation};Yo.prototype.interfaces_=function(){return[]};Yo.prototype.getClass=function(){return Yo};Yo.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1};Yo.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Pr.computeSizeBasedSnapTolerance(t),Pr.computeSizeBasedSnapTolerance(e))};Yo.isValid=function(t,e,n,r){var i=new Yo(t,e,r);return i.isValid(n)};sC.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Yo,sC);var Uo=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Uo.prototype.extractElements=function(t,e){var n=this;if(t===null)return null;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);n._skipEmpty&&i.isEmpty()||e.add(i)}};Uo.prototype.combine=function(){for(var t=this,e=new mt,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();t.extractElements(r,e)}return e.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)};Uo.prototype.interfaces_=function(){return[]};Uo.prototype.getClass=function(){return Uo};Uo.combine=function(){if(arguments.length===1){var t=arguments[0],e=new Uo(t);return e.combine()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new Uo(Uo.createList(n,r));return i.combine()}else if(arguments.length===3){var a=arguments[0],c=arguments[1],u=arguments[2],m=new Uo(Uo.createList(a,c,u));return m.combine()}};Uo.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};Uo.createList=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new mt;return n.add(t),n.add(e),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],c=new mt;return c.add(r),c.add(i),c.add(a),c}};var Fr=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new mt)},aC={STRTREE_NODE_CAPACITY:{configurable:!0}};Fr.prototype.reduceToGeometries=function(t){for(var e=this,n=new mt,r=t.iterator();r.hasNext();){var i=r.next(),a=null;Ut(i,Cs)?a=e.unionTree(i):i instanceof Vt&&(a=i),n.add(a)}return n};Fr.prototype.extractByEnvelope=function(t,e,n){for(var r=new mt,i=0;i<e.getNumGeometries();i++){var a=e.getGeometryN(i);a.getEnvelopeInternal().intersects(t)?r.add(a):n.add(a)}return this._geomFactory.buildGeometry(r)};Fr.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r)){var i=Uo.combine(t,e);return i}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var a=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,a)};Fr.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new HI(Fr.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree(),i=this.unionTree(r);return i};Fr.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=Fr.getGeometry(e,n);return this.unionSafe(i,null)}else{if(r-n===2)return this.unionSafe(Fr.getGeometry(e,n),Fr.getGeometry(e,n+1));var a=Math.trunc((r+n)/2),c=this.binaryUnion(e,n,a),u=this.binaryUnion(e,a,r);return this.unionSafe(c,u)}}};Fr.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e===null?e=r.copy():e=e.union(r)}return e};Fr.prototype.unionSafe=function(t,e){return t===null&&e===null?null:t===null?e.copy():e===null?t.copy():this.unionOptimized(t,e)};Fr.prototype.unionActual=function(t,e){return Fr.restrictToPolygons(t.union(e))};Fr.prototype.unionTree=function(t){var e=this.reduceToGeometries(t),n=this.binaryUnion(e);return n};Fr.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new mt,i=this.extractByEnvelope(n,t,r),a=this.extractByEnvelope(n,e,r),c=this.unionActual(i,a);r.add(c);var u=Uo.combine(r);return u};Fr.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),r=n.buffer(0);return r}else if(arguments.length===2){var i=arguments[0],a=arguments[1],c=i.getFactory(),u=c.createGeometryCollection([i,a]),m=u.buffer(0);return m}};Fr.prototype.interfaces_=function(){return[]};Fr.prototype.getClass=function(){return Fr};Fr.restrictToPolygons=function(t){if(Ut(t,Xl))return t;var e=ll.getPolygons(t);return e.size()===1?e.get(0):t.getFactory().createMultiPolygon(mn.toPolygonArray(e))};Fr.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)};Fr.union=function(t){var e=new Fr(t);return e.union()};aC.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Fr,aC);var ly=function(){};ly.prototype.interfaces_=function(){return[]};ly.prototype.getClass=function(){return ly};ly.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return en.createEmptyResult(en.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Yi.overlayOp(t,e,en.UNION)};function Xu(){return new uy}function uy(){this.reset()}uy.prototype={constructor:uy,reset:function(){this.s=this.t=0},add:function(t){r2(fg,t,this.t),r2(this,fg.s,this.s),this.s?this.t+=fg.t:this.s=fg.t},valueOf:function(){return this.s}};var fg=new uy;function r2(t,e,n){var r=t.s=e+n,i=r-e,a=r-i;t.t=e-a+(n-i)}var vr=1e-6,jn=Math.PI,al=jn/2,i2=jn/4,gl=jn*2,Cu=180/jn,Zs=jn/180,ji=Math.abs,bR=Math.atan,Rf=Math.atan2,Wr=Math.cos,Hr=Math.sin,Hf=Math.sqrt;function lC(t){return t>1?0:t<-1?jn:Math.acos(t)}function Vc(t){return t>1?al:t<-1?-al:Math.asin(t)}function ud(){}function cy(t,e){t&&s2.hasOwnProperty(t.type)&&s2[t.type](t,e)}var o2={Feature:function(t,e){cy(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)cy(n[r].geometry,e)}},s2={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){lv(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)lv(n[r],e,0)},Polygon:function(t,e){a2(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)a2(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)cy(n[r],e)}};function lv(t,e,n){var r=-1,i=t.length-n,a;for(e.lineStart();++r<i;)a=t[r],e.point(a[0],a[1],a[2]);e.lineEnd()}function a2(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)lv(t[n],e,1);e.polygonEnd()}function xR(t,e){t&&o2.hasOwnProperty(t.type)?o2[t.type](t,e):cy(t,e)}Xu();Xu();function uv(t){return[Rf(t[1],t[0]),Vc(t[2])]}function Nf(t){var e=t[0],n=t[1],r=Wr(n);return[r*Wr(e),r*Hr(e),Hr(n)]}function pg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function hy(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function x0(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function dg(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function cv(t){var e=Hf(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}Xu();function uC(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}function hv(t,e){return[t>jn?t-gl:t<-jn?t+gl:t,e]}hv.invert=hv;function wR(t,e,n){return(t%=gl)?e||n?uC(u2(t),c2(e,n)):u2(t):e||n?c2(e,n):hv}function l2(t){return function(e,n){return e+=t,[e>jn?e-gl:e<-jn?e+gl:e,n]}}function u2(t){var e=l2(t);return e.invert=l2(-t),e}function c2(t,e){var n=Wr(t),r=Hr(t),i=Wr(e),a=Hr(e);function c(u,m){var w=Wr(m),S=Wr(u)*w,E=Hr(u)*w,P=Hr(m),D=P*n+S*r;return[Rf(E*i-D*a,S*n-P*r),Vc(D*i+E*a)]}return c.invert=function(u,m){var w=Wr(m),S=Wr(u)*w,E=Hr(u)*w,P=Hr(m),D=P*i-E*a;return[Rf(E*i+P*a,S*n+D*r),Vc(D*n-S*r)]},c}function SR(t,e,n,r,i,a){if(n){var c=Wr(e),u=Hr(e),m=r*n;i==null?(i=e+r*gl,a=e-m/2):(i=h2(c,i),a=h2(c,a),(r>0?i<a:i>a)&&(i+=r*gl));for(var w,S=i;r>0?S>a:S<a;S-=m)w=uv([c,-u*Wr(S),-u*Hr(S)]),t.point(w[0],w[1])}}function h2(t,e){e=Nf(e),e[0]-=t,cv(e);var n=lC(-e[1]);return((-e[2]<0?-n:n)+gl-vr)%gl}function cC(){var t=[],e;return{point:function(n,r){e.push([n,r])},lineStart:function(){t.push(e=[])},lineEnd:ud,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function ER(t,e,n,r,i,a){var c=t[0],u=t[1],m=e[0],w=e[1],S=0,E=1,P=m-c,D=w-u,k;if(k=n-c,!(!P&&k>0)){if(k/=P,P<0){if(k<S)return;k<E&&(E=k)}else if(P>0){if(k>E)return;k>S&&(S=k)}if(k=i-c,!(!P&&k<0)){if(k/=P,P<0){if(k>E)return;k>S&&(S=k)}else if(P>0){if(k<S)return;k<E&&(E=k)}if(k=r-u,!(!D&&k>0)){if(k/=D,D<0){if(k<S)return;k<E&&(E=k)}else if(D>0){if(k>E)return;k>S&&(S=k)}if(k=a-u,!(!D&&k<0)){if(k/=D,D<0){if(k>E)return;k>S&&(S=k)}else if(D>0){if(k<S)return;k<E&&(E=k)}return S>0&&(t[0]=c+S*P,t[1]=u+S*D),E<1&&(e[0]=c+E*P,e[1]=u+E*D),!0}}}}}function Ag(t,e){return ji(t[0]-e[0])<vr&&ji(t[1]-e[1])<vr}function mg(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function hC(t,e,n,r,i){var a=[],c=[],u,m;if(t.forEach(function(k){if(!((V=k.length-1)<=0)){var V,j=k[0],te=k[V],U;if(Ag(j,te)){for(i.lineStart(),u=0;u<V;++u)i.point((j=k[u])[0],j[1]);i.lineEnd();return}a.push(U=new mg(j,k,null,!0)),c.push(U.o=new mg(j,null,U,!1)),a.push(U=new mg(te,k,null,!1)),c.push(U.o=new mg(te,null,U,!0))}}),!!a.length){for(c.sort(e),f2(a),f2(c),u=0,m=c.length;u<m;++u)c[u].e=n=!n;for(var w=a[0],S,E;;){for(var P=w,D=!0;P.v;)if((P=P.n)===w)return;S=P.z,i.lineStart();do{if(P.v=P.o.v=!0,P.e){if(D)for(u=0,m=S.length;u<m;++u)i.point((E=S[u])[0],E[1]);else r(P.x,P.n.x,1,i);P=P.n}else{if(D)for(S=P.p.z,u=S.length-1;u>=0;--u)i.point((E=S[u])[0],E[1]);else r(P.x,P.p.x,-1,i);P=P.p}P=P.o,S=P.z,D=!D}while(!P.v);i.lineEnd()}}}function f2(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function fC(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function IR(t){return t.length===1&&(t=CR(t)),{left:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)<0?r=a+1:i=a}return r},right:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)>0?i=a:r=a+1}return r}}}function CR(t){return function(e,n){return fC(t(e),n)}}IR(fC);function pC(t){for(var e=t.length,n,r=-1,i=0,a,c;++r<e;)i+=t[r].length;for(a=new Array(i);--e>=0;)for(c=t[e],n=c.length;--n>=0;)a[--i]=c[n];return a}var cd=1e9,gg=-cd;function TR(t,e,n,r){function i(w,S){return t<=w&&w<=n&&e<=S&&S<=r}function a(w,S,E,P){var D=0,k=0;if(w==null||(D=c(w,E))!==(k=c(S,E))||m(w,S)<0^E>0)do P.point(D===0||D===3?t:n,D>1?r:e);while((D=(D+E+4)%4)!==k);else P.point(S[0],S[1])}function c(w,S){return ji(w[0]-t)<vr?S>0?0:3:ji(w[0]-n)<vr?S>0?2:1:ji(w[1]-e)<vr?S>0?1:0:S>0?3:2}function u(w,S){return m(w.x,S.x)}function m(w,S){var E=c(w,1),P=c(S,1);return E!==P?E-P:E===0?S[1]-w[1]:E===1?w[0]-S[0]:E===2?w[1]-S[1]:S[0]-w[0]}return function(w){var S=w,E=cC(),P,D,k,V,j,te,U,W,Y,oe,_e,se={point:ce,lineStart:fe,lineEnd:Ke,polygonStart:Ce,polygonEnd:Z};function ce(Ze,tt){i(Ze,tt)&&S.point(Ze,tt)}function me(){for(var Ze=0,tt=0,qe=D.length;tt<qe;++tt)for(var Ot=D[tt],wt=1,un=Ot.length,qt=Ot[0],At,hn,Tn=qt[0],yn=qt[1];wt<un;++wt)At=Tn,hn=yn,qt=Ot[wt],Tn=qt[0],yn=qt[1],hn<=r?yn>r&&(Tn-At)*(r-hn)>(yn-hn)*(t-At)&&++Ze:yn<=r&&(Tn-At)*(r-hn)<(yn-hn)*(t-At)&&--Ze;return Ze}function Ce(){S=E,P=[],D=[],_e=!0}function Z(){var Ze=me(),tt=_e&&Ze,qe=(P=pC(P)).length;(tt||qe)&&(w.polygonStart(),tt&&(w.lineStart(),a(null,null,1,w),w.lineEnd()),qe&&hC(P,u,Ze,a,w),w.polygonEnd()),S=w,P=D=k=null}function fe(){se.point=Se,D&&D.push(k=[]),oe=!0,Y=!1,U=W=NaN}function Ke(){P&&(Se(V,j),te&&Y&&E.rejoin(),P.push(E.result())),se.point=ce,Y&&S.lineEnd()}function Se(Ze,tt){var qe=i(Ze,tt);if(D&&k.push([Ze,tt]),oe)V=Ze,j=tt,te=qe,oe=!1,qe&&(S.lineStart(),S.point(Ze,tt));else if(qe&&Y)S.point(Ze,tt);else{var Ot=[U=Math.max(gg,Math.min(cd,U)),W=Math.max(gg,Math.min(cd,W))],wt=[Ze=Math.max(gg,Math.min(cd,Ze)),tt=Math.max(gg,Math.min(cd,tt))];ER(Ot,wt,t,e,n,r)?(Y||(S.lineStart(),S.point(Ot[0],Ot[1])),S.point(wt[0],wt[1]),qe||S.lineEnd(),_e=!1):qe&&(S.lineStart(),S.point(Ze,tt),_e=!1)}U=Ze,W=tt,Y=qe}return se}}var w0=Xu();function LR(t,e){var n=e[0],r=e[1],i=[Hr(n),-Wr(n),0],a=0,c=0;w0.reset();for(var u=0,m=t.length;u<m;++u)if(S=(w=t[u]).length)for(var w,S,E=w[S-1],P=E[0],D=E[1]/2+i2,k=Hr(D),V=Wr(D),j=0;j<S;++j,P=U,k=Y,V=oe,E=te){var te=w[j],U=te[0],W=te[1]/2+i2,Y=Hr(W),oe=Wr(W),_e=U-P,se=_e>=0?1:-1,ce=se*_e,me=ce>jn,Ce=k*Y;if(w0.add(Rf(Ce*se*Hr(ce),V*oe+Ce*Wr(ce))),a+=me?_e+se*gl:_e,me^P>=n^U>=n){var Z=hy(Nf(E),Nf(te));cv(Z);var fe=hy(i,Z);cv(fe);var Ke=(me^_e>=0?-1:1)*Vc(fe[2]);(r>Ke||r===Ke&&(Z[0]||Z[1]))&&(c+=me^_e>=0?1:-1)}}return(a<-vr||a<vr&&w0<-vr)^c&1}Xu();function p2(t){return t}Xu();Xu();var Of=1/0,fy=Of,zd=-Of,py=zd,d2={point:PR,lineStart:ud,lineEnd:ud,polygonStart:ud,polygonEnd:ud,result:function(){var t=[[Of,fy],[zd,py]];return zd=py=-(fy=Of=1/0),t}};function PR(t,e){t<Of&&(Of=t),t>zd&&(zd=t),e<fy&&(fy=e),e>py&&(py=e)}Xu();function dC(t,e,n,r){return function(i,a){var c=e(a),u=i.invert(r[0],r[1]),m=cC(),w=e(m),S=!1,E,P,D,k={point:V,lineStart:te,lineEnd:U,polygonStart:function(){k.point=W,k.lineStart=Y,k.lineEnd=oe,P=[],E=[]},polygonEnd:function(){k.point=V,k.lineStart=te,k.lineEnd=U,P=pC(P);var _e=LR(E,u);P.length?(S||(a.polygonStart(),S=!0),hC(P,AR,_e,n,a)):_e&&(S||(a.polygonStart(),S=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),S&&(a.polygonEnd(),S=!1),P=E=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function V(_e,se){var ce=i(_e,se);t(_e=ce[0],se=ce[1])&&a.point(_e,se)}function j(_e,se){var ce=i(_e,se);c.point(ce[0],ce[1])}function te(){k.point=j,c.lineStart()}function U(){k.point=V,c.lineEnd()}function W(_e,se){D.push([_e,se]);var ce=i(_e,se);w.point(ce[0],ce[1])}function Y(){w.lineStart(),D=[]}function oe(){W(D[0][0],D[0][1]),w.lineEnd();var _e=w.clean(),se=m.result(),ce,me=se.length,Ce,Z,fe;if(D.pop(),E.push(D),D=null,!!me){if(_e&1){if(Z=se[0],(Ce=Z.length-1)>0){for(S||(a.polygonStart(),S=!0),a.lineStart(),ce=0;ce<Ce;++ce)a.point((fe=Z[ce])[0],fe[1]);a.lineEnd()}return}me>1&&_e&2&&se.push(se.pop().concat(se.shift())),P.push(se.filter(MR))}}return k}}function MR(t){return t.length>1}function AR(t,e){return((t=t.x)[0]<0?t[1]-al-vr:al-t[1])-((e=e.x)[0]<0?e[1]-al-vr:al-e[1])}const m2=dC(function(){return!0},kR,RR,[-jn,-al]);function kR(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(a,c){var u=a>0?jn:-jn,m=ji(a-e);ji(m-jn)<vr?(t.point(e,n=(n+c)/2>0?al:-al),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(u,n),t.point(a,n),i=0):r!==u&&m>=jn&&(ji(e-r)<vr&&(e-=r*vr),ji(a-u)<vr&&(a-=u*vr),n=DR(e,n,a,c),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(u,n),i=0),t.point(e=a,n=c),r=u},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function DR(t,e,n,r){var i,a,c=Hr(t-n);return ji(c)>vr?bR((Hr(e)*(a=Wr(r))*Hr(n)-Hr(r)*(i=Wr(e))*Hr(t))/(i*a*c)):(e+r)/2}function RR(t,e,n,r){var i;if(t==null)i=n*al,r.point(-jn,i),r.point(0,i),r.point(jn,i),r.point(jn,0),r.point(jn,-i),r.point(0,-i),r.point(-jn,-i),r.point(-jn,0),r.point(-jn,i);else if(ji(t[0]-e[0])>vr){var a=t[0]<e[0]?jn:-jn;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(e[0],e[1])}function NR(t,e){var n=Wr(t),r=n>0,i=ji(n)>vr;function a(S,E,P,D){SR(D,t,e,P,S,E)}function c(S,E){return Wr(S)*Wr(E)>n}function u(S){var E,P,D,k,V;return{lineStart:function(){k=D=!1,V=1},point:function(j,te){var U=[j,te],W,Y=c(j,te),oe=r?Y?0:w(j,te):Y?w(j+(j<0?jn:-jn),te):0;if(!E&&(k=D=Y)&&S.lineStart(),Y!==D&&(W=m(E,U),(!W||Ag(E,W)||Ag(U,W))&&(U[0]+=vr,U[1]+=vr,Y=c(U[0],U[1]))),Y!==D)V=0,Y?(S.lineStart(),W=m(U,E),S.point(W[0],W[1])):(W=m(E,U),S.point(W[0],W[1]),S.lineEnd()),E=W;else if(i&&E&&r^Y){var _e;!(oe&P)&&(_e=m(U,E,!0))&&(V=0,r?(S.lineStart(),S.point(_e[0][0],_e[0][1]),S.point(_e[1][0],_e[1][1]),S.lineEnd()):(S.point(_e[1][0],_e[1][1]),S.lineEnd(),S.lineStart(),S.point(_e[0][0],_e[0][1])))}Y&&(!E||!Ag(E,U))&&S.point(U[0],U[1]),E=U,D=Y,P=oe},lineEnd:function(){D&&S.lineEnd(),E=null},clean:function(){return V|(k&&D)<<1}}}function m(S,E,P){var D=Nf(S),k=Nf(E),V=[1,0,0],j=hy(D,k),te=pg(j,j),U=j[0],W=te-U*U;if(!W)return!P&&S;var Y=n*te/W,oe=-n*U/W,_e=hy(V,j),se=dg(V,Y),ce=dg(j,oe);x0(se,ce);var me=_e,Ce=pg(se,me),Z=pg(me,me),fe=Ce*Ce-Z*(pg(se,se)-1);if(!(fe<0)){var Ke=Hf(fe),Se=dg(me,(-Ce-Ke)/Z);if(x0(Se,se),Se=uv(Se),!P)return Se;var Ze=S[0],tt=E[0],qe=S[1],Ot=E[1],wt;tt<Ze&&(wt=Ze,Ze=tt,tt=wt);var un=tt-Ze,qt=ji(un-jn)<vr,At=qt||un<vr;if(!qt&&Ot<qe&&(wt=qe,qe=Ot,Ot=wt),At?qt?qe+Ot>0^Se[1]<(ji(Se[0]-Ze)<vr?qe:Ot):qe<=Se[1]&&Se[1]<=Ot:un>jn^(Ze<=Se[0]&&Se[0]<=tt)){var hn=dg(me,(-Ce+Ke)/Z);return x0(hn,se),[Se,uv(hn)]}}}function w(S,E){var P=r?t:jn-t,D=0;return S<-P?D|=1:S>P&&(D|=2),E<-P?D|=4:E>P&&(D|=8),D}return dC(c,u,a,r?[0,-t]:[-jn,t-jn])}function mC(t){return function(e){var n=new fv;for(var r in t)n[r]=t[r];return n.stream=e,n}}function fv(){}fv.prototype={constructor:fv,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function gC(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],a=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),a!=null&&t.clipExtent(null),xR(n,t.stream(d2));var c=d2.result(),u=Math.min(r/(c[1][0]-c[0][0]),i/(c[1][1]-c[0][1])),m=+e[0][0]+(r-u*(c[1][0]+c[0][0]))/2,w=+e[0][1]+(i-u*(c[1][1]+c[0][1]))/2;return a!=null&&t.clipExtent(a),t.scale(u*150).translate([m,w])}function OR(t,e,n){return gC(t,[[0,0],e],n)}var g2=16,zR=Wr(30*Zs);function y2(t,e){return+e?BR(t,e):FR(t)}function FR(t){return mC({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function BR(t,e){function n(r,i,a,c,u,m,w,S,E,P,D,k,V,j){var te=w-r,U=S-i,W=te*te+U*U;if(W>4*e&&V--){var Y=c+P,oe=u+D,_e=m+k,se=Hf(Y*Y+oe*oe+_e*_e),ce=Vc(_e/=se),me=ji(ji(_e)-1)<vr||ji(a-E)<vr?(a+E)/2:Rf(oe,Y),Ce=t(me,ce),Z=Ce[0],fe=Ce[1],Ke=Z-r,Se=fe-i,Ze=U*Ke-te*Se;(Ze*Ze/W>e||ji((te*Ke+U*Se)/W-.5)>.3||c*P+u*D+m*k<zR)&&(n(r,i,a,c,u,m,Z,fe,me,Y/=se,oe/=se,_e,V,j),j.point(Z,fe),n(Z,fe,me,Y,oe,_e,w,S,E,P,D,k,V,j))}}return function(r){var i,a,c,u,m,w,S,E,P,D,k,V,j={point:te,lineStart:U,lineEnd:Y,polygonStart:function(){r.polygonStart(),j.lineStart=oe},polygonEnd:function(){r.polygonEnd(),j.lineStart=U}};function te(ce,me){ce=t(ce,me),r.point(ce[0],ce[1])}function U(){E=NaN,j.point=W,r.lineStart()}function W(ce,me){var Ce=Nf([ce,me]),Z=t(ce,me);n(E,P,S,D,k,V,E=Z[0],P=Z[1],S=ce,D=Ce[0],k=Ce[1],V=Ce[2],g2,r),r.point(E,P)}function Y(){j.point=te,r.lineEnd()}function oe(){U(),j.point=_e,j.lineEnd=se}function _e(ce,me){W(i=ce,me),a=E,c=P,u=D,m=k,w=V,j.point=W}function se(){n(E,P,S,D,k,V,a,c,i,u,m,w,g2,r),j.lineEnd=Y,Y()}return j}}var VR=mC({point:function(t,e){this.stream.point(t*Zs,e*Zs)}});function UR(t){return GR(function(){return t})()}function GR(t){var e,n=150,r=480,i=250,a,c,u=0,m=0,w=0,S=0,E=0,P,D,k=null,V=m2,j=null,te,U,W,Y=p2,oe=.5,_e=y2(Z,oe),se,ce;function me(Se){return Se=D(Se[0]*Zs,Se[1]*Zs),[Se[0]*n+a,c-Se[1]*n]}function Ce(Se){return Se=D.invert((Se[0]-a)/n,(c-Se[1])/n),Se&&[Se[0]*Cu,Se[1]*Cu]}function Z(Se,Ze){return Se=e(Se,Ze),[Se[0]*n+a,c-Se[1]*n]}me.stream=function(Se){return se&&ce===Se?se:se=VR(V(P,_e(Y(ce=Se))))},me.clipAngle=function(Se){return arguments.length?(V=+Se?NR(k=Se*Zs,6*Zs):(k=null,m2),Ke()):k*Cu},me.clipExtent=function(Se){return arguments.length?(Y=Se==null?(j=te=U=W=null,p2):TR(j=+Se[0][0],te=+Se[0][1],U=+Se[1][0],W=+Se[1][1]),Ke()):j==null?null:[[j,te],[U,W]]},me.scale=function(Se){return arguments.length?(n=+Se,fe()):n},me.translate=function(Se){return arguments.length?(r=+Se[0],i=+Se[1],fe()):[r,i]},me.center=function(Se){return arguments.length?(u=Se[0]%360*Zs,m=Se[1]%360*Zs,fe()):[u*Cu,m*Cu]},me.rotate=function(Se){return arguments.length?(w=Se[0]%360*Zs,S=Se[1]%360*Zs,E=Se.length>2?Se[2]%360*Zs:0,fe()):[w*Cu,S*Cu,E*Cu]},me.precision=function(Se){return arguments.length?(_e=y2(Z,oe=Se*Se),Ke()):Hf(oe)},me.fitExtent=function(Se,Ze){return gC(me,Se,Ze)},me.fitSize=function(Se,Ze){return OR(me,Se,Ze)};function fe(){D=uC(P=wR(w,S,E),e);var Se=e(u,m);return a=r-Se[0]*n,c=i+Se[1]*n,Ke()}function Ke(){return se=ce=null,me}return function(){return e=t.apply(this,arguments),me.invert=e.invert&&Ce,fe()}}function yC(t){return function(e,n){var r=Wr(e),i=Wr(n),a=t(r*i);return[a*i*Hr(e),a*Hr(n)]}}function _C(t){return function(e,n){var r=Hf(e*e+n*n),i=t(r),a=Hr(i),c=Wr(i);return[Rf(e*a,r*c),Vc(r&&n*a/r)]}}var qR=yC(function(t){return Hf(2/(1+t))});qR.invert=_C(function(t){return 2*Vc(t/2)});var vC=yC(function(t){return(t=lC(t))&&t/Hr(t)});vC.invert=_C(function(t){return t});function jR(){return UR(vC).scale(79.4188).clipAngle(180-.001)}function _2(t,e){return[t,e]}_2.invert=_2;function WR(t,e,n){n=n||{};var r=n.units||"kilometers",i=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var a=[];switch(t.type){case"GeometryCollection":return RI(t,function(c){var u=kg(c,e,r,i);u&&a.push(u)}),ov(a);case"FeatureCollection":return Qw(t,function(c){var u=kg(c,e,r,i);u&&Qw(u,function(m){m&&a.push(m)})}),ov(a)}return kg(t,e,r,i)}function kg(t,e,n,r){var i=t.properties||{},a=t.type==="Feature"?t.geometry:t;if(a.type==="GeometryCollection"){var c=[];return RI(t,function(V){var j=kg(V,e,n,r);j&&c.push(j)}),ov(c)}var u=HR(a),m={type:a.type,coordinates:xC(a.coordinates,u)},w=new n1,S=w.read(m),E=$D(eR(e,n),"meters"),P=wi.bufferOp(S,E,r),D=new jI;if(P=D.write(P),!bC(P.coordinates)){var k={type:P.type,coordinates:wC(P.coordinates,u)};return Ey(k,i)}}function bC(t){return Array.isArray(t[0])?bC(t[0]):isNaN(t[0])}function xC(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return xC(n,e)})}function wC(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return wC(n,e)})}function HR(t){var e=nR(t).geometry.coordinates,n=[-e[0],-e[1]];return jR().rotate(n).scale(Vo)}function ZR(t,e){var n=ry(t),r=ry(e),i=t.properties||{},a=PI.difference(n.coordinates,r.coordinates);return a.length===0?null:a.length===1?AI(a[0],i):kI(a,i)}function v2(t){let e;for(const n of t)e&&n[0]-e[0]>=180?n[0]-=360:e&&n[0]-e[0]<-180&&(n[0]+=360),e=n}function b2(t,e){const n=ZR({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},t);if(!n)return;n.properties={isMask:"y"};const r=WR(t,0);if(r.geometry.type==="Polygon")for(const i of r.geometry.coordinates)v2(i);else for(const i of r.geometry.coordinates)for(const a of i)v2(a);e({type:"FeatureCollection",features:[r,n]})}let x2={type:"FeatureCollection",features:[]};function XR(t,e,n=!0,r=!0,i={},a={},c={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let u,m=[],w,S;function E(){(c!=null&&c.fill||c!=null&&c.line)&&t.addSource("full-geom",{type:"geojson",data:x2}),c!=null&&c.fill&&t.addLayer({...c==null?void 0:c.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),c!=null&&c.line&&t.addLayer({...c==null?void 0:c.line,id:"full-geom-line",type:"line",source:"full-geom"})}t.loaded()?E():t.once("load",()=>{E()});const P=k=>{u==null||u({type:"mapClick",coordinates:[k.lngLat.lng,k.lngLat.lat]})};function D(k=!1){if(!e)throw new Error;const V=document.createElement("div");return k&&V.classList.add("marker-interactive"),new SD({props:{displayIn:"maplibre"},target:V}),new e.Marker({element:V,offset:[1,-13]})}return{setEventHandler(k){k?(u=k,t.on("click",P)):(u=void 0,t.off("click",P))},flyTo(k,V){t.flyTo({center:k,zoom:V,...i})},fitBounds(k,V,j){t.fitBounds([[k[0],k[1]],[k[2],k[3]]],{padding:V,maxZoom:j,...a})},indicateReverse(k){t.getCanvasContainer().style.cursor=k?"crosshair":""},setReverseMarker(k){!e||!n||(S?k?S.setLngLat(k):(S.remove(),S=void 0):k&&(S=(typeof n=="object"?new e.Marker(n):D()).setLngLat(k).addTo(t),S.getElement().classList.add("marker-reverse")))},setMarkers(k,V){if(!n)return;function j(te){var U;(U=t.getSource("full-geom"))==null||U.setData(te)}for(const te of m)te.remove();if(m.length=0,j(x2),!!e){if(V){let te=!1;if(V.geometry.type==="GeometryCollection"){const U=V.geometry.geometries.filter(W=>W.type==="Polygon"||W.type==="MultiPolygon");if(U.length>0){let W=U.pop();for(const Y of U)W=tR(W,Y);b2({...V,geometry:W},j),te=!0}else{const W=V.geometry.geometries.filter(Y=>Y.type==="LineString"||Y.type==="MultiLineString");W.length>0&&(j({...V,geometry:{type:"GeometryCollection",geometries:W}}),te=!0)}}if(!te){if(V.geometry.type==="Polygon"||V.geometry.type==="MultiPolygon")b2(V,j);else if(V.geometry.type==="LineString"||V.geometry.type==="MultiLineString"){j(V);return}}n&&m.push((typeof n=="object"?new e.Marker(n):D()).setLngLat(V.center).addTo(t))}if(r)for(const te of k??[]){if(te===V)continue;const U=(typeof r=="object"?new e.Marker(r):D(!0)).setLngLat(te.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(te.place_type[0]==="reverse"?te.place_name:te.place_name.replace(/,.*/,""))).addTo(t),W=U.getElement();W.addEventListener("click",Y=>{Y.stopPropagation(),u==null||u({type:"markerClick",id:te.id})}),W.addEventListener("mouseenter",()=>{u==null||u({type:"markerMouseEnter",id:te.id}),U.togglePopup()}),W.addEventListener("mouseleave",()=>{u==null||u({type:"markerMouseLeave",id:te.id}),U.togglePopup()}),m.push(U)}}},setSelectedMarker(k){w&&w.getElement().classList.toggle("marker-selected",!1),w=k>-1?m[k]:void 0,w==null||w.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const k=t.getCenter();return[t.getZoom(),k.lng,k.lat]}}}function YR(t){let e,n;return{c(){e=jl("svg"),n=jl("path"),Ve(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ve(e,"viewBox","0 0 14 14"),Ve(e,"width","13"),Ve(e,"height","13"),Ve(e,"class","svelte-en2qvf")},m(r,i){ke(r,e,i),Le(e,n)},p:gt,i:gt,o:gt,d(r){r&&Me(e)}}}class SC extends Qt{constructor(e){super(),Jt(this,e,null,YR,Gt,{})}}function KR(t){let e,n;return{c(){e=jl("svg"),n=jl("path"),Ve(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ve(e,"viewBox","0 0 30 30"),Ve(e,"fill","none"),Ve(e,"xmlns","http://www.w3.org/2000/svg"),Ve(e,"class","svelte-d2loi5")},m(r,i){ke(r,e,i),Le(e,n)},p:gt,i:gt,o:gt,d(r){r&&Me(e)}}}class EC extends Qt{constructor(e){super(),Jt(this,e,null,KR,Gt,{})}}function JR(t){let e,n;return{c(){e=Ne("img"),Eo(e.src,n=t[3]+"area.svg")||Ve(e,"src",n),Ve(e,"alt",t[6]),Ve(e,"class","svelte-ltkwvy")},m(r,i){ke(r,e,i)},p(r,i){i&8&&!Eo(e.src,n=r[3]+"area.svg")&&Ve(e,"src",n),i&64&&Ve(e,"alt",r[6])},d(r){r&&Me(e)}}}function QR(t){let e,n;return{c(){e=Ne("img"),Eo(e.src,n=t[3]+"reverse.svg")||Ve(e,"src",n),Ve(e,"alt",t[6]),Ve(e,"class","svelte-ltkwvy")},m(r,i){ke(r,e,i)},p(r,i){i&8&&!Eo(e.src,n=r[3]+"reverse.svg")&&Ve(e,"src",n),i&64&&Ve(e,"alt",r[6])},d(r){r&&Me(e)}}}function $R(t){let e,n;return{c(){e=Ne("img"),Eo(e.src,n=t[3]+"poi.svg")||Ve(e,"src",n),Ve(e,"alt",t[6]),Ve(e,"class","svelte-ltkwvy")},m(r,i){ke(r,e,i)},p(r,i){i&8&&!Eo(e.src,n=r[3]+"poi.svg")&&Ve(e,"src",n),i&64&&Ve(e,"alt",r[6])},d(r){r&&Me(e)}}}function eN(t){let e,n;return{c(){e=Ne("img"),Eo(e.src,n=t[3]+"postal_code.svg")||Ve(e,"src",n),Ve(e,"alt",t[6]),Ve(e,"class","svelte-ltkwvy")},m(r,i){ke(r,e,i)},p(r,i){i&8&&!Eo(e.src,n=r[3]+"postal_code.svg")&&Ve(e,"src",n),i&64&&Ve(e,"alt",r[6])},d(r){r&&Me(e)}}}function tN(t){let e,n;return{c(){e=Ne("img"),Eo(e.src,n=t[3]+"street.svg")||Ve(e,"src",n),Ve(e,"alt",t[6]),Ve(e,"class","svelte-ltkwvy")},m(r,i){ke(r,e,i)},p(r,i){i&8&&!Eo(e.src,n=r[3]+"street.svg")&&Ve(e,"src",n),i&64&&Ve(e,"alt",r[6])},d(r){r&&Me(e)}}}function nN(t){let e,n;return{c(){e=Ne("img"),Eo(e.src,n=t[3]+"road.svg")||Ve(e,"src",n),Ve(e,"alt",t[6]),Ve(e,"class","svelte-ltkwvy")},m(r,i){ke(r,e,i)},p(r,i){i&8&&!Eo(e.src,n=r[3]+"road.svg")&&Ve(e,"src",n),i&64&&Ve(e,"alt",r[6])},d(r){r&&Me(e)}}}function rN(t){let e,n;return{c(){e=Ne("img"),Eo(e.src,n=t[3]+"housenumber.svg")||Ve(e,"src",n),Ve(e,"alt",t[6]),Ve(e,"class","svelte-ltkwvy")},m(r,i){ke(r,e,i)},p(r,i){i&8&&!Eo(e.src,n=r[3]+"housenumber.svg")&&Ve(e,"src",n),i&64&&Ve(e,"alt",r[6])},d(r){r&&Me(e)}}}function iN(t){let e,n,r,i;return{c(){e=Ne("img"),Eo(e.src,n=t[5])||Ve(e,"src",n),Ve(e,"alt",t[4]),Ve(e,"class","svelte-ltkwvy")},m(a,c){ke(a,e,c),r||(i=Wt(e,"error",t[14]),r=!0)},p(a,c){c&32&&!Eo(e.src,n=a[5])&&Ve(e,"src",n),c&16&&Ve(e,"alt",a[4])},d(a){a&&Me(e),r=!1,i()}}}function w2(t){let e,n;return{c(){e=Ne("span"),n=Mt(t[6]),Ve(e,"class","secondary svelte-ltkwvy")},m(r,i){ke(r,e,i),Le(e,n)},p(r,i){i&64&&Hn(n,r[6])},d(r){r&&Me(e)}}}function oN(t){var se,ce;let e,n,r,i,a,c,u,m,w=(t[7]?t[0].place_name:t[0].place_name.replace(/,.*/,""))+"",S,E,P=t[2]==="always"||t[2]&&!t[0].address&&((se=t[0].properties)==null?void 0:se.kind)!=="road"&&((ce=t[0].properties)==null?void 0:ce.kind)!=="road_relation"&&!t[0].id.startsWith("address.")&&!t[0].id.startsWith("postal_code.")&&(!t[0].id.startsWith("poi.")||!t[5])&&!t[7],D,k,V=(t[7]?"":t[0].place_name.replace(/[^,]*,?\s*/,""))+"",j,te,U;function W(me,Ce){var Z,fe;return Ce&1&&(n=null),Ce&1&&(r=null),Ce&1&&(i=null),me[5]?iN:me[0].address?rN:((Z=me[0].properties)==null?void 0:Z.kind)==="road"||((fe=me[0].properties)==null?void 0:fe.kind)==="road_relation"?nN:(n==null&&(n=!!me[0].id.startsWith("address.")),n?tN:(r==null&&(r=!!me[0].id.startsWith("postal_code.")),r?eN:(i==null&&(i=!!me[0].id.startsWith("poi.")),i?$R:me[7]?QR:JR)))}let Y=W(t,-1),oe=Y(t),_e=P&&w2(t);return{c(){e=Ne("li"),oe.c(),a=at(),c=Ne("span"),u=Ne("span"),m=Ne("span"),S=Mt(w),E=at(),_e&&_e.c(),D=at(),k=Ne("span"),j=Mt(V),Ve(m,"class","primary svelte-ltkwvy"),Ve(u,"class","svelte-ltkwvy"),Ve(k,"class","line2 svelte-ltkwvy"),Ve(c,"class","texts svelte-ltkwvy"),Ve(e,"tabindex","0"),Ve(e,"data-selected",t[1]),Ve(e,"class","svelte-ltkwvy"),sl(e,"selected",t[1])},m(me,Ce){ke(me,e,Ce),oe.m(e,null),Le(e,a),Le(e,c),Le(c,u),Le(u,m),Le(m,S),Le(u,E),_e&&_e.m(u,null),Le(c,D),Le(c,k),Le(k,j),te||(U=[Wt(e,"mouseenter",t[12]),Wt(e,"focus",t[13])],te=!0)},p(me,[Ce]){var Z,fe;Y===(Y=W(me,Ce))&&oe?oe.p(me,Ce):(oe.d(1),oe=Y(me),oe&&(oe.c(),oe.m(e,a))),Ce&1&&w!==(w=(me[7]?me[0].place_name:me[0].place_name.replace(/,.*/,""))+"")&&Hn(S,w),Ce&37&&(P=me[2]==="always"||me[2]&&!me[0].address&&((Z=me[0].properties)==null?void 0:Z.kind)!=="road"&&((fe=me[0].properties)==null?void 0:fe.kind)!=="road_relation"&&!me[0].id.startsWith("address.")&&!me[0].id.startsWith("postal_code.")&&(!me[0].id.startsWith("poi.")||!me[5])&&!me[7]),P?_e?_e.p(me,Ce):(_e=w2(me),_e.c(),_e.m(u,null)):_e&&(_e.d(1),_e=null),Ce&1&&V!==(V=(me[7]?"":me[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Hn(j,V),Ce&2&&Ve(e,"data-selected",me[1]),Ce&2&&sl(e,"selected",me[1])},i:gt,o:gt,d(me){me&&Me(e),oe.d(),_e&&_e.d(),te=!1,Ni(U)}}}function sN(t,e,n){var W;let r,i,{feature:a}=e,{selected:c=!1}=e,{showPlaceType:u}=e,{missingIconsCache:m}=e,{iconsBaseUrl:w}=e;const S=(W=a.properties)==null?void 0:W.categories;let E,P,D=0,k=a.place_type[0]==="reverse";function V(Y){P&&m.add(P),n(10,D++,D)}function j(Y){In.call(this,t,Y)}function te(Y){In.call(this,t,Y)}const U=Y=>V(Y.currentTarget);return t.$$set=Y=>{"feature"in Y&&n(0,a=Y.feature),"selected"in Y&&n(1,c=Y.selected),"showPlaceType"in Y&&n(2,u=Y.showPlaceType),"missingIconsCache"in Y&&n(9,m=Y.missingIconsCache),"iconsBaseUrl"in Y&&n(3,w=Y.iconsBaseUrl)},t.$$.update=()=>{var Y,oe,_e,se;if(t.$$.dirty&3640)do n(11,r--,r),n(4,E=S==null?void 0:S[r]),n(5,P=E?w+E.replace(/ /g,"_")+".svg":void 0);while(r>-1&&(!P||m.has(P)));t.$$.dirty&1&&n(6,i=a.id.startsWith("poi.")?(oe=(Y=a.properties)==null?void 0:Y.categories)==null?void 0:oe.join(", "):((se=(_e=a.properties)==null?void 0:_e.place_type_name)==null?void 0:se[0])??a.place_type[0])},n(11,r=(S==null?void 0:S.length)??0),[a,c,u,w,E,P,i,k,V,m,D,r,j,te,U]}class aN extends Qt{constructor(e){super(),Jt(this,e,sN,oN,Gt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function lN(t){let e;return{c(){e=Ne("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ve(e,"class","svelte-7cmwmc")},m(n,r){ke(n,e,r)},p:gt,i:gt,o:gt,d(n){n&&Me(e)}}}class uN extends Qt{constructor(e){super(),Jt(this,e,null,lN,Gt,{})}}function cN(t){let e,n;return{c(){e=jl("svg"),n=jl("path"),Ve(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ve(e,"viewBox","0 0 60.006 21.412"),Ve(e,"width","14"),Ve(e,"height","20"),Ve(e,"class","svelte-en2qvf")},m(r,i){ke(r,e,i),Le(e,n)},p:gt,i:gt,o:gt,d(r){r&&Me(e)}}}class hN extends Qt{constructor(e){super(),Jt(this,e,null,cN,Gt,{})}}function fN(t){let e,n,r;return{c(){e=jl("svg"),n=jl("circle"),r=jl("path"),Ve(n,"cx","4.789"),Ve(n,"cy","4.787"),Ve(n,"r","3.85"),Si(n,"stroke-width","1.875"),Si(n,"fill","none"),Ve(r,"d","M12.063 12.063 7.635 7.635"),Si(r,"stroke-width","1.875"),Si(r,"stroke-linecap","round"),Ve(e,"xmlns","http://www.w3.org/2000/svg"),Ve(e,"width","13"),Ve(e,"height","13"),Ve(e,"viewBox","0 0 13 13"),Ve(e,"class","svelte-1bpbt60")},m(i,a){ke(i,e,a),Le(e,n),Le(e,r)},p:gt,i:gt,o:gt,d(i){i&&Me(e)}}}class pN extends Qt{constructor(e){super(),Jt(this,e,null,fN,Gt,{})}}function dN(t,e,n){const r=e[1],i=e[0],a=r-i;return t===r&&n?t:((t-i)%a+a)%a+i}function S2(t){const e=[...t];return e[2]<e[0]&&(e[2]+=360),e}let nd;async function mN(t,e,n){const r=t==null?void 0:t.getCenterAndZoom();for(const i of e??[])if(!(r&&(i.minZoom!=null&&i.minZoom>r[0]||i.maxZoom!=null&&i.maxZoom<r[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(nd&&i.cachedLocationExpiry&&nd.time+i.cachedLocationExpiry>Date.now()){if(!nd.coords)break e;return nd.coords}let a;try{return a=await new Promise((c,u)=>{n.signal.addEventListener("abort",()=>{u(Error("aborted"))}),navigator.geolocation.getCurrentPosition(m=>{c([m.coords.longitude,m.coords.latitude].map(w=>w.toFixed(6)).join(","))},m=>{u(m)},i)}),a}catch{}finally{i.cachedLocationExpiry&&(nd={time:Date.now(),coords:a})}if(n.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(r&&i.type==="map-center")return r[1].toFixed(6)+","+r[2].toFixed(6)}}const E2=/(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?/i,I2=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?/i,C2=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?/i,T2=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?/i;function gN(t){if(!["DMS","DM","DD"].includes(t))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){if(t=="DD")return this.decimalCoordinates;const e=this.decimalCoordinates.split(",").map(c=>Number(c.trim()));let n=L2(e[0],t),r=L2(e[1],t);n.endsWith('.0"')&&r.endsWith('.0"')&&(n=n.replace(/\.0"$/,'"'),r=r.replace(/\.0"$/,'"'));const i=e[0]>=0?" N":" S",a=e[1]>=0?" E":" W";return`${n+i}, ${r+a}`}else throw new Error("no decimal coordinates to convert")}function L2(t,e){const n=Math.abs(t),r=Math.floor(n),i=(n-r)*60;if(e=="DM"){let u=yN(i,3).toFixed(3).padStart(6,"0");return`${r}° ${u}'`}let a=Math.floor(i),c=((i-a)*60).toFixed(1).padStart(4,"0");return a=a.toString().padStart(2,"0"),`${r}° ${a}' ${c}"`}function yN(t,e){const n=Math.pow(10,e);return Math.round((t+Number.EPSILON)*n)/n}function h1(t,e){e||(e=5),t=t.replace(/\s+/g," ").trim();let n=null,r=null,i="",a="",c=[],u=!1;if(E2.test(t))if(c=E2.exec(t),u=yg(c),u){if(n=c[2],r=c[6],n.includes(",")&&(n=n.replace(",",".")),r.includes(",")&&(r=r.replace(",",".")),Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");c[1]?(i=c[1],a=c[5]):c[4]&&(i=c[4],a=c[8])}else throw new Error("invalid decimal coordinate format");else if(I2.test(t))if(c=I2.exec(t),u=yg(c),u)n=Math.abs(parseInt(c[2])),c[4]&&(n+=c[4]/60),c[6]&&(n+=c[6].replace(",",".")/3600),parseInt(c[2])<0&&(n=-1*n),r=Math.abs(parseInt(c[9])),c[11]&&(r+=c[11]/60),c[13]&&(r+=c[13].replace(",",".")/3600),parseInt(c[9])<0&&(r=-1*r),c[1]?(i=c[1],a=c[8]):c[7]&&(i=c[7],a=c[14]);else throw new Error("invalid DMS coordinates format");else if(C2.test(t))if(c=C2.exec(t),u=yg(c),u)n=Math.abs(parseInt(c[2])),c[4]&&(n+=c[4]/60),c[6]&&(n+=c[6]/3600),parseInt(c[2])<0&&(n=-1*n),r=Math.abs(parseInt(c[10])),c[12]&&(r+=c[12]/60),c[14]&&(r+=c[14]/3600),parseInt(c[10])<0&&(r=-1*r),c[1]?(i=c[1],a=c[9]):c[8]&&(i=c[8],a=c[16]);else throw new Error("invalid DMS coordinates format");else if(T2.test(t))if(c=T2.exec(t),u=yg(c),u)n=Math.abs(parseInt(c[2])),c[4]&&(n+=c[4]/60),c[6]&&(n+=c[6]/3600),parseInt(c[2])<0&&(n=-1*n),r=Math.abs(parseInt(c[10])),c[12]&&(r+=c[12]/60),c[14]&&(r+=c[14]/3600),parseInt(c[10])<0&&(r=-1*r),c[1]?(i=c[1],a=c[9]):c[8]&&(i=c[8],a=c[16]);else throw new Error("invalid coordinates format");if(u){if(Math.abs(r)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if((i||a)&&(!i||!a))throw new Error("invalid coordinates format");if(i&&i==a)throw new Error("invalid coordinates format");let m=/S|SOUTH/i;m.test(i)&&n>0&&(n=-1*n),m=/W|WEST/i,m.test(a)&&r>0&&(r=-1*r);const w=c[0].trim();let S,E;const P=/[,/;\u0020]/g,D=w.match(P);if(D==null){const j=Math.floor(t.length/2);S=w.substring(0,j).trim(),E=w.substring(j).trim()}else{let j;D.length%2==1?j=Math.floor(D.length/2):j=D.length/2-1;let te=0;if(j==0)te=w.indexOf(D[0]),S=w.substring(0,te).trim(),E=w.substring(te+1).trim();else{let U=0,W=0;for(;U<=j;)te=w.indexOf(D[U],W),W=te+1,U++;S=w.substring(0,te).trim(),E=w.substring(te+1).trim()}}const k=S.split(".");if(k.length==2&&k[1]==0&&k[1].length!=2)throw new Error("invalid coordinates format");const V=E.split(".");if(V.length==2&&V[1]==0&&V[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return isNaN(n)&&n.includes(",")&&(n=n.replace(",",".")),n=Number(Number(n).toFixed(e)),isNaN(r)&&r.includes(",")&&(r=r.replace(",",".")),r=Number(Number(r).toFixed(e)),Object.freeze({verbatimCoordinates:w,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:n,decimalLongitude:r,decimalCoordinates:`${n},${r}`,closeEnough:_N,toCoordinateFormat:gN})}else throw new Error("coordinates pattern match failed")}function yg(t){if(!isNaN(t[0]))return!1;const e=[...t];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,r=/[eastsouthnorthwest]+/i,i=e.length/2;for(let a=0;a<i;a++){const c=e[a],u=e[a+i],m=n.test(c)&&n.test(u),w=r.test(c)&&r.test(u),S=c==u;if(!(c==null&&u==null)){if(c==null||u==null)return!1;if(m||w||S)continue;return!1}}return!0}function P2(t,e){const n=Math.abs(t-e);return Number(n.toFixed(6))<=1e-5}function _N(t){if(t.includes(",")){const e=t.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return P2(this.decimalLatitude,Number(e[0]))&&P2(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const vN=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});h1.to=vN;const bN=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],xN={decimalLatitude:40.123,decimalLongitude:-74.123},wN=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],SN=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function EN(){const t=[];return bN.forEach(e=>{e.decimalLatitude?t.push(e):t.push({...e,...xN})}),[...t,...wN,...SN]}const IN=EN();h1.formats=IN.map(t=>t.verbatimCoordinates);const CN=h1;function M2(t,e,n){const r=t.slice();return r[81]=e[n],r[83]=n,r}function A2(t){let e,n;return e=new uN({}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function k2(t){let e,n,r,i,a;return n=new hN({}),{c(){e=Ne("button"),lt(n.$$.fragment),Ve(e,"type","button"),Ve(e,"title",t[9]),Ve(e,"class","svelte-zh3kmv"),sl(e,"active",t[0])},m(c,u){ke(c,e,u),it(n,e,null),r=!0,i||(a=Wt(e,"click",t[67]),i=!0)},p(c,u){(!r||u[0]&512)&&Ve(e,"title",c[9]),(!r||u[0]&1)&&sl(e,"active",c[0])},i(c){r||(be(n.$$.fragment,c),r=!0)},o(c){Te(n.$$.fragment,c),r=!1},d(c){c&&Me(e),ot(n),i=!1,a()}}}function TN(t){let e,n=[],r=new Map,i,a,c,u=zr(t[14]);const m=w=>w[81].id+(w[81].address?","+w[81].address:"");for(let w=0;w<u.length;w+=1){let S=M2(t,u,w),E=m(S);r.set(E,n[w]=D2(E,S))}return{c(){e=Ne("ul");for(let w=0;w<n.length;w+=1)n[w].c();Ve(e,"class","svelte-zh3kmv")},m(w,S){ke(w,e,S);for(let E=0;E<n.length;E+=1)n[E]&&n[E].m(e,null);i=!0,a||(c=[Wt(e,"mouseleave",t[71]),Wt(e,"blur",t[72])],a=!0)},p(w,S){S[0]&17880064&&(u=zr(w[14]),On(),n=$L(n,S,m,1,w,u,r,e,QL,D2,null,M2),zn())},i(w){if(!i){for(let S=0;S<u.length;S+=1)be(n[S]);i=!0}},o(w){for(let S=0;S<n.length;S+=1)Te(n[S]);i=!1},d(w){w&&Me(e);for(let S=0;S<n.length;S+=1)n[S].d();a=!1,Ni(c)}}}function LN(t){let e,n,r,i,a,c;return n=new EC({}),{c(){e=Ne("div"),lt(n.$$.fragment),r=at(),i=Ne("div"),a=Mt(t[7]),Ve(i,"class","svelte-zh3kmv"),Ve(e,"class","no-results svelte-zh3kmv")},m(u,m){ke(u,e,m),it(n,e,null),Le(e,r),Le(e,i),Le(i,a),c=!0},p(u,m){(!c||m[0]&128)&&Hn(a,u[7])},i(u){c||(be(n.$$.fragment,u),c=!0)},o(u){Te(n.$$.fragment,u),c=!1},d(u){u&&Me(e),ot(n)}}}function PN(t){let e="",n;return{c(){n=Mt(e)},m(r,i){ke(r,n,i)},p:gt,i:gt,o:gt,d(r){r&&Me(n)}}}function MN(t){let e,n,r,i,a,c,u,m,w,S,E;return n=new EC({}),m=new SC({}),{c(){e=Ne("div"),lt(n.$$.fragment),r=at(),i=Ne("div"),a=Mt(t[6]),c=at(),u=Ne("button"),lt(m.$$.fragment),Ve(i,"class","svelte-zh3kmv"),Ve(u,"class","svelte-zh3kmv"),Ve(e,"class","error svelte-zh3kmv")},m(P,D){ke(P,e,D),it(n,e,null),Le(e,r),Le(e,i),Le(i,a),Le(e,c),Le(e,u),it(m,u,null),w=!0,S||(E=Wt(u,"click",t[68]),S=!0)},p(P,D){(!w||D[0]&64)&&Hn(a,P[6])},i(P){w||(be(n.$$.fragment,P),be(m.$$.fragment,P),w=!0)},o(P){Te(n.$$.fragment,P),Te(m.$$.fragment,P),w=!1},d(P){P&&Me(e),ot(n),ot(m),S=!1,E()}}}function D2(t,e){let n,r,i;function a(){return e[69](e[83])}function c(){return e[70](e[81])}return r=new aN({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),r.$on("mouseenter",a),r.$on("focus",c),{key:t,first:null,c(){n=Yr(),lt(r.$$.fragment),this.first=n},m(u,m){ke(u,n,m),it(r,u,m),i=!0},p(u,m){e=u;const w={};m[0]&16384&&(w.feature=e[81]),m[0]&1024&&(w.showPlaceType=e[10]),m[0]&49152&&(w.selected=e[15]===e[83]),m[0]&4096&&(w.iconsBaseUrl=e[12]),r.$set(w)},i(u){i||(be(r.$$.fragment,u),i=!0)},o(u){Te(r.$$.fragment,u),i=!1},d(u){u&&Me(n),ot(r,u)}}}function AN(t){let e,n,r,i,a,c,u,m,w,S,E,P,D,k,V,j,te,U,W,Y,oe,_e=!1;a=new pN({}),E=new SC({});let se=t[19]&&A2(),ce=t[5]===!0&&k2(t);const me=t[59].default,Ce=ri(me,t,t[58],null),Z=[MN,PN,LN,TN],fe=[];function Ke(Se,Ze){var tt,qe;return Se[18]?0:Se[16]?((tt=Se[14])==null?void 0:tt.length)===0?2:Se[16]&&((qe=Se[14])!=null&&qe.length)?3:-1:1}return~(j=Ke(t))&&(te=fe[j]=Z[j](t)),{c(){e=at(),n=Ne("form"),r=Ne("div"),i=Ne("button"),lt(a.$$.fragment),c=at(),u=Ne("input"),m=at(),w=Ne("div"),S=Ne("button"),lt(E.$$.fragment),P=at(),se&&se.c(),D=at(),ce&&ce.c(),k=at(),Ce&&Ce.c(),V=at(),te&&te.c(),Ve(i,"class","search-button svelte-zh3kmv"),Ve(i,"type","button"),Ve(u,"placeholder",t[8]),Ve(u,"aria-label",t[8]),Ve(u,"class","svelte-zh3kmv"),Ve(S,"type","button"),Ve(S,"title",t[3]),Ve(S,"class","svelte-zh3kmv"),Ve(w,"class","clear-button-container svelte-zh3kmv"),sl(w,"displayable",t[1]!==""),Ve(r,"class","input-group svelte-zh3kmv"),Ve(n,"tabindex","0"),Ve(n,"class",U=Dg(t[2])+" svelte-zh3kmv"),sl(n,"can-collapse",t[4]&&t[1]==="")},m(Se,Ze){ke(Se,e,Ze),ke(Se,n,Ze),Le(n,r),Le(r,i),it(a,i,null),Le(r,c),Le(r,u),t[61](u),Go(u,t[1]),Le(r,m),Le(r,w),Le(w,S),it(E,S,null),Le(w,P),se&&se.m(w,null),Le(r,D),ce&&ce.m(r,null),Le(r,k),Ce&&Ce.m(r,null),Le(n,V),~j&&fe[j].m(n,null),W=!0,Y||(oe=[Wt(i,"click",t[60]),Wt(u,"input",t[62]),Wt(u,"focus",t[63]),Wt(u,"blur",t[64]),Wt(u,"keydown",t[22]),Wt(u,"input",t[65]),Wt(S,"click",t[66]),Wt(n,"submit",WL(t[21]))],Y=!0)},p(Se,Ze){(!W||Ze[0]&256)&&Ve(u,"placeholder",Se[8]),(!W||Ze[0]&256)&&Ve(u,"aria-label",Se[8]),Ze[0]&2&&u.value!==Se[1]&&Go(u,Se[1]),(!W||Ze[0]&8)&&Ve(S,"title",Se[3]),Se[19]?se?Ze[0]&524288&&be(se,1):(se=A2(),se.c(),be(se,1),se.m(w,null)):se&&(On(),Te(se,1,1,()=>{se=null}),zn()),(!W||Ze[0]&2)&&sl(w,"displayable",Se[1]!==""),Se[5]===!0?ce?(ce.p(Se,Ze),Ze[0]&32&&be(ce,1)):(ce=k2(Se),ce.c(),be(ce,1),ce.m(r,k)):ce&&(On(),Te(ce,1,1,()=>{ce=null}),zn()),Ce&&Ce.p&&(!W||Ze[1]&134217728)&&oi(Ce,me,Se,Se[58],W?ii(me,Se[58],Ze,null):si(Se[58]),null);let tt=j;j=Ke(Se),j===tt?~j&&fe[j].p(Se,Ze):(te&&(On(),Te(fe[tt],1,1,()=>{fe[tt]=null}),zn()),~j?(te=fe[j],te?te.p(Se,Ze):(te=fe[j]=Z[j](Se),te.c()),be(te,1),te.m(n,null)):te=null),(!W||Ze[0]&4&&U!==(U=Dg(Se[2])+" svelte-zh3kmv"))&&Ve(n,"class",U),(!W||Ze[0]&22)&&sl(n,"can-collapse",Se[4]&&Se[1]==="")},i(Se){W||(be(_e),be(a.$$.fragment,Se),be(E.$$.fragment,Se),be(se),be(ce),be(Ce,Se),be(te),W=!0)},o(Se){Te(_e),Te(a.$$.fragment,Se),Te(E.$$.fragment,Se),Te(se),Te(ce),Te(Ce,Se),Te(te),W=!1},d(Se){Se&&(Me(e),Me(n)),ot(a),t[61](null),ot(E),se&&se.d(),ce&&ce.d(),Ce&&Ce.d(Se),~j&&fe[j].d(),Y=!1,Ni(oe)}}}function kN(t,e,n){let r,{$$slots:i={},$$scope:a}=e,{class:c=void 0}=e,{apiKey:u}=e,{bbox:m=void 0}=e,{clearButtonTitle:w="clear"}=e,{clearOnBlur:S=!1}=e,{collapsed:E=!1}=e,{country:P=void 0}=e,{debounceSearch:D=200}=e,{enableReverse:k=!1}=e,{errorMessage:V="Something went wrong…"}=e,{filter:j=()=>!0}=e,{flyTo:te=!0}=e,{fuzzyMatch:U=!0}=e,{language:W=void 0}=e,{limit:Y=void 0}=e,{mapController:oe=void 0}=e,{minLength:_e=2}=e,{noResultsMessage:se="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ce="Search"}=e,{proximity:me=[{type:"server-geolocation"}]}=e,{reverseActive:Ce=k==="always"}=e,{reverseButtonTitle:Z="toggle reverse geocoding"}=e,{searchValue:fe=""}=e,{showFullGeometry:Ke=!0}=e,{showPlaceType:Se="ifNeeded"}=e,{showResultsWhileTyping:Ze=!0}=e,{selectFirst:tt=!0}=e,{flyToSelected:qe=!1}=e,{markerOnSelected:Ot=!0}=e,{types:wt=void 0}=e,{excludeTypes:un=!1}=e,{zoom:qt=16}=e,{maxZoom:At=18}=e,{apiUrl:hn="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Tn={}}=e,{iconsBaseUrl:yn="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.2/icons/"}=e,{adjustUrlQuery:_n=Q=>{}}=e;function kn(){Oe.focus()}function wr(){Oe.blur()}function kr(Q,we=!0){n(1,fe=Q),we?(n(15,Yt=-1),xl()):(Kr(),setTimeout(()=>{Oe.focus(),Oe.select()}))}function Sr(){n(14,ge=void 0),n(55,It=void 0),n(15,Yt=-1)}function dr(){n(54,Pe=[]),n(55,It=void 0)}let Qe=!1,ge,Pe,It,Dn="",Oe,Yt=-1,Dr,ln=[],er,Mo,ps,Os;const Va=new Set,Pi=ju();as(()=>{oe&&(oe.setEventHandler(void 0),oe.indicateReverse(!1),oe.setSelectedMarker(-1),oe.setMarkers(void 0,void 0))});function xl(Q){if(Mo&&(clearTimeout(Mo),Mo=void 0),Yt>-1&&ge)n(55,It=ge[Yt]),n(1,fe=It.place_type[0]==="reverse"?It.place_name:It.place_name.replace(/,.*/,"")),n(18,Dr=void 0),n(54,Pe=void 0),n(15,Yt=-1);else if(fe){const we=Q||!ds(fe);rt(fe,{exact:!0}).then(()=>{n(54,Pe=ge),n(55,It=void 0),we&&Ko()}).catch(de=>n(18,Dr=de))}}function ds(Q){try{return CN(Q,6)}catch{return!1}}async function rt(Q,{byId:we=!1,exact:de=!1}={}){n(18,Dr=void 0),er==null||er.abort();const Ae=new AbortController;n(19,er=Ae);try{const Ue=ds(Q),We=new URLSearchParams;if(W!==void 0&&We.set("language",Array.isArray(W)?W.join(","):W??""),wt&&We.set("types",wt.join(",")),un&&We.set("excludeTypes",String(un)),m&&We.set("bbox",m.map(Ht=>Ht.toFixed(6)).join(",")),P&&We.set("country",Array.isArray(P)?P.join(","):P),!we&&!Ue){const Ht=await mN(oe,me,Ae);Ht&&We.set("proximity",Ht),(de||!Ze)&&We.set("autocomplete","false"),We.set("fuzzyMatch",String(U))}Y!==void 0&&(!Ue||(wt==null?void 0:wt.length)===1)&&We.set("limit",String(Y)),We.set("key",u),_n(We);const Xe=hn+"/"+encodeURIComponent(Ue?Ue.decimalLongitude+","+Ue.decimalLatitude:Q)+".json?"+We.toString();if(Xe===Dn){we?(n(14,ge=void 0),n(55,It=ln[0])):n(14,ge=ln);return}Dn=Xe;const Tt=await fetch(Xe,{signal:Ae.signal,...Tn});if(!Tt.ok)throw new Error(await Tt.text());const Dt=await Tt.json();Pi("response",{url:Xe,featureCollection:Dt}),we?(n(14,ge=void 0),n(55,It=Dt.features[0]),ln=[It]):(n(14,ge=Dt.features.filter(j)),Ue&&ge.unshift({type:"Feature",properties:{},id:"reverse_"+Ue.decimalLongitude+"_"+Ue.decimalLatitude,text:Ue.decimalLatitude+", "+Ue.decimalLongitude,place_name:Ue.decimalLatitude+", "+Ue.decimalLongitude,place_type:["reverse"],center:[Ue.decimalLongitude,Ue.decimalLatitude],bbox:[Ue.decimalLongitude,Ue.decimalLatitude,Ue.decimalLongitude,Ue.decimalLatitude],geometry:{type:"Point",coordinates:[Ue.decimalLongitude,Ue.decimalLatitude]}}),ln=ge,Ue&&Oe.focus())}catch(Ue){if(Ue&&typeof Ue=="object"&&"name"in Ue&&Ue.name==="AbortError")return;throw Ue}finally{Ae===er&&n(19,er=void 0)}}function Ko(){var de;if(!(Pe!=null&&Pe.length)||!te)return;const Q=[180,90,-180,-90],we=!Pe.some(Ae=>!Ae.matching_text);for(const Ae of Pe)if(we||!Ae.matching_text)for(const Ue of[0,1,2,3])Q[Ue]=Math[Ue<2?"min":"max"](Q[Ue],((de=Ae.bbox)==null?void 0:de[Ue])??Ae.center[Ue%2]);oe&&Pe.length>0&&(It&&Q[0]===Q[2]&&Q[1]===Q[3]?oe.flyTo(It.center,qt):oe.fitBounds(S2(Q),50,At))}function Ki(Q){n(0,Ce=k==="always"),n(14,ge=void 0),n(55,It=void 0),n(15,Yt=-1),kr(Q[1].toFixed(6)+", "+dN(Q[0],[-180,180],!0).toFixed(6),!1)}function wl(Q){if(!ge)return;let we=Q.key==="ArrowDown"?1:Q.key==="ArrowUp"?-1:0;we&&(Yt===(tt?0:-1)&&we===-1&&n(15,Yt=ge.length),n(15,Yt+=we),Yt>=ge.length&&n(15,Yt=-1),Yt<0&&tt&&n(15,Yt=0),Q.preventDefault())}function Kr(Q=!0){if(n(18,Dr=void 0),Ze){if(Mo&&clearTimeout(Mo),fe.length<_e)return;const we=fe;Mo=window.setTimeout(()=>{rt(we).catch(de=>n(18,Dr=de))},Q?D:0)}else n(14,ge=void 0),n(18,Dr=void 0)}function ht(Q){n(55,It=Q),n(1,fe=Q.place_name),n(15,Yt=-1)}const tn=()=>Oe.focus();function $t(Q){Zn[Q?"unshift":"push"](()=>{Oe=Q,n(17,Oe)})}function Rr(){fe=this.value,n(1,fe),n(13,Qe),n(27,S)}const Jo=()=>n(13,Qe=!0),Kt=()=>n(13,Qe=!1),ga=()=>Kr(),Vr=()=>{n(1,fe=""),Oe.focus()},le=()=>n(0,Ce=!Ce),B=()=>n(18,Dr=void 0),q=Q=>n(15,Yt=Q),J=Q=>ht(Q),ne=()=>{tt||n(15,Yt=-1)},xe=()=>{};return t.$$set=Q=>{"class"in Q&&n(2,c=Q.class),"apiKey"in Q&&n(25,u=Q.apiKey),"bbox"in Q&&n(26,m=Q.bbox),"clearButtonTitle"in Q&&n(3,w=Q.clearButtonTitle),"clearOnBlur"in Q&&n(27,S=Q.clearOnBlur),"collapsed"in Q&&n(4,E=Q.collapsed),"country"in Q&&n(28,P=Q.country),"debounceSearch"in Q&&n(29,D=Q.debounceSearch),"enableReverse"in Q&&n(5,k=Q.enableReverse),"errorMessage"in Q&&n(6,V=Q.errorMessage),"filter"in Q&&n(30,j=Q.filter),"flyTo"in Q&&n(31,te=Q.flyTo),"fuzzyMatch"in Q&&n(32,U=Q.fuzzyMatch),"language"in Q&&n(33,W=Q.language),"limit"in Q&&n(34,Y=Q.limit),"mapController"in Q&&n(35,oe=Q.mapController),"minLength"in Q&&n(36,_e=Q.minLength),"noResultsMessage"in Q&&n(7,se=Q.noResultsMessage),"placeholder"in Q&&n(8,ce=Q.placeholder),"proximity"in Q&&n(37,me=Q.proximity),"reverseActive"in Q&&n(0,Ce=Q.reverseActive),"reverseButtonTitle"in Q&&n(9,Z=Q.reverseButtonTitle),"searchValue"in Q&&n(1,fe=Q.searchValue),"showFullGeometry"in Q&&n(38,Ke=Q.showFullGeometry),"showPlaceType"in Q&&n(10,Se=Q.showPlaceType),"showResultsWhileTyping"in Q&&n(39,Ze=Q.showResultsWhileTyping),"selectFirst"in Q&&n(11,tt=Q.selectFirst),"flyToSelected"in Q&&n(40,qe=Q.flyToSelected),"markerOnSelected"in Q&&n(41,Ot=Q.markerOnSelected),"types"in Q&&n(42,wt=Q.types),"excludeTypes"in Q&&n(43,un=Q.excludeTypes),"zoom"in Q&&n(44,qt=Q.zoom),"maxZoom"in Q&&n(45,At=Q.maxZoom),"apiUrl"in Q&&n(46,hn=Q.apiUrl),"fetchParameters"in Q&&n(47,Tn=Q.fetchParameters),"iconsBaseUrl"in Q&&n(12,yn=Q.iconsBaseUrl),"adjustUrlQuery"in Q&&n(48,_n=Q.adjustUrlQuery),"$$scope"in Q&&n(58,a=Q.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,ps=Qe),S&&!Qe&&n(1,fe="")}),t.$$.dirty[0]&16386|t.$$.dirty[1]&32&&fe.length<_e&&(n(55,It=void 0),n(14,ge=void 0),n(18,Dr=void 0),n(54,Pe=ge)),t.$$.dirty[1]&16777344&&Ke&&It&&!It.address&&It.geometry.type==="Point"&&It.place_type[0]!=="reverse"&&rt(It.id,{byId:!0}).catch(Q=>n(18,Dr=Q)),t.$$.dirty[1]&50356241&&(oe&&It&&It.id!==Os&&te&&(!It.bbox||It.bbox[0]===It.bbox[2]&&It.bbox[1]===It.bbox[3]?oe.flyTo(It.center,It.id.startsWith("poi.")||It.id.startsWith("address.")?At:qt):oe.fitBounds(S2(It.bbox),50,At),n(14,ge=void 0),n(54,Pe=void 0),n(15,Yt=-1)),n(56,Os=It==null?void 0:It.id)),t.$$.dirty[0]&18432&&tt&&ge!=null&&ge.length&&n(15,Yt=0),t.$$.dirty[0]&2050&&(tt||n(15,Yt=-1)),t.$$.dirty[0]&16384|t.$$.dirty[1]&8388608&&Pe!==ge&&n(54,Pe=void 0),t.$$.dirty[0]&81921|t.$$.dirty[1]&8388624&&oe&&oe.setEventHandler(Q=>{switch(Q.type){case"mapClick":Ce&&Ki(Q.coordinates);break;case"markerClick":{const we=ge==null?void 0:ge.find(de=>de.id===Q.id);we&&ht(we)}break;case"markerMouseEnter":Pe&&n(15,Yt=ps?(ge==null?void 0:ge.findIndex(we=>we.id===Q.id))??-1:-1);break;case"markerMouseLeave":Pe&&n(15,Yt=-1);break}}),t.$$.dirty[0]&49152&&n(57,r=ge==null?void 0:ge[Yt]),t.$$.dirty[1]&67133969&&oe&&r&&te&&qe&&oe.flyTo(r.center,r.id.startsWith("poi.")||r.id.startsWith("address.")?At:qt),t.$$.dirty[1]&1040&&(Ot||oe==null||oe.setMarkers(void 0,void 0)),t.$$.dirty[1]&75498512&&oe&&Ot&&!Pe&&(oe.setMarkers(r?[r]:void 0,void 0),oe.setSelectedMarker(r?0:-1)),t.$$.dirty[1]&25165840&&oe&&oe.setMarkers(Pe,It),t.$$.dirty[0]&32768|t.$$.dirty[1]&8388624&&Pe&&oe&&oe.setSelectedMarker(Yt),t.$$.dirty[0]&2|t.$$.dirty[1]&16&&oe){const Q=ds(fe);oe.setReverseMarker(Q?[Q.decimalLongitude,Q.decimalLatitude]:void 0)}t.$$.dirty[1]&67108864&&Pi("select",r),t.$$.dirty[1]&16777216&&Pi("pick",It),t.$$.dirty[0]&81920&&Pi("optionsVisibilityChange",ps&&!!ge),t.$$.dirty[0]&16384&&Pi("featuresListed",ge),t.$$.dirty[1]&8388608&&Pi("featuresMarked",Pe),t.$$.dirty[0]&1&&Pi("reverseToggle",Ce),t.$$.dirty[0]&2&&Pi("queryChange",fe),t.$$.dirty[0]&1|t.$$.dirty[1]&16&&oe&&oe.indicateReverse(Ce)},[Ce,fe,c,w,E,k,V,se,ce,Z,Se,tt,yn,Qe,ge,Yt,ps,Oe,Dr,er,Va,xl,wl,Kr,ht,u,m,S,P,D,j,te,U,W,Y,oe,_e,me,Ke,Ze,qe,Ot,wt,un,qt,At,hn,Tn,_n,kn,wr,kr,Sr,dr,Pe,It,Os,r,a,i,tn,$t,Rr,Jo,Kt,ga,Vr,le,B,q,J,ne,xe]}class DN extends Qt{constructor(e){super(),Jt(this,e,kN,AN,Gt,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function R2(t){let e,n,r;return n=new DN({props:{mapController:t[1],apiKey:t[0]}}),{c(){e=Ne("div"),lt(n.$$.fragment),Ve(e,"class","svelte-ixhnie")},m(i,a){ke(i,e,a),it(n,e,null),r=!0},p(i,a){const c={};a&2&&(c.mapController=i[1]),a&1&&(c.apiKey=i[0]),n.$set(c)},i(i){r||(be(n.$$.fragment,i),r=!0)},o(i){Te(n.$$.fragment,i),r=!1},d(i){i&&Me(e),ot(n)}}}function RN(t){let e,n,r=t[1]&&R2(t);return{c(){r&&r.c(),e=Yr()},m(i,a){r&&r.m(i,a),ke(i,e,a),n=!0},p(i,[a]){i[1]?r?(r.p(i,a),a&2&&be(r,1)):(r=R2(i),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(i)}}}function NN(t,e,n){let r,{apiKey:i}=e,{map:a}=e;return t.$$set=c=>{"apiKey"in c&&n(0,i=c.apiKey),"map"in c&&n(2,a=c.map)},t.$$.update=()=>{t.$$.dirty&4&&n(1,r=a?XR(a,Es):null)},[i,r,a]}class ON extends Qt{constructor(e){super(),Jt(this,e,NN,RN,Gt,{apiKey:0,map:2})}}const zN=Symbol.for("svelte-maplibre");function FN(){return vv(zN)}function BN(t){return"layerType"in t&&t.layerType==="deckgl"}var Uc=VN;function VN(t){var e,n,r;if(t){if(Array.isArray(t)){for(e=[],n=t.length,r=0;r<n;r++){var i=t[r];i!=null&&e.push(i)}return e}if(typeof t=="object"){e={};var a=Object.keys(t);for(n=a.length,r=0;r<n;r++){var c=a[r],u=t[c];u!=null&&(e[c]=u)}return e}}}var _g=f1;function f1(t,e){return t===e||t!==t&&e!==e?!0:typeof t!=typeof e||{}.toString.call(t)!={}.toString.call(e)||t!==Object(t)||!t?!1:Array.isArray(t)?N2(t,e):{}.toString.call(t)=="[object Set]"?N2(Array.from(t),Array.from(e)):{}.toString.call(t)=="[object Object]"?GN(t,e):UN(t,e)}function UN(t,e){return t.toString()===e.toString()}function N2(t,e){var n=t.length;if(n!=e.length)return!1;for(var r=0;r<n;r++)if(!f1(t[r],e[r]))return!1;return!0}function GN(t,e){var n=Object.keys(t),r=n.length;if(r!=Object.keys(e).length)return!1;for(var i=0;i<r;i++){var a=n[i];if(!(e.hasOwnProperty(a)&&f1(t[a],e[a])))return!1}return!0}const qN=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),O2=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function z2(t){let e,n,r=(t[4]||t[3]instanceof Es.Marker)&&F2(t);return{c(){e=Ne("div"),r&&r.c()},m(i,a){ke(i,e,a),r&&r.m(e,null),t[32](e),n=!0},p(i,a){i[4]||i[3]instanceof Es.Marker?r?(r.p(i,a),a[0]&24&&be(r,1)):(r=F2(i),r.c(),be(r,1),r.m(e,null)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(),t[32](null)}}}function F2(t){let e;const n=t[30].default,r=ri(n,t,t[29],O2);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a[0]&536870933)&&oi(r,n,i,i[29],e?ii(n,i[29],a,qN):si(i[29]),O2)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function jN(t){let e,n,r=t[9].default&&z2(t);return{c(){r&&r.c(),e=Yr()},m(i,a){r&&r.m(i,a),ke(i,e,a),n=!0},p(i,a){i[9].default?r?(r.p(i,a),a[0]&512&&be(r,1)):(r=z2(i),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(i)}}}function WN(t,e,n){let r,i,a,c,u,m,{$$slots:w={},$$scope:S}=e;const E=qL(w);let{closeButton:P=void 0}=e,{closeOnClickOutside:D=!0}=e,{closeOnClickInside:k=!1}=e,{closeOnMove:V=!1}=e,{openOn:j="click"}=e,{openIfTopMost:te=!0}=e,{focusAfterOpen:U=!0}=e,{anchor:W=void 0}=e,{offset:Y=void 0}=e,{popupClass:oe=void 0}=e,{maxWidth:_e=void 0}=e,{lngLat:se=void 0}=e,{html:ce=void 0}=e,{open:me=!1}=e;const Ce=ju(),{map:Z,popupTarget:fe,layerEvent:Ke,layer:Se,eventTopMost:Ze}=FN();Lt(t,Z,Pe=>n(2,a=Pe)),Lt(t,fe,Pe=>n(3,u=Pe)),Lt(t,Ke,Pe=>n(28,c=Pe)),Lt(t,Se,Pe=>n(35,m=Pe));const tt=["click","dblclick","contextmenu"];let qe,Ot=!1,wt;function un(){if(!qe)return;let Pe=qe.getElement();!Pe||Pe===wt||(wt=Pe,j==="hover"&&(wt.style.pointerEvents="none"),wt.addEventListener("mouseenter",()=>{n(24,Ot=!0)},{passive:!0}),wt.addEventListener("mouseleave",()=>{n(24,Ot=!1)},{passive:!0}),wt.addEventListener("click",()=>{k&&n(0,me=!1)},{passive:!0}))}qu(()=>{if(a)return a.on("click",Sr),a.on("contextmenu",Sr),typeof u=="string"&&(a.on("click",u,Tn),a.on("dblclick",u,Tn),a.on("contextmenu",u,Tn),a.on("mousemove",u,kr),a.on("mouseleave",u,wr),a.on("touchstart",u,_n),a.on("touchend",u,kn)),()=>{a!=null&&a.loaded()&&(qe==null||qe.remove(),a.off("click",Sr),a.off("contextmenu",Sr),u instanceof Es.Marker?u.getPopup()===qe&&u.setPopup(void 0):typeof u=="string"&&(a.off("click",u,Tn),a.off("dblclick",u,Tn),a.off("contextmenu",u,Tn),a.off("mousemove",u,kr),a.off("mouseleave",u,wr),a.off("touchstart",u,_n),a.off("touchend",u,kn)))}});function qt(Pe){return te?!("marker"in Pe)&&!BN(Pe)&&Ze(Pe)!==m:!1}let At=null,hn="normal";function Tn(Pe){Pe.type===j&&(qt(Pe)||("layerType"in Pe?Pe.layerType==="deckgl"?(n(10,se=Pe.coordinate),n(4,At=Pe.object?[Pe.object]:null)):(n(10,se=Pe.lngLat),n(4,At=Pe.features??[])):(n(10,se=Pe.lngLat),n(4,At=Pe.features??[])),setTimeout(()=>n(0,me=!0))))}let yn=null;function _n(Pe){yn=Pe.point}function kn(Pe){if(!yn||j!=="hover")return;let It=yn.dist(Pe.point);yn=null,It<3&&(n(10,se=Pe.lngLat),n(4,At=Pe.features??[]),qe.isOpen()?n(25,hn="justOpened"):(n(25,hn="opening"),n(0,me=!0)))}function wr(Pe){j!=="hover"||yn||hn!=="normal"||(n(0,me=!1),n(4,At=null))}function kr(Pe){if(!(j!=="hover"||yn||hn!=="normal")){if(qt(Pe)){n(0,me=!1),n(4,At=null);return}n(0,me=!0),n(4,At=Pe.features??[]),n(10,se=Pe.lngLat)}}function Sr(Pe){if(hn==="justOpened"){n(25,hn="normal");return}if(!D)return;let It=[wt,u instanceof Es.Marker?u==null?void 0:u.getElement():null];me&&qe.isOpen()&&!It.some(Dn=>Dn==null?void 0:Dn.contains(Pe.originalEvent.target))&&(Pe.type==="contextmenu"&&j==="contextmenu"||Pe.type!=="contextmenu")&&n(0,me=!1)}as(()=>{a&&(qe!=null&&qe.isOpen())&&qe.remove()});let dr;const Qe=()=>n(0,me=!1);function ge(Pe){Zn[Pe?"unshift":"push"](()=>{dr=Pe,n(1,dr)})}return t.$$set=Pe=>{"closeButton"in Pe&&n(11,P=Pe.closeButton),"closeOnClickOutside"in Pe&&n(12,D=Pe.closeOnClickOutside),"closeOnClickInside"in Pe&&n(13,k=Pe.closeOnClickInside),"closeOnMove"in Pe&&n(14,V=Pe.closeOnMove),"openOn"in Pe&&n(15,j=Pe.openOn),"openIfTopMost"in Pe&&n(16,te=Pe.openIfTopMost),"focusAfterOpen"in Pe&&n(17,U=Pe.focusAfterOpen),"anchor"in Pe&&n(18,W=Pe.anchor),"offset"in Pe&&n(19,Y=Pe.offset),"popupClass"in Pe&&n(20,oe=Pe.popupClass),"maxWidth"in Pe&&n(21,_e=Pe.maxWidth),"lngLat"in Pe&&n(10,se=Pe.lngLat),"html"in Pe&&n(22,ce=Pe.html),"open"in Pe&&n(0,me=Pe.open),"$$scope"in Pe&&n(29,S=Pe.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=P??(!D&&!k)),t.$$.dirty[0]&146685952&&(qe||(n(23,qe=new Es.Popup({closeButton:r,closeOnClick:!1,closeOnMove:V,focusAfterOpen:U,maxWidth:_e,className:oe,anchor:W,offset:Y})),wt=qe.getElement(),qe.on("open",()=>{n(0,me=!0),un(),Ce("open",qe)}),qe.on("close",()=>{n(0,me=!1),Ce("close",qe)}),qe.on("hover",()=>{Ce("hover",qe)}))),t.$$.dirty[0]&8421384&&qe&&u instanceof Es.Marker&&(j==="click"?u.setPopup(qe):u.getPopup()===qe&&u.setPopup(void 0)),t.$$.dirty[0]&268468224&&tt.includes(j)&&(c==null?void 0:c.type)===j&&(Tn(c),Wn(Ke,c=null,c)),t.$$.dirty[0]&268468224&&n(26,i=j==="hover"&&((c==null?void 0:c.type)==="mousemove"||(c==null?void 0:c.type)==="mouseenter")),t.$$.dirty[0]&352354304&&j==="hover"&&Ke&&(i&&c&&(c.layerType==="deckgl"?(n(10,se=c.coordinate),n(4,At=c.object?[c.object]:null)):(n(10,se=c.lngLat),n(4,At=c.features??[]))),n(0,me=(i||Ot)??!1)),t.$$.dirty[0]&12582914&&(dr?qe.setDOMContent(dr):ce&&qe.setHTML(ce)),t.$$.dirty[0]&8389632&&se&&qe.setLngLat(se),t.$$.dirty[0]&41943045&&a){let Pe=qe.isOpen();me&&!Pe?(qe.addTo(a),hn==="opening"&&n(25,hn="justOpened")):!me&&Pe&&qe.remove()}},[me,dr,a,u,At,Z,fe,Ke,Se,E,se,P,D,k,V,j,te,U,W,Y,oe,_e,ce,qe,Ot,hn,i,r,c,S,w,Qe,ge]}class HN extends Qt{constructor(e){super(),Jt(this,e,WN,jN,Gt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Jd=Uint8Array,IC=Uint16Array,ZN=Int32Array,XN=new Jd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),YN=new Jd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),CC=function(t,e){for(var n=new IC(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new ZN(n[30]),r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}},TC=CC(XN,2),KN=TC.b,JN=TC.r;KN[28]=258,JN[258]=28;CC(YN,0);var QN=new IC(32768);for(Qn=0;Qn<32768;++Qn)Fl=(Qn&43690)>>1|(Qn&21845)<<1,Fl=(Fl&52428)>>2|(Fl&13107)<<2,Fl=(Fl&61680)>>4|(Fl&3855)<<4,QN[Qn]=((Fl&65280)>>8|(Fl&255)<<8)>>1;var Fl,Qn,zy=new Jd(288);for(Qn=0;Qn<144;++Qn)zy[Qn]=8;var Qn;for(Qn=144;Qn<256;++Qn)zy[Qn]=9;var Qn;for(Qn=256;Qn<280;++Qn)zy[Qn]=7;var Qn;for(Qn=280;Qn<288;++Qn)zy[Qn]=8;var Qn,$N=new Jd(32);for(Qn=0;Qn<32;++Qn)$N[Qn]=5;var Qn,eO=new Jd(0),tO=typeof TextDecoder<"u"&&new TextDecoder,nO=0;try{tO.decode(eO,{stream:!0}),nO=1}catch{}const rO=t=>({props:t&8}),B2=t=>({props:sO(t[3])});function iO(t){let e;const n=t[1].default,r=ri(n,t,t[2],B2);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&12)&&oi(r,n,i,i[2],e?ii(n,i[2],a,rO):si(i[2]),B2)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function oO(t){let e,n;return e=new HN({props:{openOn:t[0],$$slots:{default:[iO,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,[i]){const a={};i&1&&(a.openOn=r[0]),i&12&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function sO(t){return t?t[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function aO(t,e,n){let{$$slots:r={},$$scope:i}=e,{openOn:a="hover"}=e;return t.$$set=c=>{"openOn"in c&&n(0,a=c.openOn),"$$scope"in c&&n(2,i=c.$$scope)},[a,r,i]}class Zf extends Qt{constructor(e){super(),Jt(this,e,aO,oO,Gt,{openOn:0})}}const lO=["==",["geometry-type"],"Polygon"],uO=["==",["geometry-type"],"LineString"];function p1(t,e,n){let r=["match",t];for(let[i,a]of Object.entries(e))r.push(i),r.push(a);return r.push(n),r}function pv(t,e,n){let r=["step",t];for(let i=1;i<e.length;i++)r.push(n[i-1]),r.push(e[i]);return r.push(n[n.length-1]),r}let cO=Date.now();function Qd(t){return`${t}-${cO++}`}const d1=Symbol.for("svelte-maplibre");function Xf(){return vv(d1)}function hO(t){let e=new WeakMap;return n=>{var c;let r=e.get(n.originalEvent);if(r!==void 0)return r;let a=(c=n.target.queryRenderedFeatures(n.point).find(u=>{var m;return(m=t.get(u.layer.id))==null?void 0:m.interactive}))==null?void 0:c.layer.id;return e.set(n.originalEvent,a),a}}function fO(){let t=new Map;return _v(d1,{map:sr(null),source:Y_(null),layer:Y_(null),popupTarget:Y_(null),cluster:sr(),loadedImages:sr(new Set),minzoom:sr(0),maxzoom:sr(24),layerEvent:sr(null),layerInfo:t,eventTopMost:hO(t)})}function V2(t){return{subscribe:t.subscribe}}function m1({key:t,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:r=!1}){let i=Xf(),a=sr(null),c=V2(a),u={...i,[t]:V2(a)};if(e&&(u.popupTarget=c),r){let m=sr(null);u.layerEvent=m,i.layerEvent=m}return n&&(u.cluster=sr()),_v(d1,u),{...i,self:a}}function pO(){return m1({key:"source",setCluster:!0})}function dO(t=!0){return m1({key:"layer",setPopupTarget:t,setMouseEvent:t})}function mO(){return m1({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function U2(t){let e;return n=>{if(n)for(let r in n){let i=e==null?void 0:e[r],a=n[r];i!==a&&t(r,a,i)}else if(e)for(let r in e)t(r,void 0,e[r]);e=n}}function gO(t,...e){let n=[t];for(let r of e)if(r)Array.isArray(r)&&r[0]===t?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function yO(t){return t===!0?["has","point_count"]:t===!1?["!",["has","point_count"]]:void 0}function Fy(t,e){return["case",["boolean",["feature-state","hover"],!1],e,t]}function G2(t){let e=t[0],n,r,i=q2(t);return{c(){i.c(),n=Yr()},m(a,c){i.m(a,c),ke(a,n,c),r=!0},p(a,c){c[0]&1&&Gt(e,e=a[0])?(On(),Te(i,1,1,gt),zn(),i=q2(a),i.c(),be(i,1),i.m(n.parentNode,n)):i.p(a,c)},i(a){r||(be(i),r=!0)},o(a){Te(i),r=!1},d(a){a&&Me(n),i.d(a)}}}function q2(t){let e;const n=t[36].default,r=ri(n,t,t[35],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a[1]&16)&&oi(r,n,i,i[35],e?ii(n,i[35],a,null):si(i[35]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function _O(t){let e,n,r=t[0]&&G2(t);return{c(){r&&r.c(),e=Yr()},m(i,a){r&&r.m(i,a),ke(i,e,a),n=!0},p(i,a){i[0]?r?(r.p(i,a),a[0]&1&&be(r,1)):(r=G2(i),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(i)}}}function vO(t,e,n){let r,i,a,c,u,m,w,S,E,P,D,k,{$$slots:V={},$$scope:j}=e,{id:te=Qd("layer")}=e,{source:U=void 0}=e,{sourceLayer:W=void 0}=e,{beforeId:Y=void 0}=e,{beforeLayerType:oe=void 0}=e,{type:_e}=e,{paint:se=void 0}=e,{layout:ce=void 0}=e,{filter:me=void 0}=e,{applyToClusters:Ce=void 0}=e,{minzoom:Z=void 0}=e,{maxzoom:fe=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Se=null}=e,{interactive:Ze=!0}=e,{hoverCursor:tt=void 0}=e,{eventsIfTopMost:qe=!1}=e;const Ot=ju(),{map:wt,source:un,self:qt,minzoom:At,maxzoom:hn,eventTopMost:Tn,layerInfo:yn}=dO();Lt(t,wt,ge=>n(31,E=ge)),Lt(t,un,ge=>n(32,P=ge)),Lt(t,qt,ge=>n(0,S=ge)),Lt(t,At,ge=>n(34,k=ge)),Lt(t,hn,ge=>n(33,D=ge)),as(()=>{S&&E&&(yn.delete(S),E==null||E.removeLayer(S))});let _n;function kn(ge){var Oe,Yt;if(!Ze||!S||!E||qe&&Tn(ge)!==S)return;let Pe=ge.features??[],It=(Yt=(Oe=Pe[0])==null?void 0:Oe.properties)==null?void 0:Yt.cluster_id,Dn={event:ge,map:E,clusterId:It,layer:S,source:u,features:Pe};Ot(ge.type,Dn)}function wr(ge){var Oe,Yt;if(!Ze||!S||!E||qe&&Tn(ge)!==S)return;tt&&(E.getCanvas().style.cursor=tt);let Pe=ge.features??[];n(6,Se=Pe[0]??null);let It=(Yt=(Oe=Pe[0])==null?void 0:Oe.properties)==null?void 0:Yt.cluster_id;Ot("mouseenter",{event:ge,map:E,clusterId:It,layer:S,source:u,features:Pe})}function kr(ge){var Oe,Yt,Dr;if(!Ze||!E)return;if(qe&&Tn(ge)!==S){n(6,Se=null),Ke&&_n!==void 0&&(E==null||E.setFeatureState({source:u,sourceLayer:W,id:_n},{hover:!1}),_n=void 0);return}E.getCanvas().style.cursor=tt;let Pe=ge.features??[],It=(Yt=(Oe=Pe[0])==null?void 0:Oe.properties)==null?void 0:Yt.cluster_id,Dn=(Dr=Pe[0])==null?void 0:Dr.id;Dn!==_n&&(Ke&&(_n!==void 0&&(E==null||E.setFeatureState({source:u,id:_n,sourceLayer:W},{hover:!1})),E==null||E.setFeatureState({source:u,id:Dn,sourceLayer:W},{hover:!0})),_n=Dn,n(6,Se=Pe[0]??null)),Ot("mousemove",{event:ge,map:E,clusterId:It,layer:S,source:u,features:Pe})}function Sr(ge){if(!(!Ze||!S||!E)){if(tt&&(E.getCanvas().style.cursor=""),n(6,Se=null),Ke&&_n!==void 0){const Pe={source:u,id:_n,sourceLayer:W};E==null||E.setFeatureState(Pe,{hover:!1}),_n=void 0}Ot("mouseleave",{map:E,layer:S,source:u})}}let dr=!0;function Qe(ge){E&&(E.off("click",ge,kn),E.off("dblclick",ge,kn),E.off("contextmenu",ge,kn),E.off("mouseenter",ge,wr),E.off("mousemove",ge,kr),E.off("mouseleave",ge,Sr))}return as(()=>{E&&S&&Qe(S)}),t.$$set=ge=>{"id"in ge&&n(7,te=ge.id),"source"in ge&&n(8,U=ge.source),"sourceLayer"in ge&&n(9,W=ge.sourceLayer),"beforeId"in ge&&n(10,Y=ge.beforeId),"beforeLayerType"in ge&&n(11,oe=ge.beforeLayerType),"type"in ge&&n(12,_e=ge.type),"paint"in ge&&n(13,se=ge.paint),"layout"in ge&&n(14,ce=ge.layout),"filter"in ge&&n(15,me=ge.filter),"applyToClusters"in ge&&n(16,Ce=ge.applyToClusters),"minzoom"in ge&&n(17,Z=ge.minzoom),"maxzoom"in ge&&n(18,fe=ge.maxzoom),"manageHoverState"in ge&&n(19,Ke=ge.manageHoverState),"hovered"in ge&&n(6,Se=ge.hovered),"interactive"in ge&&n(20,Ze=ge.interactive),"hoverCursor"in ge&&n(21,tt=ge.hoverCursor),"eventsIfTopMost"in ge&&n(22,qe=ge.eventsIfTopMost),"$$scope"in ge&&n(35,j=ge.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&65536&&n(30,r=yO(Ce)),t.$$.dirty[0]&1073774592&&n(24,i=gO("all",r,me)),t.$$.dirty[0]&131072|t.$$.dirty[1]&8&&n(26,a=Z??k),t.$$.dirty[0]&262144|t.$$.dirty[1]&4&&n(25,c=fe??D),t.$$.dirty[0]&256|t.$$.dirty[1]&2&&n(29,u=U||P),t.$$.dirty[0]&654343809|t.$$.dirty[1]&1&&E&&S!==te&&u){S&&(Qe(S),yn.delete(S));let ge=Y;if(!Y&&oe){let Pe=E.getStyle().layers,It=typeof oe=="function"?oe:Oe=>Oe.type===oe,Dn=Pe==null?void 0:Pe.find(It);Dn&&(ge=Dn.id)}Wn(qt,S=te,S),E.addLayer(Uc({id:S,type:_e,source:u,"source-layer":W,filter:i,paint:se,layout:ce,minzoom:a,maxzoom:c}),ge),n(23,dr=!0),E.on("click",S,kn),E.on("dblclick",S,kn),E.on("contextmenu",S,kn),E.on("mouseenter",S,wr),E.on("mousemove",S,kr),E.on("mouseleave",S,Sr)}t.$$.dirty[0]&1048577&&S&&yn.set(S,{interactive:Ze}),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(28,m=S?U2((ge,Pe)=>E==null?void 0:E.setPaintProperty(S,ge,Pe)):void 0),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(27,w=S?U2((ge,Pe)=>E==null?void 0:E.setLayoutProperty(S,ge,Pe)):void 0),t.$$.dirty[0]&268443648&&(m==null||m(se)),t.$$.dirty[0]&134234112&&(w==null||w(ce)),t.$$.dirty[0]&100663297|t.$$.dirty[1]&1&&S&&(E==null||E.setLayerZoomRange(S,a,c)),t.$$.dirty[0]&25165825|t.$$.dirty[1]&1&&S&&(dr?n(23,dr=!1):E==null||E.setFilter(S,i))},[S,wt,un,qt,At,hn,Se,te,U,W,Y,oe,_e,se,ce,me,Ce,Z,fe,Ke,Ze,tt,qe,dr,i,c,a,w,m,u,r,E,P,D,k,j,V]}let g1=class extends Qt{constructor(e){super(),Jt(this,e,vO,_O,Gt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function bO(t){let e;const n=t[16].default,r=ri(n,t,t[24],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&16777216)&&oi(r,n,i,i[24],e?ii(n,i[24],a,null):si(i[24]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function xO(t){let e,n,r;function i(c){t[17](c)}let a={id:t[1],type:"circle",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[bO]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new g1({props:a}),Zn.push(()=>ao(e,"hovered",i)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,[u]){const m={};u&2&&(m.id=c[1]),u&4&&(m.source=c[2]),u&8&&(m.sourceLayer=c[3]),u&16&&(m.beforeId=c[4]),u&32&&(m.beforeLayerType=c[5]),u&64&&(m.paint=c[6]),u&128&&(m.layout=c[7]),u&256&&(m.filter=c[8]),u&512&&(m.applyToClusters=c[9]),u&1024&&(m.minzoom=c[10]),u&2048&&(m.maxzoom=c[11]),u&4096&&(m.hoverCursor=c[12]),u&8192&&(m.manageHoverState=c[13]),u&16384&&(m.eventsIfTopMost=c[14]),u&32768&&(m.interactive=c[15]),u&16777216&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.hovered=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function wO(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:a=Qd("circle")}=e,{source:c=void 0}=e,{sourceLayer:u=void 0}=e,{beforeId:m=void 0}=e,{beforeLayerType:w=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:P=void 0}=e,{applyToClusters:D=void 0}=e,{minzoom:k=void 0}=e,{maxzoom:V=void 0}=e,{hoverCursor:j=void 0}=e,{manageHoverState:te=!1}=e,{hovered:U=null}=e,{eventsIfTopMost:W=!1}=e,{interactive:Y=!0}=e;function oe(fe){U=fe,n(0,U)}function _e(fe){In.call(this,t,fe)}function se(fe){In.call(this,t,fe)}function ce(fe){In.call(this,t,fe)}function me(fe){In.call(this,t,fe)}function Ce(fe){In.call(this,t,fe)}function Z(fe){In.call(this,t,fe)}return t.$$set=fe=>{"id"in fe&&n(1,a=fe.id),"source"in fe&&n(2,c=fe.source),"sourceLayer"in fe&&n(3,u=fe.sourceLayer),"beforeId"in fe&&n(4,m=fe.beforeId),"beforeLayerType"in fe&&n(5,w=fe.beforeLayerType),"paint"in fe&&n(6,S=fe.paint),"layout"in fe&&n(7,E=fe.layout),"filter"in fe&&n(8,P=fe.filter),"applyToClusters"in fe&&n(9,D=fe.applyToClusters),"minzoom"in fe&&n(10,k=fe.minzoom),"maxzoom"in fe&&n(11,V=fe.maxzoom),"hoverCursor"in fe&&n(12,j=fe.hoverCursor),"manageHoverState"in fe&&n(13,te=fe.manageHoverState),"hovered"in fe&&n(0,U=fe.hovered),"eventsIfTopMost"in fe&&n(14,W=fe.eventsIfTopMost),"interactive"in fe&&n(15,Y=fe.interactive),"$$scope"in fe&&n(24,i=fe.$$scope)},[U,a,c,u,m,w,S,E,P,D,k,V,j,te,W,Y,r,oe,_e,se,ce,me,Ce,Z,i]}let By=class extends Qt{constructor(e){super(),Jt(this,e,wO,xO,Gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function SO(t){let e;const n=t[15].default,r=ri(n,t,t[23],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&8388608)&&oi(r,n,i,i[23],e?ii(n,i[23],a,null):si(i[23]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function EO(t){let e,n,r;function i(c){t[16](c)}let a={id:t[1],type:"fill",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[SO]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new g1({props:a}),Zn.push(()=>ao(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,[u]){const m={};u&2&&(m.id=c[1]),u&4&&(m.source=c[2]),u&8&&(m.sourceLayer=c[3]),u&16&&(m.beforeId=c[4]),u&32&&(m.beforeLayerType=c[5]),u&64&&(m.paint=c[6]),u&128&&(m.layout=c[7]),u&256&&(m.filter=c[8]),u&512&&(m.minzoom=c[9]),u&1024&&(m.maxzoom=c[10]),u&2048&&(m.hoverCursor=c[11]),u&4096&&(m.manageHoverState=c[12]),u&8192&&(m.eventsIfTopMost=c[13]),u&16384&&(m.interactive=c[14]),u&8388608&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.hovered=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function IO(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:a=Qd("fill")}=e,{source:c=void 0}=e,{sourceLayer:u=void 0}=e,{beforeId:m=void 0}=e,{beforeLayerType:w=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:k=void 0}=e,{hoverCursor:V=void 0}=e,{manageHoverState:j=!1}=e,{hovered:te=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:W=!0}=e;function Y(Z){te=Z,n(0,te)}function oe(Z){In.call(this,t,Z)}function _e(Z){In.call(this,t,Z)}function se(Z){In.call(this,t,Z)}function ce(Z){In.call(this,t,Z)}function me(Z){In.call(this,t,Z)}function Ce(Z){In.call(this,t,Z)}return t.$$set=Z=>{"id"in Z&&n(1,a=Z.id),"source"in Z&&n(2,c=Z.source),"sourceLayer"in Z&&n(3,u=Z.sourceLayer),"beforeId"in Z&&n(4,m=Z.beforeId),"beforeLayerType"in Z&&n(5,w=Z.beforeLayerType),"paint"in Z&&n(6,S=Z.paint),"layout"in Z&&n(7,E=Z.layout),"filter"in Z&&n(8,P=Z.filter),"minzoom"in Z&&n(9,D=Z.minzoom),"maxzoom"in Z&&n(10,k=Z.maxzoom),"hoverCursor"in Z&&n(11,V=Z.hoverCursor),"manageHoverState"in Z&&n(12,j=Z.manageHoverState),"hovered"in Z&&n(0,te=Z.hovered),"eventsIfTopMost"in Z&&n(13,U=Z.eventsIfTopMost),"interactive"in Z&&n(14,W=Z.interactive),"$$scope"in Z&&n(23,i=Z.$$scope)},[te,a,c,u,m,w,S,E,P,D,k,V,j,U,W,r,Y,oe,_e,se,ce,me,Ce,i]}let LC=class extends Qt{constructor(e){super(),Jt(this,e,IO,EO,Gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function CO(t,e,n){let r;const{map:i}=Xf();Lt(t,i,m=>n(4,r=m));let{position:a="top-left"}=e,{container:c=void 0}=e,u=null;return as(()=>{r!=null&&r.loaded()&&u&&r.removeControl(u)}),t.$$set=m=>{"position"in m&&n(1,a=m.position),"container"in m&&n(2,c=m.container)},t.$$.update=()=>{if(t.$$.dirty&30&&r&&!u){let m;typeof c=="string"?m=document.querySelector(c)??void 0:m=c,n(3,u=new Es.FullscreenControl({container:m})),r.addControl(u,a)}},[i,a,c,u,r]}class TO extends Qt{constructor(e){super(),Jt(this,e,CO,null,Gt,{position:1,container:2})}}function LO(t,e,n,r,i){let a=!1;t.getSource(e)&&(a=!0,t.removeSource(e));const c=()=>{r(e)&&(t.addSource(e,n),i())};if(a){const u=()=>{e&&(t.getSource(e)?setTimeout(u,1):c())};u()}else c()}function PO(t,e,n){tE().then(()=>{let r=KS(t);if(!r)return;r.getSource(e)===n&&r.removeSource(e)})}function j2(t){let e=t[0],n,r,i=W2(t);return{c(){i.c(),n=Yr()},m(a,c){i.m(a,c),ke(a,n,c),r=!0},p(a,c){c&1&&Gt(e,e=a[0])?(On(),Te(i,1,1,gt),zn(),i=W2(a),i.c(),be(i,1),i.m(n.parentNode,n)):i.p(a,c)},i(a){r||(be(i),r=!0)},o(a){Te(i),r=!1},d(a){a&&Me(n),i.d(a)}}}function W2(t){let e;const n=t[15].default,r=ri(n,t,t[14],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&16384)&&oi(r,n,i,i[14],e?ii(n,i[14],a,null):si(i[14]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function MO(t){let e,n,r=t[0]&&j2(t);return{c(){r&&r.c(),e=Yr()},m(i,a){r&&r.m(i,a),ke(i,e,a),n=!0},p(i,[a]){i[0]?r?(r.p(i,a),a&1&&be(r,1)):(r=j2(i),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(i)}}}function AO(t,e,n){let r,i,a,{$$slots:c={},$$scope:u}=e,{id:m=Qd("geojson")}=e,{data:w}=e,{generateId:S=!1}=e,{promoteId:E=void 0}=e,{filter:P=void 0}=e,{lineMetrics:D=void 0}=e,{cluster:k=void 0}=e;const{map:V,cluster:j,self:te}=pO();Lt(t,V,Y=>n(13,i=Y)),Lt(t,j,Y=>n(16,a=Y)),Lt(t,te,Y=>n(0,r=Y));let U,W=!0;return as(()=>{r&&U&&i&&(PO(V,r,U),Wn(te,r=null,r),n(11,U=void 0))}),t.$$set=Y=>{"id"in Y&&n(4,m=Y.id),"data"in Y&&n(5,w=Y.data),"generateId"in Y&&n(6,S=Y.generateId),"promoteId"in Y&&n(7,E=Y.promoteId),"filter"in Y&&n(8,P=Y.filter),"lineMetrics"in Y&&n(9,D=Y.lineMetrics),"cluster"in Y&&n(10,k=Y.cluster),"$$scope"in Y&&n(14,u=Y.$$scope)},t.$$.update=()=>{t.$$.dirty&1024&&Wn(j,a=k,a),t.$$.dirty&12273&&i&&r!==m&&(Wn(te,r=m,r),LO(i,r,Uc({type:"geojson",data:w,filter:P,lineMetrics:D,generateId:S,promoteId:E,cluster:!!k,clusterMinPoints:k==null?void 0:k.minPoints,clusterMaxZoom:k==null?void 0:k.maxZoom,clusterRadius:k==null?void 0:k.radius,clusterProperties:k==null?void 0:k.properties}),Y=>i&&Y===r,()=>{r&&(n(11,U=i==null?void 0:i.getSource(r)),n(12,W=!0))})),t.$$.dirty&8208&&(i==null||i.on("style.load",()=>{n(11,U=i==null?void 0:i.getSource(m))})),t.$$.dirty&6176&&U&&(W?n(12,W=!1):U.setData(w)),t.$$.dirty&3072&&(U==null||U.setClusterOptions(Uc({cluster:!!k,clusterMaxZoom:k==null?void 0:k.maxZoom,clusterRadius:k==null?void 0:k.radius})))},[r,V,j,te,m,w,S,E,P,D,k,U,W,i,u,c]}let ru=class extends Qt{constructor(e){super(),Jt(this,e,AO,MO,Gt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}};function kO(t,e,n){let r;const{map:i}=Xf();Lt(t,i,P=>n(8,r=P));let{position:a="top-left"}=e,{positionOptions:c=void 0}=e,{fitBoundsOptions:u=void 0}=e,{trackUserLocation:m=!1}=e,{showAccuracyCircle:w=!0}=e,{showUserLocation:S=!0}=e,E=null;return as(()=>{r!=null&&r.loaded()&&E&&r.removeControl(E)}),t.$$set=P=>{"position"in P&&n(1,a=P.position),"positionOptions"in P&&n(2,c=P.positionOptions),"fitBoundsOptions"in P&&n(3,u=P.fitBoundsOptions),"trackUserLocation"in P&&n(4,m=P.trackUserLocation),"showAccuracyCircle"in P&&n(5,w=P.showAccuracyCircle),"showUserLocation"in P&&n(6,S=P.showUserLocation)},t.$$.update=()=>{t.$$.dirty&510&&r&&!E&&(n(7,E=new Es.GeolocateControl({positionOptions:c,fitBoundsOptions:u,trackUserLocation:m,showAccuracyCircle:w,showUserLocation:S})),r.addControl(E,a))},[i,a,c,u,m,w,S,E,r]}class DO extends Qt{constructor(e){super(),Jt(this,e,kO,null,Gt,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function RO(t){let e;const n=t[15].default,r=ri(n,t,t[23],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&8388608)&&oi(r,n,i,i[23],e?ii(n,i[23],a,null):si(i[23]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function NO(t){let e,n,r;function i(c){t[16](c)}let a={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[RO]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new g1({props:a}),Zn.push(()=>ao(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,[u]){const m={};u&2&&(m.id=c[1]),u&4&&(m.source=c[2]),u&8&&(m.sourceLayer=c[3]),u&16&&(m.beforeId=c[4]),u&32&&(m.beforeLayerType=c[5]),u&64&&(m.paint=c[6]),u&128&&(m.layout=c[7]),u&256&&(m.filter=c[8]),u&512&&(m.minzoom=c[9]),u&1024&&(m.maxzoom=c[10]),u&2048&&(m.hoverCursor=c[11]),u&4096&&(m.manageHoverState=c[12]),u&8192&&(m.eventsIfTopMost=c[13]),u&16384&&(m.interactive=c[14]),u&8388608&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.hovered=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function OO(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:a=Qd("line")}=e,{source:c=void 0}=e,{sourceLayer:u=void 0}=e,{beforeId:m=void 0}=e,{beforeLayerType:w=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:k=void 0}=e,{hoverCursor:V=void 0}=e,{manageHoverState:j=!1}=e,{hovered:te=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:W=!0}=e;function Y(Z){te=Z,n(0,te)}function oe(Z){In.call(this,t,Z)}function _e(Z){In.call(this,t,Z)}function se(Z){In.call(this,t,Z)}function ce(Z){In.call(this,t,Z)}function me(Z){In.call(this,t,Z)}function Ce(Z){In.call(this,t,Z)}return t.$$set=Z=>{"id"in Z&&n(1,a=Z.id),"source"in Z&&n(2,c=Z.source),"sourceLayer"in Z&&n(3,u=Z.sourceLayer),"beforeId"in Z&&n(4,m=Z.beforeId),"beforeLayerType"in Z&&n(5,w=Z.beforeLayerType),"paint"in Z&&n(6,S=Z.paint),"layout"in Z&&n(7,E=Z.layout),"filter"in Z&&n(8,P=Z.filter),"minzoom"in Z&&n(9,D=Z.minzoom),"maxzoom"in Z&&n(10,k=Z.maxzoom),"hoverCursor"in Z&&n(11,V=Z.hoverCursor),"manageHoverState"in Z&&n(12,j=Z.manageHoverState),"hovered"in Z&&n(0,te=Z.hovered),"eventsIfTopMost"in Z&&n(13,U=Z.eventsIfTopMost),"interactive"in Z&&n(14,W=Z.interactive),"$$scope"in Z&&n(23,i=Z.$$scope)},[te,a,c,u,m,w,S,E,P,D,k,V,j,U,W,r,Y,oe,_e,se,ce,me,Ce,i]}let Kc=class extends Qt{constructor(e){super(),Jt(this,e,OO,NO,Gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function zO(t,e,n){let r;const i=ju();let{layer:a=void 0}=e;const{map:c}=Xf();Lt(t,c,S=>n(2,r=S));function u(S){i(S.type,{...S,map:c})}const m=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],w=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return as(()=>{if(r)if(a)for(const S of m)r.off(S,a,u);else for(const S of w)r.off(S,u)}),t.$$set=S=>{"layer"in S&&n(1,a=S.layer)},t.$$.update=()=>{if(t.$$.dirty&6&&r)if(a)for(const S of m)r.on(S,a,u);else for(const S of w)r.on(S,u)},[c,a,r]}class FO extends Qt{constructor(e){super(),Jt(this,e,zO,null,Gt,{layer:1})}}function BO(t){let e=t.getCenter(),n=Math.round(t.getZoom()*100)/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),a=Math.round(e.lat*i)/i,c=Math.round(e.lng*i)/i,u=`${n}/${a}/${c}`,m=t.getBearing(),w=t.getPitch();return(m||w)&&(u+=`/${Math.round(m*10)/10}`),w&&(u+=`/${Math.round(w)}`),`#${u}`}function VO(t){return t.replace("#","").split("/").map(parseFloat)}function UO(t,e,n){let r;const{map:i}=Xf();Lt(t,i,S=>n(6,r=S));let{position:a="top-left"}=e,{showCompass:c=!0}=e,{showZoom:u=!0}=e,{visualizePitch:m=!1}=e,w=null;return as(()=>{r!=null&&r.loaded()&&w&&r.removeControl(w)}),t.$$set=S=>{"position"in S&&n(1,a=S.position),"showCompass"in S&&n(2,c=S.showCompass),"showZoom"in S&&n(3,u=S.showZoom),"visualizePitch"in S&&n(4,m=S.visualizePitch)},t.$$.update=()=>{t.$$.dirty&126&&r&&!w&&(n(5,w=new Es.NavigationControl({showCompass:c,showZoom:u,visualizePitch:m})),r.addControl(w,a))},[i,a,c,u,m,w,r]}class GO extends Qt{constructor(e){super(),Jt(this,e,UO,null,Gt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function qO(t,e,n){let r;const{map:i}=Xf();Lt(t,i,w=>n(5,r=w));let{position:a="bottom-left"}=e,{maxWidth:c=void 0}=e,{unit:u="metric"}=e,m=null;return as(()=>{r!=null&&r.loaded()&&m&&r.removeControl(m)}),t.$$set=w=>{"position"in w&&n(1,a=w.position),"maxWidth"in w&&n(2,c=w.maxWidth),"unit"in w&&n(3,u=w.unit)},t.$$.update=()=>{t.$$.dirty&62&&r&&!m&&(n(4,m=new Es.ScaleControl({maxWidth:c,unit:u})),r.addControl(m,a))},[i,a,c,u,m,r]}class jO extends Qt{constructor(e){super(),Jt(this,e,qO,null,Gt,{position:1,maxWidth:2,unit:3})}}const{window:WO}=jL,HO=t=>({map:t[0]&16,loadedImages:t[0]&32,allImagesLoaded:t[0]&64}),H2=t=>({map:t[4],loadedImages:t[5],allImagesLoaded:t[6]});function Z2(t){let e,n,r=t[3]&&X2(t);const i=t[39].default,a=ri(i,t,t[38],H2);return{c(){r&&r.c(),e=at(),a&&a.c()},m(c,u){r&&r.m(c,u),ke(c,e,u),a&&a.m(c,u),n=!0},p(c,u){c[3]?r?(r.p(c,u),u[0]&8&&be(r,1)):(r=X2(c),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn()),a&&a.p&&(!n||u[0]&112|u[1]&128)&&oi(a,i,c,c[38],n?ii(i,c[38],u,HO):si(c[38]),H2)},i(c){n||(be(r),be(a,c),n=!0)},o(c){Te(r),Te(a,c),n=!1},d(c){c&&Me(e),r&&r.d(c),a&&a.d(c)}}}function X2(t){let e,n,r,i,a,c,u,m;return e=new GO({props:{position:t[7]}}),r=new DO({props:{position:t[7],fitBoundsOptions:{maxZoom:12}}}),a=new TO({props:{position:t[7]}}),u=new jO({props:{position:t[7]}}),{c(){lt(e.$$.fragment),n=at(),lt(r.$$.fragment),i=at(),lt(a.$$.fragment),c=at(),lt(u.$$.fragment)},m(w,S){it(e,w,S),ke(w,n,S),it(r,w,S),ke(w,i,S),it(a,w,S),ke(w,c,S),it(u,w,S),m=!0},p(w,S){const E={};S[0]&128&&(E.position=w[7]),e.$set(E);const P={};S[0]&128&&(P.position=w[7]),r.$set(P);const D={};S[0]&128&&(D.position=w[7]),a.$set(D);const k={};S[0]&128&&(k.position=w[7]),u.$set(k)},i(w){m||(be(e.$$.fragment,w),be(r.$$.fragment,w),be(a.$$.fragment,w),be(u.$$.fragment,w),m=!0)},o(w){Te(e.$$.fragment,w),Te(r.$$.fragment,w),Te(a.$$.fragment,w),Te(u.$$.fragment,w),m=!1},d(w){w&&(Me(n),Me(i),Me(c)),ot(e,w),ot(r,w),ot(a,w),ot(u,w)}}}function ZO(t){let e,n,r,i,a,c=t[4]&&t[0]&&Z2(t);return{c(){e=Ne("div"),c&&c.c(),Ve(e,"class",n=Dg(t[2])+" svelte-p00lfq"),Ve(e,"data-testid","map-container"),sl(e,"expand-map",!t[2])},m(u,m){ke(u,e,m),c&&c.m(e,null),t[40](e),r=!0,i||(a=[Wt(WO,"hashchange",t[11]),E0(t[10].call(null,e))],i=!0)},p(u,m){u[4]&&u[0]?c?(c.p(u,m),m[0]&17&&be(c,1)):(c=Z2(u),c.c(),be(c,1),c.m(e,null)):c&&(On(),Te(c,1,1,()=>{c=null}),zn()),(!r||m[0]&4&&n!==(n=Dg(u[2])+" svelte-p00lfq"))&&Ve(e,"class",n),(!r||m[0]&4)&&sl(e,"expand-map",!u[2])},i(u){r||(be(c),r=!0)},o(u){Te(c),r=!1},d(u){u&&Me(e),c&&c.d(),t[40](null),i=!1,Ni(a)}}}function XO(t,e,n){let r,i,a,c,{$$slots:u={},$$scope:m}=e,{map:w=null}=e,{mapContainer:S=void 0}=e,{class:E=void 0}=e,{style:P}=e,{diffStyleUpdates:D=!1}=e,{center:k=void 0}=e,{zoom:V=void 0}=e,{pitch:j=0}=e,{bearing:te=0}=e,{bounds:U=void 0}=e,{hash:W=!1}=e,{loaded:Y=!1}=e,{minZoom:oe=0}=e,{maxZoom:_e=22}=e,{antialias:se=void 0}=e,{zoomOnDoubleClick:ce=!0}=e,{locale:me=void 0}=e,{interactive:Ce=!0}=e,{attributionControl:Z=!0}=e,{cooperativeGestures:fe=!1}=e,{preserveDrawingBuffer:Ke=!1}=e,{maxBounds:Se=void 0}=e,{images:Ze=[]}=e,{standardControls:tt=!1}=e,{filterLayers:qe=void 0}=e,{transformRequest:Ot=void 0}=e;const wt=ju(),{map:un,loadedImages:qt}=fO();Lt(t,un,Qe=>n(4,a=Qe)),Lt(t,qt,Qe=>n(5,c=Qe));let At=new Set;async function hn(Qe,ge=!1){if(a&&!(!a.loaded()&&!ge))if("url"in Qe){At.add(Qe.id);try{let Pe=await a.loadImage(Qe.url);a==null||a.addImage(Qe.id,Pe.data,Qe.options),c.add(Qe.id),qt.set(c)}catch(Pe){wt("error",Pe)}finally{At.delete(Qe.id)}}else a.addImage(Qe.id,Qe.data,Qe.options),c.add(Qe.id),qt.set(c)}let Tn,yn,_n,kn;function wr(Qe){return Sr(),Wn(un,a=new Es.Map(Uc({container:Qe,style:P,locale:me,center:k,zoom:V,pitch:j,bearing:te,minZoom:oe,maxZoom:_e,antialias:se,interactive:Ce,preserveDrawingBuffer:Ke,maxBounds:Se,bounds:U,attributionControl:Z,transformRequest:Ot,cooperativeGestures:fe})),a),a.on("load",ge=>{ge.target.getContainer().setAttribute("data-testid","map"),ge.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,Y=!0),wt("load",a)}),a.on("error",ge=>wt("error",{...ge,map:a})),a.on("movestart",ge=>wt("movestart",{...ge,map:a})),a.on("moveend",ge=>{if(n(12,k=ge.target.getCenter()),n(13,V=ge.target.getZoom()),n(14,U=ge.target.getBounds()),wt("moveend",{...ge,map:a}),W){let Pe=window.location.href.replace(/(#.+)?$/,BO(a));window.history.replaceState(window.history.state,"",Pe)}}),a.on("click",ge=>wt("click",{...ge,map:a})),a.on("dblclick",ge=>wt("dblclick",{...ge,map:a})),a.on("contextmenu",ge=>wt("contextmenu",{...ge,map:a})),a.on("zoomstart",ge=>wt("zoomstart",{...ge,map:a})),a.on("zoom",ge=>{n(13,V=ge.target.getZoom()),wt("zoom",{...ge,map:a})}),a.on("zoomend",ge=>{n(13,V=ge.target.getZoom()),wt("zoomend",{...ge,map:a})}),a.on("style.load",()=>{if(a){const ge=a.getStyle();if(n(35,Tn=ge.layers.map(Pe=>Pe.id)),n(36,yn=Object.keys(ge.sources)),kn)for(const[Pe,It]of Object.entries(kn))a.addSource(Pe,It);if(_n)for(const Pe of _n)a.addLayer(Pe);for(const Pe of Ze)hn(Pe,!0)}}),a.on("styledata",ge=>{if(a&&qe){const Pe=a.getStyle().layers;if(Pe)for(let It of Pe)qe(It)||a.setLayoutProperty(It.id,"visibility","none")}wt("styledata",{...ge,map:a})}),{destroy(){n(0,Y=!1),a==null||a.remove(),Wn(un,a=null,a)}}}let kr=P;function Sr(){if(W){let Qe=VO(window.location.hash);Qe.length>=3&&(n(13,V=Qe[0]),n(12,k=[Qe[2],Qe[1]])),Qe.length==5&&(n(17,te=Qe[3]),n(16,j=Qe[4]))}}function dr(Qe){Zn[Qe?"unshift":"push"](()=>{S=Qe,n(1,S)})}return t.$$set=Qe=>{"map"in Qe&&n(15,w=Qe.map),"mapContainer"in Qe&&n(1,S=Qe.mapContainer),"class"in Qe&&n(2,E=Qe.class),"style"in Qe&&n(18,P=Qe.style),"diffStyleUpdates"in Qe&&n(19,D=Qe.diffStyleUpdates),"center"in Qe&&n(12,k=Qe.center),"zoom"in Qe&&n(13,V=Qe.zoom),"pitch"in Qe&&n(16,j=Qe.pitch),"bearing"in Qe&&n(17,te=Qe.bearing),"bounds"in Qe&&n(14,U=Qe.bounds),"hash"in Qe&&n(20,W=Qe.hash),"loaded"in Qe&&n(0,Y=Qe.loaded),"minZoom"in Qe&&n(21,oe=Qe.minZoom),"maxZoom"in Qe&&n(22,_e=Qe.maxZoom),"antialias"in Qe&&n(23,se=Qe.antialias),"zoomOnDoubleClick"in Qe&&n(24,ce=Qe.zoomOnDoubleClick),"locale"in Qe&&n(25,me=Qe.locale),"interactive"in Qe&&n(26,Ce=Qe.interactive),"attributionControl"in Qe&&n(27,Z=Qe.attributionControl),"cooperativeGestures"in Qe&&n(28,fe=Qe.cooperativeGestures),"preserveDrawingBuffer"in Qe&&n(29,Ke=Qe.preserveDrawingBuffer),"maxBounds"in Qe&&n(30,Se=Qe.maxBounds),"images"in Qe&&n(31,Ze=Qe.images),"standardControls"in Qe&&n(3,tt=Qe.standardControls),"filterLayers"in Qe&&n(32,qe=Qe.filterLayers),"transformRequest"in Qe&&n(33,Ot=Qe.transformRequest),"$$scope"in Qe&&n(38,m=Qe.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&8&&n(7,r=typeof tt=="boolean"?void 0:tt),t.$$.dirty[0]&16&&n(15,w=a),t.$$.dirty[0]&786448|t.$$.dirty[1]&112&&a&&!_g(P,kr)){const Qe=a.getStyle();if(Tn&&(_n=Qe.layers.filter(ge=>!Tn.includes(ge.id))),yn){const ge=Object.keys(Qe.sources).filter(Pe=>!yn.includes(Pe));kn={};for(const Pe of ge)kn[Pe]=Qe.sources[Pe]}n(37,kr=P),a.setStyle(P,{diff:D}),Wn(qt,c=new Set,c),n(34,At=new Set)}if(t.$$.dirty[0]&49|t.$$.dirty[1]&9&&Y&&a!=null&&a.loaded())for(let Qe of Ze)!c.has(Qe.id)&&!At.has(Qe.id)&&!a.hasImage(Qe.id)&&hn(Qe);t.$$.dirty[0]&32|t.$$.dirty[1]&1&&n(6,i=Ze.every(Qe=>c.has(Qe.id))),t.$$.dirty[0]&4112&&k&&!_g(k,a==null?void 0:a.getCenter())&&(a==null||a.panTo(k)),t.$$.dirty[0]&8208&&V&&!_g(V,a==null?void 0:a.getZoom())&&(a==null||a.zoomTo(V)),t.$$.dirty[0]&16400&&U&&!_g(U,a==null?void 0:a.getBounds())&&(a==null||a.fitBounds(U)),t.$$.dirty[0]&16777232&&(ce?a==null||a.doubleClickZoom.enable():a==null||a.doubleClickZoom.disable())},[Y,S,E,tt,a,c,i,r,un,qt,wr,Sr,k,V,U,w,j,te,P,D,W,oe,_e,se,ce,me,Ce,Z,fe,Ke,Se,Ze,qe,Ot,At,Tn,yn,kr,m,u,dr]}class YO extends Qt{constructor(e){super(),Jt(this,e,XO,ZO,Gt,{map:15,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:16,bearing:17,bounds:14,hash:20,loaded:0,minZoom:21,maxZoom:22,antialias:23,zoomOnDoubleClick:24,locale:25,interactive:26,attributionControl:27,cooperativeGestures:28,preserveDrawingBuffer:29,maxBounds:30,images:31,standardControls:3,filterLayers:32,transformRequest:33},null,[-1,-1])}}const KO=t=>({marker:t&8}),Y2=t=>({marker:t[3]});function JO(t){let e,n,r,i,a,c,u;const m=t[19].default,w=ri(m,t,t[18],Y2);return{c(){e=Ne("div"),w&&w.c(),Ve(e,"tabindex",n=t[1]?0:void 0),Ve(e,"role",r=t[1]?"button":void 0),Si(e,"z-index",t[2])},m(S,E){ke(S,e,E),w&&w.m(e,null),a=!0,c||(u=[E0(t[7].call(null,e)),E0(i=QO.call(null,e,t[0])),Wt(e,"click",Z_(t[20])),Wt(e,"dblclick",Z_(t[21])),Wt(e,"contextmenu",Z_(t[22])),Wt(e,"mouseenter",t[23]),Wt(e,"mouseleave",t[24]),Wt(e,"mousemove",t[25]),Wt(e,"keydown",t[8])],c=!0)},p(S,[E]){w&&w.p&&(!a||E&262152)&&oi(w,m,S,S[18],a?ii(m,S[18],E,KO):si(S[18]),Y2),(!a||E&2&&n!==(n=S[1]?0:void 0))&&Ve(e,"tabindex",n),(!a||E&2&&r!==(r=S[1]?"button":void 0))&&Ve(e,"role",r),i&&gy(i.update)&&E&1&&i.update.call(null,S[0]),E&4&&Si(e,"z-index",S[2])},i(S){a||(be(w,S),a=!0)},o(S){Te(w,S),a=!1},d(S){S&&Me(e),w&&w.d(S),c=!1,Ni(u)}}}function QO(t,e){const n=t.className;function r(i){i?t.className=`${n} ${i}`:t.className=n}return r(e),{update:r}}function $O(t,e,n){let r,i,a,{$$slots:c={},$$scope:u}=e,{marker:m=void 0}=e,{lngLat:w}=e,{class:S=void 0}=e,{interactive:E=!0}=e,{asButton:P=!1}=e,{draggable:D=!1}=e,{feature:k=null}=e,{offset:V=void 0}=e,{zIndex:j=void 0}=e,{rotation:te=0}=e,{opacity:U=1}=e;const W=ju(),{map:Y,layerEvent:oe,self:_e}=mO();Lt(t,Y,qe=>n(27,a=qe)),Lt(t,oe,qe=>n(26,r=qe)),Lt(t,_e,qe=>n(3,i=qe));function se(qe){Wn(_e,i=new Es.Marker({element:qe,rotation:te,draggable:D,offset:V,opacity:U.toString()}).setLngLat(w).addTo(a),i),n(11,m=i);const Ot=()=>Ce("dragstart"),wt=()=>{ce(),Ce("drag")},un=()=>{ce(),Ce("dragend")};return D&&(i.on("dragstart",Ot),i.on("drag",wt),i.on("dragend",un)),{destroy(){D&&(i==null||i.off("dragstart",Ot),i==null||i.off("drag",wt),i==null||i.off("dragend",un)),n(11,m=void 0),i==null||i.remove()}}}function ce(){let qe=i==null?void 0:i.getLngLat();qe&&(Array.isArray(w)?n(10,w=[qe.lng,qe.lat]):w&&"lon"in w?n(10,w={lon:qe.lng,lat:qe.lat}):n(10,w=qe))}function me(qe){qe.key===" "&&(qe.preventDefault(),qe.stopPropagation(),Ce("click"))}function Ce(qe){if(!E)return;let Ot=i==null?void 0:i.getLngLat();if(!Ot)return;const wt=[Ot.lng,Ot.lat];let un={map:a,marker:i,lngLat:wt,features:[{type:"Feature",properties:(k==null?void 0:k.properties)??{},geometry:{type:"Point",coordinates:wt}}]};Wn(oe,r={...un,layerType:"marker",type:qe},r),W(qe,un)}const Z=()=>Ce("click"),fe=()=>Ce("dblclick"),Ke=()=>Ce("contextmenu"),Se=qe=>{Ce("mouseenter")},Ze=()=>{Ce("mouseleave")},tt=()=>Ce("mousemove");return t.$$set=qe=>{"marker"in qe&&n(11,m=qe.marker),"lngLat"in qe&&n(10,w=qe.lngLat),"class"in qe&&n(0,S=qe.class),"interactive"in qe&&n(12,E=qe.interactive),"asButton"in qe&&n(1,P=qe.asButton),"draggable"in qe&&n(13,D=qe.draggable),"feature"in qe&&n(14,k=qe.feature),"offset"in qe&&n(15,V=qe.offset),"zIndex"in qe&&n(2,j=qe.zIndex),"rotation"in qe&&n(16,te=qe.rotation),"opacity"in qe&&n(17,U=qe.opacity),"$$scope"in qe&&n(18,u=qe.$$scope)},t.$$.update=()=>{t.$$.dirty&1032&&(i==null||i.setLngLat(w)),t.$$.dirty&32776&&(i==null||i.setOffset(V??[0,0])),t.$$.dirty&65544&&(i==null||i.setRotation(te)),t.$$.dirty&131080&&(i==null||i.setOpacity(U.toString()))},[S,P,j,i,Y,oe,_e,se,me,Ce,w,m,E,D,k,V,te,U,u,c,Z,fe,Ke,Se,Ze,tt]}class Fd extends Qt{constructor(e){super(),Jt(this,e,$O,JO,Gt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const e5=t=>({}),K2=t=>({}),t5=t=>({}),J2=t=>({}),n5=t=>({}),Q2=t=>({});function r5(t){let e,n,r,i,a,c;const u=t[1].top,m=ri(u,t,t[0],Q2),w=t[1].left,S=ri(w,t,t[0],J2),E=t[1].main,P=ri(E,t,t[0],K2);return{c(){e=Ne("div"),m&&m.c(),n=at(),r=Ne("div"),S&&S.c(),i=at(),a=Ne("div"),P&&P.c(),Ve(e,"class","top svelte-mpick2"),Ve(r,"class","left svelte-mpick2"),Ve(a,"class","main svelte-mpick2")},m(D,k){ke(D,e,k),m&&m.m(e,null),ke(D,n,k),ke(D,r,k),S&&S.m(r,null),ke(D,i,k),ke(D,a,k),P&&P.m(a,null),c=!0},p(D,[k]){m&&m.p&&(!c||k&1)&&oi(m,u,D,D[0],c?ii(u,D[0],k,n5):si(D[0]),Q2),S&&S.p&&(!c||k&1)&&oi(S,w,D,D[0],c?ii(w,D[0],k,t5):si(D[0]),J2),P&&P.p&&(!c||k&1)&&oi(P,E,D,D[0],c?ii(E,D[0],k,e5):si(D[0]),K2)},i(D){c||(be(m,D),be(S,D),be(P,D),c=!0)},o(D){Te(m,D),Te(S,D),Te(P,D),c=!1},d(D){D&&(Me(e),Me(n),Me(r),Me(i),Me(a)),m&&m.d(D),S&&S.d(D),P&&P.d(D)}}}function i5(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=a=>{"$$scope"in a&&n(0,i=a.$$scope)},[i,r]}class o5 extends Qt{constructor(e){super(),Jt(this,e,i5,r5,Gt,{})}}const s5=t=>({}),$2=t=>({}),a5=t=>({}),eS=t=>({}),l5=t=>({}),tS=t=>({});function u5(t){let e,n,r,i,a,c;const u=t[4].top,m=ri(u,t,t[3],tS),w=t[4].sidebar,S=ri(w,t,t[3],eS),E=t[4].map,P=ri(E,t,t[3],$2);return{c(){e=Ne("div"),m&&m.c(),n=at(),r=Ne("div"),S&&S.c(),i=at(),a=Ne("div"),P&&P.c()},m(D,k){ke(D,e,k),m&&m.m(e,null),t[5](e),ke(D,n,k),ke(D,r,k),S&&S.m(r,null),t[6](r),ke(D,i,k),ke(D,a,k),P&&P.m(a,null),t[7](a),c=!0},p(D,[k]){m&&m.p&&(!c||k&8)&&oi(m,u,D,D[3],c?ii(u,D[3],k,l5):si(D[3]),tS),S&&S.p&&(!c||k&8)&&oi(S,w,D,D[3],c?ii(w,D[3],k,a5):si(D[3]),eS),P&&P.p&&(!c||k&8)&&oi(P,E,D,D[3],c?ii(E,D[3],k,s5):si(D[3]),$2)},i(D){c||(be(m,D),be(S,D),be(P,D),c=!0)},o(D){Te(m,D),Te(S,D),Te(P,D),c=!1},d(D){D&&(Me(e),Me(n),Me(r),Me(i),Me(a)),m&&m.d(D),t[5](null),S&&S.d(D),t[6](null),P&&P.d(D),t[7](null)}}}function c5(t,e,n){let r,i,a;Lt(t,dv,E=>n(0,r=E)),Lt(t,mv,E=>n(1,i=E)),Lt(t,gv,E=>n(2,a=E));let{$$slots:c={},$$scope:u}=e;function m(E){Zn[E?"unshift":"push"](()=>{r=E,dv.set(r)})}function w(E){Zn[E?"unshift":"push"](()=>{i=E,mv.set(i)})}function S(E){Zn[E?"unshift":"push"](()=>{a=E,gv.set(a)})}return t.$$set=E=>{"$$scope"in E&&n(3,u=E.$$scope)},[r,i,a,u,c,m,w,S]}class Yf extends Qt{constructor(e){super(),Jt(this,e,c5,u5,Gt,{})}}let dv=sr(null),mv=sr(null),gv=sr(null);function h5(t){let e,n;return e=new wv({props:{properties:t[3]}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&8&&(a.properties=r[3]),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function f5(t){let e,n;return e=new Zf({props:{openOn:"hover",$$slots:{default:[h5,({props:r})=>({3:r}),({props:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&24&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function p5(t){let e,n,r;function i(c){t[1](c)}let a={id:"amenities",paint:{"circle-radius":5,"circle-opacity":0,"circle-stroke-width":2,"circle-stroke-color":Fy("orange","red")},manageHoverState:!0,filter:["has","amenity_kind"],hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[f5]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new By({props:a}),Zn.push(()=>ao(e,"hovered",i)),e.$on("click",t[2]),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,[u]){const m={};u&16&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.hovered=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function d5(t,e,n){let{hovered:r=null}=e;function i(c){r=c,n(0,r)}const a=c=>window.open(ul(c.detail.features[0].properties).osm_id,"_blank");return t.$$set=c=>{"hovered"in c&&n(0,r=c.hovered)},[r,i,a]}class PC extends Qt{constructor(e){super(),Jt(this,e,d5,p5,Gt,{hovered:0})}}function nS(t,e,n){const r=t.slice();return r[2]=e[n][0],r[3]=e[n][1],r}function rS(t,e,n){const r=t.slice();return r[6]=e[n],r}function iS(t){let e,n,r=aS(t[6])+"",i,a;return{c(){e=Ne("li"),n=Ne("a"),i=Mt(r),Ve(n,"href",a=t[6].properties.osm_id),Ve(n,"target","_blank")},m(c,u){ke(c,e,u),Le(e,n),Le(n,i)},p(c,u){u&1&&r!==(r=aS(c[6])+"")&&Hn(i,r),u&1&&a!==(a=c[6].properties.osm_id)&&Ve(n,"href",a)},d(c){c&&Me(e)}}}function oS(t){let e,n,r=t[2]+"",i,a,c=t[3].length+"",u,m,w,S,E,P=zr(t[3]),D=[];for(let k=0;k<P.length;k+=1)D[k]=iS(rS(t,P,k));return{c(){e=Ne("details"),n=Ne("summary"),i=Mt(r),a=Mt(" ("),u=Mt(c),m=Mt(")"),w=at(),S=Ne("ol");for(let k=0;k<D.length;k+=1)D[k].c();E=at()},m(k,V){ke(k,e,V),Le(e,n),Le(n,i),Le(n,a),Le(n,u),Le(n,m),Le(e,w),Le(e,S);for(let j=0;j<D.length;j+=1)D[j]&&D[j].m(S,null);Le(e,E)},p(k,V){if(V&1&&r!==(r=k[2]+"")&&Hn(i,r),V&1&&c!==(c=k[3].length+"")&&Hn(u,c),V&1){P=zr(k[3]);let j;for(j=0;j<P.length;j+=1){const te=rS(k,P,j);D[j]?D[j].p(te,V):(D[j]=iS(te),D[j].c(),D[j].m(S,null))}for(;j<D.length;j+=1)D[j].d(1);D.length=P.length}},d(k){k&&Me(e),Pa(D,k)}}}function m5(t){let e,n=zr(sS(t[0])),r=[];for(let i=0;i<n.length;i+=1)r[i]=oS(nS(t,n,i));return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=Yr()},m(i,a){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(i,a);ke(i,e,a)},p(i,[a]){if(a&1){n=zr(sS(i[0]));let c;for(c=0;c<n.length;c+=1){const u=nS(i,n,c);r[c]?r[c].p(u,a):(r[c]=oS(u),r[c].c(),r[c].m(e.parentNode,e))}for(;c<r.length;c+=1)r[c].d(1);r.length=n.length}},i:gt,o:gt,d(i){i&&Me(e),Pa(r,i)}}}function sS(t){let e=new Map;for(let r of t)e.has(r.properties.amenity_kind)||e.set(r.properties.amenity_kind,[]),e.get(r.properties.amenity_kind).push(r);let n=[...e.entries()];return n.sort((r,i)=>i[1].length-r[1].length),n}function aS(t){let e=t.properties.name||`a ${t.properties.amenity_kind}`;return t.properties.brand&&(e+=` (${t.properties.brand})`),t.properties.cuisine&&(e+=` (${t.properties.cuisine})`),e}function g5(t,e,n){let r,{gj:i}=e;return t.$$set=a=>{"gj"in a&&n(1,i=a.gj)},t.$$.update=()=>{t.$$.dirty&2&&n(0,r=i.features.filter(a=>"amenity_kind"in a.properties))},[r,i]}class MC extends Qt{constructor(e){super(),Jt(this,e,g5,m5,Gt,{gj:1})}}function lS(t,e,n){const r=t.slice();return r[3]=e[n],r}function uS(t){let e,n,r=zr(t[0]),i=[];for(let a=0;a<r.length;a+=1)i[a]=cS(lS(t,r,a));return{c(){e=Ne("div"),n=Ne("div");for(let a=0;a<i.length;a+=1)i[a].c();Ve(n,"class","inner svelte-1vq13g9"),Ve(e,"class","outer svelte-1vq13g9")},m(a,c){ke(a,e,c),Le(e,n);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(n,null);t[2](n)},p(a,c){if(c&1){r=zr(a[0]);let u;for(u=0;u<r.length;u+=1){const m=lS(a,r,u);i[u]?i[u].p(m,c):(i[u]=cS(m),i[u].c(),i[u].m(n,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=r.length}},d(a){a&&Me(e),Pa(i,a),t[2](null)}}}function cS(t){let e,n=t[3]+"",r;return{c(){e=Ne("p"),r=Mt(n)},m(i,a){ke(i,e,a),Le(e,r)},p(i,a){a&1&&n!==(n=i[3]+"")&&Hn(r,n)},d(i){i&&Me(e)}}}function y5(t){let e,n=t[0].length>0&&uS(t);return{c(){n&&n.c(),e=Yr()},m(r,i){n&&n.m(r,i),ke(r,e,i)},p(r,[i]){r[0].length>0?n?n.p(r,i):(n=uS(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:gt,o:gt,d(r){r&&Me(e),n&&n.d(r)}}}function _5(t,e,n){let{loading:r}=e,i;function a(c){Zn[c?"unshift":"push"](()=>{i=c,n(1,i),n(0,r)})}return t.$$set=c=>{"loading"in c&&n(0,r=c.loading)},t.$$.update=()=>{t.$$.dirty&3&&r.length>0&&i&&n(1,i.scrollTop=i.scrollHeight,i)},[r,i,a]}class AC extends Qt{constructor(e){super(),Jt(this,e,_5,y5,Gt,{loading:0})}}function v5(t){let e,n,r,i,a,c,u,m,w,S,E,P,D,k,V,j,te,U,W,Y,oe,_e,se,ce,me,Ce;return{c(){e=Ne("nav"),n=Ne("ul"),r=Ne("li"),i=Ne("button"),i.textContent="Change study area",a=at(),c=Ne("li"),u=Ne("button"),m=Mt("Isochrone"),S=at(),E=Ne("li"),P=Ne("button"),D=Mt("Route"),V=at(),j=Ne("li"),te=Ne("button"),U=Mt("Score"),Y=at(),oe=Ne("li"),_e=Ne("button"),se=Mt("Debug network"),u.disabled=w=t[0].kind=="isochrone",P.disabled=k=t[0].kind=="route",te.disabled=W=t[0].kind=="score",_e.disabled=ce=t[0].kind=="debug"},m(Z,fe){ke(Z,e,fe),Le(e,n),Le(n,r),Le(r,i),Le(n,a),Le(n,c),Le(c,u),Le(u,m),Le(n,S),Le(n,E),Le(E,P),Le(P,D),Le(n,V),Le(n,j),Le(j,te),Le(te,U),Le(n,Y),Le(n,oe),Le(oe,_e),Le(_e,se),me||(Ce=[Wt(i,"click",t[1]),Wt(u,"click",t[2]),Wt(P,"click",t[3]),Wt(te,"click",t[4]),Wt(_e,"click",t[5])],me=!0)},p(Z,[fe]){fe&1&&w!==(w=Z[0].kind=="isochrone")&&(u.disabled=w),fe&1&&k!==(k=Z[0].kind=="route")&&(P.disabled=k),fe&1&&W!==(W=Z[0].kind=="score")&&(te.disabled=W),fe&1&&ce!==(ce=Z[0].kind=="debug")&&(_e.disabled=ce)},i:gt,o:gt,d(Z){Z&&Me(e),me=!1,Ni(Ce)}}}function b5(t,e,n){let r;return Lt(t,Ys,w=>n(0,r=w)),[r,()=>Wn(Ys,r={kind:"title"},r),()=>Wn(Ys,r={kind:"isochrone"},r),()=>Wn(Ys,r={kind:"route"},r),()=>Wn(Ys,r={kind:"score"},r),()=>Wn(Ys,r={kind:"debug"},r)]}class Vy extends Qt{constructor(e){super(),Jt(this,e,b5,v5,Gt,{})}}function hS(t,e,n){const r=t.slice();return r[9]=e[n],r[10]=e,r[11]=n,r}function x5(t){let e,n,r=t[0].join(", ")+"",i,a,c,u,m;return{c(){e=Ne("p"),n=Mt("Amenities: "),i=Mt(r),a=at(),c=Ne("button"),c.textContent="Choose"},m(w,S){ke(w,e,S),Le(e,n),Le(e,i),ke(w,a,S),ke(w,c,S),u||(m=Wt(c,"click",t[6]),u=!0)},p(w,S){S&1&&r!==(r=w[0].join(", ")+"")&&Hn(i,r)},i:gt,o:gt,d(w){w&&(Me(e),Me(a),Me(c)),u=!1,m()}}}function w5(t){let e,n;return e=new xv({props:{$$slots:{default:[S5,({dialog:r})=>({8:r}),({dialog:r})=>r?256:0]},$$scope:{ctx:t}}}),e.$on("close",t[5]),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&4354&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function fS(t){let e,n,r,i=t[9]+"",a,c,u,m;function w(){t[3].call(n,t[9])}return{c(){e=Ne("label"),n=Ne("input"),r=at(),a=Mt(i),c=at(),Ve(n,"type","checkbox")},m(S,E){ke(S,e,E),Le(e,n),n.checked=t[1][t[9]],Le(e,r),Le(e,a),Le(e,c),u||(m=Wt(n,"change",w),u=!0)},p(S,E){t=S,E&2&&(n.checked=t[1][t[9]]),E&2&&i!==(i=t[9]+"")&&Hn(a,i)},d(S){S&&Me(e),u=!1,m()}}}function S5(t){let e,n,r,i,a,c,u,m,w,S,E=zr(Object.keys(t[1])),P=[];for(let k=0;k<E.length;k+=1)P[k]=fS(hS(t,E,k));function D(){return t[4](t[8])}return{c(){e=Ne("h2"),e.textContent="Pick types of amenity to search from",n=at(),r=Ne("fieldset"),i=Ne("legend"),i.textContent="Amenities:",a=at();for(let k=0;k<P.length;k+=1)P[k].c();c=at(),u=Ne("center"),m=Ne("button"),m.textContent="Start!"},m(k,V){ke(k,e,V),ke(k,n,V),ke(k,r,V),Le(r,i),Le(r,a);for(let j=0;j<P.length;j+=1)P[j]&&P[j].m(r,null);ke(k,c,V),ke(k,u,V),Le(u,m),w||(S=Wt(m,"click",D),w=!0)},p(k,V){if(t=k,V&2){E=zr(Object.keys(t[1]));let j;for(j=0;j<E.length;j+=1){const te=hS(t,E,j);P[j]?P[j].p(te,V):(P[j]=fS(te),P[j].c(),P[j].m(r,null))}for(;j<P.length;j+=1)P[j].d(1);P.length=E.length}},d(k){k&&(Me(e),Me(n),Me(r),Me(c),Me(u)),Pa(P,k),w=!1,S()}}}function E5(t){let e,n,r,i;const a=[w5,x5],c=[];function u(m,w){return m[2]?0:1}return e=u(t),n=c[e]=a[e](t),{c(){n.c(),r=Yr()},m(m,w){c[e].m(m,w),ke(m,r,w),i=!0},p(m,[w]){let S=e;e=u(m),e===S?c[e].p(m,w):(On(),Te(c[S],1,1,()=>{c[S]=null}),zn(),n=c[e],n?n.p(m,w):(n=c[e]=a[e](m),n.c()),be(n,1),n.m(r.parentNode,r))},i(m){i||(be(n),i=!0)},o(m){Te(n),i=!1},d(m){m&&Me(r),c[e].d(m)}}}function I5(t){return Object.entries(t).filter(e=>e[1]).map(e=>e[0])}function C5(t,e,n){let r;Lt(t,Zl,E=>n(7,r=E));let i={},a=!1,{enabled:c}=e;qu(async()=>{let E=await r.renderDebug(),P=new Set;for(let D of E.features){let k=D.properties.amenity_kind;k&&P.add(k)}for(let D of[...P].sort())n(1,i[D]=!1,i);n(1,i)});function u(E){i[E]=this.checked,n(1,i)}const m=E=>ul(E).close(),w=()=>n(2,a=!1),S=()=>n(2,a=!0);return t.$$set=E=>{"enabled"in E&&n(0,c=E.enabled)},t.$$.update=()=>{t.$$.dirty&2&&n(0,c=I5(i))},[c,i,a,u,m,w,S]}class T5 extends Qt{constructor(e){super(),Jt(this,e,C5,E5,Gt,{enabled:0})}}function L5(t){let e,n,r,i,a,c,u,m,w;return{c(){e=Ne("label"),n=Mt(`Mode:
  `),r=Ne("select"),i=Ne("option"),i.textContent="Car",a=Ne("option"),a.textContent="Bicycle",c=Ne("option"),c.textContent="Foot",u=Ne("option"),u.textContent="Public transit",i.__value="car",Go(i,i.__value),a.__value="bicycle",Go(a,a.__value),c.__value="foot",Go(c,c.__value),u.__value="transit",Go(u,u.__value),t[0]===void 0&&bd(()=>t[1].call(r))},m(S,E){ke(S,e,E),Le(e,n),Le(e,r),Le(r,i),Le(r,a),Le(r,c),Le(r,u),Rg(r,t[0],!0),m||(w=Wt(r,"change",t[1]),m=!0)},p(S,[E]){E&1&&Rg(r,S[0])},i:gt,o:gt,d(S){S&&Me(e),m=!1,w()}}}function P5(t,e,n){let{travelMode:r}=e;function i(){r=QS(this),n(0,r)}return t.$$set=a=>{"travelMode"in a&&n(0,r=a.travelMode)},[r,i]}class y1 extends Qt{constructor(e){super(),Jt(this,e,P5,L5,Gt,{travelMode:0})}}function pS(t,e,n){const r=t.slice();return r[3]=e[n],r}function M5(t){let e=t[6].name+"",n,r,i=JSON.parse(t[6].next_steps).length+"",a,c;return{c(){n=Mt(e),r=Mt(" has "),a=Mt(i),c=Mt(" next steps (arrivals)")},m(u,m){ke(u,n,m),ke(u,r,m),ke(u,a,m),ke(u,c,m)},p(u,m){m&64&&e!==(e=u[6].name+"")&&Hn(n,e),m&64&&i!==(i=JSON.parse(u[6].next_steps).length+"")&&Hn(a,i)},d(u){u&&(Me(n),Me(r),Me(a),Me(c))}}}function A5(t){let e,n;return e=new Zf({props:{openOn:"hover",$$slots:{default:[M5,({props:r})=>({6:r}),({props:r})=>r?64:0]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&192&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function dS(t){let e,n;return e=new xv({props:{$$slots:{default:[k5]},$$scope:{ctx:t}}}),e.$on("close",t[2]),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&129&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function mS(t){let e,n=JSON.stringify(t[3])+"",r;return{c(){e=Ne("p"),r=Mt(n)},m(i,a){ke(i,e,a),Le(e,r)},p(i,a){a&1&&n!==(n=JSON.stringify(i[3])+"")&&Hn(r,n)},d(i){i&&Me(e)}}}function k5(t){let e,n=zr(t[0]),r=[];for(let i=0;i<n.length;i+=1)r[i]=mS(pS(t,n,i));return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=Yr()},m(i,a){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(i,a);ke(i,e,a)},p(i,a){if(a&1){n=zr(i[0]);let c;for(c=0;c<n.length;c+=1){const u=pS(i,n,c);r[c]?r[c].p(u,a):(r[c]=mS(u),r[c].c(),r[c].m(e.parentNode,e))}for(;c<r.length;c+=1)r[c].d(1);r.length=n.length}},d(i){i&&Me(e),Pa(r,i)}}}function D5(t){let e,n,r,i;e=new By({props:{id:"stops",paint:{"circle-radius":5,"circle-color":Fy("cyan","blue")},manageHoverState:!0,filter:["has","next_steps"],hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[A5]},$$scope:{ctx:t}}}),e.$on("click",t[1]);let a=t[0]&&dS(t);return{c(){lt(e.$$.fragment),n=at(),a&&a.c(),r=Yr()},m(c,u){it(e,c,u),ke(c,n,u),a&&a.m(c,u),ke(c,r,u),i=!0},p(c,[u]){const m={};u&128&&(m.$$scope={dirty:u,ctx:c}),e.$set(m),c[0]?a?(a.p(c,u),u&1&&be(a,1)):(a=dS(c),a.c(),be(a,1),a.m(r.parentNode,r)):a&&(On(),Te(a,1,1,()=>{a=null}),zn())},i(c){i||(be(e.$$.fragment,c),be(a),i=!0)},o(c){Te(e.$$.fragment,c),Te(a),i=!1},d(c){c&&(Me(n),Me(r)),ot(e,c),a&&a.d(c)}}}function R5(t,e,n){let r=null;return[r,c=>n(0,r=JSON.parse(ul(c.detail.features[0].properties).next_steps)),()=>n(0,r=null)]}class N5 extends Qt{constructor(e){super(),Jt(this,e,R5,D5,Gt,{})}}function O5(t){let e,n,r;return n=new Vy({}),{c(){e=Ne("div"),lt(n.$$.fragment),Ve(e,"slot","top")},m(i,a){ke(i,e,a),it(n,e,null),r=!0},p:gt,i(i){r||(be(n.$$.fragment,i),r=!0)},o(i){Te(n.$$.fragment,i),r=!1},d(i){i&&Me(e),ot(n)}}}function gS(t){let e,n;return e=new MC({props:{gj:t[0]}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&1&&(a.gj=r[0]),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function z5(t){let e,n,r,i,a,c,u,m,w;function S(D){t[3](D)}let E={};t[1]!==void 0&&(E.travelMode=t[1]),c=new y1({props:E}),Zn.push(()=>ao(c,"travelMode",S));let P=t[0]&&gS(t);return{c(){e=Ne("div"),n=Ne("h2"),n.textContent="Debug mode",r=at(),i=Ne("p"),i.textContent="Hover to see a segment's properties, and click to open OSM",a=at(),lt(c.$$.fragment),m=at(),P&&P.c(),Ve(e,"slot","sidebar")},m(D,k){ke(D,e,k),Le(e,n),Le(e,r),Le(e,i),Le(e,a),it(c,e,null),Le(e,m),P&&P.m(e,null),w=!0},p(D,k){const V={};!u&&k&2&&(u=!0,V.travelMode=D[1],so(()=>u=!1)),c.$set(V),D[0]?P?(P.p(D,k),k&1&&be(P,1)):(P=gS(D),P.c(),be(P,1),P.m(e,null)):P&&(On(),Te(P,1,1,()=>{P=null}),zn())},i(D){w||(be(c.$$.fragment,D),be(P),w=!0)},o(D){Te(c.$$.fragment,D),Te(P),w=!1},d(D){D&&Me(e),ot(c),P&&P.d()}}}function yS(t){let e,n;return e=new ru({props:{data:t[0],generateId:!0,$$slots:{default:[V5]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&1&&(a.data=r[0]),i&66&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function F5(t){let e,n;return e=new wv({props:{properties:t[5]}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&32&&(a.properties=r[5]),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function B5(t){let e,n;return e=new Zf({props:{openOn:"hover",$$slots:{default:[F5,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&96&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function V5(t){let e,n,r,i,a,c;return e=new Kc({props:{id:"network",paint:{"line-width":Fy(5,7),"line-color":"black"},filter:hx(t[1]),manageHoverState:!0,hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[B5]},$$scope:{ctx:t}}}),e.$on("click",t[2]),r=new PC({}),a=new N5({}),{c(){lt(e.$$.fragment),n=at(),lt(r.$$.fragment),i=at(),lt(a.$$.fragment)},m(u,m){it(e,u,m),ke(u,n,m),it(r,u,m),ke(u,i,m),it(a,u,m),c=!0},p(u,m){const w={};m&2&&(w.filter=hx(u[1])),m&64&&(w.$$scope={dirty:m,ctx:u}),e.$set(w)},i(u){c||(be(e.$$.fragment,u),be(r.$$.fragment,u),be(a.$$.fragment,u),c=!0)},o(u){Te(e.$$.fragment,u),Te(r.$$.fragment,u),Te(a.$$.fragment,u),c=!1},d(u){u&&(Me(n),Me(i)),ot(e,u),ot(r,u),ot(a,u)}}}function U5(t){let e,n,r=t[0]&&yS(t);return{c(){e=Ne("div"),r&&r.c(),Ve(e,"slot","map")},m(i,a){ke(i,e,a),r&&r.m(e,null),n=!0},p(i,a){i[0]?r?(r.p(i,a),a&1&&be(r,1)):(r=yS(i),r.c(),be(r,1),r.m(e,null)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d()}}}function G5(t){let e,n;return e=new Yf({props:{$$slots:{map:[U5],sidebar:[z5],top:[O5]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,[i]){const a={};i&67&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function q5(t,e,n){let r,i;Lt(t,Zl,m=>n(4,r=m)),Lt(t,hf,m=>n(1,i=m));let a=null;qu(async()=>{n(0,a=await r.renderDebug())});const c=m=>window.open(ul(m.detail.features[0].properties).way,"_blank");function u(m){i=m,hf.set(i)}return[a,i,c,u]}class j5 extends Qt{constructor(e){super(),Jt(this,e,q5,G5,Gt,{})}}const Bd=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"];function W5(t){let e,n,r;return n=new Vy({}),{c(){e=Ne("div"),lt(n.$$.fragment),Ve(e,"slot","top")},m(i,a){ke(i,e,a),it(n,e,null),r=!0},p:gt,i(i){r||(be(n.$$.fragment,i),r=!0)},o(i){Te(n.$$.fragment,i),r=!1},d(i){i&&Me(e),ot(n)}}}function _S(t){let e,n;return{c(){e=Ne("p"),n=Mt(t[7])},m(r,i){ke(r,e,i),Le(e,n)},p(r,i){i&128&&Hn(n,r[7])},d(r){r&&Me(e)}}}function vS(t){let e,n;return e=new MC({props:{gj:t[5]}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&32&&(a.gj=r[5]),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function H5(t){let e,n,r,i,a,c,u,m,w,S,E,P,D,k,V,j,te,U,W,Y,oe,_e,se;function ce(fe){t[12](fe)}let me={};t[4]!==void 0&&(me.travelMode=t[4]),c=new y1({props:me}),Zn.push(()=>ao(c,"travelMode",ce)),U=new nE({props:{colorScale:Bd,limits:t[8]}});let Ce=t[7]&&_S(t),Z=t[5]&&vS(t);return{c(){e=Ne("div"),n=Ne("h2"),n.textContent="Isochrone mode",r=at(),i=Ne("p"),i.textContent=`Move the pin to calculate an isochrone from that start. The cost is time
      in seconds.`,a=at(),lt(c.$$.fragment),m=at(),w=Ne("label"),S=Mt(`Start time (PT only)
      `),E=Ne("input"),D=at(),k=Ne("label"),V=Ne("input"),j=Mt("Contours"),te=at(),lt(U.$$.fragment),W=at(),Ce&&Ce.c(),Y=at(),Z&&Z.c(),Ve(E,"type","time"),E.disabled=P=t[4]!="transit",Ve(V,"type","checkbox"),Ve(e,"slot","sidebar")},m(fe,Ke){ke(fe,e,Ke),Le(e,n),Le(e,r),Le(e,i),Le(e,a),it(c,e,null),Le(e,m),Le(e,w),Le(w,S),Le(w,E),Go(E,t[3]),Le(e,D),Le(e,k),Le(k,V),V.checked=t[1],Le(k,j),Le(e,te),it(U,e,null),Le(e,W),Ce&&Ce.m(e,null),Le(e,Y),Z&&Z.m(e,null),oe=!0,_e||(se=[Wt(E,"input",t[13]),Wt(V,"change",t[14])],_e=!0)},p(fe,Ke){const Se={};!u&&Ke&16&&(u=!0,Se.travelMode=fe[4],so(()=>u=!1)),c.$set(Se),(!oe||Ke&16&&P!==(P=fe[4]!="transit"))&&(E.disabled=P),Ke&8&&Go(E,fe[3]),Ke&2&&(V.checked=fe[1]),fe[7]?Ce?Ce.p(fe,Ke):(Ce=_S(fe),Ce.c(),Ce.m(e,Y)):Ce&&(Ce.d(1),Ce=null),fe[5]?Z?(Z.p(fe,Ke),Ke&32&&be(Z,1)):(Z=vS(fe),Z.c(),be(Z,1),Z.m(e,null)):Z&&(On(),Te(Z,1,1,()=>{Z=null}),zn())},i(fe){oe||(be(c.$$.fragment,fe),be(U.$$.fragment,fe),be(Z),oe=!0)},o(fe){Te(c.$$.fragment,fe),Te(U.$$.fragment,fe),Te(Z),oe=!1},d(fe){fe&&Me(e),ot(c),ot(U),Ce&&Ce.d(),Z&&Z.d(),_e=!1,Ni(se)}}}function bS(t){let e,n,r;function i(c){t[10](c)}let a={draggable:!0,$$slots:{default:[Z5]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.lngLat=t[0]),e=new Fd({props:a}),Zn.push(()=>ao(e,"lngLat",i)),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,u){const m={};u&524288&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.lngLat=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function Z5(t){let e;return{c(){e=Ne("span"),e.textContent="X",Ve(e,"class","dot svelte-1ej0v4r")},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function xS(t){let e,n;return e=new ru({props:{data:t[5],$$slots:{default:[K5]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&32&&(a.data=r[5]),i&524292&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function X5(t){let e=(t[18].cost_seconds/60).toFixed(1)+"",n,r;return{c(){n=Mt(e),r=Mt(" minutes away")},m(i,a){ke(i,n,a),ke(i,r,a)},p(i,a){a&262144&&e!==(e=(i[18].cost_seconds/60).toFixed(1)+"")&&Hn(n,e)},d(i){i&&(Me(n),Me(r))}}}function Y5(t){let e,n;return e=new Zf({props:{openOn:"hover",$$slots:{default:[X5,({props:r})=>({18:r}),({props:r})=>r?262144:0]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&786432&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function K5(t){let e,n,r,i,a,c,u;e=new Kc({props:{id:"isochrone",filter:uO,paint:{"line-width":20,"line-color":pv(["get","cost_seconds"],t[9],Bd),"line-opacity":.5},eventsIfTopMost:!0,$$slots:{default:[Y5]},$$scope:{ctx:t}}}),r=new LC({props:{id:"isochrone-contours",filter:lO,paint:{"fill-color":pv(["get","min_seconds"],t[9],Bd),"fill-opacity":.5}}});function m(S){t[11](S)}let w={};return t[2]!==void 0&&(w.hovered=t[2]),a=new PC({props:w}),Zn.push(()=>ao(a,"hovered",m)),{c(){lt(e.$$.fragment),n=at(),lt(r.$$.fragment),i=at(),lt(a.$$.fragment)},m(S,E){it(e,S,E),ke(S,n,E),it(r,S,E),ke(S,i,E),it(a,S,E),u=!0},p(S,E){const P={};E&524288&&(P.$$scope={dirty:E,ctx:S}),e.$set(P);const D={};!c&&E&4&&(c=!0,D.hovered=S[2],so(()=>c=!1)),a.$set(D)},i(S){u||(be(e.$$.fragment,S),be(r.$$.fragment,S),be(a.$$.fragment,S),u=!0)},o(S){Te(e.$$.fragment,S),Te(r.$$.fragment,S),Te(a.$$.fragment,S),u=!1},d(S){S&&(Me(n),Me(i)),ot(e,S),ot(r,S),ot(a,S)}}}function wS(t){let e,n;return e=new ru({props:{data:t[6],$$slots:{default:[J5]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&64&&(a.data=r[6]),i&524288&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function J5(t){let e,n;return e=new Kc({props:{id:"route",paint:{"line-width":10,"line-color":"red"}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function Q5(t){let e,n,r,i,a=t[0]&&bS(t),c=t[5]&&xS(t),u=t[6]&&wS(t);return{c(){e=Ne("div"),a&&a.c(),n=at(),c&&c.c(),r=at(),u&&u.c(),Ve(e,"slot","map")},m(m,w){ke(m,e,w),a&&a.m(e,null),Le(e,n),c&&c.m(e,null),Le(e,r),u&&u.m(e,null),i=!0},p(m,w){m[0]?a?(a.p(m,w),w&1&&be(a,1)):(a=bS(m),a.c(),be(a,1),a.m(e,n)):a&&(On(),Te(a,1,1,()=>{a=null}),zn()),m[5]?c?(c.p(m,w),w&32&&be(c,1)):(c=xS(m),c.c(),be(c,1),c.m(e,r)):c&&(On(),Te(c,1,1,()=>{c=null}),zn()),m[6]?u?(u.p(m,w),w&64&&be(u,1)):(u=wS(m),u.c(),be(u,1),u.m(e,null)):u&&(On(),Te(u,1,1,()=>{u=null}),zn())},i(m){i||(be(a),be(c),be(u),i=!0)},o(m){Te(a),Te(c),Te(u),i=!1},d(m){m&&Me(e),a&&a.d(),c&&c.d(),u&&u.d()}}}function $5(t){let e,n;return e=new Yf({props:{$$slots:{map:[Q5],sidebar:[H5],top:[W5]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,[i]){const a={};i&524543&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function SS(t,e,n){return e+t*(n-e)}function ez(t,e,n){let r,i,a;Lt(t,Bg,oe=>n(3,r=oe)),Lt(t,hf,oe=>n(4,i=oe)),Lt(t,Zl,oe=>n(15,a=oe));let c=null;qu(async()=>{let oe=await a.getBounds();n(0,c={lng:SS(.5,oe[0],oe[2]),lat:SS(.5,oe[1],oe[3])})});let u=!0,m=null,w=null,S="",E;async function P(oe,_e,se,ce){if(c)try{n(5,m=await a.isochrone({start:c,mode:i,contours:u,startTime:r})),n(7,S="")}catch(me){n(5,m=null),me=me.toString()}}async function D(oe,_e,se){if(c&&E)try{n(6,w=await a.route({start:c,end:E.geometry.coordinates,mode:i,debugSearch:!1,useHeuristic:!1,startTime:r})),n(7,S="")}catch(ce){n(6,w=null),ce=ce.toString()}else n(6,w=null)}let k=[0,3,6,9,12,15],V=k.map(oe=>oe*60);function j(oe){c=oe,n(0,c)}function te(oe){E=oe,n(2,E)}function U(oe){i=oe,hf.set(i)}function W(){r=this.value,Bg.set(r)}function Y(){u=this.checked,n(1,u)}return t.$$.update=()=>{t.$$.dirty&27&&P(),t.$$.dirty&13&&D()},[c,u,E,r,i,m,w,S,k,V,j,te,U,W,Y]}class tz extends Qt{constructor(e){super(),Jt(this,e,ez,$5,Gt,{})}}function ES(t,e,n){const r=t.slice();r[18]=e[n];const i=ul(r[18].properties);return r[17]=i,r}function nz(t){let e,n,r;return n=new Vy({}),{c(){e=Ne("div"),lt(n.$$.fragment),Ve(e,"slot","top")},m(i,a){ke(i,e,a),it(n,e,null),r=!0},p:gt,i(i){r||(be(n.$$.fragment,i),r=!0)},o(i){Te(n.$$.fragment,i),r=!1},d(i){i&&Me(e),ot(n)}}}function rz(t){let e,n,r,i,a,c=zr(t[5].features),u=[];for(let m=0;m<c.length;m+=1)u[m]=IS(ES(t,c,m));return{c(){e=Ne("button"),e.textContent="Watch how this route was found",n=at(),r=Ne("ol");for(let m=0;m<u.length;m+=1)u[m].c()},m(m,w){ke(m,e,w),ke(m,n,w),ke(m,r,w);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(r,null);i||(a=Wt(e,"click",t[8]),i=!0)},p(m,w){if(w&32){c=zr(m[5].features);let S;for(S=0;S<c.length;S+=1){const E=ES(m,c,S);u[S]?u[S].p(E,w):(u[S]=IS(E),u[S].c(),u[S].m(r,null))}for(;S<u.length;S+=1)u[S].d(1);u.length=c.length}},d(m){m&&(Me(e),Me(n),Me(r)),Pa(u,m),i=!1,a()}}}function iz(t){let e,n;return{c(){e=Ne("p"),n=Mt(t[6])},m(r,i){ke(r,e,i),Le(e,n)},p(r,i){i&64&&Hn(n,r[6])},d(r){r&&Me(e)}}}function oz(t){let e,n,r=t[17].time1+"",i,a,c=t[17].time2+"",u,m,w=t[17].route+"",S,E,P=t[17].num_stops+"",D,k;return{c(){e=Ne("li"),n=Mt("["),i=Mt(r),a=Mt(" - "),u=Mt(c),m=Mt("] Take "),S=Mt(w),E=Mt(" for "),D=Mt(P),k=Mt(`
              stops
            `)},m(V,j){ke(V,e,j),Le(e,n),Le(e,i),Le(e,a),Le(e,u),Le(e,m),Le(e,S),Le(e,E),Le(e,D),Le(e,k)},p(V,j){j&32&&r!==(r=V[17].time1+"")&&Hn(i,r),j&32&&c!==(c=V[17].time2+"")&&Hn(u,c),j&32&&w!==(w=V[17].route+"")&&Hn(S,w),j&32&&P!==(P=V[17].num_stops+"")&&Hn(D,P)},d(V){V&&Me(e)}}}function sz(t){let e;function n(a,c){return a[17].time1?lz:az}let r=n(t),i=r(t);return{c(){i.c(),e=Yr()},m(a,c){i.m(a,c),ke(a,e,c)},p(a,c){r===(r=n(a))&&i?i.p(a,c):(i.d(1),i=r(a),i&&(i.c(),i.m(e.parentNode,e)))},d(a){a&&Me(e),i.d(a)}}}function az(t){let e;return{c(){e=Ne("li"),e.textContent="Walk / cycle / drive"},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function lz(t){let e,n,r=t[17].time1+"",i,a,c=t[17].time2+"",u,m;return{c(){e=Ne("li"),n=Mt("["),i=Mt(r),a=Mt(" - "),u=Mt(c),m=Mt("] Walk")},m(w,S){ke(w,e,S),Le(e,n),Le(e,i),Le(e,a),Le(e,u),Le(e,m)},p(w,S){S&32&&r!==(r=w[17].time1+"")&&Hn(i,r),S&32&&c!==(c=w[17].time2+"")&&Hn(u,c)},d(w){w&&Me(e)}}}function IS(t){let e;function n(a,c){return a[17].kind=="road"?sz:oz}let r=n(t),i=r(t);return{c(){i.c(),e=Yr()},m(a,c){i.m(a,c),ke(a,e,c)},p(a,c){r===(r=n(a))&&i?i.p(a,c):(i.d(1),i=r(a),i&&(i.c(),i.m(e.parentNode,e)))},d(a){a&&Me(e),i.d(a)}}}function uz(t){let e,n,r,i,a,c,u,m,w,S,E,P,D,k,V,j,te,U,W,Y,oe;function _e(Z){t[11](Z)}let se={};t[4]!==void 0&&(se.travelMode=t[4]),i=new y1({props:se}),Zn.push(()=>ao(i,"travelMode",_e));function ce(Z,fe){if(Z[6])return iz;if(Z[5])return rz}let me=ce(t),Ce=me&&me(t);return{c(){e=Ne("div"),n=Ne("h2"),n.textContent="Route mode",r=at(),lt(i.$$.fragment),c=at(),u=Ne("label"),m=Ne("input"),S=Mt(`
      Use heuristic (PT only)`),E=at(),P=Ne("label"),D=Mt(`Start time (PT only)
      `),k=Ne("input"),j=at(),te=Ne("p"),te.innerHTML=`Move the <b>A</b> and <b>B</b> pins to find a route. (Hint: right-click to
      set the first pin somewhere.)`,U=at(),Ce&&Ce.c(),Ve(m,"type","checkbox"),m.disabled=w=t[4]!="transit",Ve(k,"type","time"),k.disabled=V=t[4]!="transit",Ve(e,"slot","sidebar")},m(Z,fe){ke(Z,e,fe),Le(e,n),Le(e,r),it(i,e,null),Le(e,c),Le(e,u),Le(u,m),m.checked=t[3],Le(u,S),Le(e,E),Le(e,P),Le(P,D),Le(P,k),Go(k,t[2]),Le(e,j),Le(e,te),Le(e,U),Ce&&Ce.m(e,null),W=!0,Y||(oe=[Wt(m,"change",t[12]),Wt(k,"input",t[13])],Y=!0)},p(Z,fe){const Ke={};!a&&fe&16&&(a=!0,Ke.travelMode=Z[4],so(()=>a=!1)),i.$set(Ke),(!W||fe&16&&w!==(w=Z[4]!="transit"))&&(m.disabled=w),fe&8&&(m.checked=Z[3]),(!W||fe&16&&V!==(V=Z[4]!="transit"))&&(k.disabled=V),fe&4&&Go(k,Z[2]),me===(me=ce(Z))&&Ce?Ce.p(Z,fe):(Ce&&Ce.d(1),Ce=me&&me(Z),Ce&&(Ce.c(),Ce.m(e,null)))},i(Z){W||(be(i.$$.fragment,Z),W=!0)},o(Z){Te(i.$$.fragment,Z),W=!1},d(Z){Z&&Me(e),ot(i),Ce&&Ce.d(),Y=!1,Ni(oe)}}}function cz(t){let e;return{c(){e=Ne("span"),e.textContent="A",Ve(e,"class","dot svelte-1ej0v4r")},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function hz(t){let e;return{c(){e=Ne("span"),e.textContent="B",Ve(e,"class","dot svelte-1ej0v4r")},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function CS(t){let e,n;return e=new ru({props:{data:t[5],generateId:!0,$$slots:{default:[dz]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&32&&(a.data=r[5]),i&2097152&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function fz(t){let e,n;return e=new wv({props:{properties:t[17]}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&131072&&(a.properties=r[17]),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function pz(t){let e,n;return e=new Zf({props:{openOn:"hover",$$slots:{default:[fz,({props:r})=>({17:r}),({props:r})=>r?131072:0]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&2228224&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function dz(t){let e,n;return e=new Kc({props:{id:"route",paint:{"line-width":20,"line-color":p1(["get","kind"],{road:"cyan",transit:"purple"},"red"),"line-opacity":Fy(.5,1)},manageHoverState:!0,$$slots:{default:[pz]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&2097152&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function mz(t){let e,n,r,i,a,c,u,m,w,S;n=new FO({}),n.$on("contextmenu",t[7]);function E(j){t[9](j)}let P={draggable:!0,$$slots:{default:[cz]},$$scope:{ctx:t}};t[1]!==void 0&&(P.lngLat=t[1]),i=new Fd({props:P}),Zn.push(()=>ao(i,"lngLat",E));function D(j){t[10](j)}let k={draggable:!0,$$slots:{default:[hz]},$$scope:{ctx:t}};t[0]!==void 0&&(k.lngLat=t[0]),u=new Fd({props:k}),Zn.push(()=>ao(u,"lngLat",D));let V=t[5]&&CS(t);return{c(){e=Ne("div"),lt(n.$$.fragment),r=at(),lt(i.$$.fragment),c=at(),lt(u.$$.fragment),w=at(),V&&V.c(),Ve(e,"slot","map")},m(j,te){ke(j,e,te),it(n,e,null),Le(e,r),it(i,e,null),Le(e,c),it(u,e,null),Le(e,w),V&&V.m(e,null),S=!0},p(j,te){const U={};te&2097152&&(U.$$scope={dirty:te,ctx:j}),!a&&te&2&&(a=!0,U.lngLat=j[1],so(()=>a=!1)),i.$set(U);const W={};te&2097152&&(W.$$scope={dirty:te,ctx:j}),!m&&te&1&&(m=!0,W.lngLat=j[0],so(()=>m=!1)),u.$set(W),j[5]?V?(V.p(j,te),te&32&&be(V,1)):(V=CS(j),V.c(),be(V,1),V.m(e,null)):V&&(On(),Te(V,1,1,()=>{V=null}),zn())},i(j){S||(be(n.$$.fragment,j),be(i.$$.fragment,j),be(u.$$.fragment,j),be(V),S=!0)},o(j){Te(n.$$.fragment,j),Te(i.$$.fragment,j),Te(u.$$.fragment,j),Te(V),S=!1},d(j){j&&Me(e),ot(n),ot(i),ot(u),V&&V.d()}}}function gz(t){let e,n;return e=new Yf({props:{$$slots:{map:[mz],sidebar:[uz],top:[nz]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,[i]){const a={};i&2097279&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function yz(t,e,n){let r,i,a,c,u,m,w;Lt(t,ff,Y=>n(0,r=Y)),Lt(t,Ic,Y=>n(1,i=Y)),Lt(t,Ys,Y=>n(14,a=Y)),Lt(t,Bg,Y=>n(2,c=Y)),Lt(t,fx,Y=>n(3,u=Y)),Lt(t,hf,Y=>n(4,m=Y)),Lt(t,Zl,Y=>n(15,w=Y));let S=null,E="";async function P(Y,oe,_e,se,ce){try{n(5,S=await w.route({start:Y,end:[oe.lng,oe.lat],mode:_e,debugSearch:!1,useHeuristic:u,startTime:c})),n(6,E="")}catch(me){n(5,S=null),n(6,E=me.toString())}}function D(Y){Wn(Ic,i=Y.detail.lngLat,i)}async function k(){try{let Y=await w.route({start:i,end:[r.lng,r.lat],mode:m,debugSearch:!0,useHeuristic:u,startTime:c});Wn(Ys,a={kind:"debug-route",debugGj:Y,start:i,end:r,routeGj:S},a)}catch(Y){n(6,E=Y.toString())}}function V(Y){i=Y,Ic.set(i)}function j(Y){r=Y,ff.set(r)}function te(Y){m=Y,hf.set(m)}function U(){u=this.checked,fx.set(u)}function W(){c=this.value,Bg.set(c)}return t.$$.update=()=>{t.$$.dirty&31&&P(i,r,m)},[r,i,c,u,m,S,E,D,k,V,j,te,U,W]}class _z extends Qt{constructor(e){super(),Jt(this,e,yz,gz,Gt,{})}}function vz(t){let e,n,r,i;return{c(){e=Ne("div"),n=Ne("button"),n.textContent="Back",Ve(e,"slot","top")},m(a,c){ke(a,e,c),Le(e,n),r||(i=Wt(n,"click",t[10]),r=!0)},p:gt,d(a){a&&Me(e),r=!1,i()}}}function bz(t){let e,n,r,i,a,c,u,m,w,S=ul(t[4].features[t[4].features.length-1].properties).time+"",E,P,D;return{c(){e=Ne("div"),n=Ne("h2"),n.textContent="Debugging a route",r=at(),i=Ne("p"),i.textContent=`${t[6]} total nodes searched`,a=at(),c=Ne("input"),u=at(),m=Ne("p"),w=Mt("Search is currently at "),E=Mt(S),Ve(c,"type","range"),Ve(c,"min","1"),Ve(c,"max",t[6]),Ve(e,"slot","sidebar")},m(k,V){ke(k,e,V),Le(e,n),Le(e,r),Le(e,i),Le(e,a),Le(e,c),Go(c,t[3]),Le(e,u),Le(e,m),Le(m,w),Le(m,E),P||(D=[Wt(c,"change",t[9]),Wt(c,"input",t[9])],P=!0)},p(k,V){V&8&&Go(c,k[3]),V&16&&S!==(S=ul(k[4].features[k[4].features.length-1].properties).time+"")&&Hn(E,S)},d(k){k&&Me(e),P=!1,Ni(D)}}}function xz(t){let e;return{c(){e=Ne("span"),e.textContent="A",Ve(e,"class","dot svelte-1ej0v4r")},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function wz(t){let e;return{c(){e=Ne("span"),e.textContent="B",Ve(e,"class","dot svelte-1ej0v4r")},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function Sz(t){let e,n;return e=new Kc({props:{paint:{"line-width":20,"line-color":p1(["get","kind"],{road:"cyan",transit:"purple"},"red"),"line-opacity":.5}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function Ez(t){let e,n,r,i;return e=new By({props:{paint:{"circle-radius":5,"circle-color":"black"}}}),r=new Kc({props:{paint:{"line-width":5,"line-color":p1(["get","kind"],{road:"black",transit:"orange"},"red")}}}),{c(){lt(e.$$.fragment),n=at(),lt(r.$$.fragment)},m(a,c){it(e,a,c),ke(a,n,c),it(r,a,c),i=!0},p:gt,i(a){i||(be(e.$$.fragment,a),be(r.$$.fragment,a),i=!0)},o(a){Te(e.$$.fragment,a),Te(r.$$.fragment,a),i=!1},d(a){a&&Me(n),ot(e,a),ot(r,a)}}}function Iz(t){let e,n,r,i,a,c,u,m,w;return n=new Fd({props:{lngLat:t[0],$$slots:{default:[xz]},$$scope:{ctx:t}}}),i=new Fd({props:{lngLat:t[1],$$slots:{default:[wz]},$$scope:{ctx:t}}}),c=new ru({props:{data:t[2],$$slots:{default:[Sz]},$$scope:{ctx:t}}}),m=new ru({props:{data:t[4],generateId:!0,$$slots:{default:[Ez]},$$scope:{ctx:t}}}),{c(){e=Ne("div"),lt(n.$$.fragment),r=at(),lt(i.$$.fragment),a=at(),lt(c.$$.fragment),u=at(),lt(m.$$.fragment),Ve(e,"slot","map")},m(S,E){ke(S,e,E),it(n,e,null),Le(e,r),it(i,e,null),Le(e,a),it(c,e,null),Le(e,u),it(m,e,null),w=!0},p(S,E){const P={};E&1&&(P.lngLat=S[0]),E&4096&&(P.$$scope={dirty:E,ctx:S}),n.$set(P);const D={};E&2&&(D.lngLat=S[1]),E&4096&&(D.$$scope={dirty:E,ctx:S}),i.$set(D);const k={};E&4&&(k.data=S[2]),E&4096&&(k.$$scope={dirty:E,ctx:S}),c.$set(k);const V={};E&16&&(V.data=S[4]),E&4096&&(V.$$scope={dirty:E,ctx:S}),m.$set(V)},i(S){w||(be(n.$$.fragment,S),be(i.$$.fragment,S),be(c.$$.fragment,S),be(m.$$.fragment,S),w=!0)},o(S){Te(n.$$.fragment,S),Te(i.$$.fragment,S),Te(c.$$.fragment,S),Te(m.$$.fragment,S),w=!1},d(S){S&&Me(e),ot(n),ot(i),ot(c),ot(m)}}}function Cz(t){let e,n,r,i;return e=new Yf({props:{$$slots:{map:[Iz],sidebar:[bz],top:[vz]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(a,c){it(e,a,c),n=!0,r||(i=Wt(window,"keydown",t[7]),r=!0)},p(a,[c]){const u={};c&4159&&(u.$$scope={dirty:c,ctx:a}),e.$set(u)},i(a){n||(be(e.$$.fragment,a),n=!0)},o(a){Te(e.$$.fragment,a),n=!1},d(a){ot(e,a),r=!1,i()}}}function Tz(t,e,n){let r,i,a;Lt(t,yy,V=>n(11,i=V)),Lt(t,Ys,V=>n(5,a=V));let{debugGj:c}=e,{start:u}=e,{end:m}=e,{routeGj:w}=e,S=c.features.length/2,E=1;function P(V){V.key=="ArrowLeft"&&E>1&&(V.stopPropagation(),n(3,E--,E)),V.key=="ArrowRight"&&E<S&&(V.stopPropagation(),n(3,E++,E))}qu(()=>{i==null||i.keyboard.disable()}),as(()=>{i==null||i.keyboard.enable()});function D(){E=HL(this.value),n(3,E)}const k=()=>Wn(Ys,a={kind:"route"},a);return t.$$set=V=>{"debugGj"in V&&n(8,c=V.debugGj),"start"in V&&n(0,u=V.start),"end"in V&&n(1,m=V.end),"routeGj"in V&&n(2,w=V.routeGj)},t.$$.update=()=>{t.$$.dirty&264&&n(4,r={type:"FeatureCollection",features:c.features.slice(0,2*E)})},[u,m,w,E,r,a,S,P,c,D,k]}class Lz extends Qt{constructor(e){super(),Jt(this,e,Tz,Cz,Gt,{debugGj:8,start:0,end:1,routeGj:2})}}function TS(t){let e,n;return e=new AC({props:{loading:t[2]}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&4&&(a.loading=r[2]),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function Pz(t){let e,n,r;return n=new Vy({}),{c(){e=Ne("div"),lt(n.$$.fragment),Ve(e,"slot","top")},m(i,a){ke(i,e,a),it(n,e,null),r=!0},p:gt,i(i){r||(be(n.$$.fragment,i),r=!0)},o(i){Te(n.$$.fragment,i),r=!1},d(i){i&&Me(e),ot(n)}}}function Mz(t){let e,n,r,i,a,c,u,m,w,S;function E(D){t[7](D)}let P={};return t[0]!==void 0&&(P.enabled=t[0]),i=new T5({props:P}),Zn.push(()=>ao(i,"enabled",E)),u=new nE({props:{colorScale:Bd,limits:t[5]}}),{c(){e=Ne("div"),n=Ne("h2"),n.textContent="Score mode",r=at(),lt(i.$$.fragment),c=at(),lt(u.$$.fragment),m=at(),w=Ne("p"),w.textContent=`This is an early experiment of a mode to show an "access score". Right
      now, it's starting from every POI based on the types chosen below and
      walking up to 10 minutes to the nearest bicycle parking. This is a simple
      way of showing POIs without any nearby parking. Note the granularity of
      results is poor; the search begins and ends at the nearest intersection,
      and the time to walk doesn't take into account the side of the road or
      walking partly down some road.`,Ve(e,"slot","sidebar")},m(D,k){ke(D,e,k),Le(e,n),Le(e,r),it(i,e,null),Le(e,c),it(u,e,null),Le(e,m),Le(e,w),S=!0},p(D,k){const V={};!a&&k&1&&(a=!0,V.enabled=D[0],so(()=>a=!1)),i.$set(V)},i(D){S||(be(i.$$.fragment,D),be(u.$$.fragment,D),S=!0)},o(D){Te(i.$$.fragment,D),Te(u.$$.fragment,D),S=!1},d(D){D&&Me(e),ot(i),ot(u)}}}function LS(t){let e,n;return e=new ru({props:{data:t[3],$$slots:{default:[Dz]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&8&&(a.data=r[3]),i&8194&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function Az(t){let e,n=t[12].poi+"",r,i,a=t[12].cost+"",c,u;return{c(){e=Mt("From "),r=Mt(n),i=Mt(", it's "),c=Mt(a),u=Mt(" seconds to the nearest parking")},m(m,w){ke(m,e,w),ke(m,r,w),ke(m,i,w),ke(m,c,w),ke(m,u,w)},p(m,w){w&4096&&n!==(n=m[12].poi+"")&&Hn(r,n),w&4096&&a!==(a=m[12].cost+"")&&Hn(c,a)},d(m){m&&(Me(e),Me(r),Me(i),Me(c),Me(u))}}}function kz(t){let e,n;return e=new Zf({props:{openOn:"hover",$$slots:{default:[Az,({props:r})=>({12:r}),({props:r})=>r?4096:0]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&12288&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function Dz(t){let e,n,r;function i(c){t[6](c)}let a={paint:{"circle-radius":15,"circle-color":pv(["get","cost"],t[5],Bd)},manageHoverState:!0,eventsIfTopMost:!0,$$slots:{default:[kz]},$$scope:{ctx:t}};return t[1]!==void 0&&(a.hovered=t[1]),e=new By({props:a}),Zn.push(()=>ao(e,"hovered",i)),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,u){const m={};u&8192&&(m.$$scope={dirty:u,ctx:c}),!n&&u&2&&(n=!0,m.hovered=c[1],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function PS(t){let e,n;return e=new ru({props:{data:t[4],$$slots:{default:[Rz]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&16&&(a.data=r[4]),i&8192&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function Rz(t){let e,n;return e=new Kc({props:{id:"route",paint:{"line-width":10,"line-color":"red"}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function Nz(t){let e,n,r,i=t[3]&&LS(t),a=t[4]&&PS(t);return{c(){e=Ne("div"),i&&i.c(),n=at(),a&&a.c(),Ve(e,"slot","map")},m(c,u){ke(c,e,u),i&&i.m(e,null),Le(e,n),a&&a.m(e,null),r=!0},p(c,u){c[3]?i?(i.p(c,u),u&8&&be(i,1)):(i=LS(c),i.c(),be(i,1),i.m(e,n)):i&&(On(),Te(i,1,1,()=>{i=null}),zn()),c[4]?a?(a.p(c,u),u&16&&be(a,1)):(a=PS(c),a.c(),be(a,1),a.m(e,null)):a&&(On(),Te(a,1,1,()=>{a=null}),zn())},i(c){r||(be(i),be(a),r=!0)},o(c){Te(i),Te(a),r=!1},d(c){c&&Me(e),i&&i.d(),a&&a.d()}}}function Oz(t){let e,n,r,i=t[3]==null&&TS(t);return n=new Yf({props:{$$slots:{map:[Nz],sidebar:[Mz],top:[Pz]},$$scope:{ctx:t}}}),{c(){i&&i.c(),e=at(),lt(n.$$.fragment)},m(a,c){i&&i.m(a,c),ke(a,e,c),it(n,a,c),r=!0},p(a,[c]){a[3]==null?i?(i.p(a,c),c&8&&be(i,1)):(i=TS(a),i.c(),be(i,1),i.m(e.parentNode,e)):i&&(On(),Te(i,1,1,()=>{i=null}),zn());const u={};c&8219&&(u.$$scope={dirty:c,ctx:a}),n.$set(u)},i(a){r||(be(i),be(n.$$.fragment,a),r=!0)},o(a){Te(i),Te(n.$$.fragment,a),r=!1},d(a){a&&Me(e),i&&i.d(a),ot(n,a)}}}function zz(t,e,n){let r;Lt(t,Zl,V=>n(8,r=V));let i=[],a=[],c=null;async function u(V){n(2,i=[...i,"Calculating scores"]),n(3,c=await r.score({poiKinds:a},Ev(m))),n(2,i=[])}function m(V){n(2,i=[...i,V])}let w=null,S=Array.from(Array(6).keys()).map(V=>60*10/(6-1)*V),E;async function P(V){if(E)try{n(4,w=await r.route({start:{lng:E.geometry.coordinates[0],lat:E.geometry.coordinates[1]},end:[E.properties.closest_lon,E.properties.closest_lat],mode:"foot",debugSearch:!1,useHeuristic:!1,startTime:"07:00"}))}catch(j){console.log(`No route: ${j}`),n(4,w=null)}else n(4,w=null)}function D(V){E=V,n(1,E)}function k(V){a=V,n(0,a)}return t.$$.update=()=>{t.$$.dirty&1&&u(),t.$$.dirty&2&&P()},[a,E,i,c,w,S,D,k]}class Fz extends Qt{constructor(e){super(),Jt(this,e,zz,Oz,Gt,{})}}var wo=63710088e-1,_1={centimeters:wo*100,centimetres:wo*100,degrees:wo/111325,feet:wo*3.28084,inches:wo*39.37,kilometers:wo/1e3,kilometres:wo/1e3,meters:wo,metres:wo,miles:wo/1609.344,millimeters:wo*1e3,millimetres:wo*1e3,nauticalmiles:wo/1852,radians:1,yards:wo*1.0936},Bz={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/wo,yards:1.0936133},yv={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ha(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function Vz(t,e,n){switch(t){case"Point":return rs(e).geometry;case"LineString":return Js(e).geometry;case"Polygon":return v1(e).geometry;case"MultiPoint":return DC(e).geometry;case"MultiLineString":return kC(e).geometry;case"MultiPolygon":return RC(e).geometry;default:throw new Error(t+" is invalid")}}function rs(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!dy(t[0])||!dy(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return ha(r,e,n)}function Uz(t,e,n){return n===void 0&&(n={}),Gc(t.map(function(r){return rs(r,e)}),n)}function v1(t,e,n){n===void 0&&(n={});for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<a[a.length-1].length;c++)if(a[a.length-1][c]!==a[0][c])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:t};return ha(u,e,n)}function Gz(t,e,n){return n===void 0&&(n={}),Gc(t.map(function(r){return v1(r,e)}),n)}function Js(t,e,n){if(n===void 0&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return ha(r,e,n)}function qz(t,e,n){return n===void 0&&(n={}),Gc(t.map(function(r){return Js(r,e)}),n)}function Gc(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function kC(t,e,n){n===void 0&&(n={});var r={type:"MultiLineString",coordinates:t};return ha(r,e,n)}function DC(t,e,n){n===void 0&&(n={});var r={type:"MultiPoint",coordinates:t};return ha(r,e,n)}function RC(t,e,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:t};return ha(r,e,n)}function jz(t,e,n){n===void 0&&(n={});var r={type:"GeometryCollection",geometries:t};return ha(r,e,n)}function Wz(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function b1(t,e){e===void 0&&(e="kilometers");var n=_1[e];if(!n)throw new Error(e+" units is invalid");return t*n}function Uy(t,e){e===void 0&&(e="kilometers");var n=_1[e];if(!n)throw new Error(e+" units is invalid");return t/n}function Hz(t,e){return Vd(Uy(t,e))}function Zz(t){var e=t%360;return e<0&&(e+=360),e}function Vd(t){var e=t%(2*Math.PI);return e*180/Math.PI}function Qs(t){var e=t%360;return e*Math.PI/180}function Xz(t,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return b1(Uy(t,e),n)}function Yz(t,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var r=yv[e];if(!r)throw new Error("invalid original units");var i=yv[n];if(!i)throw new Error("invalid final units");return t/r*i}function dy(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function x1(t){return!!t&&t.constructor===Object}function Kz(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!dy(e))throw new Error("bbox must only contain numbers")})}function Jz(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const Qz=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:yv,bearingToAzimuth:Zz,convertArea:Yz,convertLength:Xz,degreesToRadians:Qs,earthRadius:wo,factors:_1,feature:ha,featureCollection:Gc,geometry:Vz,geometryCollection:jz,isNumber:dy,isObject:x1,lengthToDegrees:Hz,lengthToRadians:Uy,lineString:Js,lineStrings:qz,multiLineString:kC,multiPoint:DC,multiPolygon:RC,point:rs,points:Uz,polygon:v1,polygons:Gz,radiansToDegrees:Vd,radiansToLength:b1,round:Wz,unitsFactors:Bz,validateBBox:Kz,validateId:Jz},Symbol.toStringTag,{value:"Module"}));function Ud(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function zf(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function NC(t,e,n){if(n===void 0&&(n={}),n.final===!0)return $z(t,e);var r=Ud(t),i=Ud(e),a=Qs(r[0]),c=Qs(i[0]),u=Qs(r[1]),m=Qs(i[1]),w=Math.sin(c-a)*Math.cos(m),S=Math.cos(u)*Math.sin(m)-Math.sin(u)*Math.cos(m)*Math.cos(c-a);return Vd(Math.atan2(w,S))}function $z(t,e){var n=NC(e,t);return n=(n+180)%360,n}function rd(t,e,n){n===void 0&&(n={});var r=Ud(t),i=Ud(e),a=Qs(i[1]-r[1]),c=Qs(i[0]-r[0]),u=Qs(r[1]),m=Qs(i[1]),w=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(u)*Math.cos(m);return b1(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)),n.units)}function MS(t,e,n,r){r===void 0&&(r={});var i=Ud(t),a=Qs(i[0]),c=Qs(i[1]),u=Qs(n),m=Uy(e,r.units),w=Math.asin(Math.sin(c)*Math.cos(m)+Math.cos(c)*Math.sin(m)*Math.cos(u)),S=a+Math.atan2(Math.sin(u)*Math.sin(m)*Math.cos(c),Math.cos(m)-Math.sin(c)*Math.sin(w)),E=Vd(S),P=Vd(w);return rs([E,P],r.properties)}function $d(t,e,n){if(t!==null)for(var r,i,a,c,u,m,w,S=0,E=0,P,D=t.type,k=D==="FeatureCollection",V=D==="Feature",j=k?t.features.length:1,te=0;te<j;te++){w=k?t.features[te].geometry:V?t.geometry:t,P=w?w.type==="GeometryCollection":!1,u=P?w.geometries.length:1;for(var U=0;U<u;U++){var W=0,Y=0;if(c=P?w.geometries[U]:w,c!==null){m=c.coordinates;var oe=c.type;switch(S=n&&(oe==="Polygon"||oe==="MultiPolygon")?1:0,oe){case null:break;case"Point":if(e(m,E,te,W,Y)===!1)return!1;E++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<m.length;r++){if(e(m[r],E,te,W,Y)===!1)return!1;E++,oe==="MultiPoint"&&W++}oe==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<m.length;r++){for(i=0;i<m[r].length-S;i++){if(e(m[r][i],E,te,W,Y)===!1)return!1;E++}oe==="MultiLineString"&&W++,oe==="Polygon"&&Y++}oe==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<m.length;r++){for(Y=0,i=0;i<m[r].length;i++){for(a=0;a<m[r][i].length-S;a++){if(e(m[r][i][a],E,te,W,Y)===!1)return!1;E++}Y++}W++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if($d(c.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function eF(t,e,n,r){var i=n;return $d(t,function(a,c,u,m,w){c===0&&n===void 0?i=a:i=e(i,a,c,u,m,w)},r),i}function OC(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}function tF(t,e,n){var r=n;return OC(t,function(i,a){a===0&&n===void 0?r=i:r=e(r,i,a)}),r}function my(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function nF(t,e,n){var r=n;return my(t,function(i,a){a===0&&n===void 0?r=i:r=e(r,i,a)}),r}function rF(t){var e=[];return $d(t,function(n){e.push(n)}),e}function w1(t,e){var n,r,i,a,c,u,m,w,S,E,P=0,D=t.type==="FeatureCollection",k=t.type==="Feature",V=D?t.features.length:1;for(n=0;n<V;n++){for(u=D?t.features[n].geometry:k?t.geometry:t,w=D?t.features[n].properties:k?t.properties:{},S=D?t.features[n].bbox:k?t.bbox:void 0,E=D?t.features[n].id:k?t.id:void 0,m=u?u.type==="GeometryCollection":!1,c=m?u.geometries.length:1,i=0;i<c;i++){if(a=m?u.geometries[i]:u,a===null){if(e(null,P,w,S,E)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,P,w,S,E)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(e(a.geometries[r],P,w,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}function iF(t,e,n){var r=n;return w1(t,function(i,a,c,u,m){a===0&&n===void 0?r=i:r=e(r,i,a,c,u,m)}),r}function Kf(t,e){w1(t,function(n,r,i,a,c){var u=n===null?null:n.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return e(ha(n,i,{bbox:a,id:c}),r,0)===!1?!1:void 0}var m;switch(u){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var w=0;w<n.coordinates.length;w++){var S=n.coordinates[w],E={type:m,coordinates:S};if(e(ha(E,i),r,w)===!1)return!1}})}function oF(t,e,n){var r=n;return Kf(t,function(i,a,c){a===0&&c===0&&n===void 0?r=i:r=e(r,i,a,c)}),r}function zC(t,e){Kf(t,function(n,r,i){var a=0;if(n.geometry){var c=n.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var u,m=0,w=0,S=0;if($d(n,function(E,P,D,k,V){if(u===void 0||r>m||k>w||V>S){u=E,m=r,w=k,S=V,a=0;return}var j=Js([u,E],n.properties);if(e(j,r,i,V,a)===!1)return!1;a++,u=E})===!1)return!1}}})}function sF(t,e,n){var r=n,i=!1;return zC(t,function(a,c,u,m,w){i===!1&&n===void 0?r=a:r=e(r,a,c,u,m,w),i=!0}),r}function FC(t,e){if(!t)throw new Error("geojson is required");Kf(t,function(n,r,i){if(n.geometry!==null){var a=n.geometry.type,c=n.geometry.coordinates;switch(a){case"LineString":if(e(n,r,i,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<c.length;u++)if(e(Js(c[u],n.properties),r,i,u)===!1)return!1;break}}})}function aF(t,e,n){var r=n;return FC(t,function(i,a,c,u){a===0&&n===void 0?r=i:r=e(r,i,a,c,u)}),r}function lF(t,e){if(e=e||{},!x1(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,c=e.properties,u;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,u=t.features[n].geometry;break;case"Feature":c=c||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var m=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=m.length+a-1),Js([m[a],m[a+1]],c,e);case"Polygon":return i<0&&(i=m.length+i),a<0&&(a=m[i].length+a-1),Js([m[i][a],m[i][a+1]],c,e);case"MultiLineString":return r<0&&(r=m.length+r),a<0&&(a=m[r].length+a-1),Js([m[r][a],m[r][a+1]],c,e);case"MultiPolygon":return r<0&&(r=m.length+r),i<0&&(i=m[r].length+i),a<0&&(a=m[r][i].length-a-1),Js([m[r][i][a],m[r][i][a+1]],c,e)}throw new Error("geojson is invalid")}function uF(t,e){if(e=e||{},!x1(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,c=e.properties,u;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,u=t.features[n].geometry;break;case"Feature":c=c||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var m=u.coordinates;switch(u.type){case"Point":return rs(m,c,e);case"MultiPoint":return r<0&&(r=m.length+r),rs(m[r],c,e);case"LineString":return a<0&&(a=m.length+a),rs(m[a],c,e);case"Polygon":return i<0&&(i=m.length+i),a<0&&(a=m[i].length+a),rs(m[i][a],c,e);case"MultiLineString":return r<0&&(r=m.length+r),a<0&&(a=m[r].length+a),rs(m[r][a],c,e);case"MultiPolygon":return r<0&&(r=m.length+r),i<0&&(i=m[r].length+i),a<0&&(a=m[r][i].length-a),rs(m[r][i][a],c,e)}throw new Error("geojson is invalid")}const cF=Object.freeze(Object.defineProperty({__proto__:null,coordAll:rF,coordEach:$d,coordReduce:eF,featureEach:my,featureReduce:nF,findPoint:uF,findSegment:lF,flattenEach:Kf,flattenReduce:oF,geomEach:w1,geomReduce:iF,lineEach:FC,lineReduce:aF,propEach:OC,propReduce:tF,segmentEach:zC,segmentReduce:sF},Symbol.toStringTag,{value:"Module"}));function AS(t){if(!t)throw new Error("geojson is required");var e=[];return Kf(t,function(n){hF(n,e)}),Gc(e)}function hF(t,e){var n=[],r=t.geometry;if(r!==null){switch(r.type){case"Polygon":n=zf(r);break;case"LineString":n=[zf(r)]}n.forEach(function(i){var a=fF(i,t.properties);a.forEach(function(c){c.id=e.length,e.push(c)})})}}function fF(t,e){var n=[];return t.reduce(function(r,i){var a=Js([r,i],e);return a.bbox=pF(r,i),n.push(a),i}),n}function pF(t,e){var n=t[0],r=t[1],i=e[0],a=e[1],c=n<i?n:i,u=r<a?r:a,m=n>i?n:i,w=r>a?r:a;return[c,u,m,w]}var S1={exports:{}},BC={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Gd,function(){function n(U,W,Y,oe,_e){(function se(ce,me,Ce,Z,fe){for(;Z>Ce;){if(Z-Ce>600){var Ke=Z-Ce+1,Se=me-Ce+1,Ze=Math.log(Ke),tt=.5*Math.exp(2*Ze/3),qe=.5*Math.sqrt(Ze*tt*(Ke-tt)/Ke)*(Se-Ke/2<0?-1:1),Ot=Math.max(Ce,Math.floor(me-Se*tt/Ke+qe)),wt=Math.min(Z,Math.floor(me+(Ke-Se)*tt/Ke+qe));se(ce,me,Ot,wt,fe)}var un=ce[me],qt=Ce,At=Z;for(r(ce,Ce,me),fe(ce[Z],un)>0&&r(ce,Ce,Z);qt<At;){for(r(ce,qt,At),qt++,At--;fe(ce[qt],un)<0;)qt++;for(;fe(ce[At],un)>0;)At--}fe(ce[Ce],un)===0?r(ce,Ce,At):r(ce,++At,Z),At<=me&&(Ce=At+1),me<=At&&(Z=At-1)}})(U,W,Y||0,oe||U.length-1,_e||i)}function r(U,W,Y){var oe=U[W];U[W]=U[Y],U[Y]=oe}function i(U,W){return U<W?-1:U>W?1:0}var a=function(U){U===void 0&&(U=9),this._maxEntries=Math.max(4,U),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function c(U,W,Y){if(!Y)return W.indexOf(U);for(var oe=0;oe<W.length;oe++)if(Y(U,W[oe]))return oe;return-1}function u(U,W){m(U,0,U.children.length,W,U)}function m(U,W,Y,oe,_e){_e||(_e=j(null)),_e.minX=1/0,_e.minY=1/0,_e.maxX=-1/0,_e.maxY=-1/0;for(var se=W;se<Y;se++){var ce=U.children[se];w(_e,U.leaf?oe(ce):ce)}return _e}function w(U,W){return U.minX=Math.min(U.minX,W.minX),U.minY=Math.min(U.minY,W.minY),U.maxX=Math.max(U.maxX,W.maxX),U.maxY=Math.max(U.maxY,W.maxY),U}function S(U,W){return U.minX-W.minX}function E(U,W){return U.minY-W.minY}function P(U){return(U.maxX-U.minX)*(U.maxY-U.minY)}function D(U){return U.maxX-U.minX+(U.maxY-U.minY)}function k(U,W){return U.minX<=W.minX&&U.minY<=W.minY&&W.maxX<=U.maxX&&W.maxY<=U.maxY}function V(U,W){return W.minX<=U.maxX&&W.minY<=U.maxY&&W.maxX>=U.minX&&W.maxY>=U.minY}function j(U){return{children:U,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function te(U,W,Y,oe,_e){for(var se=[W,Y];se.length;)if(!((Y=se.pop())-(W=se.pop())<=oe)){var ce=W+Math.ceil((Y-W)/oe/2)*oe;n(U,ce,W,Y,_e),se.push(W,ce,ce,Y)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(U){var W=this.data,Y=[];if(!V(U,W))return Y;for(var oe=this.toBBox,_e=[];W;){for(var se=0;se<W.children.length;se++){var ce=W.children[se],me=W.leaf?oe(ce):ce;V(U,me)&&(W.leaf?Y.push(ce):k(U,me)?this._all(ce,Y):_e.push(ce))}W=_e.pop()}return Y},a.prototype.collides=function(U){var W=this.data;if(!V(U,W))return!1;for(var Y=[];W;){for(var oe=0;oe<W.children.length;oe++){var _e=W.children[oe],se=W.leaf?this.toBBox(_e):_e;if(V(U,se)){if(W.leaf||k(U,se))return!0;Y.push(_e)}}W=Y.pop()}return!1},a.prototype.load=function(U){if(!U||!U.length)return this;if(U.length<this._minEntries){for(var W=0;W<U.length;W++)this.insert(U[W]);return this}var Y=this._build(U.slice(),0,U.length-1,0);if(this.data.children.length)if(this.data.height===Y.height)this._splitRoot(this.data,Y);else{if(this.data.height<Y.height){var oe=this.data;this.data=Y,Y=oe}this._insert(Y,this.data.height-Y.height-1,!0)}else this.data=Y;return this},a.prototype.insert=function(U){return U&&this._insert(U,this.data.height-1),this},a.prototype.clear=function(){return this.data=j([]),this},a.prototype.remove=function(U,W){if(!U)return this;for(var Y,oe,_e,se=this.data,ce=this.toBBox(U),me=[],Ce=[];se||me.length;){if(se||(se=me.pop(),oe=me[me.length-1],Y=Ce.pop(),_e=!0),se.leaf){var Z=c(U,se.children,W);if(Z!==-1)return se.children.splice(Z,1),me.push(se),this._condense(me),this}_e||se.leaf||!k(se,ce)?oe?(Y++,se=oe.children[Y],_e=!1):se=null:(me.push(se),Ce.push(Y),Y=0,oe=se,se=se.children[0])}return this},a.prototype.toBBox=function(U){return U},a.prototype.compareMinX=function(U,W){return U.minX-W.minX},a.prototype.compareMinY=function(U,W){return U.minY-W.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(U){return this.data=U,this},a.prototype._all=function(U,W){for(var Y=[];U;)U.leaf?W.push.apply(W,U.children):Y.push.apply(Y,U.children),U=Y.pop();return W},a.prototype._build=function(U,W,Y,oe){var _e,se=Y-W+1,ce=this._maxEntries;if(se<=ce)return u(_e=j(U.slice(W,Y+1)),this.toBBox),_e;oe||(oe=Math.ceil(Math.log(se)/Math.log(ce)),ce=Math.ceil(se/Math.pow(ce,oe-1))),(_e=j([])).leaf=!1,_e.height=oe;var me=Math.ceil(se/ce),Ce=me*Math.ceil(Math.sqrt(ce));te(U,W,Y,Ce,this.compareMinX);for(var Z=W;Z<=Y;Z+=Ce){var fe=Math.min(Z+Ce-1,Y);te(U,Z,fe,me,this.compareMinY);for(var Ke=Z;Ke<=fe;Ke+=me){var Se=Math.min(Ke+me-1,fe);_e.children.push(this._build(U,Ke,Se,oe-1))}}return u(_e,this.toBBox),_e},a.prototype._chooseSubtree=function(U,W,Y,oe){for(;oe.push(W),!W.leaf&&oe.length-1!==Y;){for(var _e=1/0,se=1/0,ce=void 0,me=0;me<W.children.length;me++){var Ce=W.children[me],Z=P(Ce),fe=(Ke=U,Se=Ce,(Math.max(Se.maxX,Ke.maxX)-Math.min(Se.minX,Ke.minX))*(Math.max(Se.maxY,Ke.maxY)-Math.min(Se.minY,Ke.minY))-Z);fe<se?(se=fe,_e=Z<_e?Z:_e,ce=Ce):fe===se&&Z<_e&&(_e=Z,ce=Ce)}W=ce||W.children[0]}var Ke,Se;return W},a.prototype._insert=function(U,W,Y){var oe=Y?U:this.toBBox(U),_e=[],se=this._chooseSubtree(oe,this.data,W,_e);for(se.children.push(U),w(se,oe);W>=0&&_e[W].children.length>this._maxEntries;)this._split(_e,W),W--;this._adjustParentBBoxes(oe,_e,W)},a.prototype._split=function(U,W){var Y=U[W],oe=Y.children.length,_e=this._minEntries;this._chooseSplitAxis(Y,_e,oe);var se=this._chooseSplitIndex(Y,_e,oe),ce=j(Y.children.splice(se,Y.children.length-se));ce.height=Y.height,ce.leaf=Y.leaf,u(Y,this.toBBox),u(ce,this.toBBox),W?U[W-1].children.push(ce):this._splitRoot(Y,ce)},a.prototype._splitRoot=function(U,W){this.data=j([U,W]),this.data.height=U.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(U,W,Y){for(var oe,_e,se,ce,me,Ce,Z,fe=1/0,Ke=1/0,Se=W;Se<=Y-W;Se++){var Ze=m(U,0,Se,this.toBBox),tt=m(U,Se,Y,this.toBBox),qe=(_e=Ze,se=tt,ce=void 0,me=void 0,Ce=void 0,Z=void 0,ce=Math.max(_e.minX,se.minX),me=Math.max(_e.minY,se.minY),Ce=Math.min(_e.maxX,se.maxX),Z=Math.min(_e.maxY,se.maxY),Math.max(0,Ce-ce)*Math.max(0,Z-me)),Ot=P(Ze)+P(tt);qe<fe?(fe=qe,oe=Se,Ke=Ot<Ke?Ot:Ke):qe===fe&&Ot<Ke&&(Ke=Ot,oe=Se)}return oe||Y-W},a.prototype._chooseSplitAxis=function(U,W,Y){var oe=U.leaf?this.compareMinX:S,_e=U.leaf?this.compareMinY:E;this._allDistMargin(U,W,Y,oe)<this._allDistMargin(U,W,Y,_e)&&U.children.sort(oe)},a.prototype._allDistMargin=function(U,W,Y,oe){U.children.sort(oe);for(var _e=this.toBBox,se=m(U,0,W,_e),ce=m(U,Y-W,Y,_e),me=D(se)+D(ce),Ce=W;Ce<Y-W;Ce++){var Z=U.children[Ce];w(se,U.leaf?_e(Z):Z),me+=D(se)}for(var fe=Y-W-1;fe>=W;fe--){var Ke=U.children[fe];w(ce,U.leaf?_e(Ke):Ke),me+=D(ce)}return me},a.prototype._adjustParentBBoxes=function(U,W,Y){for(var oe=Y;oe>=0;oe--)w(W[oe],U)},a.prototype._condense=function(U){for(var W=U.length-1,Y=void 0;W>=0;W--)U[W].children.length===0?W>0?(Y=U[W-1].children).splice(Y.indexOf(U[W]),1):this.clear():u(U[W],this.toBBox)},a})})(BC);var dF=BC.exports;const mF=_y(Qz),gF=_y(cF),yF=_y(eD);var $a=dF,VC=mF,UC=gF,$h=yF.default,_F=UC.featureEach;UC.coordEach;VC.polygon;var kS=VC.featureCollection;function GC(t){var e=new $a(t);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:$h(n),$a.prototype.insert.call(this,n)},e.load=function(n){var r=[];return Array.isArray(n)?n.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:$h(i),r.push(i)}):_F(n,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:$h(i),r.push(i)}),$a.prototype.load.call(this,r)},e.remove=function(n,r){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:$h(n),$a.prototype.remove.call(this,n,r)},e.clear=function(){return $a.prototype.clear.call(this)},e.search=function(n){var r=$a.prototype.search.call(this,this.toBBox(n));return kS(r)},e.collides=function(n){return $a.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=$a.prototype.all.call(this);return kS(n)},e.toJSON=function(){return $a.prototype.toJSON.call(this)},e.fromJSON=function(n){return $a.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var r;if(n.bbox)r=n.bbox;else if(Array.isArray(n)&&n.length===4)r=n;else if(Array.isArray(n)&&n.length===6)r=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")r=$h(n);else if(n.type==="FeatureCollection")r=$h(n);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}S1.exports=GC;S1.exports.default=GC;var vF=S1.exports;const bF=Iv(vF);function xF(t,e){var n={},r=[];if(t.type==="LineString"&&(t=ha(t)),e.type==="LineString"&&(e=ha(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=DS(t,e);return i&&r.push(i),Gc(r)}var a=bF();return a.load(AS(e)),my(AS(t),function(c){my(a.search(c),function(u){var m=DS(c,u);if(m){var w=zf(m).join(",");n[w]||(n[w]=!0,r.push(m))}})}),Gc(r)}function DS(t,e){var n=zf(t),r=zf(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],a=n[0][1],c=n[1][0],u=n[1][1],m=r[0][0],w=r[0][1],S=r[1][0],E=r[1][1],P=(E-w)*(c-i)-(S-m)*(u-a),D=(S-m)*(a-w)-(E-w)*(i-m),k=(c-i)*(a-w)-(u-a)*(i-m);if(P===0)return null;var V=D/P,j=k/P;if(V>=0&&V<=1&&j>=0&&j<=1){var te=i+V*(c-i),U=a+V*(u-a);return rs([te,U])}return null}function wF(t,e,n){n===void 0&&(n={});var r=rs([1/0,1/0],{dist:1/0}),i=0;return Kf(t,function(a){for(var c=zf(a),u=0;u<c.length-1;u++){var m=rs(c[u]);m.properties.dist=rd(e,m,n);var w=rs(c[u+1]);w.properties.dist=rd(e,w,n);var S=rd(m,w,n),E=Math.max(m.properties.dist,w.properties.dist),P=NC(m,w),D=MS(e,E,P+90,n),k=MS(e,E,P-90,n),V=xF(Js([D.geometry.coordinates,k.geometry.coordinates]),Js([m.geometry.coordinates,w.geometry.coordinates])),j=null;V.features.length>0&&(j=V.features[0],j.properties.dist=rd(e,j,n),j.properties.location=i+rd(m,j,n)),m.properties.dist<r.properties.dist&&(r=m,r.properties.index=u,r.properties.location=i),w.properties.dist<r.properties.dist&&(r=w,r.properties.index=u+1,r.properties.location=i+S),j&&j.properties.dist<r.properties.dist&&(r=j,r.properties.index=u),i+=S}}),r}const SF=["==",["geometry-type"],"Polygon"],EF=["==",["geometry-type"],"LineString"],IF=["==",["geometry-type"],"Point"];function S0(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:qC(t)}}}function qC(t){return[Math.round(t[0]*1e7)/1e7,Math.round(t[1]*1e7)/1e7]}const jC=sr({type:"FeatureCollection",features:[]}),WC=sr(0),CF=100;class TF{constructor(e){gi(this,"map");gi(this,"active");gi(this,"eventListenersSuccess");gi(this,"eventListenersUpdated");gi(this,"eventListenersFailure");gi(this,"points");gi(this,"cursor");gi(this,"hover");gi(this,"dragFrom");gi(this,"previousStates");gi(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,r=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=n,i[1]-=r}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});gi(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(RS(this.points).forEach((r,i)=>{n.push([i+1,wF(r,this.cursor).properties.dist])}),n.sort((r,i)=>r[1]-i[1]),n.length>0){let r=n[0][0];this.points.splice(r,0,this.cursor.geometry.coordinates),this.hover=r}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});gi(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=S0(e.lngLat.toArray()),this.onClick(e),this.finish())});gi(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});gi(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});gi(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});gi(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e={type:"FeatureCollection",features:[]};this.points.forEach((i,a)=>{let c=S0(i);c.properties.hover=this.hover==a,c.properties.idx=a,e.features.push(c)}),e.features=e.features.concat(RS(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),jC.set(e);let r="crosshair";this.hover!=null&&(r=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=r,WC.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=S0(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(qC),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>CF&&this.previousStates.shift()}}function RS(t){let e=[];for(let n=0;n<t.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[t[n],t[n+1]]},properties:{}});return t.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[t[t.length-1],t[0]]},properties:{}}),e}function LF(t){let e,n,r;return{c(){e=Mt("Undo ("),n=Mt(t[1]),r=Mt(")")},m(i,a){ke(i,e,a),ke(i,n,a),ke(i,r,a)},p(i,a){a&2&&Hn(n,i[1])},d(i){i&&(Me(e),Me(n),Me(r))}}}function PF(t){let e;return{c(){e=Mt("Undo")},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function MF(t){let e,n,r,i,a,c,u,m,w,S,E;function P(V,j){return V[1]==0?PF:LF}let D=P(t),k=D(t);return{c(){e=Ne("div"),n=Ne("button"),n.textContent="Finish",r=at(),i=Ne("button"),i.textContent="Cancel",a=at(),c=Ne("button"),k.c(),m=at(),w=Ne("ul"),w.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,c.disabled=u=t[1]==0,Si(e,"display","flex"),Si(e,"justify-content","space-between")},m(V,j){ke(V,e,j),Le(e,n),Le(e,r),Le(e,i),Le(e,a),Le(e,c),k.m(c,null),ke(V,m,j),ke(V,w,j),S||(E=[Wt(n,"click",t[2]),Wt(i,"click",t[3]),Wt(c,"click",t[4])],S=!0)},p(V,[j]){D===(D=P(V))&&k?k.p(V,j):(k.d(1),k=D(V),k&&(k.c(),k.m(c,null))),j&2&&u!==(u=V[1]==0)&&(c.disabled=u)},i:gt,o:gt,d(V){V&&(Me(e),Me(m),Me(w)),k.d(),S=!1,Ni(E)}}}function AF(t,e,n){let r;Lt(t,WC,m=>n(1,r=m));let{polygonTool:i}=e;const a=()=>i.finish(),c=()=>i.cancel(),u=()=>i.undo();return t.$$set=m=>{"polygonTool"in m&&n(0,i=m.polygonTool)},[i,r,a,c,u]}class kF extends Qt{constructor(e){super(),Jt(this,e,AF,MF,Gt,{polygonTool:0})}}let DF=Date.now();function em(t){return`${t}-${DF++}`}const HC=Symbol.for("svelte-maplibre");function RF(){return vv(HC)}function NS(t){return{subscribe:t.subscribe}}function ZC({key:t,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:r=!1}){let i=RF(),a=sr(null),c=NS(a),u={...i,[t]:NS(a)};if(e&&(u.popupTarget=c),r){let m=sr(null);u.layerEvent=m,i.layerEvent=m}return n&&(u.cluster=sr()),_v(HC,u),{...i,self:a}}function NF(){return ZC({key:"source",setCluster:!0})}function OF(t=!0){return ZC({key:"layer",setPopupTarget:t,setMouseEvent:t})}function OS(t){let e;return n=>{if(n)for(let r in n){let i=e==null?void 0:e[r],a=n[r];i!==a&&t(r,a,i)}else if(e)for(let r in e)t(r,void 0,e[r]);e=n}}function zF(t,...e){let n=[t];for(let r of e)if(r)Array.isArray(r)&&r[0]===t?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function FF(t){return t===!0?["has","point_count"]:t===!1?["!",["has","point_count"]]:void 0}function zS(t){let e=t[0],n,r,i=FS(t);return{c(){i.c(),n=Yr()},m(a,c){i.m(a,c),ke(a,n,c),r=!0},p(a,c){c[0]&1&&Gt(e,e=a[0])?(On(),Te(i,1,1,gt),zn(),i=FS(a),i.c(),be(i,1),i.m(n.parentNode,n)):i.p(a,c)},i(a){r||(be(i),r=!0)},o(a){Te(i),r=!1},d(a){a&&Me(n),i.d(a)}}}function FS(t){let e;const n=t[36].default,r=ri(n,t,t[35],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a[1]&16)&&oi(r,n,i,i[35],e?ii(n,i[35],a,null):si(i[35]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function BF(t){let e,n,r=t[0]&&zS(t);return{c(){r&&r.c(),e=Yr()},m(i,a){r&&r.m(i,a),ke(i,e,a),n=!0},p(i,a){i[0]?r?(r.p(i,a),a[0]&1&&be(r,1)):(r=zS(i),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(i)}}}function VF(t,e,n){let r,i,a,c,u,m,w,S,E,P,D,k,{$$slots:V={},$$scope:j}=e,{id:te=em("layer")}=e,{source:U=void 0}=e,{sourceLayer:W=void 0}=e,{beforeId:Y=void 0}=e,{beforeLayerType:oe=void 0}=e,{type:_e}=e,{paint:se=void 0}=e,{layout:ce=void 0}=e,{filter:me=void 0}=e,{applyToClusters:Ce=void 0}=e,{minzoom:Z=void 0}=e,{maxzoom:fe=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Se=null}=e,{interactive:Ze=!0}=e,{hoverCursor:tt=void 0}=e,{eventsIfTopMost:qe=!1}=e;const Ot=ju(),{map:wt,source:un,self:qt,minzoom:At,maxzoom:hn,eventTopMost:Tn,layerInfo:yn}=OF();Lt(t,wt,ge=>n(31,E=ge)),Lt(t,un,ge=>n(32,P=ge)),Lt(t,qt,ge=>n(0,S=ge)),Lt(t,At,ge=>n(34,k=ge)),Lt(t,hn,ge=>n(33,D=ge)),as(()=>{S&&E&&(yn.delete(S),E==null||E.removeLayer(S))});let _n;function kn(ge){var Oe,Yt;if(!Ze||!S||!E||qe&&Tn(ge)!==S)return;let Pe=ge.features??[],It=(Yt=(Oe=Pe[0])==null?void 0:Oe.properties)==null?void 0:Yt.cluster_id,Dn={event:ge,map:E,clusterId:It,layer:S,source:u,features:Pe};Ot(ge.type,Dn)}function wr(ge){var Oe,Yt;if(!Ze||!S||!E||qe&&Tn(ge)!==S)return;tt&&(E.getCanvas().style.cursor=tt);let Pe=ge.features??[];n(6,Se=Pe[0]??null);let It=(Yt=(Oe=Pe[0])==null?void 0:Oe.properties)==null?void 0:Yt.cluster_id;Ot("mouseenter",{event:ge,map:E,clusterId:It,layer:S,source:u,features:Pe})}function kr(ge){var Oe,Yt,Dr;if(!Ze||!E)return;if(qe&&Tn(ge)!==S){n(6,Se=null),Ke&&_n!==void 0&&(E==null||E.setFeatureState({source:u,sourceLayer:W,id:_n},{hover:!1}),_n=void 0);return}E.getCanvas().style.cursor=tt;let Pe=ge.features??[],It=(Yt=(Oe=Pe[0])==null?void 0:Oe.properties)==null?void 0:Yt.cluster_id,Dn=(Dr=Pe[0])==null?void 0:Dr.id;Dn!==_n&&(Ke&&(_n!==void 0&&(E==null||E.setFeatureState({source:u,id:_n,sourceLayer:W},{hover:!1})),E==null||E.setFeatureState({source:u,id:Dn,sourceLayer:W},{hover:!0})),_n=Dn,n(6,Se=Pe[0]??null)),Ot("mousemove",{event:ge,map:E,clusterId:It,layer:S,source:u,features:Pe})}function Sr(ge){if(!(!Ze||!S||!E)){if(tt&&(E.getCanvas().style.cursor=""),n(6,Se=null),Ke&&_n!==void 0){const Pe={source:u,id:_n,sourceLayer:W};E==null||E.setFeatureState(Pe,{hover:!1}),_n=void 0}Ot("mouseleave",{map:E,layer:S,source:u})}}let dr=!0;function Qe(ge){E&&(E.off("click",ge,kn),E.off("dblclick",ge,kn),E.off("contextmenu",ge,kn),E.off("mouseenter",ge,wr),E.off("mousemove",ge,kr),E.off("mouseleave",ge,Sr))}return as(()=>{E&&S&&Qe(S)}),t.$$set=ge=>{"id"in ge&&n(7,te=ge.id),"source"in ge&&n(8,U=ge.source),"sourceLayer"in ge&&n(9,W=ge.sourceLayer),"beforeId"in ge&&n(10,Y=ge.beforeId),"beforeLayerType"in ge&&n(11,oe=ge.beforeLayerType),"type"in ge&&n(12,_e=ge.type),"paint"in ge&&n(13,se=ge.paint),"layout"in ge&&n(14,ce=ge.layout),"filter"in ge&&n(15,me=ge.filter),"applyToClusters"in ge&&n(16,Ce=ge.applyToClusters),"minzoom"in ge&&n(17,Z=ge.minzoom),"maxzoom"in ge&&n(18,fe=ge.maxzoom),"manageHoverState"in ge&&n(19,Ke=ge.manageHoverState),"hovered"in ge&&n(6,Se=ge.hovered),"interactive"in ge&&n(20,Ze=ge.interactive),"hoverCursor"in ge&&n(21,tt=ge.hoverCursor),"eventsIfTopMost"in ge&&n(22,qe=ge.eventsIfTopMost),"$$scope"in ge&&n(35,j=ge.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&65536&&n(30,r=FF(Ce)),t.$$.dirty[0]&1073774592&&n(24,i=zF("all",r,me)),t.$$.dirty[0]&131072|t.$$.dirty[1]&8&&n(26,a=Z??k),t.$$.dirty[0]&262144|t.$$.dirty[1]&4&&n(25,c=fe??D),t.$$.dirty[0]&256|t.$$.dirty[1]&2&&n(29,u=U||P),t.$$.dirty[0]&654343809|t.$$.dirty[1]&1&&E&&S!==te&&u){S&&(Qe(S),yn.delete(S));let ge=Y;if(!Y&&oe){let Pe=E.getStyle().layers,It=typeof oe=="function"?oe:Oe=>Oe.type===oe,Dn=Pe==null?void 0:Pe.find(It);Dn&&(ge=Dn.id)}Wn(qt,S=te,S),E.addLayer(Uc({id:S,type:_e,source:u,"source-layer":W,filter:i,paint:se,layout:ce,minzoom:a,maxzoom:c}),ge),n(23,dr=!0),E.on("click",S,kn),E.on("dblclick",S,kn),E.on("contextmenu",S,kn),E.on("mouseenter",S,wr),E.on("mousemove",S,kr),E.on("mouseleave",S,Sr)}t.$$.dirty[0]&1048577&&S&&yn.set(S,{interactive:Ze}),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(28,m=S?OS((ge,Pe)=>E==null?void 0:E.setPaintProperty(S,ge,Pe)):void 0),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(27,w=S?OS((ge,Pe)=>E==null?void 0:E.setLayoutProperty(S,ge,Pe)):void 0),t.$$.dirty[0]&268443648&&(m==null||m(se)),t.$$.dirty[0]&134234112&&(w==null||w(ce)),t.$$.dirty[0]&100663297|t.$$.dirty[1]&1&&S&&(E==null||E.setLayerZoomRange(S,a,c)),t.$$.dirty[0]&25165825|t.$$.dirty[1]&1&&S&&(dr?n(23,dr=!1):E==null||E.setFilter(S,i))},[S,wt,un,qt,At,hn,Se,te,U,W,Y,oe,_e,se,ce,me,Ce,Z,fe,Ke,Ze,tt,qe,dr,i,c,a,w,m,u,r,E,P,D,k,j,V]}class E1 extends Qt{constructor(e){super(),Jt(this,e,VF,BF,Gt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function UF(t){let e;const n=t[16].default,r=ri(n,t,t[24],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&16777216)&&oi(r,n,i,i[24],e?ii(n,i[24],a,null):si(i[24]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function GF(t){let e,n,r;function i(c){t[17](c)}let a={id:t[1],type:"circle",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[UF]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new E1({props:a}),Zn.push(()=>ao(e,"hovered",i)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,[u]){const m={};u&2&&(m.id=c[1]),u&4&&(m.source=c[2]),u&8&&(m.sourceLayer=c[3]),u&16&&(m.beforeId=c[4]),u&32&&(m.beforeLayerType=c[5]),u&64&&(m.paint=c[6]),u&128&&(m.layout=c[7]),u&256&&(m.filter=c[8]),u&512&&(m.applyToClusters=c[9]),u&1024&&(m.minzoom=c[10]),u&2048&&(m.maxzoom=c[11]),u&4096&&(m.hoverCursor=c[12]),u&8192&&(m.manageHoverState=c[13]),u&16384&&(m.eventsIfTopMost=c[14]),u&32768&&(m.interactive=c[15]),u&16777216&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.hovered=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function qF(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:a=em("circle")}=e,{source:c=void 0}=e,{sourceLayer:u=void 0}=e,{beforeId:m=void 0}=e,{beforeLayerType:w=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:P=void 0}=e,{applyToClusters:D=void 0}=e,{minzoom:k=void 0}=e,{maxzoom:V=void 0}=e,{hoverCursor:j=void 0}=e,{manageHoverState:te=!1}=e,{hovered:U=null}=e,{eventsIfTopMost:W=!1}=e,{interactive:Y=!0}=e;function oe(fe){U=fe,n(0,U)}function _e(fe){In.call(this,t,fe)}function se(fe){In.call(this,t,fe)}function ce(fe){In.call(this,t,fe)}function me(fe){In.call(this,t,fe)}function Ce(fe){In.call(this,t,fe)}function Z(fe){In.call(this,t,fe)}return t.$$set=fe=>{"id"in fe&&n(1,a=fe.id),"source"in fe&&n(2,c=fe.source),"sourceLayer"in fe&&n(3,u=fe.sourceLayer),"beforeId"in fe&&n(4,m=fe.beforeId),"beforeLayerType"in fe&&n(5,w=fe.beforeLayerType),"paint"in fe&&n(6,S=fe.paint),"layout"in fe&&n(7,E=fe.layout),"filter"in fe&&n(8,P=fe.filter),"applyToClusters"in fe&&n(9,D=fe.applyToClusters),"minzoom"in fe&&n(10,k=fe.minzoom),"maxzoom"in fe&&n(11,V=fe.maxzoom),"hoverCursor"in fe&&n(12,j=fe.hoverCursor),"manageHoverState"in fe&&n(13,te=fe.manageHoverState),"hovered"in fe&&n(0,U=fe.hovered),"eventsIfTopMost"in fe&&n(14,W=fe.eventsIfTopMost),"interactive"in fe&&n(15,Y=fe.interactive),"$$scope"in fe&&n(24,i=fe.$$scope)},[U,a,c,u,m,w,S,E,P,D,k,V,j,te,W,Y,r,oe,_e,se,ce,me,Ce,Z,i]}class jF extends Qt{constructor(e){super(),Jt(this,e,qF,GF,Gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function WF(t){let e;const n=t[15].default,r=ri(n,t,t[23],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&8388608)&&oi(r,n,i,i[23],e?ii(n,i[23],a,null):si(i[23]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function HF(t){let e,n,r;function i(c){t[16](c)}let a={id:t[1],type:"fill",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[WF]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new E1({props:a}),Zn.push(()=>ao(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,[u]){const m={};u&2&&(m.id=c[1]),u&4&&(m.source=c[2]),u&8&&(m.sourceLayer=c[3]),u&16&&(m.beforeId=c[4]),u&32&&(m.beforeLayerType=c[5]),u&64&&(m.paint=c[6]),u&128&&(m.layout=c[7]),u&256&&(m.filter=c[8]),u&512&&(m.minzoom=c[9]),u&1024&&(m.maxzoom=c[10]),u&2048&&(m.hoverCursor=c[11]),u&4096&&(m.manageHoverState=c[12]),u&8192&&(m.eventsIfTopMost=c[13]),u&16384&&(m.interactive=c[14]),u&8388608&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.hovered=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function ZF(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:a=em("fill")}=e,{source:c=void 0}=e,{sourceLayer:u=void 0}=e,{beforeId:m=void 0}=e,{beforeLayerType:w=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:k=void 0}=e,{hoverCursor:V=void 0}=e,{manageHoverState:j=!1}=e,{hovered:te=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:W=!0}=e;function Y(Z){te=Z,n(0,te)}function oe(Z){In.call(this,t,Z)}function _e(Z){In.call(this,t,Z)}function se(Z){In.call(this,t,Z)}function ce(Z){In.call(this,t,Z)}function me(Z){In.call(this,t,Z)}function Ce(Z){In.call(this,t,Z)}return t.$$set=Z=>{"id"in Z&&n(1,a=Z.id),"source"in Z&&n(2,c=Z.source),"sourceLayer"in Z&&n(3,u=Z.sourceLayer),"beforeId"in Z&&n(4,m=Z.beforeId),"beforeLayerType"in Z&&n(5,w=Z.beforeLayerType),"paint"in Z&&n(6,S=Z.paint),"layout"in Z&&n(7,E=Z.layout),"filter"in Z&&n(8,P=Z.filter),"minzoom"in Z&&n(9,D=Z.minzoom),"maxzoom"in Z&&n(10,k=Z.maxzoom),"hoverCursor"in Z&&n(11,V=Z.hoverCursor),"manageHoverState"in Z&&n(12,j=Z.manageHoverState),"hovered"in Z&&n(0,te=Z.hovered),"eventsIfTopMost"in Z&&n(13,U=Z.eventsIfTopMost),"interactive"in Z&&n(14,W=Z.interactive),"$$scope"in Z&&n(23,i=Z.$$scope)},[te,a,c,u,m,w,S,E,P,D,k,V,j,U,W,r,Y,oe,_e,se,ce,me,Ce,i]}class XF extends Qt{constructor(e){super(),Jt(this,e,ZF,HF,Gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function YF(t,e,n,r,i){let a=!1;t.getSource(e)&&(a=!0,t.removeSource(e));const c=()=>{r(e)&&(t.addSource(e,n),i())};if(a){const u=()=>{e&&(t.getSource(e)?setTimeout(u,1):c())};u()}else c()}function KF(t,e,n){tE().then(()=>{let r=KS(t);if(!r)return;r.getSource(e)===n&&r.removeSource(e)})}function BS(t){let e=t[0],n,r,i=VS(t);return{c(){i.c(),n=Yr()},m(a,c){i.m(a,c),ke(a,n,c),r=!0},p(a,c){c&1&&Gt(e,e=a[0])?(On(),Te(i,1,1,gt),zn(),i=VS(a),i.c(),be(i,1),i.m(n.parentNode,n)):i.p(a,c)},i(a){r||(be(i),r=!0)},o(a){Te(i),r=!1},d(a){a&&Me(n),i.d(a)}}}function VS(t){let e;const n=t[15].default,r=ri(n,t,t[14],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&16384)&&oi(r,n,i,i[14],e?ii(n,i[14],a,null):si(i[14]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function JF(t){let e,n,r=t[0]&&BS(t);return{c(){r&&r.c(),e=Yr()},m(i,a){r&&r.m(i,a),ke(i,e,a),n=!0},p(i,[a]){i[0]?r?(r.p(i,a),a&1&&be(r,1)):(r=BS(i),r.c(),be(r,1),r.m(e.parentNode,e)):r&&(On(),Te(r,1,1,()=>{r=null}),zn())},i(i){n||(be(r),n=!0)},o(i){Te(r),n=!1},d(i){i&&Me(e),r&&r.d(i)}}}function QF(t,e,n){let r,i,a,{$$slots:c={},$$scope:u}=e,{id:m=em("geojson")}=e,{data:w}=e,{generateId:S=!1}=e,{promoteId:E=void 0}=e,{filter:P=void 0}=e,{lineMetrics:D=void 0}=e,{cluster:k=void 0}=e;const{map:V,cluster:j,self:te}=NF();Lt(t,V,Y=>n(13,i=Y)),Lt(t,j,Y=>n(16,a=Y)),Lt(t,te,Y=>n(0,r=Y));let U,W=!0;return as(()=>{r&&U&&i&&(KF(V,r,U),Wn(te,r=null,r),n(11,U=void 0))}),t.$$set=Y=>{"id"in Y&&n(4,m=Y.id),"data"in Y&&n(5,w=Y.data),"generateId"in Y&&n(6,S=Y.generateId),"promoteId"in Y&&n(7,E=Y.promoteId),"filter"in Y&&n(8,P=Y.filter),"lineMetrics"in Y&&n(9,D=Y.lineMetrics),"cluster"in Y&&n(10,k=Y.cluster),"$$scope"in Y&&n(14,u=Y.$$scope)},t.$$.update=()=>{t.$$.dirty&1024&&Wn(j,a=k,a),t.$$.dirty&12273&&i&&r!==m&&(Wn(te,r=m,r),YF(i,r,Uc({type:"geojson",data:w,filter:P,lineMetrics:D,generateId:S,promoteId:E,cluster:!!k,clusterMinPoints:k==null?void 0:k.minPoints,clusterMaxZoom:k==null?void 0:k.maxZoom,clusterRadius:k==null?void 0:k.radius,clusterProperties:k==null?void 0:k.properties}),Y=>i&&Y===r,()=>{r&&(n(11,U=i==null?void 0:i.getSource(r)),n(12,W=!0))})),t.$$.dirty&8208&&(i==null||i.on("style.load",()=>{n(11,U=i==null?void 0:i.getSource(m))})),t.$$.dirty&6176&&U&&(W?n(12,W=!1):U.setData(w)),t.$$.dirty&3072&&(U==null||U.setClusterOptions(Uc({cluster:!!k,clusterMaxZoom:k==null?void 0:k.maxZoom,clusterRadius:k==null?void 0:k.radius})))},[r,V,j,te,m,w,S,E,P,D,k,U,W,i,u,c]}class $F extends Qt{constructor(e){super(),Jt(this,e,QF,JF,Gt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function e6(t){let e;const n=t[15].default,r=ri(n,t,t[23],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),e=!0},p(i,a){r&&r.p&&(!e||a&8388608)&&oi(r,n,i,i[23],e?ii(n,i[23],a,null):si(i[23]),null)},i(i){e||(be(r,i),e=!0)},o(i){Te(r,i),e=!1},d(i){r&&r.d(i)}}}function t6(t){let e,n,r;function i(c){t[16](c)}let a={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[e6]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new E1({props:a}),Zn.push(()=>ao(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){lt(e.$$.fragment)},m(c,u){it(e,c,u),r=!0},p(c,[u]){const m={};u&2&&(m.id=c[1]),u&4&&(m.source=c[2]),u&8&&(m.sourceLayer=c[3]),u&16&&(m.beforeId=c[4]),u&32&&(m.beforeLayerType=c[5]),u&64&&(m.paint=c[6]),u&128&&(m.layout=c[7]),u&256&&(m.filter=c[8]),u&512&&(m.minzoom=c[9]),u&1024&&(m.maxzoom=c[10]),u&2048&&(m.hoverCursor=c[11]),u&4096&&(m.manageHoverState=c[12]),u&8192&&(m.eventsIfTopMost=c[13]),u&16384&&(m.interactive=c[14]),u&8388608&&(m.$$scope={dirty:u,ctx:c}),!n&&u&1&&(n=!0,m.hovered=c[0],so(()=>n=!1)),e.$set(m)},i(c){r||(be(e.$$.fragment,c),r=!0)},o(c){Te(e.$$.fragment,c),r=!1},d(c){ot(e,c)}}}function n6(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:a=em("line")}=e,{source:c=void 0}=e,{sourceLayer:u=void 0}=e,{beforeId:m=void 0}=e,{beforeLayerType:w=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:k=void 0}=e,{hoverCursor:V=void 0}=e,{manageHoverState:j=!1}=e,{hovered:te=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:W=!0}=e;function Y(Z){te=Z,n(0,te)}function oe(Z){In.call(this,t,Z)}function _e(Z){In.call(this,t,Z)}function se(Z){In.call(this,t,Z)}function ce(Z){In.call(this,t,Z)}function me(Z){In.call(this,t,Z)}function Ce(Z){In.call(this,t,Z)}return t.$$set=Z=>{"id"in Z&&n(1,a=Z.id),"source"in Z&&n(2,c=Z.source),"sourceLayer"in Z&&n(3,u=Z.sourceLayer),"beforeId"in Z&&n(4,m=Z.beforeId),"beforeLayerType"in Z&&n(5,w=Z.beforeLayerType),"paint"in Z&&n(6,S=Z.paint),"layout"in Z&&n(7,E=Z.layout),"filter"in Z&&n(8,P=Z.filter),"minzoom"in Z&&n(9,D=Z.minzoom),"maxzoom"in Z&&n(10,k=Z.maxzoom),"hoverCursor"in Z&&n(11,V=Z.hoverCursor),"manageHoverState"in Z&&n(12,j=Z.manageHoverState),"hovered"in Z&&n(0,te=Z.hovered),"eventsIfTopMost"in Z&&n(13,U=Z.eventsIfTopMost),"interactive"in Z&&n(14,W=Z.interactive),"$$scope"in Z&&n(23,i=Z.$$scope)},[te,a,c,u,m,w,S,E,P,D,k,V,j,U,W,r,Y,oe,_e,se,ce,me,Ce,i]}class r6 extends Qt{constructor(e){super(),Jt(this,e,n6,t6,Gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function i6(t){let e,n,r,i,a,c;return e=new XF({props:{id:"edit-polygon-fill",filter:SF,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),r=new r6({props:{id:"edit-polygon-lines",filter:EF,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),a=new jF({props:{id:"edit-polygon-vertices",filter:IF,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){lt(e.$$.fragment),n=at(),lt(r.$$.fragment),i=at(),lt(a.$$.fragment)},m(u,m){it(e,u,m),ke(u,n,m),it(r,u,m),ke(u,i,m),it(a,u,m),c=!0},p:gt,i(u){c||(be(e.$$.fragment,u),be(r.$$.fragment,u),be(a.$$.fragment,u),c=!0)},o(u){Te(e.$$.fragment,u),Te(r.$$.fragment,u),Te(a.$$.fragment,u),c=!1},d(u){u&&(Me(n),Me(i)),ot(e,u),ot(r,u),ot(a,u)}}}function o6(t){let e,n;return e=new $F({props:{data:t[0],$$slots:{default:[i6]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,[i]){const a={};i&1&&(a.data=r[0]),i&2&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function s6(t,e,n){let r;return Lt(t,jC,i=>n(0,r=i)),[r]}class a6 extends Qt{constructor(e){super(),Jt(this,e,s6,o6,Gt,{})}}function l6(t){let e,n,r,i,a,c,u;return{c(){e=Ne("button"),e.textContent="Import current view",n=at(),r=Ne("i"),r.textContent="or...",i=at(),a=Ne("button"),a.textContent="Draw an area to import on the map",Ve(e,"type","button"),Ve(a,"type","button")},m(m,w){ke(m,e,w),ke(m,n,w),ke(m,r,w),ke(m,i,w),ke(m,a,w),c||(u=[Wt(e,"click",t[1]),Wt(a,"click",t[2])],c=!0)},p:gt,i:gt,o:gt,d(m){m&&(Me(e),Me(n),Me(r),Me(i),Me(a)),c=!1,Ni(u)}}}function u6(t){let e,n;return e=new kF({props:{polygonTool:t[0]}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&1&&(a.polygonTool=r[0]),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function c6(t){let e,n,r,i;const a=[u6,l6],c=[];function u(m,w){return m[0]?0:1}return e=u(t),n=c[e]=a[e](t),{c(){n.c(),r=Yr()},m(m,w){c[e].m(m,w),ke(m,r,w),i=!0},p(m,[w]){let S=e;e=u(m),e===S?c[e].p(m,w):(On(),Te(c[S],1,1,()=>{c[S]=null}),zn(),n=c[e],n?n.p(m,w):(n=c[e]=a[e](m),n.c()),be(n,1),n.m(r.parentNode,r))},i(m){i||(be(n),i=!0)},o(m){Te(n),i=!1},d(m){m&&Me(r),c[e].d(m)}}}function id(t){return[t.lng,t.lat]}function h6(t,e,n){let{map:r}=e;const i=ju();let a=null;async function c(S){try{i("loading","Loading from Overpass");let P=await(await fetch(p6(S))).text();i("gotXml",P)}catch(E){i("error",E.toString())}}function u(){let S=r.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[id(S.getSouthWest()),id(S.getNorthWest()),id(S.getNorthEast()),id(S.getSouthEast()),id(S.getSouthWest())]],type:"Polygon"}}}async function m(){if(r){if(r.getZoom()<13){i("error","Zoom in more to import");return}await c(u())}}function w(){r&&(n(0,a=new TF(r)),a.startNew(),a.addEventListenerSuccess(async S=>{n(0,a=null),await c(S)}),a.addEventListenerFailure(()=>{n(0,a=null)}))}return t.$$set=S=>{"map"in S&&n(3,r=S.map)},[a,m,w,r]}class f6 extends Qt{constructor(e){super(),Jt(this,e,h6,c6,Gt,{map:3})}}function p6(t){let e='poly:"';for(let[r,i]of t.geometry.coordinates[0])e+=`${i} ${r} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}function US(t,e,n){const r=t.slice();return r[21]=e[n][0],r[22]=e[n][1],r}function GS(t,e,n){const r=t.slice();return r[25]=e[n][0],r[26]=e[n][1],r}function qS(t){let e,n=t[26]+"",r,i;return{c(){e=Ne("option"),r=Mt(n),e.__value=i=t[25],Go(e,e.__value)},m(a,c){ke(a,e,c),Le(e,r)},p(a,c){c&4&&n!==(n=a[26]+"")&&Hn(r,n),c&4&&i!==(i=a[25])&&(e.__value=i,Go(e,e.__value))},d(a){a&&Me(e)}}}function jS(t){let e,n,r=zr(t[22]),i=[];for(let a=0;a<r.length;a+=1)i[a]=qS(GS(t,r,a));return{c(){e=Ne("optgroup");for(let a=0;a<i.length;a+=1)i[a].c();Ve(e,"label",n=t[21])},m(a,c){ke(a,e,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null)},p(a,c){if(c&4){r=zr(a[22]);let u;for(u=0;u<r.length;u+=1){const m=GS(a,r,u);i[u]?i[u].p(m,c):(i[u]=qS(m),i[u].c(),i[u].m(e,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=r.length}c&4&&n!==(n=a[21])&&Ve(e,"label",n)},d(a){a&&Me(e),Pa(i,a)}}}function d6(t){let e,n,r,i,a,c,u,m,w,S,E,P,D,k,V,j,te,U,W,Y,oe,_e,se,ce,me,Ce,Z,fe;e=new AC({props:{loading:t[1]}});let Ke=zr(t[2]),Se=[];for(let Ze=0;Ze<Ke.length;Ze+=1)Se[Ze]=jS(US(t,Ke,Ze));return U=new f6({props:{map:t[5]}}),U.$on("gotXml",t[8]),U.$on("loading",t[11]),U.$on("error",t[12]),{c(){lt(e.$$.fragment),n=at(),r=Ne("div"),i=Ne("label"),a=Mt(`Load an example:
    `),c=Ne("select"),u=Ne("option"),u.textContent="Custom file loaded";for(let Ze=0;Ze<Se.length;Ze+=1)Se[Ze].c();m=at(),w=Ne("i"),w.textContent="or...",S=at(),E=Ne("div"),P=Ne("label"),D=Mt(`Load an osm.xml or a .pbf file:
    `),k=Ne("input"),V=at(),j=Ne("i"),j.textContent="or...",te=at(),lt(U.$$.fragment),W=at(),Y=Ne("i"),Y.textContent="or...",oe=at(),_e=Ne("div"),se=Ne("label"),ce=Mt(`Load a pre-built graph.bin file:
    `),me=Ne("input"),u.__value="",Go(u,u.__value),t[0]===void 0&&bd(()=>t[9].call(c)),Ve(k,"type","file"),Ve(me,"type","file")},m(Ze,tt){it(e,Ze,tt),ke(Ze,n,tt),ke(Ze,r,tt),Le(r,i),Le(i,a),Le(i,c),Le(c,u);for(let qe=0;qe<Se.length;qe+=1)Se[qe]&&Se[qe].m(c,null);Rg(c,t[0],!0),ke(Ze,m,tt),ke(Ze,w,tt),ke(Ze,S,tt),ke(Ze,E,tt),Le(E,P),Le(P,D),Le(P,k),t[10](k),ke(Ze,V,tt),ke(Ze,j,tt),ke(Ze,te,tt),it(U,Ze,tt),ke(Ze,W,tt),ke(Ze,Y,tt),ke(Ze,oe,tt),ke(Ze,_e,tt),Le(_e,se),Le(se,ce),Le(se,me),t[13](me),Ce=!0,Z||(fe=[Wt(c,"change",t[9]),Wt(k,"change",t[6]),Wt(me,"change",t[7])],Z=!0)},p(Ze,[tt]){const qe={};if(tt&2&&(qe.loading=Ze[1]),e.$set(qe),tt&4){Ke=zr(Ze[2]);let wt;for(wt=0;wt<Ke.length;wt+=1){const un=US(Ze,Ke,wt);Se[wt]?Se[wt].p(un,tt):(Se[wt]=jS(un),Se[wt].c(),Se[wt].m(c,null))}for(;wt<Se.length;wt+=1)Se[wt].d(1);Se.length=Ke.length}tt&5&&Rg(c,Ze[0]);const Ot={};tt&32&&(Ot.map=Ze[5]),U.$set(Ot)},i(Ze){Ce||(be(e.$$.fragment,Ze),be(U.$$.fragment,Ze),Ce=!0)},o(Ze){Te(e.$$.fragment,Ze),Te(U.$$.fragment,Ze),Ce=!1},d(Ze){Ze&&(Me(n),Me(r),Me(m),Me(w),Me(S),Me(E),Me(V),Me(j),Me(te),Me(W),Me(Y),Me(oe),Me(_e)),ot(e,Ze),Pa(Se,Ze),t[10](null),ot(U,Ze),t[13](null),Z=!1,Ni(fe)}}}function m6(t,e,n){let r,i,a;Lt(t,lf,ce=>n(15,r=ce)),Lt(t,Zl,ce=>n(16,i=ce)),Lt(t,yy,ce=>n(5,a=ce));let c="",u=[],m=!1,w=[];qu(async()=>{try{let ce=await fetch("/osm/areas.json");if(ce.ok)m=!0,console.log("Using local cache, not od2net.org"),n(2,w=await ce.json());else{let me=await fetch("https://assets.od2net.org/severance_pbfs/areas.json");n(2,w=await me.json())}}catch{}});let S;async function E(ce){try{await k(await S.files[0].arrayBuffer()),n(0,c="")}catch(me){window.alert(`Couldn't open this file: ${me}`)}n(1,u=[])}let P;async function D(ce){try{n(1,u=["Loading pre-built file"]);let me=await P.files[0].arrayBuffer();console.time("load"),await i.loadGraphFile(new Uint8Array(me)),console.timeEnd("load"),Wn(lf,r=!0,r),n(0,c="")}catch(me){window.alert(`Couldn't open this file: ${me}`)}n(1,u=[])}async function k(ce){n(1,u=["Building map model from OSM input"]),console.time("load"),await i.loadOsmFile(new Uint8Array(ce),Ev(V)),console.timeEnd("load"),Wn(lf,r=!0,r)}function V(ce){n(1,u=[...u,ce])}async function j(ce){try{await k(new TextEncoder().encode(ce.detail)),n(0,c="")}catch(me){window.alert(`Couldn't import from Overpass: ${me}`)}n(1,u=[])}async function te(ce){ce!=""&&(m?await U(`/osm/${ce}.pbf`):await U(`https://assets.od2net.org/severance_pbfs/${ce}.pbf`))}async function U(ce){try{n(1,u=[`Downloading ${ce}`]);let me=await fetch(ce);await k(await me.arrayBuffer())}catch(me){window.alert(`Couldn't open from URL ${ce}: ${me}`)}n(1,u=[])}function W(){c=QS(this),n(0,c),n(2,w)}function Y(ce){Zn[ce?"unshift":"push"](()=>{S=ce,n(3,S)})}const oe=ce=>n(1,u=[...u,ce.detail]),_e=ce=>window.alert(ce.detail);function se(ce){Zn[ce?"unshift":"push"](()=>{P=ce,n(4,P)})}return t.$$.update=()=>{t.$$.dirty&1&&te(c)},[c,u,w,S,P,a,E,D,j,W,Y,oe,_e,se]}class g6 extends Qt{constructor(e){super(),Jt(this,e,m6,d6,Gt,{})}}function y6(t){let e;return{c(){e=Ne("div"),Ve(e,"slot","top")},m(n,r){ke(n,e,r)},p:gt,d(n){n&&Me(e)}}}function _6(t){let e;return{c(){e=Ne("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(n,r){ke(n,e,r)},i:gt,o:gt,d(n){n&&Me(e)}}}function v6(t){let e,n;return e=new g6({}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function b6(t){let e,n,r,i,a,c;const u=[v6,_6],m=[];function w(S,E){return S[0]?0:1}return i=w(t),a=m[i]=u[i](t),{c(){e=Ne("div"),n=Ne("h2"),n.textContent="Choose your study area",r=at(),a.c(),Ve(e,"slot","sidebar")},m(S,E){ke(S,e,E),Le(e,n),Le(e,r),m[i].m(e,null),c=!0},p(S,E){let P=i;i=w(S),i!==P&&(On(),Te(m[P],1,1,()=>{m[P]=null}),zn(),a=m[i],a||(a=m[i]=u[i](S),a.c()),be(a,1),a.m(e,null))},i(S){c||(be(a),c=!0)},o(S){Te(a),c=!1},d(S){S&&Me(e),m[i].d()}}}function x6(t){let e,n,r;return n=new a6({}),{c(){e=Ne("div"),lt(n.$$.fragment),Ve(e,"slot","map")},m(i,a){ke(i,e,a),it(n,e,null),r=!0},p:gt,i(i){r||(be(n.$$.fragment,i),r=!0)},o(i){Te(n.$$.fragment,i),r=!1},d(i){i&&Me(e),ot(n)}}}function w6(t){let e,n;return e=new Yf({props:{$$slots:{map:[x6],sidebar:[b6],top:[y6]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,[i]){const a={};i&33&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function S6(t,e,n){let r,i,a,c,u;return Lt(t,ff,m=>n(1,r=m)),Lt(t,Ic,m=>n(2,i=m)),Lt(t,Zl,m=>n(3,a=m)),Lt(t,lf,m=>n(4,c=m)),Lt(t,yy,m=>n(0,u=m)),qu(async()=>{Wn(lf,c=!1,c),await a.unset(),Wn(Ic,i=null,i),Wn(ff,r=null,r)}),[u]}class E6 extends Qt{constructor(e){super(),Jt(this,e,S6,w6,Gt,{})}}function I6(){return new Worker("/15m/assets/worker-e9143c35.js")}function C6(t){let e,n,r,i,a,c;return{c(){e=Ne("div"),n=Ne("button"),n.innerHTML=`<img src="${nP}" style="height: 6vh;" alt="A/B Street logo"/>`,r=at(),i=Ne("span"),Ve(n,"class","outline"),Si(i,"width","100%"),Ve(e,"slot","top"),Si(e,"display","flex")},m(u,m){ke(u,e,m),Le(e,n),Le(e,r),Le(e,i),t[16](i),a||(c=Wt(n,"click",t[15]),a=!0)},p:gt,d(u){u&&Me(e),t[16](null),a=!1,c()}}}function WS(t){let e,n,r,i,a,c;return{c(){e=Ne("hr"),n=at(),r=Ne("div"),i=Ne("button"),i.textContent="Zoom to fit"},m(u,m){ke(u,e,m),ke(u,n,m),ke(u,r,m),Le(r,i),a||(c=Wt(i,"click",t[8]),a=!0)},p:gt,d(u){u&&(Me(e),Me(n),Me(r)),a=!1,c()}}}function T6(t){let e,n,r,i,a,c=t[5].kind!="title"&&WS(t);return{c(){e=Ne("div"),n=Ne("h1"),n.textContent="15-minute neighbourhood tool",r=at(),i=Ne("div"),a=at(),c&&c.c(),Ve(e,"slot","left")},m(u,m){ke(u,e,m),Le(e,n),Le(e,r),Le(e,i),t[14](i),Le(e,a),c&&c.m(e,null)},p(u,m){u[5].kind!="title"?c?c.p(u,m):(c=WS(u),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(u){u&&Me(e),t[14](null),c&&c.d()}}}function HS(t){let e,n;return e=new E6({}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function ZS(t){let e,n,r,i,a,c,u={ctx:t,current:null,token:null,hasCatch:!1,pending:A6,then:P6,catch:L6,value:20,blocks:[,,,]};tx(e=ul(t[6]).getInvertedBoundary(),u);const m=[O6,N6,R6,D6,k6],w=[];function S(E,P){return E[5].kind=="debug"?0:E[5].kind=="isochrone"?1:E[5].kind=="route"?2:E[5].kind=="score"?3:E[5].kind=="debug-route"?4:-1}return~(r=S(t))&&(i=w[r]=m[r](t)),{c(){u.block.c(),n=at(),i&&i.c(),a=Yr()},m(E,P){u.block.m(E,u.anchor=P),u.mount=()=>n.parentNode,u.anchor=n,ke(E,n,P),~r&&w[r].m(E,P),ke(E,a,P),c=!0},p(E,P){t=E,u.ctx=t,P&64&&e!==(e=ul(t[6]).getInvertedBoundary())&&tx(e,u)||JL(u,t,P);let D=r;r=S(t),r===D?~r&&w[r].p(t,P):(i&&(On(),Te(w[D],1,1,()=>{w[D]=null}),zn()),~r?(i=w[r],i?i.p(t,P):(i=w[r]=m[r](t),i.c()),be(i,1),i.m(a.parentNode,a)):i=null)},i(E){c||(be(u.block),be(i),c=!0)},o(E){for(let P=0;P<3;P+=1){const D=u.blocks[P];Te(D)}Te(i),c=!1},d(E){E&&(Me(n),Me(a)),u.block.d(E),u.token=null,u=null,~r&&w[r].d(E)}}}function L6(t){return{c:gt,m:gt,p:gt,i:gt,o:gt,d:gt}}function P6(t){let e,n;return e=new ru({props:{data:t[20],$$slots:{default:[M6]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&64&&(a.data=r[20]),i&2097152&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function M6(t){let e,n;return e=new LC({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function A6(t){return{c:gt,m:gt,p:gt,i:gt,o:gt,d:gt}}function k6(t){let e,n;return e=new Lz({props:{debugGj:t[5].debugGj,start:t[5].start,end:t[5].end,routeGj:t[5].routeGj}}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p(r,i){const a={};i&32&&(a.debugGj=r[5].debugGj),i&32&&(a.start=r[5].start),i&32&&(a.end=r[5].end),i&32&&(a.routeGj=r[5].routeGj),e.$set(a)},i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function D6(t){let e,n;return e=new Fz({}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function R6(t){let e,n;return e=new _z({}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function N6(t){let e,n;return e=new tz({}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function O6(t){let e,n;return e=new j5({}),{c(){lt(e.$$.fragment)},m(r,i){it(e,r,i),n=!0},p:gt,i(r){n||(be(e.$$.fragment,r),n=!0)},o(r){Te(e.$$.fragment,r),n=!1},d(r){ot(e,r)}}}function z6(t){let e,n,r,i,a,c,u;e=new ON({props:{map:t[0],apiKey:fE}});let m=t[5].kind=="title"&&HS(),w=t[4]&&ZS(t);return{c(){lt(e.$$.fragment),n=at(),r=Ne("div"),i=at(),m&&m.c(),a=at(),w&&w.c(),c=Yr()},m(S,E){it(e,S,E),ke(S,n,E),ke(S,r,E),t[12](r),ke(S,i,E),m&&m.m(S,E),ke(S,a,E),w&&w.m(S,E),ke(S,c,E),u=!0},p(S,E){const P={};E&1&&(P.map=S[0]),e.$set(P),S[5].kind=="title"?m?E&32&&be(m,1):(m=HS(),m.c(),be(m,1),m.m(a.parentNode,a)):m&&(On(),Te(m,1,1,()=>{m=null}),zn()),S[4]?w?(w.p(S,E),E&16&&be(w,1)):(w=ZS(S),w.c(),be(w,1),w.m(c.parentNode,c)):w&&(On(),Te(w,1,1,()=>{w=null}),zn())},i(S){u||(be(e.$$.fragment,S),be(m),be(w),u=!0)},o(S){Te(e.$$.fragment,S),Te(m),Te(w),u=!1},d(S){S&&(Me(n),Me(r),Me(i),Me(a),Me(c)),ot(e,S),t[12](null),m&&m.d(S),w&&w.d(S)}}}function F6(t){let e,n,r,i;function a(u){t[13](u)}let c={style:`https://api.maptiler.com/maps/dataviz/style.json?key=${fE}`,standardControls:!0,hash:!0,$$slots:{default:[z6]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.map=t[0]),n=new YO({props:c}),Zn.push(()=>ao(n,"map",a)),{c(){e=Ne("div"),lt(n.$$.fragment),Ve(e,"slot","main"),Si(e,"position","relative"),Si(e,"width","100%"),Si(e,"height","100vh")},m(u,m){ke(u,e,m),it(n,e,null),i=!0},p(u,m){const w={};m&2097273&&(w.$$scope={dirty:m,ctx:u}),!r&&m&1&&(r=!0,w.map=u[0],so(()=>r=!1)),n.$set(w)},i(u){i||(be(n.$$.fragment,u),i=!0)},o(u){Te(n.$$.fragment,u),i=!1},d(u){u&&Me(e),ot(n)}}}function B6(t){let e,n,r,i;return e=new NP({}),r=new o5({props:{$$slots:{main:[F6],left:[T6],top:[C6]},$$scope:{ctx:t}}}),{c(){lt(e.$$.fragment),n=at(),lt(r.$$.fragment)},m(a,c){it(e,a,c),ke(a,n,c),it(r,a,c),i=!0},p(a,[c]){const u={};c&2097407&&(u.$$scope={dirty:c,ctx:a}),r.$set(u)},i(a){i||(be(e.$$.fragment,a),be(r.$$.fragment,a),i=!0)},o(a){Te(e.$$.fragment,a),Te(r.$$.fragment,a),i=!1},d(a){a&&Me(n),ot(e,a),ot(r,a)}}}function vg(t,e,n){return e+t*(n-e)}function V6(t,e,n){let r,i,a,c,u,m,w,S,E;Lt(t,gv,se=>n(9,r=se)),Lt(t,mv,se=>n(10,i=se)),Lt(t,dv,se=>n(11,a=se)),Lt(t,lf,se=>n(4,c=se)),Lt(t,Ys,se=>n(5,u=se)),Lt(t,ff,se=>n(17,m=se)),Lt(t,Ic,se=>n(18,w=se)),Lt(t,Zl,se=>n(6,S=se)),Lt(t,Fg,se=>n(7,E=se)),qu(async()=>{const se=aE(new I6);let ce=await new se;Zl.set(ce)});let P;async function D(){P&&c&&P.fitBounds(await S.getBounds(),{animate:!1})}async function k(se){if(se){console.log("New map model loaded");let ce=await S.getBounds();Wn(Ic,w={lng:vg(.4,ce[0],ce[2]),lat:vg(.4,ce[1],ce[3])},w),Wn(ff,m={lng:vg(.6,ce[0],ce[2]),lat:vg(.6,ce[1],ce[3])},m),await D(),Wn(Ys,u={kind:"isochrone"},u)}}let V,j,te;function U(se){Zn[se?"unshift":"push"](()=>{te=se,n(3,te),n(9,r)})}function W(se){P=se,n(0,P)}function Y(se){Zn[se?"unshift":"push"](()=>{j=se,n(2,j),n(10,i)})}const oe=()=>Wn(Fg,E=!0,E);function _e(se){Zn[se?"unshift":"push"](()=>{V=se,n(1,V),n(11,a)})}return t.$$.update=()=>{t.$$.dirty&1&&P&&yy.set(P),t.$$.dirty&16&&k(c),t.$$.dirty&2050&&V&&a&&(n(1,V.innerHTML="",V),V.appendChild(a)),t.$$.dirty&1028&&j&&i&&(n(2,j.innerHTML="",j),j.appendChild(i)),t.$$.dirty&520&&te&&r&&(n(3,te.innerHTML="",te),te.appendChild(r))},[P,V,j,te,c,u,S,E,D,r,i,a,U,W,Y,oe,_e]}class U6 extends Qt{constructor(e){super(),Jt(this,e,V6,B6,Gt,{})}}new U6({target:document.getElementById("app")});
