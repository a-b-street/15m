var ke=Object.defineProperty;var Ae=(p,h,k)=>h in p?ke(p,h,{enumerable:!0,configurable:!0,writable:!0,value:k}):p[h]=k;var ne=(p,h,k)=>(Ae(p,typeof h!="symbol"?h+"":h,k),k);(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const p=Symbol("Comlink.proxy"),h=Symbol("Comlink.endpoint"),k=Symbol("Comlink.releaseProxy"),z=Symbol("Comlink.finalizer"),P=Symbol("Comlink.thrown"),J=e=>typeof e=="object"&&e!==null||typeof e=="function",te={canHandle:e=>J(e)&&e[p],serialize(e){const{port1:n,port2:t}=new MessageChannel;return D(e,n),[t,[t]]},deserialize(e){return e.start(),se(e)}},re={canHandle:e=>J(e)&&P in e,serialize({value:e}){let n;return e instanceof Error?n={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:n={isError:!1,value:e},[n,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},G=new Map([["proxy",te],["throw",re]]);function oe(e,n){for(const t of e)if(n===t||t==="*"||t instanceof RegExp&&t.test(n))return!0;return!1}function D(e,n=globalThis,t=["*"]){n.addEventListener("message",function r(o){if(!o||!o.data)return;if(!oe(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:f,type:i,path:c}=Object.assign({path:[]},o.data),u=(o.data.argumentList||[]).map(A);let _;try{const l=c.slice(0,-1).reduce((w,j)=>w[j],e),b=c.reduce((w,j)=>w[j],e);switch(i){case"GET":_=b;break;case"SET":l[c.slice(-1)[0]]=A(o.data.value),_=!0;break;case"APPLY":_=b.apply(l,u);break;case"CONSTRUCT":{const w=new b(...u);_=fe(w)}break;case"ENDPOINT":{const{port1:w,port2:j}=new MessageChannel;D(e,j),_=ue(w,[w])}break;case"RELEASE":_=void 0;break;default:return}}catch(l){_={value:l,[P]:0}}Promise.resolve(_).catch(l=>({value:l,[P]:0})).then(l=>{const[b,w]=I(l);n.postMessage(Object.assign(Object.assign({},b),{id:f}),w),i==="RELEASE"&&(n.removeEventListener("message",r),Y(n),z in e&&typeof e[z]=="function"&&e[z]())}).catch(l=>{const[b,w]=I({value:new TypeError("Unserializable return value"),[P]:0});n.postMessage(Object.assign(Object.assign({},b),{id:f}),w)})}),n.start&&n.start()}function ie(e){return e.constructor.name==="MessagePort"}function Y(e){ie(e)&&e.close()}function se(e,n){return U(e,[],n)}function B(e){if(e)throw new Error("Proxy has been released and is not useable")}function K(e){return v(e,{type:"RELEASE"}).then(()=>{Y(e)})}const N=new WeakMap,C="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const n=(N.get(e)||0)-1;N.set(e,n),n===0&&K(e)});function ae(e,n){const t=(N.get(n)||0)+1;N.set(n,t),C&&C.register(e,n,e)}function ce(e){C&&C.unregister(e)}function U(e,n=[],t=function(){}){let r=!1;const o=new Proxy(t,{get(f,i){if(B(r),i===k)return()=>{ce(o),K(e),r=!0};if(i==="then"){if(n.length===0)return{then:()=>o};const c=v(e,{type:"GET",path:n.map(u=>u.toString())}).then(A);return c.then.bind(c)}return U(e,[...n,i])},set(f,i,c){B(r);const[u,_]=I(c);return v(e,{type:"SET",path:[...n,i].map(l=>l.toString()),value:u},_).then(A)},apply(f,i,c){B(r);const u=n[n.length-1];if(u===h)return v(e,{type:"ENDPOINT"}).then(A);if(u==="bind")return U(e,n.slice(0,-1));const[_,l]=X(c);return v(e,{type:"APPLY",path:n.map(b=>b.toString()),argumentList:_},l).then(A)},construct(f,i){B(r);const[c,u]=X(i);return v(e,{type:"CONSTRUCT",path:n.map(_=>_.toString()),argumentList:c},u).then(A)}});return ae(o,e),o}function _e(e){return Array.prototype.concat.apply([],e)}function X(e){const n=e.map(I);return[n.map(t=>t[0]),_e(n.map(t=>t[1]))]}const Q=new WeakMap;function ue(e,n){return Q.set(e,n),e}function fe(e){return Object.assign(e,{[p]:!0})}function I(e){for(const[n,t]of G)if(t.canHandle(e)){const[r,o]=t.serialize(e);return[{type:"HANDLER",name:n,value:r},o]}return[{type:"RAW",value:e},Q.get(e)||[]]}function A(e){switch(e.type){case"HANDLER":return G.get(e.name).deserialize(e.value);case"RAW":return e.value}}function v(e,n,t){return new Promise(r=>{const o=de();e.addEventListener("message",function f(i){!i.data||!i.data.id||i.data.id!==o||(e.removeEventListener("message",f),r(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:o},n),t)})}function de(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let s;const m=new Array(128).fill(void 0);m.push(void 0,null,!0,!1);function a(e){return m[e]}let T=m.length;function le(e){e<132||(m[e]=T,T=e)}function S(e){const n=a(e);return le(e),n}let x=0,O=null;function M(){return(O===null||O.byteLength===0)&&(O=new Uint8Array(s.memory.buffer)),O}const W=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ge=typeof W.encodeInto=="function"?function(e,n){return W.encodeInto(e,n)}:function(e,n){const t=W.encode(e);return n.set(t),{read:e.length,written:t.length}};function H(e,n,t){if(t===void 0){const c=W.encode(e),u=n(c.length,1)>>>0;return M().subarray(u,u+c.length).set(c),x=c.length,u}let r=e.length,o=n(r,1)>>>0;const f=M();let i=0;for(;i<r;i++){const c=e.charCodeAt(i);if(c>127)break;f[o+i]=c}if(i!==r){i!==0&&(e=e.slice(i)),o=t(o,r,r=i+e.length*3,1)>>>0;const c=M().subarray(o+i,o+r),u=ge(e,c);i+=u.written,o=t(o,r,i,1)>>>0}return x=i,o}function R(e){return e==null}let L=null;function d(){return(L===null||L.byteLength===0)&&(L=new Int32Array(s.memory.buffer)),L}let F=null;function Z(){return(F===null||F.byteLength===0)&&(F=new Float64Array(s.memory.buffer)),F}const q=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&q.decode();function y(e,n){return e=e>>>0,q.decode(M().subarray(e,e+n))}function g(e){T===m.length&&m.push(m.length+1);const n=T;return T=m[n],m[n]=e,n}function V(e){const n=typeof e;if(n=="number"||n=="boolean"||e==null)return`${e}`;if(n=="string")return`"${e}"`;if(n=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(n=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let f="[";o>0&&(f+=V(e[0]));for(let i=1;i<o;i++)f+=", "+V(e[i]);return f+="]",f}const t=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(t.length>1)r=t[1];else return toString.call(e);if(r=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:r}function be(e,n){const t=n(e.length*1,1)>>>0;return M().set(e,t/1),x=e.length,t}function we(e,n){return e=e>>>0,Z().subarray(e/8,e/8+n)}function E(e,n){try{return e.apply(this,n)}catch(t){s.__wbindgen_exn_store(g(t))}}const ye=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>s.__wbg_mapmodel_free(e>>>0));class ee{__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,ye.unregister(this),n}free(){const n=this.__destroy_into_raw();s.__wbg_mapmodel_free(n)}constructor(n,t,r){try{const c=s.__wbindgen_add_to_stack_pointer(-16),u=be(n,s.__wbindgen_malloc),_=x;s.mapmodel_new(c,u,_,t,R(r)?0:g(r));var o=d()[c/4+0],f=d()[c/4+1],i=d()[c/4+2];if(i)throw S(f);return this.__wbg_ptr=o>>>0,this}finally{s.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let n,t;try{const _=s.__wbindgen_add_to_stack_pointer(-16);s.mapmodel_renderDebug(_,this.__wbg_ptr);var r=d()[_/4+0],o=d()[_/4+1],f=d()[_/4+2],i=d()[_/4+3],c=r,u=o;if(i)throw c=0,u=0,S(f);return n=c,t=u,y(c,u)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(n,t,1)}}getInvertedBoundary(){let n,t;try{const _=s.__wbindgen_add_to_stack_pointer(-16);s.mapmodel_getInvertedBoundary(_,this.__wbg_ptr);var r=d()[_/4+0],o=d()[_/4+1],f=d()[_/4+2],i=d()[_/4+3],c=r,u=o;if(i)throw c=0,u=0,S(f);return n=c,t=u,y(c,u)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(n,t,1)}}getBounds(){try{const o=s.__wbindgen_add_to_stack_pointer(-16);s.mapmodel_getBounds(o,this.__wbg_ptr);var n=d()[o/4+0],t=d()[o/4+1],r=we(n,t).slice();return s.__wbindgen_free(n,t*8,8),r}finally{s.__wbindgen_add_to_stack_pointer(16)}}isochrone(n){let t,r;try{const l=s.__wbindgen_add_to_stack_pointer(-16);s.mapmodel_isochrone(l,this.__wbg_ptr,g(n));var o=d()[l/4+0],f=d()[l/4+1],i=d()[l/4+2],c=d()[l/4+3],u=o,_=f;if(c)throw u=0,_=0,S(i);return t=u,r=_,y(u,_)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(t,r,1)}}route(n){let t,r;try{const l=s.__wbindgen_add_to_stack_pointer(-16);s.mapmodel_route(l,this.__wbg_ptr,g(n));var o=d()[l/4+0],f=d()[l/4+1],i=d()[l/4+2],c=d()[l/4+3],u=o,_=f;if(c)throw u=0,_=0,S(i);return t=u,r=_,y(u,_)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(t,r,1)}}score(n,t){let r,o;try{const b=s.__wbindgen_add_to_stack_pointer(-16);s.mapmodel_score(b,this.__wbg_ptr,g(n),R(t)?0:g(t));var f=d()[b/4+0],i=d()[b/4+1],c=d()[b/4+2],u=d()[b/4+3],_=f,l=i;if(u)throw _=0,l=0,S(c);return r=_,o=l,y(_,l)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(r,o,1)}}}async function he(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function me(){const e={};return e.wbg={},e.wbg.__wbindgen_object_drop_ref=function(n){S(n)},e.wbg.__wbindgen_string_get=function(n,t){const r=a(t),o=typeof r=="string"?r:void 0;var f=R(o)?0:H(o,s.__wbindgen_malloc,s.__wbindgen_realloc),i=x;d()[n/4+1]=i,d()[n/4+0]=f},e.wbg.__wbindgen_boolean_get=function(n){const t=a(n);return typeof t=="boolean"?t?1:0:2},e.wbg.__wbindgen_is_object=function(n){const t=a(n);return typeof t=="object"&&t!==null},e.wbg.__wbindgen_is_undefined=function(n){return a(n)===void 0},e.wbg.__wbindgen_in=function(n,t){return a(n)in a(t)},e.wbg.__wbindgen_number_get=function(n,t){const r=a(t),o=typeof r=="number"?r:void 0;Z()[n/8+1]=R(o)?0:o,d()[n/4+0]=!R(o)},e.wbg.__wbindgen_error_new=function(n,t){const r=new Error(y(n,t));return g(r)},e.wbg.__wbindgen_string_new=function(n,t){const r=y(n,t);return g(r)},e.wbg.__wbindgen_jsval_loose_eq=function(n,t){return a(n)==a(t)},e.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(n,t){const r=a(n)[a(t)];return g(r)},e.wbg.__wbindgen_object_clone_ref=function(n){const t=a(n);return g(t)},e.wbg.__wbg_debug_34c9290896ec9856=function(n){console.debug(a(n))},e.wbg.__wbg_error_e60eff06f24ab7a4=function(n){console.error(a(n))},e.wbg.__wbg_info_d7d58472d0bab115=function(n){console.info(a(n))},e.wbg.__wbg_log_a4530b4fe289336f=function(n){console.log(a(n))},e.wbg.__wbg_warn_f260f49434e45e62=function(n){console.warn(a(n))},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return g(n)},e.wbg.__wbg_stack_658279fe44541cf6=function(n,t){const r=a(t).stack,o=H(r,s.__wbindgen_malloc,s.__wbindgen_realloc),f=x;d()[n/4+1]=f,d()[n/4+0]=o},e.wbg.__wbg_error_f851667af71bcfc6=function(n,t){let r,o;try{r=n,o=t,console.error(y(n,t))}finally{s.__wbindgen_free(r,o,1)}},e.wbg.__wbg_performance_a1b8bde2ee512264=function(n){const t=a(n).performance;return g(t)},e.wbg.__wbg_now_abd80e969af37148=function(n){return a(n).now()},e.wbg.__wbg_get_bd8e338fbd5f5cc8=function(n,t){const r=a(n)[t>>>0];return g(r)},e.wbg.__wbg_length_cd7af8117672b8b8=function(n){return a(n).length},e.wbg.__wbindgen_is_function=function(n){return typeof a(n)=="function"},e.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(n,t){const r=new Function(y(n,t));return g(r)},e.wbg.__wbg_next_40fc327bfc8770e6=function(n){const t=a(n).next;return g(t)},e.wbg.__wbg_next_196c84450b364254=function(){return E(function(n){const t=a(n).next();return g(t)},arguments)},e.wbg.__wbg_done_298b57d23c0fc80c=function(n){return a(n).done},e.wbg.__wbg_value_d93c65011f51a456=function(n){const t=a(n).value;return g(t)},e.wbg.__wbg_iterator_2cee6dadfd956dfa=function(){return g(Symbol.iterator)},e.wbg.__wbg_get_e3c254076557e348=function(){return E(function(n,t){const r=Reflect.get(a(n),a(t));return g(r)},arguments)},e.wbg.__wbg_call_27c0f87801dedf93=function(){return E(function(n,t){const r=a(n).call(a(t));return g(r)},arguments)},e.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return E(function(){const n=self.self;return g(n)},arguments)},e.wbg.__wbg_window_c6fb939a7f436783=function(){return E(function(){const n=window.window;return g(n)},arguments)},e.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return E(function(){const n=globalThis.globalThis;return g(n)},arguments)},e.wbg.__wbg_global_207b558942527489=function(){return E(function(){const n=global.global;return g(n)},arguments)},e.wbg.__wbg_isArray_2ab64d95e09ea0ae=function(n){return Array.isArray(a(n))},e.wbg.__wbg_instanceof_ArrayBuffer_836825be07d4c9d2=function(n){let t;try{t=a(n)instanceof ArrayBuffer}catch{t=!1}return t},e.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return E(function(n,t,r){const o=a(n).call(a(t),a(r));return g(o)},arguments)},e.wbg.__wbg_buffer_12d079cc21e14bdb=function(n){const t=a(n).buffer;return g(t)},e.wbg.__wbg_new_63b92bc8671ed464=function(n){const t=new Uint8Array(a(n));return g(t)},e.wbg.__wbg_set_a47bac70306a19a7=function(n,t,r){a(n).set(a(t),r>>>0)},e.wbg.__wbg_length_c20a40f15020d68a=function(n){return a(n).length},e.wbg.__wbg_instanceof_Uint8Array_2b3bbecd033d19f6=function(n){let t;try{t=a(n)instanceof Uint8Array}catch{t=!1}return t},e.wbg.__wbindgen_debug_string=function(n,t){const r=V(a(t)),o=H(r,s.__wbindgen_malloc,s.__wbindgen_realloc),f=x;d()[n/4+1]=f,d()[n/4+0]=o},e.wbg.__wbindgen_throw=function(n,t){throw new Error(y(n,t))},e.wbg.__wbindgen_memory=function(){const n=s.memory;return g(n)},e}function pe(e,n){return s=e.exports,$.__wbindgen_wasm_module=n,F=null,L=null,O=null,s}async function $(e){if(s!==void 0)return s;typeof e>"u"&&(e="/15m/assets/backend_bg.wasm");const n=me();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:r}=await he(await e,n);return pe(t,r)}class Ee{constructor(){ne(this,"inner");this.inner=null}async loadOsmFile(n,t){await $(),this.inner=new ee(n,!0,t)}async loadGraphFile(n){await $(),this.inner=new ee(n,!1,void 0)}isLoaded(){return this.inner!=null}unset(){this.inner=null}getBounds(){if(!this.inner)throw new Error("Backend used without a file loaded");return Array.from(this.inner.getBounds())}getInvertedBoundary(){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.renderDebug())}isochrone(n){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.isochrone({x:n.start.lng,y:n.start.lat,mode:n.mode,contours:n.contours,start_time:n.startTime}))}route(n){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.route({x1:n.start.lng,y1:n.start.lat,x2:n.end[0],y2:n.end[1],mode:n.mode,debug_search:n.debugSearch,use_heuristic:n.useHeuristic,start_time:n.startTime}))}score(n,t){if(!this.inner)throw new Error("Backend used without a file loaded");return JSON.parse(this.inner.score({poi_kinds:n.poiKinds},t))}}D(Ee)})();
